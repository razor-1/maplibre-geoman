(function(te,Ur){typeof exports=="object"&&typeof module<"u"?Ur(exports,require("maplibre-gl")):typeof define=="function"&&define.amd?define(["exports","maplibre-gl"],Ur):(te=typeof globalThis<"u"?globalThis:te||self,Ur(te.Geoman={},te.maplibregl))})(this,(function(te,Ur){"use strict";const am="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mLYpUHOwgopChOtlFRRxrFYpQIdQKrTqYXPoHTRqSFBdHwbXg4M9i1cHFWVcHV0EQ/AFxdnBSdJESv0sKLWK847iH97735e47QGhWmWaFEoCm22YmlRRz+VWx5xUhmmGMIi4zy5iTpDR8x9c9Any/i/Ms/7o/R79asBgQEIkTzDBt4g3imU3b4LxPHGVlWSU+J54w6YLEj1xXPH7jXHJZ4JlRM5uZJ44Si6UuVrqYlU2NeJo4pmo65Qs5j1XOW5y1ap2178lfGCnoK8tcpzWCFBaxBAkiFNRRQRU24rTrpFjI0HnSxz/s+iVyKeSqgJFjATVokF0/+B/87q1VnJr0kiJJIPziOB9jQM8u0Go4zvex47ROgOAzcKV3/LUmMPtJeqOjxY6AgW3g4rqjKXvA5Q4w9GTIpuxKQVpCsQi8n9E35YHBW6Bvzetb+xynD0CWepW+AQ4OgfESZa/7vLu3u2//1rT79wN2rHKoBaSKHQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+gEBAUlKJesuC4AABWbSURBVHja7Z3fcxTHEce/t1ohYekA2QaBDBgocGLHNmW7Kg4pV9l5SeUleci/4b9H/0aeU3mJXXEF5yEmEOw4hgKFH7JBtpEQwhLS3eVhunV9w+7tHWh3e2Z7q64OyZJ18+Mz3+7pme4W7Bn6tBdXWwD4lYj3FMA0gCkAswCOAJihrw8AOAfgdwDOAmgDmKDf3YunB6ADYB3AdQB/BnANwEMAWwA2ANwH8Ii+3gSwA6BLv8vvvfWPD/VslPOflnVBLhQQYKQCiEl6zQCYB/AigGMA3gBwGMB+guQQgFfpfZKg2sunC2AbwCqA/9H7FoCfAKwA+ArAtwB+BHCPoNmmFwOzw6AAgMFigIyrFhMChgMERJu+PkJQHCNI5un7qfi9F+i9VUJf88TeBvCY3js06TcIih8Jkq9IUTZIde6R2myI3zNVMUBGAiOlST1NrwMAjgM4BeAtAUKbIJklxZim35WAJSXB4UPSlROcINkkRXlEcKwLcP4NYAnAHQJlk17bUlUMlIYDkgHGPpr8BwEcJWVYAPA2AXKcwGAza0ooRiL6s1Vx//Yy3rtCUbaEebVOYCwBuAJgmZTmOwBrBNETA6XBgAwBYw7ACYLhbYLjRYLlIP3MpOest2oAYhxgep5zvk0QrBEUPxIkVwia2wAeGCgNBGQEME4DeIcAOUHm1bRwztMaVWIv1WVHOOubZGbdJkAuAbhpoDQIELErlRSAcZq+nhNqMeEpReh91vOUpSNU5QGBcbMAlG5Tdr1aDYGjRROdYxZFYOzzHO4Y+8o3w3YIgCJQOLbSaYKatBoAR0JKsB/Ay2Q+nRkRjKaYoL0RQblBZtj3cPGWbQDdmCFpRQyGVI0DcFuybwL4FVx0+6SBMRYot+Ci9p8DuAq3dfwwdjVpRQxHCheoO0xKcY7geJNgaRsYY4GyTlBcJUiukbKswAUqd2KEpBUhHBM06WfgotznAVwgQE6TmbWffiYxMEYCpUsA/ETm1U0C5CKAy3DR+g36mU5MkLQiAsM3qeYJjg/pfZ6+P4X+wUEDYzxQOmRSPYSLyF8G8Cm934vR5GpFBEeWSXWB4DiGwXNSMDieCRJg8LzXtwTHxVhNrlZEcMzCRb59k+owgZOaauypmuwQCCsZJtcy3HZw8JCkEcHxCoB3AXxkJlUli2oqVHmGFqIZsRDdZUjai6vBBhXTwOHgo+gMx2/ofcEzqQyMvYfEP7YzhcGjOCBINgBshwpJGigciYBjwYPjFQFHYnCUDgovQKzi/rMsIAkuqJgGCscU+kfSz5NZxXDMmr9ROSS8YPmQsLrwUfqt0CBpBQrHS+SE/xzArwmSBYNDjfP+iJTjMoC/A/ianPgf4LaBg4GkFRAcLbjI9xyA1wH8Fu6G31m4yLjtVOmC5DFc5P063A3GvwD4D9yxlScIZHcrCQgO9jmOknK8Re9Hvd0Tg6N+5z0tGKtJAC1xDcEAeU44UuGQnyez6iz6x0ZsG1cfJBPon6A+65nCuwuadkiSQODIinMcMTiCgeTIsM0UzZCkyjvZh0PGOV4wOILwbydorBbQP67Cz24wMeO/GSAF6iE71o9z2G5VWJDIhc536u8A2Ggvrqp02lPFcEzBHV+wOEeckPBu1xYrSHtxVd1R+UQhHGxaHYA7bHghy7kzOIL0SfzNlgs0xge0+iOpwo7kTpyHCwaew2BaT4MjfCXxx3eFlKSrzR9RoyCe33EsZ4Wxs1XhQ5LkWAjHeONFk4okiuBIPL+DbwIexuCRdXvCh2SiYKwTLZAkSuDgSHnuqmJwRAlJnrWgJtKuxcSSAaU8v8Oe+CDJ8kdkALjZCuKZVi+jn7dqYGcDcWY19EsX5L3kz8YGiL9jyWmZXtZiaqVKVpFZuIyHfgfFYlrllSfojdFPdZZXqMIf4QVyDS5Dyjr6JRt6jQMk4wj7GfSPrquR2D2Cwi9BwAEyruxUpPI8ieROntbSC89rYp+luXAHlGurvbjaqiuAmNa8erANegIuV+5JuIyHIZtWWdnT/SI2G/DS4xT0Eacz4qPiecV7QuwzGR9p0xx4By5TCt8dqU1FagEkQz1O02uOvhdivMNP18n1N7LKoN2HuzwkA2S9HLOKt0NfR7+Sblb5t0mEm0aV2+rPh9t1q0haY4f46nEi0F2rvITPsoJTViHNFfTTdfZG6KcryC8gKitghZpvOGtO1K4ilQMygnqEMqhFJQOWMFgD0C/FvAWvDPOQnZ4HBJQsQX0VT9dQDLmUQ968qFVFUiUrRWjqIZ3tvFoaS/S1rCK74znrow42A8WmyAO4JNJchfc6ATKs5kkSCCSqVKRSQCJQDz+J8yMUly3z65Dv7nCNuhpSv3VF32yLv79GCnWL/nZW1Sz2VbRfMFOnIqmCFSIU9cjKSbsEV3WpsPDlOED4j/i9ngcM1xfMUjEG5Qypi8xRDOWQqFGRyjpJRM33w12a+RDAH+HO4cyhX15Zs0nVwWDOp4tk3txCTRVhCyr3noSLK8g7NbN4uq67tofLVT+gfv4TXJmFu3A1SirLq1W1giRkNx8lxzIE9fDriy8D+ALAJzR4XIqsllLJ9Hd6BMq25xc9FDtn/Nn44tmkYkh8FXkbwH8hEs/FaGLxsYJpsfuye3JT6UCxv8G1xLlozCcEyTKZW9vsY9QV8c0AhQOUm56pt4N+5vtp6DzO45/wXqA5M00K3qnKzKoEkIwj7bLBE8rh4AyBN5BdA6MDRak0BShyQ+GugGMD7tTsGfQzUmqFJGtBXYNLhF2Js55W2FiWzOMkmUep8YlSOLq0+t4H8E8AnwH4BoFUUVr/+FCvvbjKO2eP4M42bdFnfw3ABwDeo3HYr9Tc8k3ya7RjV5mzXvrkzEjEcIpeB5WaV9LneEjK8RmAfwD4EoMFK1Xnl2U1wWDJtC+pLZ9R2x5KE1GpmXVQzJtKEzykFa8E83B5Wo8rdc6lWbJBPsc1Uo5lAKu0CgdTyTXD5OLP/Q21ja+5tqHvZLBvebwFd4btB1KRbhUTt8qVoE2QtBWrh5++/yKZVWuhwZEBCgc416hNmTUFlapILXOnKvtfVoSSW4xanXJ/K3clZDhyIFlB9o5cB/puL9Y2f0r9IxnZ2Y8oVQ/2O4ZOnBjqfgtIhi0EmvwRX0WOoMLs8GlFELL/8QY1cEqZgkjTaikA02OvTcmsBWxS0QLG92L4mP9VuMOapQcNkwro5+uiL8LdX9CWW5cd1ydwRxtuwB0fuS9NjhjUI2N3S8Z5rlPbdytAKVkU/DIYfAemkpwFpQGSUd+j0oY9w2q6AXfQ7xLc2ard7c+Y4PAgkdvZt6jtuydnlZlZuQttmWZW2QriS+M8dAUHffW4icGTo1HCkQFJXvs1pRuqxVSvwsRi+/Yw9CWgzlIPjSto0/ugVTCXggSEG8WX8aehKzBYpB69mNUjwx8JQUUYkmkMJvcI1sSqvEGmHtGrSKULbimAZMQ/KpPEMdVjGy6qvESvRqnHEBXh/lhD/1CgFkgy51RZjnpSMnwyp9Nh6Ip/8Gnd7+CyjzRVPfJU5Ar1zSYqvKCkbU6V7YNwinttDro8cvEjXLCMt3UbpR4ZKsLbvpyuiFOk1t0nWVZJ6XdZkhIbw///FP00mZrMK44kf0sTYRM6zyHVsXBsop/wTp4k0GRmyVzFKGtuVXWaV5NzzubVFlwE+Su4Y+2aTAkNpuc99LNBbinqmxaeznYflpM+RFG0rJJsSqzDS2rQRPMqw8xiX4TzCWty1CudU0lD54LMUsLJ3Uw9rH8aD0hIK6RKhW1aHzVRQeS9D78EgT3WR40HRB7zXjH/o9AP4Qwujdzha6KJxSskV31qamBwlL6SfdT1+tAAacAE6JrvUeiLdJvcP4lNAnusjwwQe+wxQOyxxwCxp+qnZYDY4NuT3TeVnXkyQHROAG2HKLX1T2WnZg0QXYqh8Ri+iifnNqjWGiIGSEmQZF7kqiKdfkDzQvNtUAPEBl+FeaU1XVN0gGhLhKw9mbYW51xjuqZK51RSUUO0HekIoRyDBgXRmq6psiMwScl0azwUWGs6/QAddG2VwCo9RJmU3JDMY+UKQNGeM7juvtFYrqKWY/hlNlrrpZu8rPOaS1JX2Tey9LK2chWVz6lSAMm5dKMtjaVMp881uCebamYNqWWvqVxF7pwq67JbUlGDNtGvSqrFWfdrcJ+Azsq7VTvmM9QX2mrZS+f8Cc2p0hfcJLYGPYOjLmtwz9GuTaNURKjHPuoD7g9ttewrX3CrUpANhY66v2K+02AV0d4XtZnsZQOiOTuGv2qeplejVCRDPZ7qByWLRS1zqTRAAsnSZyoSRh/Ulg0zqYh8rVn6ilbPJGYVobYlAahHbfMoqZN8xSpyEv1t3yghEXDwtu5J5epRiyVSlYJoztLnq8gZAGfhIsi79yBigkT4HXzs/wi1+Yxi9ahlDpUKSEDZwmVk/RSACwDOwwXLZiP0R2R7F6itF6jt2tpbazb+pMIVQHO2cDY3+J7IeQAfAXiXJtALACZiUBFqAyvHArXxI2qzvBujqa21zZ+0xhVgjuzfnpLB8CeOVL/d08jtxdVOqDl8BRxDFwKF6lGbBVKlgoRQ0SnP9DgNF1WeClVJPDgOUptCMCVrrXhVuoKsf3yo115czasJOKtsxeLPMUE7OfMAzgF4Da48MuBKI2+1F1c7CCAjvOeQMxwL1KZz1MYZMQ7aqoHl1kysou+TihuaWVUW+kp7ye3PMwA+APA+gF/AHQEP4oJVxgWoY9SG96lNZyC2s6G3VF5tVXerPKXp1yW/A711yRmSabgt0PcA/B7AHwD8EsBxYZKojJOIOAebjMfps/+B2vIetW0aOpPDSd/jDmqq216Fky7NrG0yUZbo9aqYaD1lgySd9qPIrve+DHerbbu9uNrVYHIJ1WAVzNqtmifl0HpJTKqHnC9rqLiWfVrzivAzAC9Bb9odhmQ/nk40x6bLfTIBngDYoYWgclAEGPy59hEERzJ2q2aUmlXqLI7KAPFURNqUGp31PJ+kDeAVz66/DuAWOfEbVYOSA8YM3Db6SbgIub9bNaEcDt85H/BZq1x80pobzrsSh6ArJpIHSUvY85z04QaASwBuAridBwovEnsIBYaAcQJuG/cdcsRPoZ9CVHsCuDznfBM11ElMa+gAua/9Je2qvAz92Q1bos/YD2kTLKcJkCxQtmlguwQLxgXGA0ICO4F+fi8fjNP09RxBLe+Wa47jqHDOawEksJhIHiS+E+xPTgZliUB5SO3jK8d8TVQCM46C8c7UNL0O0N8+lQHGDClLijDKGKhxzutUkDz78qByMyvPL8kzb5Zo9WMT4Z5QlG0MJtPrFQDJGwSTAsp59DOyvE2AZIHRQlhpVVWFA1IlnXCWBnsf+kkCEAAkLRq0LFBepV069rX4mMQG3HmiUe5V+1kO2+jnFH4D/ZxeR2mBCRkMVc55bYAMiYmcFLZ9L6CBzQNlFm4Le4vMybcIDD50599r6OWolMxEz2lSOWUq+xbT4m+HCIY657xuBZGO2G2y2eVVz8kABzgLlCka3IO0EcHm1QaZRY9HVBAZpGQzi2Mycss25Az1/pyo1TmvFRChIk9ot+cmvU4EqiJ5oMidpin084TN0YTvjDD4/P+Y8pxtP+N6yHdVWD14PtTunNetILGqiA8KPFh4kCUw4+5iIRIoiubCbSg4q1db3EFcx/VV5AF9T9sp371QlUS8UmGKDXtNCuVIEF/h0cJ5UOf5tlThyhGTihSpC2BVrdSqR60K0kAVsScw9agdkBBWEHuaPfa1A2IqYuqhVT20KIipiKmH2jFXAYipiKmHRvXQpCCmIqYeKsdaDSCmIqYe2tRDm4KYiph6qBtjVYCMoCJdgyR4OLqhqIdGBclbYW7BHRXXVFfEnmczrXZoLG+FYCGoAyRDRW7AZQ65D+AnuBOw9oT5dGgM79OY3tCsHkD9Z7GKVOQR3LHnz9G/Mcf5nEK4Y23PoGm1BeB7AFdpTJcgcu1q/OAqs4jQShJkh9oz8oJ3lcZ2C0BXaxLwRHnHDpNkc9jDdMyDMpnVAuKVb5NOnTns4TvmA2OouYSEagURppY57HE65l3t9VXSADrYHHZzzE1BnsFhvwm9RXjsCdgxDwqQHKm+Ri8ztcwxN0CEw85JxW5mrUimIuaYN1ZBLDZijrkBsgedb5DUrh6dmBaxoAApiI2Yw67HtMo1g0NSjyAVpCA2UpTr1p5yAeFT2Pdi2UhJAx8M3kK8iH5cZIL+HVP2wVBMq8dwpR4u05gMbMWHph6h+iC+w75CA/IpvQ8rKWBPOXAUjkWIcAQLiICkcNUySCrxO+T2+0Uai29pbDqhwhE0IDHbvYE9WQFcLjcXvD8YNCDerpYFEOszrbKOAAUVEIxVQaSpZWe16jWt/IWpEzocUQBSIPVmall/GyAjntWqrRBkhOpRqNgxqEdUCjLCsXi7gbh3plVU0fJhTxrhIGZJ/2G4moBc+swCiM8OSKN2DWPyQfJMraf25U1Fnsu0ii5a3hhAMkytvMiuQfLsfkd00fJGASIgGbbamT/yfH5HVNHypvkgRfay+SN704/RRMsbpyCeP7Jj/khpfkcU0fJGAuKZWuaPlON3dGKGI3pAzB8xv8N8EPNHzO8wBTF/xPwOA8T8EfM7DJAA/JGm3h/hAGvj/Y7GAjKifd1poNPeE+rReL+j0YAU+CPLaGaWRpklZrnpfkfTFSTPH/kEwBc0QZrktEuzc5n64JMm+x3ySdHQZ/3jQ7324qqcGJxHK4Xb+uVt3wnEu/070kLRVDgaDUiOaZHCJZ07TO8MSYwFeoY55U01Nc3EyvFHRnFOe5HBMdJmRZPVo/GACEiGraSxQeLDkeeUd5sOhwEymtN+NzJzQ5qVd80pNx/keZx2floAjiP8pNhZO1Z/NafcAHnW1ZXhiGFnq0kqaSZWyU57oX0e2EQa2c8y9TBAxoUk9J2tkdtjcBgg40ASw86W7VgZIKVCMqrN3lMOh+1YmZNeDiRDdrYA4BUAs6IfW8rhsB0rA6SUyebvbOVB0lL6mSUctmNlgOy5imAIJNpiJMNiHQNwmHoYIGVDoi1GMrLfZHCYk16G0645RmKxDgNEHSRaYiQW6zBAVEGiKUZisQ4DRCUkGmIkFuswJ121415njMRiHQaI+mecGMleQlIEh8U6DBA1KoKKIRkLDlMPA6RJkBgcBohBYnAYIAbJeJAYHAaIQWJwGCAGyXiQGBwGiEGSA4nBYYAYJDmQGBwGiEGSAwkMDgPEIBkOicFhgBgkGZDM0L83DA4DxCDpP1xi4Sh9/R2ASwaHAdJkSPjuRgJgEv167QBwFcDfAPwLdhuw1sfug9QAiXDCH8Pd+Psa7v7GHXpdpu/do58xOGp6/g9eQPkxBqxc0wAAAABJRU5ErkJggg==";let jo;try{jo="free"}catch{jo=process.env.VITE_GEOMAN_VERSION||null}const it="gm",ae=`_${it}`,st=jo==="pro",pc={draw:{marker:{type:"draw",eventType:"toggle",targetMode:"marker",settings:{exclusive:!0}},circle_marker:{type:"draw",eventType:"toggle",targetMode:"circle_marker",settings:{exclusive:!0}},text_marker:{type:"draw",eventType:"toggle",targetMode:"text_marker",settings:{exclusive:!0}},circle:{type:"draw",eventType:"toggle",targetMode:"circle",settings:{exclusive:!0}},ellipse:{type:"draw",eventType:"toggle",targetMode:"ellipse",settings:{exclusive:!0}},line:{type:"draw",eventType:"toggle",targetMode:"line",settings:{exclusive:!0}},rectangle:{type:"draw",eventType:"toggle",targetMode:"rectangle",settings:{exclusive:!0}},polygon:{type:"draw",eventType:"toggle",targetMode:"polygon",settings:{exclusive:!0}},freehand:{type:"draw",eventType:"toggle",targetMode:"freehand",settings:{exclusive:!0}},custom_shape:{type:"draw",eventType:"toggle",targetMode:"custom_shape",settings:{exclusive:!0}}},edit:{drag:{type:"edit",eventType:"toggle",targetMode:"drag",settings:{exclusive:!0}},change:{type:"edit",eventType:"toggle",targetMode:"change",settings:{exclusive:!0}},rotate:{type:"edit",eventType:"toggle",targetMode:"rotate",settings:{exclusive:!0}},scale:{type:"edit",eventType:"toggle",targetMode:"scale",settings:{exclusive:!0}},copy:{type:"edit",eventType:"toggle",targetMode:"copy",settings:{exclusive:!0}},cut:{type:"edit",eventType:"toggle",targetMode:"cut",settings:{exclusive:!0}},split:{type:"edit",eventType:"toggle",targetMode:"split",settings:{exclusive:!0}},union:{type:"edit",eventType:"toggle",targetMode:"union",settings:{exclusive:!0}},difference:{type:"edit",eventType:"toggle",targetMode:"difference",settings:{exclusive:!0}},line_simplification:{type:"edit",eventType:"toggle",targetMode:"line_simplification",settings:{exclusive:!0}},lasso:{type:"edit",eventType:"toggle",targetMode:"lasso",settings:{exclusive:!0}},delete:{type:"edit",eventType:"toggle",targetMode:"delete",settings:{exclusive:!0}}},helper:{shape_markers:{type:"helper",eventType:"toggle",targetMode:"shape_markers",settings:{exclusive:!1,enabledBy:["drag","change","rotate","scale","line_simplification"]}},snapping:{type:"helper",eventType:"toggle",targetMode:"snapping",settings:{exclusive:!1}},pin:{type:"helper",eventType:"toggle",targetMode:"pin",settings:{exclusive:!1}},snap_guides:{type:"helper",eventType:"toggle",targetMode:"snap_guides",settings:{exclusive:!1}},measurements:{type:"helper",eventType:"toggle",targetMode:"measurements",settings:{exclusive:!1}},auto_trace:{type:"helper",eventType:"toggle",targetMode:"auto_trace",settings:{exclusive:!1}},geofencing:{type:"helper",eventType:"toggle",targetMode:"geofencing",settings:{exclusive:!1}},zoom_to_features:{type:"helper",eventType:"click",targetMode:"zoom_to_features",settings:{exclusive:!1}},click_to_edit:{type:"helper",eventType:"toggle",targetMode:"click_to_edit",settings:{exclusive:!1}}}},om=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m22.775 29.562 6.75-6.75-5.625-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.626-5.55-6.75 6.75zm25.95 26.101 6.75-6.825-5.624-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.55-5.55-6.75 6.75zm.6-46.126 5.25 5.25ZM16.7 59.039H5v-11.7l14.55-14.551L2 15.237l13.05-13.2 17.7 17.624L46.1 6.312q.676-.676 1.5-.976.826-.3 1.65-.3.826 0 1.65.3.826.3 1.5.976l5.326 5.325q.675.675.975 1.5.3.825.3 1.65t-.3 1.65q-.3.825-.975 1.5l-13.35 13.35L62 48.913l-13.125 13.05-17.551-17.55Zm-7.2-4.5h5.25l29.476-29.552-5.25-5.25L9.5 49.288Zm32.1-32.178-2.625-2.625 5.25 5.25Z"/>
</svg>`,mc=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" stroke-width="7"/>
    <circle cx="32" cy="32" r="5" fill="currentColor"/>
</svg>`,vt={marker:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M32 62.81s23.107-21.898 23.107-38.512a23.107 23.107 0 0 0-46.214 0C8.893 40.912 32 62.809 32 62.809m0-26.958a11.554 11.554 0 1 1 0-23.107 11.554 11.554 0 0 1 0 23.107"/>
</svg>
`,circle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" stroke-width="7"/>
    <path stroke="currentColor" stroke-dasharray="3" stroke-width="4" d="M6 32h52M32 6v52"/>
</svg>`,ellipse:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 64 64"
   version="1.1"
   id="svg2"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs2" />
  <path
     fill="none"
     d="M 0,0 H 24 V 24 H 0 Z"
     id="path1"
     style="display:inline" />
  <ellipse
     cx="32"
     cy="32"
     fill="currentColor"
     fill-opacity="0.15"
     stroke="currentColor"
     stroke-width="7"
     id="circle1"
     rx="26.787416"
     ry="15.158148" />
  <path
     stroke="currentColor"
     stroke-dasharray="3"
     stroke-width="4"
     d="M 6.4966994,32 H 58 M 32,18.552705 v 30.15073"
     id="path2"
     style="stroke-width:3;stroke-dasharray:3;stroke-dashoffset:0" />
</svg>
`,circle_marker:mc,text_marker:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <path fill="currentColor"
          d="M6.962 3.385h50.076a3.577 3.577 0 0 1 3.577 3.577v50.076a3.577 3.577 0 0 1-3.577 3.577H6.962a3.577 3.577 0 0 1-3.577-3.577V6.962a3.577 3.577 0 0 1 3.577-3.577Zm3.577 7.154v42.922h42.922V10.539Zm7.154 7.154h28.614v7.153H17.693Zm0 14.307h28.614v7.154H17.693Z"/>
</svg>
`,line:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <line x1="8" y1="50" x2="24" y2="20" stroke="currentColor" stroke-width="8"/>
    <line x1="24" y1="20" x2="40" y2="54" stroke="currentColor" stroke-width="8"/>
    <line x1="40" y1="54" x2="54" y2="10" stroke="currentColor" stroke-width="8"/>
    <circle cx="8" cy="50" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="24" cy="20" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,rectangle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Rectangle -->
    <polygon points="10,10 54,10 54,54 10,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="10" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="10" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,polygon:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Polygon -->
    <polygon points="8,28 40,6 55,35 51,55 18,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="9" cy="28" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="8" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="55" cy="35" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="50" cy="55" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="18" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,freehand:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M44.698 2.661a1.644 1.644 0 0 1 2.328 0l9.866 9.866a1.644 1.644 0 0 1 0 2.329L24.004 47.744a1.644 1.644 0 0 1-.552.362L7.008 54.683a1.644 1.644 0 0 1-2.138-2.138l6.578-16.444a1.644 1.644 0 0 1 .362-.552zm-3.089 7.742 7.542 7.541 4.252-4.252-7.541-7.541zm5.216 9.866-7.54-7.54-21.378 21.376v.964h1.644a1.644 1.644 0 0 1 1.645 1.644v1.645h1.644a1.644 1.644 0 0 1 1.645 1.644v1.644h.963zM14.724 37.29l-.35.348L9.35 50.204l12.566-5.025.349-.35a1.644 1.644 0 0 1-1.07-1.538v-1.645h-1.644a1.644 1.644 0 0 1-1.644-1.644v-1.644h-1.644a1.644 1.644 0 0 1-1.54-1.07"/>
    <path stroke="currentColor" stroke-width="5.107"
          d="M6.298 59.53c3.44-1.692 6.88-3.384 10.558-4.319s7.594-1.111 11.719-.298c4.125.814 8.459 2.617 13.483 2.655 5.023.038 10.737-1.689 16.45-3.415"/>
</svg>
`,custom_shape:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <circle cx="49.754" cy="50.219" r="10.098" fill="none" stroke="currentColor" stroke-width="5.1"/>
    <path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4.491"
          d="M44.516 26.657H17.842l6.669-11.55 6.668-11.55 6.669 11.55Z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="4.683" d="M4.481 40.605h20.761v19.093H4.481z"/>
</svg>
`,drag:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path
            fill="currentColor"
            d="M32 61.4 19.85 49.42l3.28-3.235 6.634 6.542V34.205H10.98l6.26 6.174-3.279 3.234L2.185 32l11.852-11.686 3.28 3.234-6.336 6.247h18.783V11.273l-6.261 6.174-3.28-3.234L32 2.6l11.777 11.613-3.28 3.234-6.26-6.174v18.522h18.782l-6.26-6.174 3.279-3.234L61.815 32 50.038 43.613l-3.28-3.234 6.261-6.174H34.236v18.522l6.634-6.542 3.28 3.234z"
    />
</svg>
`,change:om,rotate:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M58.709 17.724c-.3-.6-.601-.901-.902-1.502l-.3-.601c-.301-.601-.602-.902-.902-1.503l-.3-.601c-.301-.601-.602-.902-1.203-1.503l-.6-.901 8.414-9.317-13.825.3-13.824.301 1.502 13.524 1.503 13.524 9.617-10.819v.3l.3.602c.301.3.301.6.602.6l.3.602c0 .6 0 .901.3 1.202.903 2.104 1.804 4.208 2.105 6.311.6 4.208 0 8.716-1.804 12.623l-.6 1.202-.301.3-.902 1.503-.3.601c-.601.601-1.202 1.503-1.804 2.104-1.502 1.503-3.305 3.005-5.109 3.907-1.803 1.202-3.907 1.803-6.311 2.404-2.104.301-4.508.601-6.612.301-2.404-.3-4.508-.902-6.612-1.503-2.103-.901-3.907-2.104-5.71-3.606l-1.202-1.202-.601-.902-.601-.601c-.3-.3-.601-.601-.601-.902l-.902-1.202-.3-.3-.602-1.203c0-.3-.3-.3-.3-.6l-.902-1.503-.3-.601-.902-2.705q-.901-3.607-.901-7.213V27.04c0-.601 0-.901.3-1.202l.3-1.803.602-1.803c.901-2.405 2.103-4.509 3.606-6.612q2.254-3.156 5.41-5.41c.6-.3.901-1.202.3-1.803-.3-.3-.6-.601-.901-.601h-.601l-.3.3c-2.706 1.202-4.81 3.006-6.913 4.809-2.104 2.104-3.607 4.508-5.11 7.213-2.704 5.41-3.606 11.42-2.404 17.431.3 1.503.601 2.705.902 4.207l.902 2.405c.3.3.6.6.6 1.202l.602 1.202c0 .3.3.601.3.601l.902 1.503c.3.601.6.901.901 1.503l.301.6c.3.301.601.902.902 1.203l2.103 1.803c2.104 2.104 4.809 3.907 7.514 5.41q4.057 2.254 9.016 2.705c1.503.3 3.005.3 4.508.3 1.803 0 3.306 0 4.809-.3 3.005-.602 6.311-1.503 9.016-3.006l.6-.3c.602-.3.903-.601 1.504-.902l2.103-1.202c.601-.3.902-.601 1.203-.902l.6-.6a3.622 3.622 0 0 0 1.503-1.504l.3-.3c.902-.902 2.105-2.104 2.706-3.005l1.803-2.705 1.202-1.804c3.005-5.71 4.208-12.322 3.306-18.633-.601-3.306-1.503-6.612-3.005-9.317z"/>
</svg>
`,scale:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor" stroke="currentColor">
        <path d="m37.62 5.028-.337.284-4.039 4.068 3.547 3.523L39.875 9.8l2.846.596 1.025-4.893-4.176-.877Zm9.995 6.393 9.787 2.053 1.026-4.895-9.787-2.05zm14.68 3.078 9.787 2.05 1.025-4.892-9.787-2.053zm-39.623 5.522 3.547 3.523 7.049-7.094-3.547-3.523zm-10.57 10.642 3.546 3.524 7.047-7.094-3.547-3.524zM1.529 41.306l3.55 3.523 7.046-7.096-3.547-3.523Zm70.977 4.027 3.91 3.115 3.44-4.387-1.118-6.55zM.947 48.319l5.617 8.274 4.137-2.809-5.617-8.273Zm62.211 8.744 3.91 3.116 6.233-7.82-3.91-3.116zM9.373 60.73l5.62 8.272 4.134-2.809-5.617-8.271zm44.438 8.067 3.91 3.115 6.232-7.82-3.91-3.117zM17.8 73.138l5.617 8.273 4.137-2.808-5.617-8.274zm26.662 7.388 3.91 3.116 6.232-7.82-3.91-3.116zm-18.236 5.022 5.617 8.273 4.136-2.81-5.617-8.272zm8.888 6.709 3.91 3.117 6.233-7.822-3.91-3.115z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="M22.672 20.02a3.5 3.5 0 0 0-2.506 1.034L-.514 41.872a3.5 3.5 0 0 0-.412 4.434L18 74.176a3.5 3.5 0 0 0 5.633.216l33.494-42.038a3.5 3.5 0 0 0-2.018-5.605l-31.742-6.654a3.5 3.5 0 0 0-.695-.074zm1.121 7.317 24.32 5.098-26.992 33.877L6.484 44.759Z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="m78.734 7.668 2.61 11.396-18.145 4.154 2.705 11.816L84.05 30.88l2.609 11.396L100 21.011Z"
              stroke-width="3"
              transform="translate(1.586 1.586) scale(.60827)"/>
    </g>
</svg>
`,copy:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.687.926a2.173 2.173 0 0 0-.433.045c-4.075.232-7.358 3.618-7.358 7.747 0 .084.01.164.012.246l-12.987 4.261a7.842 7.842 0 0 0-6.126-3.563 2.173 2.173 0 0 0-.424-.043 2.173 2.173 0 0 0-.435.044c-4.073.232-7.358 3.618-7.358 7.747 0 3.143 1.901 5.869 4.604 7.097L8.377 35.11a2.173 2.173 0 0 0-.028.007C4.274 35.35.99 38.736.99 42.865c0 4.277 3.514 7.791 7.791 7.791 2.497 0 4.727-1.201 6.157-3.048l12.887 6.235a7.67 7.67 0 0 0-.139 1.44c0 4.277 3.515 7.791 7.792 7.791 4.278 0 7.793-3.514 7.793-7.792a7.67 7.67 0 0 0-1.885-5.027l.508-1.05-3.263-1.579 4.505-29.969.888-.29-.368-1.122a7.78 7.78 0 0 0 2.28-1.018l.447 1.364 4.72-1.547-.774-2.359-2.522.826a7.73 7.73 0 0 0 1.672-4.793c0-4.132-3.288-7.52-7.368-7.748a2.173 2.173 0 0 0-.424-.044zm0 4.346a3.414 3.414 0 0 1 3.447 3.446 3.415 3.415 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.446-3.447 3.414 3.414 0 0 1 3.445-3.446zm20.076 3.725a1.242 1.242 0 0 0-.382.062l-1.612.528.578 1.76-.293 1.94 2.456.37.486-3.234a1.242 1.242 0 0 0-1.233-1.426Zm-4.354 1.364-4.72 1.548.775 2.36 4.719-1.548-.774-2.36zm-22.153 2.732a7.877 7.877 0 0 0 3.735 2.922l-.062.408-.397.13.26.793-4.255 28.298-3.818-1.847-1.082 2.235 3.718 1.798a7.841 7.841 0 0 0-3.543 2.147l-13.272-6.42c.02-.23.035-.458.035-.692 0-2.888-1.609-5.408-3.969-6.745l2.912-11.012c3.74-.562 6.645-3.81 6.645-7.698l-.001-.02 13.094-4.297zm-20.885.87a3.414 3.414 0 0 1 3.445 3.447 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm45.314 1.78-.738 4.912 2.456.37.738-4.912zM36.172 17.33l-1.793.588a1.242 1.242 0 0 0-.813.862l-.788 2.978 2.401.634.615-2.325 1.15-.377-.773-2.36zm22.405 5.781-.737 4.913 2.455.368.739-4.91zm-26.432 1.048-1.27 4.802 2.401.634 1.27-4.802zm25.325 6.32-.739 4.913 2.457.368.738-4.911-2.456-.37zm-27.23.882-1.27 4.802 2.402.634 1.27-4.801zm26.124 6.486-.739 4.91 2.455.37.74-4.912-2.457-.368zm-28.027.717-1.27 4.803 2.4.634 1.27-4.802-2.401-.634zm-19.555.856a3.414 3.414 0 0 1 3.446 3.446 3.414 3.414 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.445-3.447 3.414 3.414 0 0 1 3.445-3.446zm46.473 5.795-.739 4.91 2.456.37.74-4.911zm-11.124 5.072-1.082 2.236 4.47 2.164 1.083-2.237zm-8.651 1.55a3.414 3.414 0 0 1 3.445 3.446 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm18.669.745-.358 2.378-2.953-1.428-1.083 2.236 4.472 2.163.541-1.117 1.228.183.608-4.046-2.455-.37z"/>
</svg>
`,cut:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor" fill="currentColor" stroke-width="2"
          d="M44.095 2.247a2.285 2.285 0 0 0-.135.04L12.025 12.762a2.285 2.285 0 0 0-1.497 1.588l-7.772 29.4a2.285 2.285 0 0 0 1.213 2.641L35.397 61.6a2.285 2.285 0 0 0 2.873-.754l22.64-32.582a2.285 2.285 0 0 0 .05-2.534L46.6 3.23a2.285 2.285 0 0 0-2.504-.982ZM43.7 7.182l12.203 19.12-5.167 1.76 1.052 3.09 2.031-.693L38.07 53.122l.01-1.375-3.262-.023-.034 4.5-27.13-13.127 6.975-26.38Zm3.946 21.932-6.18 2.105 1.052 3.09 6.18-2.105zm-9.27 3.157-2.329.793a1.632 1.632 0 0 0-1.105 1.534l-.03 4.068 3.265.024.02-2.91 1.232-.419zm-3.488 9.66-.047 6.529 3.264.023.048-6.528z"/>
</svg>
`,split:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor">
        <path d="m4.879 2.684-2.832 2.8L7.65 11.15l2.832-2.801Zm8.403 8.495-2.832 2.802 5.603 5.662 2.831-2.802zm8.404 8.494-2.832 2.8 5.602 5.664 2.832-2.802z"
        />
        <path d="M27.814 7.408a3.576 3.576 0 0 0-1.161-.176 3.2 3.2 0 0 0-.878.138l7.963 26.068L7.18 27.3c-.543 2.352 1.67 6.055 4.962 6.816l23.054 5.297 2.326 6.42c-2.27-.175-4.279 1.912-4.908 3.805-.535 1.698-.512 3.656.085 5.61.597 1.954 1.671 3.59 3.064 4.7 1.393 1.11 3.238 1.71 5.023 1.164 8.064-3.039 2.135-15.793.467-20.58 5.917 1.023 18.77 5.88 20.578-1.979.42-1.819-.306-3.616-1.509-4.929-1.203-1.313-2.909-2.27-4.9-2.73-1.99-.46-3.866-.547-5.602.303-1.737.849-3.768 2.642-3.468 4.73a6.17 6.17 0 0 0 .012.43l-6.563-1.794-6.88-22.632c-.702-2.297-3.445-3.99-5.108-4.523Zm26.824 26.88c1.36.315 2.472.99 3.116 1.692.644.703.795 1.307.684 1.79-.112.482-.511.956-1.399 1.305-.887.348-2.182.467-3.542.152-1.361-.314-2.472-.99-3.116-1.693-.644-.703-.797-1.304-.686-1.787.112-.482.513-.956 1.4-1.305a5.198 5.198 0 0 1 1.594-.327 6.98 6.98 0 0 1 1.949.173zM37.846 49.174c.333.069.71.25 1.13.585.746.594 1.497 1.654 1.905 2.99.408 1.335.379 2.635.092 3.545-.287.91-.731 1.34-1.205 1.484-.473.145-1.085.036-1.831-.558-.746-.594-1.496-1.655-1.904-2.99-.407-1.336-.378-2.637-.092-3.546.287-.91.732-1.342 1.206-1.486.118-.036.245-.057.38-.058.102 0 .207.011.319.034z"
        />
    </g>
</svg>
`,delete:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M39.063 42.14 22.288 28.12 7.96 44.603l11.338 9.854h9.059zm-3.498 12.317h25.941v5.465h-44.25L4.377 48.726a5.465 5.465 0 0 1-.542-7.711L34.311 5.958a5.465 5.465 0 0 1 7.712-.538l16.496 14.343a5.465 5.465 0 0 1 .541 7.709z"/>
</svg>`,union:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.233 7.917c-5.5 0-10.519 2.077-14.328 5.482a21.443 21.443 0 0 0-4.138-.404c-11.88 0-21.544 9.664-21.544 21.544s9.664 21.544 21.544 21.544c5.5 0 10.519-2.077 14.328-5.482 1.34.263 2.722.404 4.138.404 11.88 0 21.544-9.664 21.544-21.544S53.113 7.917 41.233 7.917zm-9.969 6.791a21.61 21.61 0 0 1 5.598 3.499l-2.01 2.33a18.557 18.557 0 0 0-4.8-2.999Zm-7.927 2.765 2.557 1.714a18.558 18.558 0 0 0-2.396 5.128l-2.955-.86a21.614 21.614 0 0 1 2.794-5.982zm15.86 3.08a21.413 21.413 0 0 1 3.46 5.628l-2.839 1.188a18.357 18.357 0 0 0-2.963-4.817zm-19.334 6.142 3.053.399a18.348 18.348 0 0 0 .144 5.654l-3.027.552a21.407 21.407 0 0 1-.17-6.605Zm23.834 2.63a21.81 21.81 0 0 1 .548 3.263c.1 1.1.115 2.207.044 3.31l-3.07-.195c.12-1.888-.056-3.8-.511-5.64zm-19.918 6.172a18.37 18.37 0 0 0 2.64 5.003l-2.466 1.84a21.427 21.427 0 0 1-3.083-5.84Zm17.042 3.016 3.004.666a21.486 21.486 0 0 1-2.404 6.15l-2.66-1.547a18.434 18.434 0 0 0 2.06-5.27zm-12.535 4.124a18.554 18.554 0 0 0 4.6 3.302l-1.392 2.744a21.611 21.611 0 0 1-5.363-3.85Z"/>
</svg>
`,difference:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m41.478 7.967-.033 3.069c1.887.02 3.772.337 5.561.933l.97-2.913a21.337 21.337 0 0 0-6.498-1.09Zm-3.294.215a21.567 21.567 0 0 0-6.298 1.915l1.332 2.766a18.518 18.518 0 0 1 5.401-1.641zm12.836 2.155-1.402 2.73a18.497 18.497 0 0 1 4.572 3.312l2.16-2.179a21.548 21.548 0 0 0-5.331-3.863ZM22.783 13.06c-11.848 0-21.486 9.638-21.486 21.486 0 11.849 9.638 21.486 21.486 21.486a21.37 21.37 0 0 0 14.288-5.466c.003 0 .006 0 .009.002.04-.036.078-.075.117-.11l.077-.072a21.285 21.285 0 0 0 1.51-1.532 22.128 22.128 0 0 0 .867-1.025 19.557 19.557 0 0 1-.88-.095c-.196-.025-.389-.058-.582-.09-.097-.015-.194-.028-.29-.045a18.378 18.378 0 0 1-1.576-.359l-.118-.03c-7.753-2.172-13.422-9.271-13.422-17.728a18.34 18.34 0 0 1 5.867-13.478c.1-.093.199-.185.3-.276.153-.136.31-.268.467-.4.097-.08.193-.163.291-.242.255-.203.514-.402.78-.592a21.534 21.534 0 0 0-1.76-.592l-.018-.005c-.176-.05-.355-.095-.533-.141-.132-.035-.263-.073-.397-.105-.213-.051-.43-.095-.646-.14-.077-.016-.153-.035-.231-.05H26.9a21.37 21.37 0 0 0-4.118-.4Zm35.728 3.64-2.472 1.82a18.424 18.424 0 0 1 2.61 5.004l2.907-.986a21.474 21.474 0 0 0-3.045-5.839Zm3.864 9.034-3.022.534c.328 1.86.37 3.772.118 5.642l3.042.409a21.448 21.448 0 0 0-.138-6.585zm-3.496 8.943a18.539 18.539 0 0 1-2.416 5.104l2.543 1.72a21.586 21.586 0 0 0 2.815-5.952zM54.703 42a18.288 18.288 0 0 1-4.428 3.492l1.505 2.675a21.348 21.348 0 0 0 5.173-4.08zm-6.995 4.69a18.512 18.512 0 0 1-5.526 1.158l.163 3.065a21.56 21.56 0 0 0 6.444-1.35z"/>
</svg>
`,line_simplification:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.947 25.554c-2.176 3.77-.867 8.656 2.903 10.832 2.126 1.229 4.607 1.346 6.757.539l8.252 12.152a7.79 7.79 0 0 0-.701 1.005c-2.176 3.77-.867 8.656 2.903 10.833 3.77 2.177 8.655.867 10.832-2.903 2.1-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.404-.181 7.955 7.955 0 0 0-6.086-.432l-8.348-12.292c.19-.252.369-.512.53-.79 1.457-2.526 1.339-5.537-.03-7.907l8.202-8.256c3.494 1.335 7.562.025 9.575-3.229l13.899 2.913c.266 2.435 1.634 4.721 3.899 6.03 3.77 2.176 8.655.866 10.832-2.904 2.101-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.403-.181c-3.71-1.87-8.328-.556-10.429 3.083-.084.147-.155.297-.228.446l-13.5-2.83c-.053-2.55-1.329-5.023-3.58-6.499a2.211 2.211 0 0 0-.358-.259 2.211 2.211 0 0 0-.405-.181c-3.708-1.87-8.326-.556-10.428 3.083-1.61 2.79-1.307 6.19.486 8.652l-7.84 7.892a2.211 2.211 0 0 0-.094-.036c-3.71-1.87-8.328-.556-10.429 3.084zm3.83 2.211a3.473 3.473 0 0 1 4.79-1.282 3.472 3.472 0 0 1 1.284 4.789 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.79ZM23.656 8.173a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.789 1.284 3.475 3.475 0 0 1-1.284-4.791zm-.666 44.12a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791zm29.166-37.88a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791z"/>
    <path fill="currentColor"
          d="M12.9 13.516c-.63.177-.685.37-.88.95l-1.069 3.18 2.995 1.006.844-2.506 2.074-.882-1.236-2.908zm19.209 5.25 4.378 4.554 2.277-2.19-4.379-4.554zm8.132 3.106 1.441 2.812 5.623-2.882-1.441-2.812zM5.448 46.082l3.144.304.608-6.29-3.145-.303zm4.623 3.728 5.762 2.592 1.297-2.88-5.762-2.593z"/>
</svg>
`,lasso:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <ellipse cx="4.907" cy="-32.051" fill="none" stroke="currentColor" stroke-dasharray="13.7543, 6.87718"
             stroke-width="5.489" rx="20.4" ry="13.713" transform="matrix(-.71127 .70292 -.86047 -.5095 0 0)"/>
    <path fill="currentColor"
          d="M34.597 25.275a1.934 1.934 0 0 0-2.04 2.165l2.922 31.37c.188 1.523 1.989 2.235 3.165 1.249l6.169-5.004 2.765 4.79c1.59 2.756 4.115 3.431 6.87 1.841 2.756-1.59 3.433-4.114 1.841-6.87l-2.755-4.773 7.31-2.803c1.443-.525 1.728-2.44.503-3.365L35.64 25.66a1.93 1.93 0 0 0-1.042-.383z"/>
</svg>
`,shape_markers:null,snapping:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor" fill-rule="evenodd"
          d="M19.435 3.417c-4.478 0-8.96 1.693-12.343 5.076-6.766 6.766-6.766 17.913 0 24.679h.006c2.754 2.749 5.563 5.561 8.357 8.357 1.857 1.859 3.696 3.696 5.553 5.553l.949.949 1.892 1.898 9.496-9.49-1.898-1.898-6.502-6.502c-2.796-2.797-5.6-5.606-8.363-8.362-1.65-1.653-1.652-4.042 0-5.694 1.653-1.653 4.047-1.653 5.7 0l8.357 8.362 6.502 6.502 1.898 1.893 9.49-9.49-1.893-1.893-6.507-6.502-8.357-8.362c-3.384-3.383-7.86-5.076-12.337-5.076Zm0 2.68c3.789 0 7.577 1.432 10.439 4.294l8.357 8.362-5.694 5.694-8.357-8.362a6.7 6.7 0 0 0-9.496 0 6.697 6.697 0 0 0 0 9.49c2.76 2.755 5.566 5.564 8.363 8.362l-5.694 5.694c-2.795-2.796-5.601-5.607-8.357-8.357H8.99c-5.724-5.724-5.724-15.16 0-20.883 2.861-2.862 6.655-4.294 10.444-4.294ZM57.709 29.03a4.266 4.266 0 0 0-4.268 4.268c0 1.594.881 2.973 2.176 3.707-.714 4.997-1.424 10.107-2.176 15.037-.934 0-1.792.309-2.495.818l-7.115-5.07a4.25 4.25 0 0 0 .115-.965 4.27 4.27 0 1 0-4.268 4.268 4.23 4.23 0 0 0 2.732-1.012l6.973 4.965a4.22 4.22 0 0 0-.215 1.269 4.27 4.27 0 0 0 4.273 4.268 4.266 4.266 0 0 0 4.268-4.268 4.247 4.247 0 0 0-1.657-3.356l2.208-15.446c2.095-.273 3.722-2.045 3.722-4.215a4.27 4.27 0 0 0-4.273-4.268z"
    />
</svg>
`,pin:`\uFEFF<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M42.012 2.106a4.092 4.092 0 0 0-5.741.735 4.092 4.092 0 0 0 .572 5.607L23.964 23.45a8.185 8.185 0 0 0-10.458 2.142l5.18 4.005 5.454 4.218L7.87 59.22a1.124 7.304 37.712 0 0 1.54 1.19l20.494-22.138 5.454 4.217 5.18 4.005a8.185 8.185 0 0 0-.558-10.66l11.277-16.24a4.092 4.092 0 0 0 5.572-.858 4.092 4.092 0 0 0-.735-5.74z"/>
</svg>
`,snap_guides:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor"
          stroke-width="3.8"
          d="m2.155 32.345 42.35-29.82M18.963 60.919l42.35-29.82M31.443 2.332l29.82 42.35M2.207 19.515l29.82 42.35"/>
</svg>
`,measurements:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.717 38.645a2.675 2.668 79.7 0 0-.307 3.769L16.754 60.55a2.675 2.668 79.7 0 0 3.76.312l41.769-35.508a2.675 2.668 79.7 0 0 .307-3.769L47.246 3.45a2.675 2.668 79.7 0 0-3.76-.312zm5.486 2.352 37.702-32.05 11.892 14.056-2.717 2.31-4.458-5.269-2.033 1.729 4.457 5.269-3.11 2.643-4.457-5.268-2.034 1.728 4.458 5.27-3.106 2.64-4.458-5.27-2.033 1.73 4.457 5.268-3.11 2.644-6.194-7.32-2.033 1.728 6.193 7.32-3.11 2.645-4.457-5.269-2.034 1.729 4.458 5.268-3.106 2.64-4.458-5.268-2.033 1.73 4.457 5.268-3.11 2.643-4.457-5.268-2.034 1.729 4.458 5.268-2.098 1.783z"/>
</svg>
`,auto_trace:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M16.862 2.13 7.297 21.17a2.091 2.091 0 0 0-.193 1.288l4.107 24.166-7.618 13.15 3.619 2.096 7.997-13.804a2.091 2.091 0 0 0 .252-1.397l-4.119-24.235 9.256-18.428Zm40.876.255-1.25 2.49 2.668 1.341 1.25-2.49zm-2.593 5.16-2.68 5.337 2.668 1.341 2.682-5.338zm-4.022 8.007-2.682 5.338 2.67 1.34 2.681-5.337zm-18.67 5.83.055 6.984-11.118.087.056 7.242 11.12-.088.054 6.985 10.521-10.688zm18.927 2.817-2.945.5 1.001 5.89 2.945-.5zm1.502 8.835-2.945.5 1.001 5.89 2.945-.5zm1.502 8.834-2.945.5.74 4.355-.24.413 2.585 1.499.51-.881a1.494 1.494 0 0 0 .18-1zm-3.943 7.854-2.994 5.17 2.584 1.496 2.994-5.169zm-4.492 7.754-1.497 2.584 2.584 1.497 1.498-2.584z"/>
</svg>
`,geofencing:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M31.226 17.87c-4.69 0-8.532 3.832-8.532 8.508 0 1.812.58 3.495 1.558 4.88l5.932 10.255c.831 1.085 1.383.879 2.074-.058l6.543-11.135c.132-.24.236-.493.327-.753a8.396 8.396 0 0 0 .628-3.19c0-4.675-3.841-8.506-8.53-8.506zm0 3.987a4.5 4.5 0 0 1 4.532 4.52 4.5 4.5 0 0 1-4.532 4.521 4.5 4.5 0 0 1-4.534-4.52 4.5 4.5 0 0 1 4.533-4.52z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="5" d="M8.97 53.509 4.423 19.145 35.698 4.199l23.88 25.127L43.06 59.801Z"/>
</svg>
`,zoom_to_features:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.585 1.585V13.75h5.17v1.52H8.58v-1.52h5.17V1.585Zm3.041 3.041h6.083v6.083H4.626Zm9.429 2.13V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0v1.597a1.521 1.521 0 0 0-.325.152l-15.686 9.758a1.52 1.52 0 0 0-.199 2.437l23.512 20.553a1.52 1.52 0 0 0 2.477-.78l4.212-17.037v.352h1.825v-3.65H55.42v1.524a1.52 1.52 0 0 0-.222-.296L43.002 8.741a1.521 1.521 0 0 0-.182-.16h2.259V6.754Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm3.042 2.432v3.65h1.825v-3.65Zm-13.752 2.549 10.757 11.137-3.57 14.446-20.087-17.559Zm13.752 2.926v3.65h1.825v-3.65ZM6.755 17.096v3.65H8.58v-3.65zm0 5.475v3.65h1.628a1.52 1.52 0 0 0 1.02.909l12.683 3.406 7.905 12.694c.168.27.417.481.712.602l13.39 4.576a1.52 1.52 0 0 0 1.157-2.814l-12.936-4.389L24.35 28.42a1.52 1.52 0 0 0-.896-.664L10.19 24.193a1.52 1.52 0 0 0-1.61.557v-2.178zm48.665 3.042v3.65h1.825v-3.65ZM6.755 28.046v3.65H8.58v-3.65zm48.665 3.042v3.65h1.825v-3.65ZM6.755 33.52v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65ZM6.755 38.996v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65zm-35.382.913c-3.454 0-6.287 2.833-6.287 6.287 0 3.076 2.248 5.654 5.179 6.183h-1.225v1.825h3.65V55.42h-.206c2.712-.5 4.777-2.796 5.055-5.59l.002-.002a1.52 1.52 0 0 0 0-1.18c-.314-3.168-2.922-5.698-6.168-5.698zM6.755 44.47v3.65H8.58v-3.65zm13.283 1.521a3.223 3.223 0 0 1 3.246 3.246 3.223 3.223 0 0 1-3.246 3.246 3.223 3.223 0 0 1-3.246-3.246 3.223 3.223 0 0 1 3.246-3.246zm35.382 1.52v2.738h-5.17v12.166h12.165V50.25h-5.17v-2.737ZM6.755 49.946v3.65H8.58v-3.65zm46.536 3.346h6.083v6.083H53.29ZM6.755 55.42v1.825h3.65V55.42H7.668Zm5.475 0v1.825h3.65V55.42zm10.95 0v1.825h3.65V55.42zm5.474 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42z"/>
</svg>
`,click_to_edit:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.839 34.833c-7.104-9.763-5.332-23.33 4.2-30.266C21.572-2.369 35.03.123 42.13 9.882L56.166 29.17c7.098 9.755 5.329 23.325-4.204 30.262-9.533 6.936-22.989 4.444-30.09-5.315L7.841 34.836Zm5.063-25.476c-6.079 5.766-7.006 15.598-1.634 22.98l.778 1.07 12.002-8.732zm3.43-2.495L27.476 22.18l12.002-8.733-.781-1.073c-5.37-7.38-15.01-9.522-22.367-5.512m25.643 10.014L14.54 36.836l10.762 14.79c5.818 7.997 16.653 9.842 24.163 4.378 7.51-5.465 9.088-16.342 3.267-24.342z"/>
</svg>
`},Zo=t=>[{type:"circle",paint:{"circle-radius":t.circleMarkerRadius,"circle-color":t.fillColor,"circle-opacity":t.fillOpacity,"circle-stroke-color":t.lineColor,"circle-stroke-width":t.lineWidth,"circle-stroke-opacity":t.lineOpacity}}],pi=t=>[{type:"circle",paint:{"circle-radius":7,"circle-color":"#ffffff","circle-opacity":1,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],Ko=t=>[{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],Qo=()=>[{type:"symbol",layout:{"icon-image":"default-marker","icon-size":.18,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}],Vt=t=>[{type:"fill",paint:{"fill-color":t.fillColor,"fill-opacity":t.fillOpacity}},{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],eu=t=>[{type:"circle",paint:{"circle-radius":6,"circle-color":"#ffffff","circle-opacity":.6,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],tu=()=>[{type:"line",paint:{"line-color":"#00979f","line-width":1.8,"line-dasharray":[2,1]}}],gt=`__${it}_`,Pt=`${gt}id`,vc=6e4,K={...st&&{standby:`${it}_standby`},main:`${it}_main`,temporary:`${it}_temporary`},nu=()=>[{type:"symbol",layout:{"text-field":["get",`${gt}text`],"text-justify":"center"},paint:{"text-color":"black","text-halo-color":"#fff","text-halo-width":2}}],Fe={[K.main]:{lineColor:"#278cda",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[K.temporary]:{lineColor:"#ff5600",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},...st&&{[K.standby]:{lineColor:"#787878",lineOpacity:.8,lineWidth:3,fillColor:"#a5a5a5",fillOpacity:.4,circleMarkerRadius:10}}},yc={polygon:{[K.main]:Vt(Fe[K.main]),[K.temporary]:Vt(Fe[K.temporary]),...st&&{[K.standby]:Vt(Fe[K.standby])}},ellipse:{[K.main]:Vt(Fe[K.main]),[K.temporary]:Vt(Fe[K.temporary]),...st&&{[K.standby]:Vt(Fe[K.standby])}},rectangle:{[K.main]:Vt(Fe[K.main]),[K.temporary]:Vt(Fe[K.temporary]),...st&&{[K.standby]:Vt(Fe[K.standby])}},circle:{[K.main]:Vt(Fe[K.main]),[K.temporary]:Vt(Fe[K.temporary]),...st&&{[K.standby]:Vt(Fe[K.standby])}},circle_marker:{[K.main]:Zo(Fe[K.main]),[K.temporary]:Zo(Fe[K.temporary]),...st&&{[K.standby]:Zo(Fe[K.standby])}},line:{[K.main]:Ko(Fe[K.main]),[K.temporary]:Ko(Fe[K.temporary]),...st&&{[K.standby]:Ko(Fe[K.standby])}},marker:{[K.temporary]:Qo(),[K.main]:Qo(),...st&&{[K.standby]:Qo()}},text_marker:{[K.main]:nu(),[K.temporary]:nu(),...st&&{[K.standby]:nu()}},dom_marker:{[K.main]:[],[K.temporary]:[],...st&&{[K.standby]:[]}},center_marker:{[K.main]:pi(Fe[K.main]),[K.temporary]:pi(Fe[K.temporary]),...st&&{[K.standby]:pi(Fe[K.standby])}},vertex_marker:{[K.main]:pi(Fe[K.main]),[K.temporary]:pi(Fe[K.temporary]),...st&&{[K.standby]:pi(Fe[K.standby])}},edge_marker:{[K.main]:eu(Fe[K.main]),[K.temporary]:eu(Fe[K.temporary]),...st&&{[K.standby]:eu(Fe[K.standby])}},snap_guide:{[K.main]:tu(),[K.temporary]:tu(),...st&&{[K.standby]:tu()}}},um={settings:{throttlingDelay:10,awaitDataUpdatesOnEvents:!0,useDefaultLayers:!0,controlsPosition:"top-left",controlsUiEnabledByDefault:!0,controlsCollapsible:!1,controlsStyles:{controlGroupClass:"maplibregl-ctrl maplibregl-ctrl-group",controlContainerClass:"gm-control-container",controlButtonClass:"gm-control-button"},idGenerator:null,markerIcons:{default:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0A95F0" class="bi bi-geo-alt-fill"
     viewBox="0 0 16 16">
    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
</svg>
`,control:`<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21">
    <circle cx="10.5" cy="10.5" r="9.213" fill="#fff" stroke="#278cda" stroke-width="2.303"/>
</svg>
`}},layerStyles:yc,controls:{draw:{marker:{title:"Marker",icon:vt.marker,uiEnabled:!0,active:!1},circle_marker:{title:"Circle Marker",icon:vt.circle_marker,uiEnabled:!0,active:!1},text_marker:{title:"Text Marker",icon:vt.text_marker,uiEnabled:!0,active:!1},circle:{title:"Circle",icon:vt.circle,uiEnabled:!0,active:!1},ellipse:{title:"Ellipse",icon:vt.ellipse,uiEnabled:!0,active:!1},line:{title:"Line",icon:vt.line,uiEnabled:!0,active:!1},rectangle:{title:"Rectangle",icon:vt.rectangle,uiEnabled:!0,active:!1},polygon:{title:"Polygon",icon:vt.polygon,uiEnabled:!0,active:!1}},edit:{drag:{title:"Drag",icon:vt.drag,uiEnabled:!0,active:!1},change:{title:"Change",icon:vt.change,uiEnabled:!0,active:!1},rotate:{title:"Rotate",icon:vt.rotate,uiEnabled:!0,active:!1},cut:{title:"Cut",icon:vt.cut,uiEnabled:!0,active:!1},delete:{title:"Delete",icon:vt.delete,uiEnabled:!0,active:!1}},helper:{shape_markers:{title:"Shape markers",icon:null,uiEnabled:!1,active:!1},snapping:{title:"Snapping",icon:vt.snapping,uiEnabled:!0,active:!1},zoom_to_features:{title:"Zoom to features",icon:vt.zoom_to_features,uiEnabled:!0,active:!1}}}};var _c=typeof global=="object"&&global&&global.Object===Object&&global,lm=typeof self=="object"&&self&&self.Object===Object&&self,fn=_c||lm||Function("return this")(),Wt=fn.Symbol,Ec=Object.prototype,cm=Ec.hasOwnProperty,hm=Ec.toString,as=Wt?Wt.toStringTag:void 0;function fm(t){var e=cm.call(t,as),r=t[as];try{t[as]=void 0;var s=!0}catch{}var u=hm.call(t);return s&&(e?t[as]=r:delete t[as]),u}var gm=Object.prototype,dm=gm.toString;function pm(t){return dm.call(t)}var mm="[object Null]",vm="[object Undefined]",wc=Wt?Wt.toStringTag:void 0;function zr(t){return t==null?t===void 0?vm:mm:wc&&wc in Object(t)?fm(t):pm(t)}function Tn(t){return t!=null&&typeof t=="object"}var ym="[object Symbol]";function mi(t){return typeof t=="symbol"||Tn(t)&&zr(t)==ym}function vi(t,e){for(var r=-1,s=t==null?0:t.length,u=Array(s);++r<s;)u[r]=e(t[r],r,t);return u}var xt=Array.isArray,xc=Wt?Wt.prototype:void 0,kc=xc?xc.toString:void 0;function Sc(t){if(typeof t=="string")return t;if(xt(t))return vi(t,Sc)+"";if(mi(t))return kc?kc.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var _m=/\s/;function Em(t){for(var e=t.length;e--&&_m.test(t.charAt(e)););return e}var wm=/^\s+/;function xm(t){return t&&t.slice(0,Em(t)+1).replace(wm,"")}function kt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Mc=NaN,km=/^[-+]0x[0-9a-f]+$/i,Sm=/^0b[01]+$/i,Mm=/^0o[0-7]+$/i,Im=parseInt;function Ic(t){if(typeof t=="number")return t;if(mi(t))return Mc;if(kt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=kt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=xm(t);var r=Sm.test(t);return r||Mm.test(t)?Im(t.slice(2),r?2:8):km.test(t)?Mc:+t}function ha(t){return t}var bm="[object AsyncFunction]",Tm="[object Function]",Am="[object GeneratorFunction]",Lm="[object Proxy]";function ru(t){if(!kt(t))return!1;var e=zr(t);return e==Tm||e==Am||e==bm||e==Lm}var iu=fn["__core-js_shared__"],bc=(function(){var t=/[^.]+$/.exec(iu&&iu.keys&&iu.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Cm(t){return!!bc&&bc in t}var Nm=Function.prototype,Pm=Nm.toString;function qr(t){if(t!=null){try{return Pm.call(t)}catch{}try{return t+""}catch{}}return""}var Om=/[\\^$.*+?()[\]{}|]/g,Rm=/^\[object .+?Constructor\]$/,Dm=Function.prototype,Fm=Object.prototype,Gm=Dm.toString,Bm=Fm.hasOwnProperty,Um=RegExp("^"+Gm.call(Bm).replace(Om,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function zm(t){if(!kt(t)||Cm(t))return!1;var e=ru(t)?Um:Rm;return e.test(qr(t))}function qm(t,e){return t?.[e]}function Yr(t,e){var r=qm(t,e);return zm(r)?r:void 0}var su=Yr(fn,"WeakMap"),Tc=Object.create,Ym=(function(){function t(){}return function(e){if(!kt(e))return{};if(Tc)return Tc(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();function Hm(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function Jm(){}function $m(t,e){var r=-1,s=t.length;for(e||(e=Array(s));++r<s;)e[r]=t[r];return e}var Xm=800,Vm=16,Wm=Date.now;function jm(t){var e=0,r=0;return function(){var s=Wm(),u=Vm-(s-r);if(r=s,u>0){if(++e>=Xm)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Zm(t){return function(){return t}}var fa=(function(){try{var t=Yr(Object,"defineProperty");return t({},"",{}),t}catch{}})(),Km=fa?function(t,e){return fa(t,"toString",{configurable:!0,enumerable:!1,value:Zm(e),writable:!0})}:ha,Qm=jm(Km);function ev(t,e){for(var r=-1,s=t==null?0:t.length;++r<s&&e(t[r],r,t)!==!1;);return t}function tv(t,e,r,s){for(var u=t.length,l=r+-1;++l<u;)if(e(t[l],l,t))return l;return-1}function nv(t){return t!==t}function rv(t,e,r){for(var s=r-1,u=t.length;++s<u;)if(t[s]===e)return s;return-1}function iv(t,e,r){return e===e?rv(t,e,r):tv(t,nv,r)}function Ac(t,e){var r=t==null?0:t.length;return!!r&&iv(t,e,0)>-1}var sv=9007199254740991,av=/^(?:0|[1-9]\d*)$/;function ga(t,e){var r=typeof t;return e=e??sv,!!e&&(r=="number"||r!="symbol"&&av.test(t))&&t>-1&&t%1==0&&t<e}function os(t,e,r){e=="__proto__"&&fa?fa(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function us(t,e){return t===e||t!==t&&e!==e}var ov=Object.prototype,uv=ov.hasOwnProperty;function au(t,e,r){var s=t[e];(!(uv.call(t,e)&&us(s,r))||r===void 0&&!(e in t))&&os(t,e,r)}function lv(t,e,r,s){var u=!r;r||(r={});for(var l=-1,f=e.length;++l<f;){var h=e[l],p=void 0;p===void 0&&(p=t[h]),u?os(r,h,p):au(r,h,p)}return r}var Lc=Math.max;function cv(t,e,r){return e=Lc(e===void 0?t.length-1:e,0),function(){for(var s=arguments,u=-1,l=Lc(s.length-e,0),f=Array(l);++u<l;)f[u]=s[e+u];u=-1;for(var h=Array(e+1);++u<e;)h[u]=s[u];return h[e]=r(f),Hm(t,this,h)}}function ou(t,e){return Qm(cv(t,e,ha),t+"")}var hv=9007199254740991;function uu(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=hv}function yi(t){return t!=null&&uu(t.length)&&!ru(t)}function lu(t,e,r){if(!kt(r))return!1;var s=typeof e;return(s=="number"?yi(r)&&ga(e,r.length):s=="string"&&e in r)?us(r[e],t):!1}function Cc(t){return ou(function(e,r){var s=-1,u=r.length,l=u>1?r[u-1]:void 0,f=u>2?r[2]:void 0;for(l=t.length>3&&typeof l=="function"?(u--,l):void 0,f&&lu(r[0],r[1],f)&&(l=u<3?void 0:l,u=1),e=Object(e);++s<u;){var h=r[s];h&&t(e,h,s,l)}return e})}var fv=Object.prototype;function cu(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||fv;return t===r}function gv(t,e){for(var r=-1,s=Array(t);++r<t;)s[r]=e(r);return s}var dv="[object Arguments]";function Nc(t){return Tn(t)&&zr(t)==dv}var Pc=Object.prototype,pv=Pc.hasOwnProperty,mv=Pc.propertyIsEnumerable,ls=Nc((function(){return arguments})())?Nc:function(t){return Tn(t)&&pv.call(t,"callee")&&!mv.call(t,"callee")};function vv(){return!1}var Oc=typeof te=="object"&&te&&!te.nodeType&&te,Rc=Oc&&typeof module=="object"&&module&&!module.nodeType&&module,yv=Rc&&Rc.exports===Oc,Dc=yv?fn.Buffer:void 0,_v=Dc?Dc.isBuffer:void 0,cs=_v||vv,Ev="[object Arguments]",wv="[object Array]",xv="[object Boolean]",kv="[object Date]",Sv="[object Error]",Mv="[object Function]",Iv="[object Map]",bv="[object Number]",Tv="[object Object]",Av="[object RegExp]",Lv="[object Set]",Cv="[object String]",Nv="[object WeakMap]",Pv="[object ArrayBuffer]",Ov="[object DataView]",Rv="[object Float32Array]",Dv="[object Float64Array]",Fv="[object Int8Array]",Gv="[object Int16Array]",Bv="[object Int32Array]",Uv="[object Uint8Array]",zv="[object Uint8ClampedArray]",qv="[object Uint16Array]",Yv="[object Uint32Array]",Je={};Je[Rv]=Je[Dv]=Je[Fv]=Je[Gv]=Je[Bv]=Je[Uv]=Je[zv]=Je[qv]=Je[Yv]=!0,Je[Ev]=Je[wv]=Je[Pv]=Je[xv]=Je[Ov]=Je[kv]=Je[Sv]=Je[Mv]=Je[Iv]=Je[bv]=Je[Tv]=Je[Av]=Je[Lv]=Je[Cv]=Je[Nv]=!1;function Hv(t){return Tn(t)&&uu(t.length)&&!!Je[zr(t)]}function da(t){return function(e){return t(e)}}var Fc=typeof te=="object"&&te&&!te.nodeType&&te,hs=Fc&&typeof module=="object"&&module&&!module.nodeType&&module,Jv=hs&&hs.exports===Fc,hu=Jv&&_c.process,_i=(function(){try{var t=hs&&hs.require&&hs.require("util").types;return t||hu&&hu.binding&&hu.binding("util")}catch{}})(),Gc=_i&&_i.isTypedArray,fu=Gc?da(Gc):Hv,$v=Object.prototype,Xv=$v.hasOwnProperty;function Bc(t,e){var r=xt(t),s=!r&&ls(t),u=!r&&!s&&cs(t),l=!r&&!s&&!u&&fu(t),f=r||s||u||l,h=f?gv(t.length,String):[],p=h.length;for(var d in t)(e||Xv.call(t,d))&&!(f&&(d=="length"||u&&(d=="offset"||d=="parent")||l&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||ga(d,p)))&&h.push(d);return h}function Uc(t,e){return function(r){return t(e(r))}}var Vv=Uc(Object.keys,Object),Wv=Object.prototype,jv=Wv.hasOwnProperty;function Zv(t){if(!cu(t))return Vv(t);var e=[];for(var r in Object(t))jv.call(t,r)&&r!="constructor"&&e.push(r);return e}function pa(t){return yi(t)?Bc(t):Zv(t)}function Kv(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Qv=Object.prototype,ey=Qv.hasOwnProperty;function ty(t){if(!kt(t))return Kv(t);var e=cu(t),r=[];for(var s in t)s=="constructor"&&(e||!ey.call(t,s))||r.push(s);return r}function zc(t){return yi(t)?Bc(t,!0):ty(t)}var ny=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ry=/^\w*$/;function gu(t,e){if(xt(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||mi(t)?!0:ry.test(t)||!ny.test(t)||e!=null&&t in Object(e)}var fs=Yr(Object,"create");function iy(){this.__data__=fs?fs(null):{},this.size=0}function sy(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ay="__lodash_hash_undefined__",oy=Object.prototype,uy=oy.hasOwnProperty;function ly(t){var e=this.__data__;if(fs){var r=e[t];return r===ay?void 0:r}return uy.call(e,t)?e[t]:void 0}var cy=Object.prototype,hy=cy.hasOwnProperty;function fy(t){var e=this.__data__;return fs?e[t]!==void 0:hy.call(e,t)}var gy="__lodash_hash_undefined__";function dy(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=fs&&e===void 0?gy:e,this}function Hr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}Hr.prototype.clear=iy,Hr.prototype.delete=sy,Hr.prototype.get=ly,Hr.prototype.has=fy,Hr.prototype.set=dy;function py(){this.__data__=[],this.size=0}function ma(t,e){for(var r=t.length;r--;)if(us(t[r][0],e))return r;return-1}var my=Array.prototype,vy=my.splice;function yy(t){var e=this.__data__,r=ma(e,t);if(r<0)return!1;var s=e.length-1;return r==s?e.pop():vy.call(e,r,1),--this.size,!0}function _y(t){var e=this.__data__,r=ma(e,t);return r<0?void 0:e[r][1]}function Ey(t){return ma(this.__data__,t)>-1}function wy(t,e){var r=this.__data__,s=ma(r,t);return s<0?(++this.size,r.push([t,e])):r[s][1]=e,this}function Kn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}Kn.prototype.clear=py,Kn.prototype.delete=yy,Kn.prototype.get=_y,Kn.prototype.has=Ey,Kn.prototype.set=wy;var gs=Yr(fn,"Map");function xy(){this.size=0,this.__data__={hash:new Hr,map:new(gs||Kn),string:new Hr}}function ky(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function va(t,e){var r=t.__data__;return ky(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Sy(t){var e=va(this,t).delete(t);return this.size-=e?1:0,e}function My(t){return va(this,t).get(t)}function Iy(t){return va(this,t).has(t)}function by(t,e){var r=va(this,t),s=r.size;return r.set(t,e),this.size+=r.size==s?0:1,this}function Qn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}Qn.prototype.clear=xy,Qn.prototype.delete=Sy,Qn.prototype.get=My,Qn.prototype.has=Iy,Qn.prototype.set=by;var Ty="Expected a function";function du(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ty);var r=function(){var s=arguments,u=e?e.apply(this,s):s[0],l=r.cache;if(l.has(u))return l.get(u);var f=t.apply(this,s);return r.cache=l.set(u,f)||l,f};return r.cache=new(du.Cache||Qn),r}du.Cache=Qn;var Ay=500;function Ly(t){var e=du(t,function(s){return r.size===Ay&&r.clear(),s}),r=e.cache;return e}var Cy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ny=/\\(\\)?/g,Py=Ly(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Cy,function(r,s,u,l){e.push(u?l.replace(Ny,"$1"):s||r)}),e});function Oy(t){return t==null?"":Sc(t)}function pu(t,e){return xt(t)?t:gu(t,e)?[t]:Py(Oy(t))}function ds(t){if(typeof t=="string"||mi(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function mu(t,e){e=pu(e,t);for(var r=0,s=e.length;t!=null&&r<s;)t=t[ds(e[r++])];return r&&r==s?t:void 0}function Ei(t,e,r){var s=t==null?void 0:mu(t,e);return s===void 0?r:s}function qc(t,e){for(var r=-1,s=e.length,u=t.length;++r<s;)t[u+r]=e[r];return t}var Yc=Wt?Wt.isConcatSpreadable:void 0;function Ry(t){return xt(t)||ls(t)||!!(Yc&&t&&t[Yc])}function Dy(t,e,r,s,u){var l=-1,f=t.length;for(r||(r=Ry),u||(u=[]);++l<f;){var h=t[l];r(h)?qc(u,h):u[u.length]=h}return u}var Hc=Uc(Object.getPrototypeOf,Object),Fy="[object Object]",Gy=Function.prototype,By=Object.prototype,Jc=Gy.toString,Uy=By.hasOwnProperty,zy=Jc.call(Object);function $c(t){if(!Tn(t)||zr(t)!=Fy)return!1;var e=Hc(t);if(e===null)return!0;var r=Uy.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Jc.call(r)==zy}function qy(){this.__data__=new Kn,this.size=0}function Yy(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Hy(t){return this.__data__.get(t)}function Jy(t){return this.__data__.has(t)}var $y=200;function Xy(t,e){var r=this.__data__;if(r instanceof Kn){var s=r.__data__;if(!gs||s.length<$y-1)return s.push([t,e]),this.size=++r.size,this;r=this.__data__=new Qn(s)}return r.set(t,e),this.size=r.size,this}function gn(t){var e=this.__data__=new Kn(t);this.size=e.size}gn.prototype.clear=qy,gn.prototype.delete=Yy,gn.prototype.get=Hy,gn.prototype.has=Jy,gn.prototype.set=Xy;var Xc=typeof te=="object"&&te&&!te.nodeType&&te,Vc=Xc&&typeof module=="object"&&module&&!module.nodeType&&module,Vy=Vc&&Vc.exports===Xc,Wc=Vy?fn.Buffer:void 0,jc=Wc?Wc.allocUnsafe:void 0;function Zc(t,e){if(e)return t.slice();var r=t.length,s=jc?jc(r):new t.constructor(r);return t.copy(s),s}function Wy(t,e){for(var r=-1,s=t==null?0:t.length,u=0,l=[];++r<s;){var f=t[r];e(f,r,t)&&(l[u++]=f)}return l}function jy(){return[]}var Zy=Object.prototype,Ky=Zy.propertyIsEnumerable,Kc=Object.getOwnPropertySymbols,Qy=Kc?function(t){return t==null?[]:(t=Object(t),Wy(Kc(t),function(e){return Ky.call(t,e)}))}:jy;function e0(t,e,r){var s=e(t);return xt(t)?s:qc(s,r(t))}function vu(t){return e0(t,pa,Qy)}var yu=Yr(fn,"DataView"),_u=Yr(fn,"Promise"),wi=Yr(fn,"Set"),Qc="[object Map]",t0="[object Object]",eh="[object Promise]",th="[object Set]",nh="[object WeakMap]",rh="[object DataView]",n0=qr(yu),r0=qr(gs),i0=qr(_u),s0=qr(wi),a0=qr(su),dn=zr;(yu&&dn(new yu(new ArrayBuffer(1)))!=rh||gs&&dn(new gs)!=Qc||_u&&dn(_u.resolve())!=eh||wi&&dn(new wi)!=th||su&&dn(new su)!=nh)&&(dn=function(t){var e=zr(t),r=e==t0?t.constructor:void 0,s=r?qr(r):"";if(s)switch(s){case n0:return rh;case r0:return Qc;case i0:return eh;case s0:return th;case a0:return nh}return e});var o0=Object.prototype,u0=o0.hasOwnProperty;function l0(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&u0.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var ya=fn.Uint8Array;function Eu(t){var e=new t.constructor(t.byteLength);return new ya(e).set(new ya(t)),e}function c0(t,e){var r=Eu(t.buffer);return new t.constructor(r,t.byteOffset,t.byteLength)}var h0=/\w*$/;function f0(t){var e=new t.constructor(t.source,h0.exec(t));return e.lastIndex=t.lastIndex,e}var ih=Wt?Wt.prototype:void 0,sh=ih?ih.valueOf:void 0;function g0(t){return sh?Object(sh.call(t)):{}}function ah(t,e){var r=e?Eu(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var d0="[object Boolean]",p0="[object Date]",m0="[object Map]",v0="[object Number]",y0="[object RegExp]",_0="[object Set]",E0="[object String]",w0="[object Symbol]",x0="[object ArrayBuffer]",k0="[object DataView]",S0="[object Float32Array]",M0="[object Float64Array]",I0="[object Int8Array]",b0="[object Int16Array]",T0="[object Int32Array]",A0="[object Uint8Array]",L0="[object Uint8ClampedArray]",C0="[object Uint16Array]",N0="[object Uint32Array]";function P0(t,e,r){var s=t.constructor;switch(e){case x0:return Eu(t);case d0:case p0:return new s(+t);case k0:return c0(t);case S0:case M0:case I0:case b0:case T0:case A0:case L0:case C0:case N0:return ah(t,r);case m0:return new s;case v0:case E0:return new s(t);case y0:return f0(t);case _0:return new s;case w0:return g0(t)}}function oh(t){return typeof t.constructor=="function"&&!cu(t)?Ym(Hc(t)):{}}var O0="[object Map]";function R0(t){return Tn(t)&&dn(t)==O0}var uh=_i&&_i.isMap,D0=uh?da(uh):R0,F0="[object Set]";function G0(t){return Tn(t)&&dn(t)==F0}var lh=_i&&_i.isSet,B0=lh?da(lh):G0,U0=1,ch="[object Arguments]",z0="[object Array]",q0="[object Boolean]",Y0="[object Date]",H0="[object Error]",hh="[object Function]",J0="[object GeneratorFunction]",$0="[object Map]",X0="[object Number]",fh="[object Object]",V0="[object RegExp]",W0="[object Set]",j0="[object String]",Z0="[object Symbol]",K0="[object WeakMap]",Q0="[object ArrayBuffer]",e_="[object DataView]",t_="[object Float32Array]",n_="[object Float64Array]",r_="[object Int8Array]",i_="[object Int16Array]",s_="[object Int32Array]",a_="[object Uint8Array]",o_="[object Uint8ClampedArray]",u_="[object Uint16Array]",l_="[object Uint32Array]",ze={};ze[ch]=ze[z0]=ze[Q0]=ze[e_]=ze[q0]=ze[Y0]=ze[t_]=ze[n_]=ze[r_]=ze[i_]=ze[s_]=ze[$0]=ze[X0]=ze[fh]=ze[V0]=ze[W0]=ze[j0]=ze[Z0]=ze[a_]=ze[o_]=ze[u_]=ze[l_]=!0,ze[H0]=ze[hh]=ze[K0]=!1;function _a(t,e,r,s,u,l){var f,h=e&U0;if(f!==void 0)return f;if(!kt(t))return t;var p=xt(t);if(p)f=l0(t);else{var d=dn(t),v=d==hh||d==J0;if(cs(t))return Zc(t,h);if(d==fh||d==ch||v&&!u)f=v?{}:oh(t);else{if(!ze[d])return u?t:{};f=P0(t,d,h)}}l||(l=new gn);var _=l.get(t);if(_)return _;l.set(t,f),B0(t)?t.forEach(function(M){f.add(_a(M,e,r,M,t,l))}):D0(t)&&t.forEach(function(M,R){f.set(R,_a(M,e,r,R,t,l))});var w=vu,k=p?void 0:w(t);return ev(k||t,function(M,R){k&&(R=M,M=t[R]),au(f,R,_a(M,e,r,R,t,l))}),f}var c_=1,h_=4;function Ut(t){return _a(t,c_|h_)}var f_="__lodash_hash_undefined__";function g_(t){return this.__data__.set(t,f_),this}function d_(t){return this.__data__.has(t)}function xi(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Qn;++e<r;)this.add(t[e])}xi.prototype.add=xi.prototype.push=g_,xi.prototype.has=d_;function p_(t,e){for(var r=-1,s=t==null?0:t.length;++r<s;)if(e(t[r],r,t))return!0;return!1}function Ea(t,e){return t.has(e)}var m_=1,v_=2;function gh(t,e,r,s,u,l){var f=r&m_,h=t.length,p=e.length;if(h!=p&&!(f&&p>h))return!1;var d=l.get(t),v=l.get(e);if(d&&v)return d==e&&v==t;var _=-1,w=!0,k=r&v_?new xi:void 0;for(l.set(t,e),l.set(e,t);++_<h;){var M=t[_],R=e[_];if(s)var C=f?s(R,M,_,e,t,l):s(M,R,_,t,e,l);if(C!==void 0){if(C)continue;w=!1;break}if(k){if(!p_(e,function(I,A){if(!Ea(k,A)&&(M===I||u(M,I,r,s,l)))return k.push(A)})){w=!1;break}}else if(!(M===R||u(M,R,r,s,l))){w=!1;break}}return l.delete(t),l.delete(e),w}function y_(t){var e=-1,r=Array(t.size);return t.forEach(function(s,u){r[++e]=[u,s]}),r}function wu(t){var e=-1,r=Array(t.size);return t.forEach(function(s){r[++e]=s}),r}var __=1,E_=2,w_="[object Boolean]",x_="[object Date]",k_="[object Error]",S_="[object Map]",M_="[object Number]",I_="[object RegExp]",b_="[object Set]",T_="[object String]",A_="[object Symbol]",L_="[object ArrayBuffer]",C_="[object DataView]",dh=Wt?Wt.prototype:void 0,xu=dh?dh.valueOf:void 0;function N_(t,e,r,s,u,l,f){switch(r){case C_:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case L_:return!(t.byteLength!=e.byteLength||!l(new ya(t),new ya(e)));case w_:case x_:case M_:return us(+t,+e);case k_:return t.name==e.name&&t.message==e.message;case I_:case T_:return t==e+"";case S_:var h=y_;case b_:var p=s&__;if(h||(h=wu),t.size!=e.size&&!p)return!1;var d=f.get(t);if(d)return d==e;s|=E_,f.set(t,e);var v=gh(h(t),h(e),s,u,l,f);return f.delete(t),v;case A_:if(xu)return xu.call(t)==xu.call(e)}return!1}var P_=1,O_=Object.prototype,R_=O_.hasOwnProperty;function D_(t,e,r,s,u,l){var f=r&P_,h=vu(t),p=h.length,d=vu(e),v=d.length;if(p!=v&&!f)return!1;for(var _=p;_--;){var w=h[_];if(!(f?w in e:R_.call(e,w)))return!1}var k=l.get(t),M=l.get(e);if(k&&M)return k==e&&M==t;var R=!0;l.set(t,e),l.set(e,t);for(var C=f;++_<p;){w=h[_];var I=t[w],A=e[w];if(s)var Y=f?s(A,I,w,e,t,l):s(I,A,w,t,e,l);if(!(Y===void 0?I===A||u(I,A,r,s,l):Y)){R=!1;break}C||(C=w=="constructor")}if(R&&!C){var $=t.constructor,J=e.constructor;$!=J&&"constructor"in t&&"constructor"in e&&!(typeof $=="function"&&$ instanceof $&&typeof J=="function"&&J instanceof J)&&(R=!1)}return l.delete(t),l.delete(e),R}var F_=1,ph="[object Arguments]",mh="[object Array]",wa="[object Object]",G_=Object.prototype,vh=G_.hasOwnProperty;function B_(t,e,r,s,u,l){var f=xt(t),h=xt(e),p=f?mh:dn(t),d=h?mh:dn(e);p=p==ph?wa:p,d=d==ph?wa:d;var v=p==wa,_=d==wa,w=p==d;if(w&&cs(t)){if(!cs(e))return!1;f=!0,v=!1}if(w&&!v)return l||(l=new gn),f||fu(t)?gh(t,e,r,s,u,l):N_(t,e,p,r,s,u,l);if(!(r&F_)){var k=v&&vh.call(t,"__wrapped__"),M=_&&vh.call(e,"__wrapped__");if(k||M){var R=k?t.value():t,C=M?e.value():e;return l||(l=new gn),u(R,C,r,s,l)}}return w?(l||(l=new gn),D_(t,e,r,s,u,l)):!1}function xa(t,e,r,s,u){return t===e?!0:t==null||e==null||!Tn(t)&&!Tn(e)?t!==t&&e!==e:B_(t,e,r,s,xa,u)}var U_=1,z_=2;function q_(t,e,r,s){var u=r.length,l=u;if(t==null)return!l;for(t=Object(t);u--;){var f=r[u];if(f[2]?f[1]!==t[f[0]]:!(f[0]in t))return!1}for(;++u<l;){f=r[u];var h=f[0],p=t[h],d=f[1];if(f[2]){if(p===void 0&&!(h in t))return!1}else{var v=new gn,_;if(!(_===void 0?xa(d,p,U_|z_,s,v):_))return!1}}return!0}function yh(t){return t===t&&!kt(t)}function Y_(t){for(var e=pa(t),r=e.length;r--;){var s=e[r],u=t[s];e[r]=[s,u,yh(u)]}return e}function _h(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}function H_(t){var e=Y_(t);return e.length==1&&e[0][2]?_h(e[0][0],e[0][1]):function(r){return r===t||q_(r,t,e)}}function J_(t,e){return t!=null&&e in Object(t)}function $_(t,e,r){e=pu(e,t);for(var s=-1,u=e.length,l=!1;++s<u;){var f=ds(e[s]);if(!(l=t!=null&&r(t,f)))break;t=t[f]}return l||++s!=u?l:(u=t==null?0:t.length,!!u&&uu(u)&&ga(f,u)&&(xt(t)||ls(t)))}function X_(t,e){return t!=null&&$_(t,e,J_)}var V_=1,W_=2;function j_(t,e){return gu(t)&&yh(e)?_h(ds(t),e):function(r){var s=Ei(r,t);return s===void 0&&s===e?X_(r,t):xa(e,s,V_|W_)}}function Z_(t){return function(e){return e?.[t]}}function K_(t){return function(e){return mu(e,t)}}function Q_(t){return gu(t)?Z_(ds(t)):K_(t)}function Eh(t){return typeof t=="function"?t:t==null?ha:typeof t=="object"?xt(t)?j_(t[0],t[1]):H_(t):Q_(t)}function e1(t,e,r,s){for(var u=-1,l=t==null?0:t.length;++u<l;){var f=t[u];e(s,f,r(f),t)}return s}function t1(t){return function(e,r,s){for(var u=-1,l=Object(e),f=s(e),h=f.length;h--;){var p=f[++u];if(r(l[p],p,l)===!1)break}return e}}var wh=t1();function n1(t,e){return t&&wh(t,e,pa)}function r1(t,e){return function(r,s){if(r==null)return r;if(!yi(r))return t(r,s);for(var u=r.length,l=-1,f=Object(r);++l<u&&s(f[l],l,f)!==!1;);return r}}var xh=r1(n1);function i1(t,e,r,s){return xh(t,function(u,l,f){e(s,u,r(u),f)}),s}function kh(t,e){return function(r,s){var u=xt(r)?e1:i1,l=e?e():{};return u(r,t,Eh(s),l)}}var s1=Object.prototype,a1=s1.hasOwnProperty,o1=kh(function(t,e,r){a1.call(t,r)?++t[r]:os(t,r,1)}),ku=function(){return fn.Date.now()},u1="Expected a function",l1=Math.max,c1=Math.min;function Sh(t,e,r){var s,u,l,f,h,p,d=0,v=!1,_=!1,w=!0;if(typeof t!="function")throw new TypeError(u1);e=Ic(e)||0,kt(r)&&(v=!!r.leading,_="maxWait"in r,l=_?l1(Ic(r.maxWait)||0,e):l,w="trailing"in r?!!r.trailing:w);function k(q){var W=s,E=u;return s=u=void 0,d=q,f=t.apply(E,W),f}function M(q){return d=q,h=setTimeout(I,e),v?k(q):f}function R(q){var W=q-p,E=q-d,S=e-W;return _?c1(S,l-E):S}function C(q){var W=q-p,E=q-d;return p===void 0||W>=e||W<0||_&&E>=l}function I(){var q=ku();if(C(q))return A(q);h=setTimeout(I,R(q))}function A(q){return h=void 0,w&&s?k(q):(s=u=void 0,f)}function Y(){h!==void 0&&clearTimeout(h),d=0,s=p=u=h=void 0}function $(){return h===void 0?f:A(ku())}function J(){var q=ku(),W=C(q);if(s=arguments,u=this,p=q,W){if(h===void 0)return M(p);if(_)return clearTimeout(h),h=setTimeout(I,e),k(p)}return h===void 0&&(h=setTimeout(I,e)),f}return J.cancel=Y,J.flush=$,J}function Su(t,e,r){(r!==void 0&&!us(t[e],r)||r===void 0&&!(e in t))&&os(t,e,r)}function Mh(t){return Tn(t)&&yi(t)}function Mu(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function h1(t){return lv(t,zc(t))}function f1(t,e,r,s,u,l,f){var h=Mu(t,r),p=Mu(e,r),d=f.get(p);if(d){Su(t,r,d);return}var v=l?l(h,p,r+"",t,e,f):void 0,_=v===void 0;if(_){var w=xt(p),k=!w&&cs(p),M=!w&&!k&&fu(p);v=p,w||k||M?xt(h)?v=h:Mh(h)?v=$m(h):k?(_=!1,v=Zc(p,!0)):M?(_=!1,v=ah(p,!0)):v=[]:$c(p)||ls(p)?(v=h,ls(h)?v=h1(h):(!kt(h)||ru(h))&&(v=oh(p))):_=!1}_&&(f.set(p,v),u(v,p,s,l,f),f.delete(p)),Su(t,r,v)}function Iu(t,e,r,s,u){t!==e&&wh(e,function(l,f){if(u||(u=new gn),kt(l))f1(t,e,f,r,Iu,s,u);else{var h=s?s(Mu(t,f),l,f+"",t,e,u):void 0;h===void 0&&(h=l),Su(t,f,h)}},zc)}var g1=Cc(function(t,e,r,s){Iu(t,e,r,s)});function d1(t,e,r){for(var s=-1,u=t==null?0:t.length;++s<u;)if(r(e,t[s]))return!0;return!1}function p1(t,e){var r=-1,s=yi(t)?Array(t.length):[];return xh(t,function(u,l,f){s[++r]=e(u,l,f)}),s}function m1(t,e){return vi(e,function(r){return t[r]})}function v1(t){return t==null?[]:m1(t,pa(t))}var y1=Math.min;function _1(t,e,r){for(var s=Ac,u=t[0].length,l=t.length,f=l,h=Array(l),p=1/0,d=[];f--;){var v=t[f];p=y1(v.length,p),h[f]=u>=120&&v.length>=120?new xi(f&&v):void 0}v=t[0];var _=-1,w=h[0];e:for(;++_<u&&d.length<p;){var k=v[_],M=k;if(k=k!==0?k:0,!(w?Ea(w,M):s(d,M))){for(f=l;--f;){var R=h[f];if(!(R?Ea(R,M):s(t[f],M)))continue e}w&&w.push(M),d.push(k)}}return d}function E1(t){return Mh(t)?t:[]}var w1=ou(function(t){var e=vi(t,E1);return e.length&&e[0]===t[0]?_1(e):[]});function ki(t,e){return xa(t,e)}var x1=kh(function(t,e,r){os(t,r,e)}),k1=Cc(function(t,e,r){Iu(t,e,r)});function S1(t,e,r,s){if(!kt(t))return t;e=pu(e,t);for(var u=-1,l=e.length,f=l-1,h=t;h!=null&&++u<l;){var p=ds(e[u]),d=r;if(p==="__proto__"||p==="constructor"||p==="prototype")return t;if(u!=f){var v=h[p];d=void 0,d===void 0&&(d=kt(v)?v:ga(e[u+1])?[]:{})}au(h,p,d),h=h[p]}return t}function M1(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}function I1(t,e){if(t!==e){var r=t!==void 0,s=t===null,u=t===t,l=mi(t),f=e!==void 0,h=e===null,p=e===e,d=mi(e);if(!h&&!d&&!l&&t>e||l&&f&&p&&!h&&!d||s&&f&&p||!r&&p||!u)return 1;if(!s&&!l&&!d&&t<e||d&&r&&u&&!s&&!l||h&&r&&u||!f&&u||!p)return-1}return 0}function b1(t,e,r){for(var s=-1,u=t.criteria,l=e.criteria,f=u.length,h=r.length;++s<f;){var p=I1(u[s],l[s]);if(p){if(s>=h)return p;var d=r[s];return p*(d=="desc"?-1:1)}}return t.index-e.index}function T1(t,e,r){e.length?e=vi(e,function(l){return xt(l)?function(f){return mu(f,l.length===1?l[0]:l)}:l}):e=[ha];var s=-1;e=vi(e,da(Eh));var u=p1(t,function(l,f,h){var p=vi(e,function(d){return d(l)});return{criteria:p,index:++s,value:l}});return M1(u,function(l,f){return b1(l,f,r)})}function A1(t,e,r){return t==null?t:S1(t,e,r)}var Ih=ou(function(t,e){if(t==null)return[];var r=e.length;return r>1&&lu(t,e[0],e[1])?e=[]:r>2&&lu(e[0],e[1],e[2])&&(e=[e[0]]),T1(t,Dy(e),[])}),L1="Expected a function";function bh(t,e,r){var s=!0,u=!0;if(typeof t!="function")throw new TypeError(L1);return kt(r)&&(s="leading"in r?!!r.leading:s,u="trailing"in r?!!r.trailing:u),Sh(t,e,{leading:s,maxWait:e,trailing:u})}var C1=1/0,N1=wi&&1/wu(new wi([,-0]))[1]==C1?function(t){return new wi(t)}:Jm,P1=200;function O1(t,e,r){var s=-1,u=Ac,l=t.length,f=!0,h=[],p=h;if(r)f=!1,u=d1;else if(l>=P1){var d=N1(t);if(d)return wu(d);f=!1,u=Ea,p=new xi}else p=h;e:for(;++s<l;){var v=t[s],_=v;if(v=r||v!==0?v:0,f&&_===_){for(var w=p.length;w--;)if(p[w]===_)continue e;h.push(v)}else u(p,_,r)||(p!==h&&p.push(_),h.push(v))}return h}function Th(t,e){return e=typeof e=="function"?e:void 0,t&&t.length?O1(t,void 0,e):[]}function Ah(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ka={exports:{}},R1=ka.exports,Lh;function D1(){return Lh||(Lh=1,(function(t){(function(e,r){t.exports?t.exports=r():e.log=r()})(R1,function(){var e=function(){},r="undefined",s=typeof window!==r&&typeof window.navigator!==r&&/Trident\/|MSIE /.test(window.navigator.userAgent),u=["trace","debug","info","warn","error"],l={},f=null;function h(R,C){var I=R[C];if(typeof I.bind=="function")return I.bind(R);try{return Function.prototype.bind.call(I,R)}catch{return function(){return Function.prototype.apply.apply(I,[R,arguments])}}}function p(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(R){return R==="debug"&&(R="log"),typeof console===r?!1:R==="trace"&&s?p:console[R]!==void 0?h(console,R):console.log!==void 0?h(console,"log"):e}function v(){for(var R=this.getLevel(),C=0;C<u.length;C++){var I=u[C];this[I]=C<R?e:this.methodFactory(I,R,this.name)}if(this.log=this.debug,typeof console===r&&R<this.levels.SILENT)return"No console available for logging"}function _(R){return function(){typeof console!==r&&(v.call(this),this[R].apply(this,arguments))}}function w(R,C,I){return d(R)||_.apply(this,arguments)}function k(R,C){var I=this,A,Y,$,J="loglevel";typeof R=="string"?J+=":"+R:typeof R=="symbol"&&(J=void 0);function q(O){var P=(u[O]||"silent").toUpperCase();if(!(typeof window===r||!J)){try{window.localStorage[J]=P;return}catch{}try{window.document.cookie=encodeURIComponent(J)+"="+P+";"}catch{}}}function W(){var O;if(!(typeof window===r||!J)){try{O=window.localStorage[J]}catch{}if(typeof O===r)try{var P=window.document.cookie,F=encodeURIComponent(J),D=P.indexOf(F+"=");D!==-1&&(O=/^([^;]+)/.exec(P.slice(D+F.length+1))[1])}catch{}return I.levels[O]===void 0&&(O=void 0),O}}function E(){if(!(typeof window===r||!J)){try{window.localStorage.removeItem(J)}catch{}try{window.document.cookie=encodeURIComponent(J)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function S(O){var P=O;if(typeof P=="string"&&I.levels[P.toUpperCase()]!==void 0&&(P=I.levels[P.toUpperCase()]),typeof P=="number"&&P>=0&&P<=I.levels.SILENT)return P;throw new TypeError("log.setLevel() called with invalid level: "+O)}I.name=R,I.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},I.methodFactory=C||w,I.getLevel=function(){return $??Y??A},I.setLevel=function(O,P){return $=S(O),P!==!1&&q($),v.call(I)},I.setDefaultLevel=function(O){Y=S(O),W()||I.setLevel(O,!1)},I.resetLevel=function(){$=null,E(),v.call(I)},I.enableAll=function(O){I.setLevel(I.levels.TRACE,O)},I.disableAll=function(O){I.setLevel(I.levels.SILENT,O)},I.rebuild=function(){if(f!==I&&(A=S(f.getLevel())),v.call(I),f===I)for(var O in l)l[O].rebuild()},A=S(f?f.getLevel():"WARN");var b=W();b!=null&&($=S(b)),v.call(I)}f=new k,f.getLogger=function(C){if(typeof C!="symbol"&&typeof C!="string"||C==="")throw new TypeError("You must supply a name when creating a logger.");var I=l[C];return I||(I=l[C]=new k(C,f.methodFactory)),I};var M=typeof window!==r?window.log:void 0;return f.noConflict=function(){return typeof window!==r&&window.log===f&&(window.log=M),f},f.getLoggers=function(){return l},f.default=f,f})})(ka)),ka.exports}var F1=D1();const ne=Ah(F1),G1=(t,e)=>{let r=null;try{t.forEach(s=>{if(e(s))throw r=s,new Error("found")})}catch{}return r};function bu(t,e,r=[]){e(t,r),Array.isArray(t)?t.forEach((s,u)=>bu(s,e,[...r,u])):$c(t)?Object.entries(t).forEach(([s,u])=>bu(u,e,[...r,s])):t!==null&&typeof t=="object"&&ne.warn(`forEachDeep: unknown collection type (${t}), path "${r.join(".")}"`)}const B1=t=>{const e=["shape_markers"],r=t.settings.controlsUiEnabledByDefault;bu(t,(s,u)=>{const l=u.at(2);if(u.length===4&&u.at(-1)==="uiEnabled"){if(e.includes(l))return;A1(t,u,r)}})},Tu=()=>Ut(um),Au=!1;var Lu=Array.isArray,U1=Array.prototype.indexOf,Sa=Array.from,Ch=Object.defineProperty,ps=Object.getOwnPropertyDescriptor,z1=Object.getOwnPropertyDescriptors,q1=Object.prototype,Y1=Array.prototype,Nh=Object.getPrototypeOf,Ph=Object.isExtensible;function H1(t){return typeof t=="function"}const pn=()=>{};function J1(t){for(var e=0;e<t.length;e++)t[e]()}function Oh(){var t,e,r=new Promise((s,u)=>{t=s,e=u});return{promise:r,resolve:t,reject:e}}function Ma(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const r=[];for(const s of t)if(r.push(s),r.length===e)break;return r}const dt=2,Ia=4,ba=8,Rh=1<<24,An=16,er=32,Jr=64,Cu=128,jt=512,yt=1024,St=2048,tr=4096,zt=8192,xr=16384,Ta=32768,$r=65536,Dh=1<<17,Fh=1<<18,Si=1<<19,$1=1<<20,nr=1<<25,Xr=32768,Nu=1<<21,Pu=1<<22,kr=1<<23,ms=Symbol("$state"),X1=Symbol(""),Mi=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Gh(t){return t===this.v}function Bh(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Uh(t){return!Bh(t,this.v)}function zh(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function V1(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function W1(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function j1(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Z1(t){throw new Error("https://svelte.dev/e/effect_orphan")}function K1(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Q1(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function eE(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function tE(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function nE(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let rE=!1;const iE=1,sE=2,qh=4,aE=8,oE=16,uE=1,lE=2,cE=4,hE=1,fE=2,pt=Symbol(),gE="http://www.w3.org/1999/xhtml";let _t=null;function Ii(t){_t=t}function Yh(t){return dE().get(t)}function bi(t,e=!1,r){_t={p:_t,i:!1,c:null,e:null,s:t,x:null,l:null}}function Ti(t){var e=_t,r=e.e;if(r!==null){e.e=null;for(var s of r)Ef(s)}return e.i=!0,_t=e.p,{}}function Hh(){return!0}function dE(t){return _t===null&&zh(),_t.c??=new Map(pE(_t)||void 0)}function pE(t){let e=t.p;for(;e!==null;){const r=e.c;if(r!==null)return r;e=e.p}return null}let Ai=[];function mE(){var t=Ai;Ai=[],J1(t)}function vs(t){if(Ai.length===0){var e=Ai;queueMicrotask(()=>{e===Ai&&mE()})}Ai.push(t)}function vE(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function yE(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function ys(t){if(typeof t!="object"||t===null||ms in t)return t;const e=Nh(t);if(e!==q1&&e!==Y1)return t;var r=new Map,s=Lu(t),u=Nn(0),l=Zr,f=h=>{if(Zr===l)return h();var p=be,d=Zr;Ot(null),df(l);var v=h();return Ot(p),df(d),v};return s&&r.set("length",Nn(t.length)),new Proxy(t,{defineProperty(h,p,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Q1();var v=r.get(p);return v===void 0?v=f(()=>{var _=Nn(d.value);return r.set(p,_),_}):Mt(v,d.value,!0),!0},deleteProperty(h,p){var d=r.get(p);if(d===void 0){if(p in h){const v=f(()=>Nn(pt));r.set(p,v),ws(u)}}else Mt(d,pt),ws(u);return!0},get(h,p,d){if(p===ms)return t;var v=r.get(p),_=p in h;if(v===void 0&&(!_||ps(h,p)?.writable)&&(v=f(()=>{var k=ys(_?h[p]:pt),M=Nn(k);return M}),r.set(p,v)),v!==void 0){var w=Ee(v);return w===pt?void 0:w}return Reflect.get(h,p,d)},getOwnPropertyDescriptor(h,p){var d=Reflect.getOwnPropertyDescriptor(h,p);if(d&&"value"in d){var v=r.get(p);v&&(d.value=Ee(v))}else if(d===void 0){var _=r.get(p),w=_?.v;if(_!==void 0&&w!==pt)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return d},has(h,p){if(p===ms)return!0;var d=r.get(p),v=d!==void 0&&d.v!==pt||Reflect.has(h,p);if(d!==void 0||Re!==null&&(!v||ps(h,p)?.writable)){d===void 0&&(d=f(()=>{var w=v?ys(h[p]):pt,k=Nn(w);return k}),r.set(p,d));var _=Ee(d);if(_===pt)return!1}return v},set(h,p,d,v){var _=r.get(p),w=p in h;if(s&&p==="length")for(var k=d;k<_.v;k+=1){var M=r.get(k+"");M!==void 0?Mt(M,pt):k in h&&(M=f(()=>Nn(pt)),r.set(k+"",M))}if(_===void 0)(!w||ps(h,p)?.writable)&&(_=f(()=>Nn(void 0)),Mt(_,ys(d)),r.set(p,_));else{w=_.v!==pt;var R=f(()=>ys(d));Mt(_,R)}var C=Reflect.getOwnPropertyDescriptor(h,p);if(C?.set&&C.set.call(v,d),!w){if(s&&typeof p=="string"){var I=r.get("length"),A=Number(p);Number.isInteger(A)&&A>=I.v&&Mt(I,A+1)}ws(u)}return!0},ownKeys(h){Ee(u);var p=Reflect.ownKeys(h).filter(_=>{var w=r.get(_);return w===void 0||w.v!==pt});for(var[d,v]of r)v.v!==pt&&!(d in h)&&p.push(d);return p},setPrototypeOf(){eE()}})}function Jh(t){try{if(t!==null&&typeof t=="object"&&ms in t)return t[ms]}catch{}return t}function _E(t,e){return Object.is(Jh(t),Jh(e))}var $h,Xh,Vh,Wh;function EE(){if($h===void 0){$h=window,Xh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;Vh=ps(e,"firstChild").get,Wh=ps(e,"nextSibling").get,Ph(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ph(r)&&(r.__t=void 0)}}function rr(t=""){return document.createTextNode(t)}function Sr(t){return Vh.call(t)}function _s(t){return Wh.call(t)}function mn(t,e){return Sr(t)}function vn(t,e=!1){{var r=Sr(t);return r instanceof Comment&&r.data===""?_s(r):r}}function Es(t,e=1,r=!1){let s=t;for(;e--;)s=_s(s);return s}function wE(t){t.textContent=""}function jh(){return!1}function Zh(t){var e=Re;if(e===null)return be.f|=kr,t;if((e.f&Ta)===0){if((e.f&Cu)===0)throw t;e.b.error(t)}else Li(t,e)}function Li(t,e){for(;e!==null;){if((e.f&Cu)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const xE=-7169;function at(t,e){t.f=t.f&xE|e}function Ou(t){(t.f&jt)!==0||t.deps===null?at(t,yt):at(t,tr)}function Kh(t){if(t!==null)for(const e of t)(e.f&dt)===0||(e.f&Xr)===0||(e.f^=Xr,Kh(e.deps))}function Qh(t,e,r){(t.f&St)!==0?e.add(t):(t.f&tr)!==0&&r.add(t),Kh(t.deps),at(t,yt)}const Aa=new Set;let $e=null,La=null,yn=null,Ln=[],Ru=null,Du=!1;class Cn{committed=!1;current=new Map;previous=new Map;#t=new Set;#a=new Set;#e=0;#i=0;#s=null;#r=new Set;#n=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#i>0}process(e){Ln=[],La=null,this.apply();var r=[],s=[];for(const u of e)this.#o(u,r,s);this.is_fork||this.#l(),this.is_deferred()?(this.#u(s),this.#u(r)):(La=this,$e=null,ef(s),ef(r),La=null,this.#s?.resolve()),yn=null}#o(e,r,s){e.f^=yt;for(var u=e.first,l=null;u!==null;){var f=u.f,h=(f&(er|Jr))!==0,p=h&&(f&yt)!==0,d=p||(f&zt)!==0||this.skipped_effects.has(u);if(!d&&u.fn!==null){h?u.f^=yt:l!==null&&(f&(Ia|ba|Rh))!==0?l.b.defer_effect(u):(f&Ia)!==0?r.push(u):Ss(u)&&((f&An)!==0&&this.#r.add(u),Ms(u));var v=u.first;if(v!==null){u=v;continue}}var _=u.parent;for(u=u.next;u===null&&_!==null;)_===l&&(l=null),u=_.next,_=_.parent}}#u(e){for(var r=0;r<e.length;r+=1)Qh(e[r],this.#r,this.#n)}capture(e,r){r!==pt&&!this.previous.has(e)&&this.previous.set(e,r),(e.f&kr)===0&&(this.current.set(e,e.v),yn?.set(e,e.v))}activate(){$e=this,this.apply()}deactivate(){$e===this&&($e=null,yn=null)}flush(){if(this.activate(),Ln.length>0){if(kE(),$e!==null&&$e!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#a)e(this);this.#a.clear()}#l(){if(this.#i===0){for(const e of this.#t)e();this.#t.clear()}this.#e===0&&this.#c()}#c(){if(Aa.size>1){this.previous.clear();var e=yn,r=!0;for(const u of Aa){if(u===this){r=!1;continue}const l=[];for(const[h,p]of this.current){if(u.current.has(h))if(r&&p!==u.current.get(h))u.current.set(h,p);else continue;l.push(h)}if(l.length===0)continue;const f=[...u.current.keys()].filter(h=>!this.current.has(h));if(f.length>0){var s=Ln;Ln=[];const h=new Set,p=new Map;for(const d of l)tf(d,f,h,p);if(Ln.length>0){$e=u,u.apply();for(const d of Ln)u.#o(d,[],[]);u.deactivate()}Ln=s}}$e=null,yn=e}this.committed=!0,Aa.delete(this)}increment(e){this.#e+=1,e&&(this.#i+=1)}decrement(e){this.#e-=1,e&&(this.#i-=1),this.revive()}revive(){for(const e of this.#r)this.#n.delete(e),at(e,St),sr(e);for(const e of this.#n)at(e,tr),sr(e);this.flush()}oncommit(e){this.#t.add(e)}ondiscard(e){this.#a.add(e)}settled(){return(this.#s??=Oh()).promise}static ensure(){if($e===null){const e=$e=new Cn;Aa.add($e),Cn.enqueue(()=>{$e===e&&e.flush()})}return $e}static enqueue(e){vs(e)}apply(){}}function kE(){var t=Wr;Du=!0;var e=null;try{var r=0;for(Na(!0);Ln.length>0;){var s=Cn.ensure();if(r++>1e3){var u,l;SE()}s.process(Ln),Mr.clear()}}finally{Du=!1,Na(t),Ru=null}}function SE(){try{K1()}catch(t){Li(t,Ru)}}let ir=null;function ef(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var s=t[r++];if((s.f&(xr|zt))===0&&Ss(s)&&(ir=new Set,Ms(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?If(s):s.fn=null),ir?.size>0)){Mr.clear();for(const u of ir){if((u.f&(xr|zt))!==0)continue;const l=[u];let f=u.parent;for(;f!==null;)ir.has(f)&&(ir.delete(f),l.push(f)),f=f.parent;for(let h=l.length-1;h>=0;h--){const p=l[h];(p.f&(xr|zt))===0&&Ms(p)}}ir.clear()}}ir=null}}function tf(t,e,r,s){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const u of t.reactions){const l=u.f;(l&dt)!==0?tf(u,e,r,s):(l&(Pu|An))!==0&&(l&St)===0&&nf(u,e,s)&&(at(u,St),sr(u))}}function nf(t,e,r){const s=r.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const u of t.deps){if(e.includes(u))return!0;if((u.f&dt)!==0&&nf(u,e,r))return r.set(u,!0),!0}return r.set(t,!1),!1}function sr(t){for(var e=Ru=t;e.parent!==null;){e=e.parent;var r=e.f;if(Du&&e===Re&&(r&An)!==0&&(r&Fh)===0)return;if((r&(Jr|er))!==0){if((r&yt)===0)return;e.f^=yt}}Ln.push(e)}function ME(t){let e=0,r=Vr(0),s;return()=>{Uu()&&(Ee(r),xf(()=>(e===0&&(s=Is(()=>t(()=>ws(r)))),e+=1,()=>{vs(()=>{e-=1,e===0&&(s?.(),s=void 0,ws(r))})})))}}var IE=$r|Si|Cu;function bE(t,e,r){new TE(t,e,r)}class TE{parent;is_pending=!1;#t;#a=null;#e;#i;#s;#r=null;#n=null;#o=null;#u=null;#l=null;#c=0;#h=0;#g=!1;#d=new Set;#p=new Set;#f=null;#E=ME(()=>(this.#f=Vr(this.#c),()=>{this.#f=null}));constructor(e,r,s){this.#t=e,this.#e=r,this.#i=s,this.parent=Re.b,this.is_pending=!!this.#e.pending,this.#s=qu(()=>{Re.b=this;{var u=this.#y();try{this.#r=Kt(()=>s(u))}catch(l){this.error(l)}this.#h>0?this.#v():this.is_pending=!1}return()=>{this.#l?.remove()}},IE)}#w(){try{this.#r=Kt(()=>this.#i(this.#t))}catch(e){this.error(e)}}#x(){const e=this.#e.pending;e&&(this.#n=Kt(()=>e(this.#t)),Cn.enqueue(()=>{var r=this.#y();this.#r=this.#m(()=>(Cn.ensure(),Kt(()=>this.#i(r)))),this.#h>0?this.#v():(Kr(this.#n,()=>{this.#n=null}),this.is_pending=!1)}))}#y(){var e=this.#t;return this.is_pending&&(this.#l=rr(),this.#t.before(this.#l),e=this.#l),e}defer_effect(e){Qh(e,this.#d,this.#p)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#m(e){var r=Re,s=be,u=_t;Pn(this.#s),Ot(this.#s),Ii(this.#s.ctx);try{return e()}catch(l){return Zh(l),null}finally{Pn(r),Ot(s),Ii(u)}}#v(){const e=this.#e.pending;this.#r!==null&&(this.#u=document.createDocumentFragment(),this.#u.append(this.#l),Af(this.#r,this.#u)),this.#n===null&&(this.#n=Kt(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}if(this.#h+=e,this.#h===0){this.is_pending=!1;for(const r of this.#d)at(r,St),sr(r);for(const r of this.#p)at(r,tr),sr(r);this.#d.clear(),this.#p.clear(),this.#n&&Kr(this.#n,()=>{this.#n=null}),this.#u&&(this.#t.before(this.#u),this.#u=null)}}update_pending_count(e){this.#_(e),this.#c+=e,this.#f&&Ci(this.#f,this.#c)}get_effect_pending(){return this.#E(),Ee(this.#f)}error(e){var r=this.#e.onerror;let s=this.#e.failed;if(this.#g||!r&&!s)throw e;this.#r&&(Rt(this.#r),this.#r=null),this.#n&&(Rt(this.#n),this.#n=null),this.#o&&(Rt(this.#o),this.#o=null);var u=!1,l=!1;const f=()=>{if(u){yE();return}u=!0,l&&nE(),Cn.ensure(),this.#c=0,this.#o!==null&&Kr(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#m(()=>(this.#g=!1,Kt(()=>this.#i(this.#t)))),this.#h>0?this.#v():this.is_pending=!1};var h=be;try{Ot(null),l=!0,r?.(e,f),l=!1}catch(p){Li(p,this.#s&&this.#s.parent)}finally{Ot(h)}s&&vs(()=>{this.#o=this.#m(()=>{Cn.ensure(),this.#g=!0;try{return Kt(()=>{s(this.#t,()=>e,()=>f)})}catch(p){return Li(p,this.#s.parent),null}finally{this.#g=!1}})})}}function AE(t,e,r,s){const u=Fu;if(r.length===0&&t.length===0){s(e.map(u));return}var l=$e,f=Re,h=LE();function p(){Promise.all(r.map(d=>CE(d))).then(d=>{h();try{s([...e.map(u),...d])}catch(v){(f.f&xr)===0&&Li(v,f)}l?.deactivate(),Ca()}).catch(d=>{Li(d,f)})}t.length>0?Promise.all(t).then(()=>{h();try{return p()}finally{l?.deactivate(),Ca()}}):p()}function LE(){var t=Re,e=be,r=_t,s=$e;return function(l=!0){Pn(t),Ot(e),Ii(r),l&&s?.activate()}}function Ca(){Pn(null),Ot(null),Ii(null)}function Fu(t){var e=dt|St,r=be!==null&&(be.f&dt)!==0?be:null;return Re!==null&&(Re.f|=Si),{ctx:_t,deps:null,effects:null,equals:Gh,f:e,fn:t,reactions:null,rv:0,v:pt,wv:0,parent:r??Re,ac:null}}function CE(t,e,r){let s=Re;s===null&&V1();var u=s.b,l=void 0,f=Vr(pt),h=!be,p=new Map;return qE(()=>{var d=Oh();l=d.promise;try{Promise.resolve(t()).then(d.resolve,d.reject).then(()=>{v===$e&&v.committed&&v.deactivate(),Ca()})}catch(k){d.reject(k),Ca()}var v=$e;if(h){var _=u.is_rendered();u.update_pending_count(1),v.increment(_),p.get(v)?.reject(Mi),p.delete(v),p.set(v,d)}const w=(k,M=void 0)=>{if(v.activate(),M)M!==Mi&&(f.f|=kr,Ci(f,M));else{(f.f&kr)!==0&&(f.f^=kr),Ci(f,k);for(const[R,C]of p){if(p.delete(R),R===v)break;C.reject(Mi)}}h&&(u.update_pending_count(-1),v.decrement(_))};d.promise.then(w,k=>w(null,k||"unknown"))}),zu(()=>{for(const d of p.values())d.reject(Mi)}),new Promise(d=>{function v(_){function w(){_===l?d(f):v(l)}_.then(w,w)}v(l)})}function _n(t){const e=Fu(t);return ff(e),e}function NE(t){const e=Fu(t);return e.equals=Uh,e}function rf(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)Rt(e[r])}}function PE(t){for(var e=t.parent;e!==null;){if((e.f&dt)===0)return(e.f&xr)===0?e:null;e=e.parent}return null}function Gu(t){var e,r=Re;Pn(PE(t));try{t.f&=~Xr,rf(t),e=vf(t)}finally{Pn(r)}return e}function sf(t){var e=Gu(t);if(!t.equals(e)&&(t.wv=pf(),(!$e?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){at(t,yt);return}jr||(yn!==null?(Uu()||$e?.is_fork)&&yn.set(t,e):Ou(t))}let Bu=new Set;const Mr=new Map;let af=!1;function Vr(t,e){var r={f:0,v:t,reactions:null,equals:Gh,rv:0,wv:0};return r}function Nn(t,e){const r=Vr(t);return ff(r),r}function of(t,e=!1,r=!0){const s=Vr(t);return e||(s.equals=Uh),s}function Mt(t,e,r=!1){be!==null&&(!En||(be.f&Dh)!==0)&&Hh()&&(be.f&(dt|An|Pu|Dh))!==0&&!ar?.includes(t)&&tE();let s=r?ys(e):e;return Ci(t,s)}function Ci(t,e){if(!t.equals(e)){var r=t.v;jr?Mr.set(t,e):Mr.set(t,r),t.v=e;var s=Cn.ensure();if(s.capture(t,r),(t.f&dt)!==0){const u=t;(t.f&St)!==0&&Gu(u),Ou(u)}t.wv=pf(),uf(t,St),Re!==null&&(Re.f&yt)!==0&&(Re.f&(er|Jr))===0&&(Zt===null?DE([t]):Zt.push(t)),!s.is_fork&&Bu.size>0&&!af&&OE()}return e}function OE(){af=!1;var t=Wr;Na(!0);const e=Array.from(Bu);try{for(const r of e)(r.f&yt)!==0&&at(r,tr),Ss(r)&&Ms(r)}finally{Na(t)}Bu.clear()}function ws(t){Mt(t,t.v+1)}function uf(t,e){var r=t.reactions;if(r!==null)for(var s=r.length,u=0;u<s;u++){var l=r[u],f=l.f,h=(f&St)===0;if(h&&at(l,e),(f&dt)!==0){var p=l;yn?.delete(p),(f&Xr)===0&&(f&jt&&(l.f|=Xr),uf(p,tr))}else h&&((f&An)!==0&&ir!==null&&ir.add(l),sr(l))}}let lf=!1;function RE(){lf||(lf=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function xs(t){var e=be,r=Re;Ot(null),Pn(null);try{return t()}finally{Ot(e),Pn(r)}}function cf(t,e,r,s=r){t.addEventListener(e,()=>xs(r));const u=t.__on_r;u?t.__on_r=()=>{u(),s(!0)}:t.__on_r=()=>s(!0),RE()}let Wr=!1;function Na(t){Wr=t}let jr=!1;function hf(t){jr=t}let be=null,En=!1;function Ot(t){be=t}let Re=null;function Pn(t){Re=t}let ar=null;function ff(t){be!==null&&(ar===null?ar=[t]:ar.push(t))}let It=null,qt=0,Zt=null;function DE(t){Zt=t}let gf=1,ks=0,Zr=ks;function df(t){Zr=t}function pf(){return++gf}function Ss(t){var e=t.f;if((e&St)!==0)return!0;if(e&dt&&(t.f&=~Xr),(e&tr)!==0){for(var r=t.deps,s=r.length,u=0;u<s;u++){var l=r[u];if(Ss(l)&&sf(l),l.wv>t.wv)return!0}(e&jt)!==0&&yn===null&&at(t,yt)}return!1}function mf(t,e,r=!0){var s=t.reactions;if(s!==null&&!ar?.includes(t))for(var u=0;u<s.length;u++){var l=s[u];(l.f&dt)!==0?mf(l,e,!1):e===l&&(r?at(l,St):(l.f&yt)!==0&&at(l,tr),sr(l))}}function vf(t){var e=It,r=qt,s=Zt,u=be,l=ar,f=_t,h=En,p=Zr,d=t.f;It=null,qt=0,Zt=null,be=(d&(er|Jr))===0?t:null,ar=null,Ii(t.ctx),En=!1,Zr=++ks,t.ac!==null&&(xs(()=>{t.ac.abort(Mi)}),t.ac=null);try{t.f|=Nu;var v=t.fn,_=v(),w=t.deps;if(It!==null){var k;if(Pa(t,qt),w!==null&&qt>0)for(w.length=qt+It.length,k=0;k<It.length;k++)w[qt+k]=It[k];else t.deps=w=It;if(Uu()&&(t.f&jt)!==0)for(k=qt;k<w.length;k++)(w[k].reactions??=[]).push(t)}else w!==null&&qt<w.length&&(Pa(t,qt),w.length=qt);if(Hh()&&Zt!==null&&!En&&w!==null&&(t.f&(dt|tr|St))===0)for(k=0;k<Zt.length;k++)mf(Zt[k],t);return u!==null&&u!==t&&(ks++,Zt!==null&&(s===null?s=Zt:s.push(...Zt))),(t.f&kr)!==0&&(t.f^=kr),_}catch(M){return Zh(M)}finally{t.f^=Nu,It=e,qt=r,Zt=s,be=u,ar=l,Ii(f),En=h,Zr=p}}function FE(t,e){let r=e.reactions;if(r!==null){var s=U1.call(r,t);if(s!==-1){var u=r.length-1;u===0?r=e.reactions=null:(r[s]=r[u],r.pop())}}if(r===null&&(e.f&dt)!==0&&(It===null||!It.includes(e))){var l=e;(l.f&jt)!==0&&(l.f^=jt,l.f&=~Xr),Ou(l),rf(l),Pa(l,0)}}function Pa(t,e){var r=t.deps;if(r!==null)for(var s=e;s<r.length;s++)FE(t,r[s])}function Ms(t){var e=t.f;if((e&xr)===0){at(t,yt);var r=Re,s=Wr;Re=t,Wr=!0;try{(e&(An|Rh))!==0?YE(t):Sf(t),kf(t);var u=vf(t);t.teardown=typeof u=="function"?u:null,t.wv=gf;var l;Au&&rE&&(t.f&St)!==0&&t.deps}finally{Wr=s,Re=r}}}function Ee(t){var e=t.f,r=(e&dt)!==0;if(be!==null&&!En){var s=Re!==null&&(Re.f&xr)!==0;if(!s&&!ar?.includes(t)){var u=be.deps;if((be.f&Nu)!==0)t.rv<ks&&(t.rv=ks,It===null&&u!==null&&u[qt]===t?qt++:It===null?It=[t]:It.includes(t)||It.push(t));else{(be.deps??=[]).push(t);var l=t.reactions;l===null?t.reactions=[be]:l.includes(be)||l.push(be)}}}if(jr&&Mr.has(t))return Mr.get(t);if(r){var f=t;if(jr){var h=f.v;return((f.f&yt)===0&&f.reactions!==null||_f(f))&&(h=Gu(f)),Mr.set(f,h),h}var p=(f.f&jt)===0&&!En&&be!==null&&(Wr||(be.f&jt)!==0),d=f.deps===null;Ss(f)&&(p&&(f.f|=jt),sf(f)),p&&!d&&yf(f)}if(yn?.has(t))return yn.get(t);if((t.f&kr)!==0)throw t.v;return t.v}function yf(t){if(t.deps!==null){t.f|=jt;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&dt)!==0&&(e.f&jt)===0&&yf(e)}}function _f(t){if(t.v===pt)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Mr.has(e)||(e.f&dt)!==0&&_f(e))return!0;return!1}function Is(t){var e=En;try{return En=!0,t()}finally{En=e}}function GE(t){Re===null&&(be===null&&Z1(),j1()),jr&&W1()}function BE(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function or(t,e,r){var s=Re;s!==null&&(s.f&zt)!==0&&(t|=zt);var u={ctx:_t,deps:null,nodes:null,f:t|St|jt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{Ms(u),u.f|=Ta}catch(h){throw Rt(u),h}else e!==null&&sr(u);var l=u;if(r&&l.deps===null&&l.teardown===null&&l.nodes===null&&l.first===l.last&&(l.f&Si)===0&&(l=l.first,(t&An)!==0&&(t&$r)!==0&&l!==null&&(l.f|=$r)),l!==null&&(l.parent=s,s!==null&&BE(l,s),be!==null&&(be.f&dt)!==0&&(t&Jr)===0)){var f=be;(f.effects??=[]).push(l)}return u}function Uu(){return be!==null&&!En}function zu(t){const e=or(ba,null,!1);return at(e,yt),e.teardown=t,e}function UE(t){GE();var e=Re.f,r=!be&&(e&er)!==0&&(e&Ta)===0;if(r){var s=_t;(s.e??=[]).push(t)}else return Ef(t)}function Ef(t){return or(Ia|$1,t,!1)}function zE(t){Cn.ensure();const e=or(Jr|Si,t,!0);return(r={})=>new Promise(s=>{r.outro?Kr(e,()=>{Rt(e),s(void 0)}):(Rt(e),s(void 0))})}function wf(t){return or(Ia,t,!1)}function qE(t){return or(Pu|Si,t,!0)}function xf(t,e=0){return or(ba|e,t,!0)}function wn(t,e=[],r=[],s=[]){AE(s,e,r,u=>{or(ba,()=>t(...u.map(Ee)),!0)})}function qu(t,e=0){var r=or(An|e,t,!0);return r}function Kt(t){return or(er|Si,t,!0)}function kf(t){var e=t.teardown;if(e!==null){const r=jr,s=be;hf(!0),Ot(null);try{e.call(null)}finally{hf(r),Ot(s)}}}function Sf(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const u=r.ac;u!==null&&xs(()=>{u.abort(Mi)});var s=r.next;(r.f&Jr)!==0?r.parent=null:Rt(r,e),r=s}}function YE(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&er)===0&&Rt(e),e=r}}function Rt(t,e=!0){var r=!1;(e||(t.f&Fh)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Mf(t.nodes.start,t.nodes.end),r=!0),Sf(t,e&&!r),Pa(t,0),at(t,xr);var s=t.nodes&&t.nodes.t;if(s!==null)for(const l of s)l.stop();kf(t);var u=t.parent;u!==null&&u.first!==null&&If(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Mf(t,e){for(;t!==null;){var r=t===e?null:_s(t);t.remove(),t=r}}function If(t){var e=t.parent,r=t.prev,s=t.next;r!==null&&(r.next=s),s!==null&&(s.prev=r),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=r))}function Kr(t,e,r=!0){var s=[];bf(t,s,!0);var u=()=>{r&&Rt(t),e&&e()},l=s.length;if(l>0){var f=()=>--l||u();for(var h of s)h.out(f)}else u()}function bf(t,e,r){if((t.f&zt)===0){t.f^=zt;var s=t.nodes&&t.nodes.t;if(s!==null)for(const h of s)(h.is_global||r)&&e.push(h);for(var u=t.first;u!==null;){var l=u.next,f=(u.f&$r)!==0||(u.f&er)!==0&&(t.f&An)!==0;bf(u,e,f?r:!1),u=l}}}function Yu(t){Tf(t,!0)}function Tf(t,e){if((t.f&zt)!==0){t.f^=zt,(t.f&yt)===0&&(at(t,St),sr(t));for(var r=t.first;r!==null;){var s=r.next,u=(r.f&$r)!==0||(r.f&er)!==0;Tf(r,u?e:!1),r=s}var l=t.nodes&&t.nodes.t;if(l!==null)for(const f of l)(f.is_global||e)&&f.in()}}function Af(t,e){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end;r!==null;){var u=r===s?null:_s(r);e.append(r),r=u}}const HE=["touchstart","touchmove"];function JE(t){return HE.includes(t)}const Lf=new Set,Hu=new Set;function Oa(t){for(var e=0;e<t.length;e++)Lf.add(t[e]);for(var r of Hu)r(t)}let Cf=null;function Ra(t){var e=this,r=e.ownerDocument,s=t.type,u=t.composedPath?.()||[],l=u[0]||t.target;Cf=t;var f=0,h=Cf===t&&t.__root;if(h){var p=u.indexOf(h);if(p!==-1&&(e===document||e===window)){t.__root=e;return}var d=u.indexOf(e);if(d===-1)return;p<=d&&(f=p)}if(l=u[f]||t.target,l!==e){Ch(t,"currentTarget",{configurable:!0,get(){return l||r}});var v=be,_=Re;Ot(null),Pn(null);try{for(var w,k=[];l!==null;){var M=l.assignedSlot||l.parentNode||l.host||null;try{var R=l["__"+s];R!=null&&(!l.disabled||t.target===l)&&R.call(l,t)}catch(C){w?k.push(C):w=C}if(t.cancelBubble||M===e||M===null)break;l=M}if(w){for(let C of k)queueMicrotask(()=>{throw C});throw w}}finally{t.__root=e,delete t.currentTarget,Ot(v),Pn(_)}}}function Nf(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function bs(t,e){var r=Re;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function Qt(t,e){var r=(e&hE)!==0,s=(e&fE)!==0,u,l=!t.startsWith("<!>");return()=>{u===void 0&&(u=Nf(l?t:"<!>"+t),r||(u=Sr(u)));var f=s||Xh?document.importNode(u,!0):u.cloneNode(!0);if(r){var h=Sr(f),p=f.lastChild;bs(h,p)}else bs(f,f);return f}}function Pf(t=""){{var e=rr(t+"");return bs(e,e),e}}function ur(){var t=document.createDocumentFragment(),e=document.createComment(""),r=rr();return t.append(e,r),bs(e,r),t}function We(t,e){t!==null&&t.before(e)}let Ju=!0;function Ni(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??=t.nodeValue)&&(t.__t=r,t.nodeValue=r+"")}function $E(t,e){return XE(t,e)}const Pi=new Map;function XE(t,{target:e,anchor:r,props:s={},events:u,context:l,intro:f=!0}){EE();var h=new Set,p=_=>{for(var w=0;w<_.length;w++){var k=_[w];if(!h.has(k)){h.add(k);var M=JE(k);e.addEventListener(k,Ra,{passive:M});var R=Pi.get(k);R===void 0?(document.addEventListener(k,Ra,{passive:M}),Pi.set(k,1)):Pi.set(k,R+1)}}};p(Sa(Lf)),Hu.add(p);var d=void 0,v=zE(()=>{var _=r??e.appendChild(rr());return bE(_,{pending:()=>{}},w=>{if(l){bi({});var k=_t;k.c=l}u&&(s.$$events=u),Ju=f,d=t(w,s)||{},Ju=!0,l&&Ti()}),()=>{for(var w of h){e.removeEventListener(w,Ra);var k=Pi.get(w);--k===0?(document.removeEventListener(w,Ra),Pi.delete(w)):Pi.set(w,k)}Hu.delete(p),_!==r&&_.parentNode?.removeChild(_)}});return $u.set(d,v),d}let $u=new WeakMap;function VE(t,e){const r=$u.get(t);return r?($u.delete(t),r(e)):Promise.resolve()}class WE{anchor;#t=new Map;#a=new Map;#e=new Map;#i=new Set;#s=!0;constructor(e,r=!0){this.anchor=e,this.#s=r}#r=()=>{var e=$e;if(this.#t.has(e)){var r=this.#t.get(e),s=this.#a.get(r);if(s)Yu(s),this.#i.delete(r);else{var u=this.#e.get(r);u&&(this.#a.set(r,u.effect),this.#e.delete(r),u.fragment.lastChild.remove(),this.anchor.before(u.fragment),s=u.effect)}for(const[l,f]of this.#t){if(this.#t.delete(l),l===e)break;const h=this.#e.get(f);h&&(Rt(h.effect),this.#e.delete(f))}for(const[l,f]of this.#a){if(l===r||this.#i.has(l))continue;const h=()=>{if(Array.from(this.#t.values()).includes(l)){var d=document.createDocumentFragment();Af(f,d),d.append(rr()),this.#e.set(l,{effect:f,fragment:d})}else Rt(f);this.#i.delete(l),this.#a.delete(l)};this.#s||!s?(this.#i.add(l),Kr(f,h,!1)):h()}}};#n=e=>{this.#t.delete(e);const r=Array.from(this.#t.values());for(const[s,u]of this.#e)r.includes(s)||(Rt(u.effect),this.#e.delete(s))};ensure(e,r){var s=$e,u=jh();if(r&&!this.#a.has(e)&&!this.#e.has(e))if(u){var l=document.createDocumentFragment(),f=rr();l.append(f),this.#e.set(e,{effect:Kt(()=>r(f)),fragment:l})}else this.#a.set(e,Kt(()=>r(this.anchor)));if(this.#t.set(s,e),u){for(const[h,p]of this.#a)h===e?s.skipped_effects.delete(p):s.skipped_effects.add(p);for(const[h,p]of this.#e)h===e?s.skipped_effects.delete(p.effect):s.skipped_effects.add(p.effect);s.oncommit(this.#r),s.ondiscard(this.#n)}else this.#r()}}function Yt(t,e,r=!1){var s=new WE(t),u=r?$r:0;function l(f,h){s.ensure(f,h)}qu(()=>{var f=!1;e((h,p=!0)=>{f=!0,l(p,h)}),f||l(!1,null)},u)}function jE(t,e){return e}function ZE(t,e,r){for(var s=[],u=e.length,l,f=e.length,h=0;h<u;h++){let _=e[h];Kr(_,()=>{if(l){if(l.pending.delete(_),l.done.add(_),l.pending.size===0){var w=t.outrogroups;Xu(Sa(l.done)),w.delete(l),w.size===0&&(t.outrogroups=null)}}else f-=1},!1)}if(f===0){var p=s.length===0&&r!==null;if(p){var d=r,v=d.parentNode;wE(v),v.append(d),t.items.clear()}Xu(e,!p)}else l={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(l)}function Xu(t,e=!0){for(var r=0;r<t.length;r++)Rt(t[r],e)}var Of;function Ts(t,e,r,s,u,l=null){var f=t,h=new Map,p=(e&qh)!==0;if(p){var d=t;f=d.appendChild(rr())}var v=null,_=NE(()=>{var I=r();return Lu(I)?I:I==null?[]:Sa(I)}),w,k=!0;function M(){C.fallback=v,KE(C,w,f,e,s),v!==null&&(w.length===0?(v.f&nr)===0?Yu(v):(v.f^=nr,As(v,null,f)):Kr(v,()=>{v=null}))}var R=qu(()=>{w=Ee(_);for(var I=w.length,A=new Set,Y=$e,$=jh(),J=0;J<I;J+=1){var q=w[J],W=s(q,J),E=k?null:h.get(W);E?(E.v&&Ci(E.v,q),E.i&&Ci(E.i,J),$&&Y.skipped_effects.delete(E.e)):(E=QE(h,k?f:Of??=rr(),q,W,J,u,e,r),k||(E.e.f|=nr),h.set(W,E)),A.add(W)}if(I===0&&l&&!v&&(k?v=Kt(()=>l(f)):(v=Kt(()=>l(Of??=rr())),v.f|=nr)),!k)if($){for(const[S,b]of h)A.has(S)||Y.skipped_effects.add(b.e);Y.oncommit(M),Y.ondiscard(()=>{})}else M();Ee(_)}),C={effect:R,items:h,outrogroups:null,fallback:v};k=!1}function KE(t,e,r,s,u){var l=(s&aE)!==0,f=e.length,h=t.items,p=t.effect.first,d,v=null,_,w=[],k=[],M,R,C,I;if(l)for(I=0;I<f;I+=1)M=e[I],R=u(M,I),C=h.get(R).e,(C.f&nr)===0&&(C.nodes?.a?.measure(),(_??=new Set).add(C));for(I=0;I<f;I+=1){if(M=e[I],R=u(M,I),C=h.get(R).e,t.outrogroups!==null)for(const b of t.outrogroups)b.pending.delete(C),b.done.delete(C);if((C.f&nr)!==0)if(C.f^=nr,C===p)As(C,null,r);else{var A=v?v.next:p;C===t.effect.last&&(t.effect.last=C.prev),C.prev&&(C.prev.next=C.next),C.next&&(C.next.prev=C.prev),Ir(t,v,C),Ir(t,C,A),As(C,A,r),v=C,w=[],k=[],p=v.next;continue}if((C.f&zt)!==0&&(Yu(C),l&&(C.nodes?.a?.unfix(),(_??=new Set).delete(C))),C!==p){if(d!==void 0&&d.has(C)){if(w.length<k.length){var Y=k[0],$;v=Y.prev;var J=w[0],q=w[w.length-1];for($=0;$<w.length;$+=1)As(w[$],Y,r);for($=0;$<k.length;$+=1)d.delete(k[$]);Ir(t,J.prev,q.next),Ir(t,v,J),Ir(t,q,Y),p=Y,v=q,I-=1,w=[],k=[]}else d.delete(C),As(C,p,r),Ir(t,C.prev,C.next),Ir(t,C,v===null?t.effect.first:v.next),Ir(t,v,C),v=C;continue}for(w=[],k=[];p!==null&&p!==C;)(d??=new Set).add(p),k.push(p),p=p.next;if(p===null)continue}(C.f&nr)===0&&w.push(C),v=C,p=C.next}if(t.outrogroups!==null){for(const b of t.outrogroups)b.pending.size===0&&(Xu(Sa(b.done)),t.outrogroups?.delete(b));t.outrogroups.size===0&&(t.outrogroups=null)}if(p!==null||d!==void 0){var W=[];if(d!==void 0)for(C of d)(C.f&zt)===0&&W.push(C);for(;p!==null;)(p.f&zt)===0&&p!==t.fallback&&W.push(p),p=p.next;var E=W.length;if(E>0){var S=(s&qh)!==0&&f===0?r:null;if(l){for(I=0;I<E;I+=1)W[I].nodes?.a?.measure();for(I=0;I<E;I+=1)W[I].nodes?.a?.fix()}ZE(t,W,S)}}l&&vs(()=>{if(_!==void 0)for(C of _)C.nodes?.a?.apply()})}function QE(t,e,r,s,u,l,f,h){var p=(f&iE)!==0?(f&oE)===0?of(r,!1,!1):Vr(r):null,d=(f&sE)!==0?Vr(u):null;return{v:p,i:d,e:Kt(()=>(l(e,p??r,d??u,h),()=>{t.delete(s)}))}}function As(t,e,r){if(t.nodes)for(var s=t.nodes.start,u=t.nodes.end,l=e&&(e.f&nr)===0?e.nodes.start:r;s!==null;){var f=_s(s);if(l.before(s),s===u)return;s=f}}function Ir(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function Rf(t,e,r=!1,s=!1,u=!1){var l=t,f="";wn(()=>{var h=Re;if(f!==(f=e()??"")&&(h.nodes!==null&&(Mf(h.nodes.start,h.nodes.end),h.nodes=null),f!=="")){var p=f+"";r?p=`<svg>${p}</svg>`:s&&(p=`<math>${p}</math>`);var d=Nf(p);if((r||s)&&(d=Sr(d)),bs(Sr(d),d.lastChild),r||s)for(;Sr(d);)l.before(Sr(d));else l.before(d)}})}const ew=()=>performance.now(),lr={tick:t=>requestAnimationFrame(t),now:()=>ew(),tasks:new Set};function Df(){const t=lr.now();lr.tasks.forEach(e=>{e.c(t)||(lr.tasks.delete(e),e.f())}),lr.tasks.size!==0&&lr.tick(Df)}function tw(t){let e;return lr.tasks.size===0&&lr.tick(Df),{promise:new Promise(r=>{lr.tasks.add(e={c:t,f:r})}),abort(){lr.tasks.delete(e)}}}function Da(t,e){xs(()=>{t.dispatchEvent(new CustomEvent(e))})}function nw(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function Ff(t){const e={},r=t.split(";");for(const s of r){const[u,l]=s.split(":");if(!u||l===void 0)break;const f=nw(u.trim());e[f]=l.trim()}return e}const rw=t=>t;function Gf(t,e,r,s){var u=(t&uE)!==0,l=(t&lE)!==0,f=u&&l,h=(t&cE)!==0,p=f?"both":u?"in":"out",d,v=e.inert,_=e.style.overflow,w,k;function M(){return xs(()=>d??=r()(e,s?.()??{},{direction:p}))}var R={is_global:h,in(){if(e.inert=v,!u){k?.abort(),k?.reset?.();return}l||w?.abort(),Da(e,"introstart"),w=Vu(e,M(),k,1,()=>{Da(e,"introend"),w?.abort(),w=d=void 0,e.style.overflow=_})},out(Y){if(!l){Y?.(),d=void 0;return}e.inert=!0,Da(e,"outrostart"),k=Vu(e,M(),w,0,()=>{Da(e,"outroend"),Y?.()})},stop:()=>{w?.abort(),k?.abort()}},C=Re;if((C.nodes.t??=[]).push(R),u&&Ju){var I=h;if(!I){for(var A=C.parent;A&&(A.f&$r)!==0;)for(;(A=A.parent)&&(A.f&An)===0;);I=!A||(A.f&Ta)!==0}I&&wf(()=>{Is(()=>R.in())})}}function Vu(t,e,r,s,u){var l=s===1;if(H1(e)){var f,h=!1;return vs(()=>{if(!h){var C=e({direction:l?"in":"out"});f=Vu(t,C,r,s,u)}}),{abort:()=>{h=!0,f?.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(r?.deactivate(),!e?.duration)return u(),{abort:pn,deactivate:pn,reset:pn,t:()=>s};const{delay:p=0,css:d,tick:v,easing:_=rw}=e;var w=[];if(l&&r===void 0&&(v&&v(0,1),d)){var k=Ff(d(0,1));w.push(k,k)}var M=()=>1-s,R=t.animate(w,{duration:p,fill:"forwards"});return R.onfinish=()=>{R.cancel();var C=r?.t()??1-s;r?.abort();var I=s-C,A=e.duration*Math.abs(I),Y=[];if(A>0){var $=!1;if(d)for(var J=Math.ceil(A/16.666666666666668),q=0;q<=J;q+=1){var W=C+I*_(q/J),E=Ff(d(W,1-W));Y.push(E),$||=E.overflow==="hidden"}$&&(t.style.overflow="hidden"),M=()=>{var S=R.currentTime;return C+I*_(S/A)},v&&tw(()=>{if(R.playState!=="running")return!1;var S=M();return v(S,1-S),!0})}R=t.animate(Y,{duration:A,fill:"forwards"}),R.onfinish=()=>{M=()=>s,v?.(s,1-s),u()}},{abort:()=>{R&&(R.cancel(),R.effect=null,R.onfinish=pn)},deactivate:()=>{u=pn},reset:()=>{s===0&&v?.(1,0)},t:()=>M()}}function Bf(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var u=t.length;for(e=0;e<u;e++)t[e]&&(r=Bf(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function iw(){for(var t,e,r=0,s="",u=arguments.length;r<u;r++)(t=arguments[r])&&(e=Bf(t))&&(s&&(s+=" "),s+=e);return s}function sw(t){return typeof t=="object"?iw(t):t??""}const Uf=[...` 	
\r\f\v\uFEFF`];function aw(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var u in r)if(r[u])s=s?s+" "+u:u;else if(s.length)for(var l=u.length,f=0;(f=s.indexOf(u,f))>=0;){var h=f+l;(f===0||Uf.includes(s[f-1]))&&(h===s.length||Uf.includes(s[h]))?s=(f===0?"":s.substring(0,f))+s.substring(h+1):f=h}}return s===""?null:s}function Ls(t,e,r,s,u,l){var f=t.__className;if(f!==r||f===void 0){var h=aw(r,s,l);h==null?t.removeAttribute("class"):t.className=h,t.__className=r}else if(l&&u!==l)for(var p in l){var d=!!l[p];(u==null||d!==!!u[p])&&t.classList.toggle(p,d)}return l}function zf(t,e,r=!1){if(t.multiple){if(e==null)return;if(!Lu(e))return vE();for(var s of t.options)s.selected=e.includes(Cs(s));return}for(s of t.options){var u=Cs(s);if(_E(u,e)){s.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function ow(t){var e=new MutationObserver(()=>{zf(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),zu(()=>{e.disconnect()})}function uw(t,e,r=e){var s=new WeakSet,u=!0;cf(t,"change",l=>{var f=l?"[selected]":":checked",h;if(t.multiple)h=[].map.call(t.querySelectorAll(f),Cs);else{var p=t.querySelector(f)??t.querySelector("option:not([disabled])");h=p&&Cs(p)}r(h),$e!==null&&s.add($e)}),wf(()=>{var l=e();if(t===document.activeElement){var f=La??$e;if(s.has(f))return}if(zf(t,l,u),u&&l===void 0){var h=t.querySelector(":checked");h!==null&&(l=Cs(h),r(l))}t.__value=l,u=!1}),ow(t)}function Cs(t){return"__value"in t?t.__value:t.value}const lw=Symbol("is custom element"),cw=Symbol("is html");function br(t,e,r,s){var u=hw(t);u[e]!==(u[e]=r)&&(e==="loading"&&(t[X1]=r),r==null?t.removeAttribute(e):typeof r!="string"&&fw(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function hw(t){return t.__attributes??={[lw]:t.nodeName.includes("-"),[cw]:t.namespaceURI===gE}}var qf=new Map;function fw(t){var e=t.getAttribute("is")||t.nodeName,r=qf.get(e);if(r)return r;qf.set(e,r=[]);for(var s,u=t,l=Element.prototype;l!==u;){s=z1(u);for(var f in s)s[f].set&&r.push(f);u=Nh(u)}return r}function gw(t,e,r=e){cf(t,"change",s=>{var u=s?t.defaultChecked:t.checked;r(u)}),Is(e)==null&&r(t.checked),xf(()=>{var s=e();t.checked=!!s})}let Wu=Symbol();function Yf(t,e,r){const s=r[e]??={store:null,source:of(void 0),unsubscribe:pn};if(s.store!==t&&!(Wu in r))if(s.unsubscribe(),s.store=t??null,t==null)s.source.v=void 0,s.unsubscribe=pn;else{var u=!0;s.unsubscribe=Jf(t,l=>{u?s.source.v=l:Mt(s.source,l)}),u=!1}return t&&Wu in r?mw(t):Ee(s.source)}function Hf(){const t={};function e(){zu(()=>{for(var r in t)t[r].unsubscribe();Ch(t,Wu,{enumerable:!1,value:!0})})}return[t,e]}function dw(t){_t===null&&zh(),UE(()=>{const e=Is(t);if(typeof e=="function")return e})}function Jf(t,e,r){if(t==null)return e(void 0),pn;const s=Is(()=>t.subscribe(e,r));return s.unsubscribe?()=>s.unsubscribe():s}const Oi=[];function pw(t,e=pn){let r=null;const s=new Set;function u(h){if(Bh(t,h)&&(t=h,r)){const p=!Oi.length;for(const d of s)d[1](),Oi.push(d,t);if(p){for(let d=0;d<Oi.length;d+=2)Oi[d][0](Oi[d+1]);Oi.length=0}}}function l(h){u(h(t))}function f(h,p=pn){const d=[h,p];return s.add(d),s.size===1&&(r=e(u,l)||pn),h(t),()=>{s.delete(d),s.size===0&&r&&(r(),r=null)}}return{set:u,update:l,subscribe:f}}function mw(t){let e;return Jf(t,r=>e=r)(),e}const vw={controls:Ut(pc),options:Tu().controls,settings:Tu().settings},ju=pw(vw),yw="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(yw);const _w=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.474 17.988h49.045L31.996 46.012zm-3.85 3.37 24.522 28.019a5.113 5.113 0 0 0 7.7 0l24.523-28.02c2.894-3.308.542-8.482-3.85-8.482H7.474a5.113 5.113 0 0 0-3.85 8.482"/>
</svg>
`,Ew=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.474 46.012h49.045L31.996 17.988Zm-3.85-3.37 24.522-28.019a5.113 5.113 0 0 1 7.7 0l24.523 28.02c2.894 3.308.542 8.482-3.85 8.482H7.474a5.113 5.113 0 0 1-3.85-8.482"/>
</svg>
`;var ww=Qt("<option> </option>"),xw=Qt('<label class="svelte-18zciyf"> </label> <select class="svelte-18zciyf"></select>',1),kw=Qt('<label class="svelte-18zciyf"><input type="checkbox" class="svelte-18zciyf"/> </label>'),Sw=Qt('<div class="action-option svelte-18zciyf"><!></div>');function Mw(t,e){bi(e,!0);let r=Nn("");dw(()=>{e.actionOption&&(e.actionOption.type==="select"?Mt(r,e.actionOption.value.value,!0):e.actionOption.type==="toggle"&&Mt(r,e.actionOption.value,!0))});const s=h=>{if(!e.actionInstance||!e.actionOption){ne.error("Can't apply option value",e.actionInstance,e.actionOption);return}if(e.actionOption?.type==="toggle"){const p=h.target;Mt(r,p.checked,!0)}else if(e.actionOption?.type==="select"){const p=h.target;Mt(r,p.value,!0)}e.actionInstance.applyOptionValue(e.name,Ee(r))};var u=ur(),l=vn(u);{var f=h=>{var p=Sw(),d=mn(p);{var v=w=>{var k=xw(),M=vn(k),R=mn(M),C=Es(M,2);C.__change=s,Ts(C,21,()=>e.actionOption.choices,jE,(I,A)=>{var Y=ww(),$=mn(Y),J={};wn(()=>{Ni($,Ee(A).title),J!==(J=Ee(A).value)&&(Y.value=(Y.__value=Ee(A).value)??"")}),We(I,Y)}),wn(()=>{br(M,"for",e.name),Ni(R,e.actionOption.label),br(C,"id",e.name)}),uw(C,()=>Ee(r),I=>Mt(r,I)),We(w,k)},_=w=>{var k=ur(),M=vn(k);{var R=C=>{var I=kw(),A=mn(I);A.__change=s;var Y=Es(A);wn($=>{br(I,"for",e.name),br(A,"id",$),Ni(Y,` ${e.actionOption.label??""}`)},[()=>String(e.name)]),gw(A,()=>Ee(r),$=>Mt(r,$)),We(C,I)};Yt(M,C=>{e.actionOption.type==="toggle"&&typeof Ee(r)=="boolean"&&C(R)},!0)}We(w,k)};Yt(d,w=>{e.actionOption.type==="select"?w(v):w(_,!1)})}We(h,p)};Yt(l,h=>{e.actionOption&&h(f)})}We(t,u),Ti()}Oa(["change"]);var Iw=Qt('<button type="submit" class="sub-action svelte-1xmw7n6"> </button>');function bw(t,e){bi(e,!0);const r=f=>{if(f.preventDefault(),!e.actionInstance||!e.subAction){ne.error("Can't run a SubAction",e.actionInstance,e.subAction);return}e.subAction.method()};var s=ur(),u=vn(s);{var l=f=>{var h=Iw();h.__click=r;var p=mn(h);wn(()=>{br(h,"id",`subaction-${e.name}`),br(h,"title",e.subAction.label),Ni(p,e.subAction.label)}),We(f,h)};Yt(u,f=>{e.subAction&&f(l)})}We(t,s),Ti()}Oa(["click"]);var Tw=Qt("<!> <!>",1);function Aw(t,e){bi(e,!0);const r=Yh("gm"),s=_n(()=>e.control.type),u=_n(()=>e.control.targetMode),l=_n(()=>Ee(s)&&Ee(u)&&r.actionInstances[`${Ee(s)}__${Ee(u)}`]||null);var f=ur(),h=vn(f);{var p=d=>{var v=Tw(),_=vn(v);Ts(_,17,()=>Object.entries(Ee(l).options),([k,M])=>k,(k,M)=>{var R=_n(()=>Ma(Ee(M),2));let C=()=>Ee(R)[0],I=()=>Ee(R)[1];Mw(k,{get name(){return C()},get actionInstance(){return Ee(l)},get actionOption(){return I()}})});var w=Es(_,2);Ts(w,17,()=>Object.entries(Ee(l).actions),([k,M])=>k,(k,M)=>{var R=_n(()=>Ma(Ee(M),2));let C=()=>Ee(R)[0],I=()=>Ee(R)[1];bw(k,{get name(){return C()},get actionInstance(){return Ee(l)},get subAction(){return I()}})}),We(d,v)};Yt(h,d=>{Ee(l)&&d(p)})}We(t,f),Ti()}const{entries:$f,setPrototypeOf:Xf,isFrozen:Lw,getPrototypeOf:Cw,getOwnPropertyDescriptor:Nw}=Object;let{freeze:bt,seal:en,create:Zu}=Object,{apply:Ku,construct:Qu}=typeof Reflect<"u"&&Reflect;bt||(bt=function(e){return e}),en||(en=function(e){return e}),Ku||(Ku=function(e,r){for(var s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];return e.apply(r,u)}),Qu||(Qu=function(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),u=1;u<r;u++)s[u-1]=arguments[u];return new e(...s)});const Fa=At(Array.prototype.forEach),Pw=At(Array.prototype.lastIndexOf),Vf=At(Array.prototype.pop),Ns=At(Array.prototype.push),Ow=At(Array.prototype.splice),Ga=At(String.prototype.toLowerCase),el=At(String.prototype.toString),tl=At(String.prototype.match),Ps=At(String.prototype.replace),Rw=At(String.prototype.indexOf),Dw=At(String.prototype.trim),xn=At(Object.prototype.hasOwnProperty),Tt=At(RegExp.prototype.test),Os=Fw(TypeError);function At(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var r=arguments.length,s=new Array(r>1?r-1:0),u=1;u<r;u++)s[u-1]=arguments[u];return Ku(t,e,s)}}function Fw(t){return function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return Qu(t,r)}}function Me(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ga;Xf&&Xf(t,null);let s=e.length;for(;s--;){let u=e[s];if(typeof u=="string"){const l=r(u);l!==u&&(Lw(e)||(e[s]=l),u=l)}t[u]=!0}return t}function Gw(t){for(let e=0;e<t.length;e++)xn(t,e)||(t[e]=null);return t}function On(t){const e=Zu(null);for(const[r,s]of $f(t))xn(t,r)&&(Array.isArray(s)?e[r]=Gw(s):s&&typeof s=="object"&&s.constructor===Object?e[r]=On(s):e[r]=s);return e}function Rs(t,e){for(;t!==null;){const s=Nw(t,e);if(s){if(s.get)return At(s.get);if(typeof s.value=="function")return At(s.value)}t=Cw(t)}function r(){return null}return r}const Wf=bt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),nl=bt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),rl=bt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Bw=bt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),il=bt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Uw=bt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),jf=bt(["#text"]),Zf=bt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),sl=bt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Kf=bt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ba=bt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),zw=en(/\{\{[\w\W]*|[\w\W]*\}\}/gm),qw=en(/<%[\w\W]*|[\w\W]*%>/gm),Yw=en(/\$\{[\w\W]*/gm),Hw=en(/^data-[\-\w.\u00B7-\uFFFF]+$/),Jw=en(/^aria-[\-\w]+$/),Qf=en(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),$w=en(/^(?:\w+script|data):/i),Xw=en(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),eg=en(/^html$/i),Vw=en(/^[a-z][.\w]*(-[.\w]+)+$/i);var tg=Object.freeze({__proto__:null,ARIA_ATTR:Jw,ATTR_WHITESPACE:Xw,CUSTOM_ELEMENT:Vw,DATA_ATTR:Hw,DOCTYPE_NAME:eg,ERB_EXPR:qw,IS_ALLOWED_URI:Qf,IS_SCRIPT_OR_DATA:$w,MUSTACHE_EXPR:zw,TMPLIT_EXPR:Yw});const Ds={element:1,text:3,progressingInstruction:7,comment:8,document:9},Ww=function(){return typeof window>"u"?null:window},jw=function(e,r){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const u="data-tt-policy-suffix";r&&r.hasAttribute(u)&&(s=r.getAttribute(u));const l="dompurify"+(s?"#"+s:"");try{return e.createPolicy(l,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},ng=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function rg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ww();const e=pe=>rg(pe);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Ds.document||!t.Element)return e.isSupported=!1,e;let{document:r}=t;const s=r,u=s.currentScript,{DocumentFragment:l,HTMLTemplateElement:f,Node:h,Element:p,NodeFilter:d,NamedNodeMap:v=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:_,DOMParser:w,trustedTypes:k}=t,M=p.prototype,R=Rs(M,"cloneNode"),C=Rs(M,"remove"),I=Rs(M,"nextSibling"),A=Rs(M,"childNodes"),Y=Rs(M,"parentNode");if(typeof f=="function"){const pe=r.createElement("template");pe.content&&pe.content.ownerDocument&&(r=pe.content.ownerDocument)}let $,J="";const{implementation:q,createNodeIterator:W,createDocumentFragment:E,getElementsByTagName:S}=r,{importNode:b}=s;let O=ng();e.isSupported=typeof $f=="function"&&typeof Y=="function"&&q&&q.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:P,ERB_EXPR:F,TMPLIT_EXPR:D,DATA_ATTR:L,ARIA_ATTR:B,IS_SCRIPT_OR_DATA:U,ATTR_WHITESPACE:H,CUSTOM_ELEMENT:j}=tg;let{IS_ALLOWED_URI:Z}=tg,re=null;const ce=Me({},[...Wf,...nl,...rl,...il,...jf]);let le=null;const se=Me({},[...Zf,...sl,...Kf,...Ba]);let ue=Object.seal(Zu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ke=null,Ne=null;const X=Object.seal(Zu(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let qn=!0,Te=!0,fe=!1,N=!0,Pe=!1,Ge=!0,Se=!1,$i=!1,oi=!1,Dr=!1,ie=!1,ui=!1,ta=!0,Yn=!1;const tc="user-content-";let we=!0,Mn=!1,In={},Ft=null;const ye=Me({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Xi=null;const Ie=Me({},["audio","video","img","source","image","track"]);let _e=null;const Bo=Me({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Gt="http://www.w3.org/1998/Math/MathML",Vi="http://www.w3.org/2000/svg",me="http://www.w3.org/1999/xhtml";let Fr=me,na=!1,li=null;const Bt=Me({},[Gt,Vi,me],el);let Hn=Me({},["mi","mo","mn","ms","mtext"]),Ct=Me({},["annotation-xml"]);const Uo=Me({},["title","style","font","a","script"]);let Jn=null;const nc=["application/xhtml+xml","text/html"],zo="text/html";let Be=null,oe=null;const Wi=r.createElement("form"),ci=function(G){return G instanceof RegExp||G instanceof Function},vr=function(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(oe&&oe===G)){if((!G||typeof G!="object")&&(G={}),G=On(G),Jn=nc.indexOf(G.PARSER_MEDIA_TYPE)===-1?zo:G.PARSER_MEDIA_TYPE,Be=Jn==="application/xhtml+xml"?el:Ga,re=xn(G,"ALLOWED_TAGS")?Me({},G.ALLOWED_TAGS,Be):ce,le=xn(G,"ALLOWED_ATTR")?Me({},G.ALLOWED_ATTR,Be):se,li=xn(G,"ALLOWED_NAMESPACES")?Me({},G.ALLOWED_NAMESPACES,el):Bt,_e=xn(G,"ADD_URI_SAFE_ATTR")?Me(On(Bo),G.ADD_URI_SAFE_ATTR,Be):Bo,Xi=xn(G,"ADD_DATA_URI_TAGS")?Me(On(Ie),G.ADD_DATA_URI_TAGS,Be):Ie,Ft=xn(G,"FORBID_CONTENTS")?Me({},G.FORBID_CONTENTS,Be):ye,ke=xn(G,"FORBID_TAGS")?Me({},G.FORBID_TAGS,Be):On({}),Ne=xn(G,"FORBID_ATTR")?Me({},G.FORBID_ATTR,Be):On({}),In=xn(G,"USE_PROFILES")?G.USE_PROFILES:!1,qn=G.ALLOW_ARIA_ATTR!==!1,Te=G.ALLOW_DATA_ATTR!==!1,fe=G.ALLOW_UNKNOWN_PROTOCOLS||!1,N=G.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=G.SAFE_FOR_TEMPLATES||!1,Ge=G.SAFE_FOR_XML!==!1,Se=G.WHOLE_DOCUMENT||!1,Dr=G.RETURN_DOM||!1,ie=G.RETURN_DOM_FRAGMENT||!1,ui=G.RETURN_TRUSTED_TYPE||!1,oi=G.FORCE_BODY||!1,ta=G.SANITIZE_DOM!==!1,Yn=G.SANITIZE_NAMED_PROPS||!1,we=G.KEEP_CONTENT!==!1,Mn=G.IN_PLACE||!1,Z=G.ALLOWED_URI_REGEXP||Qf,Fr=G.NAMESPACE||me,Hn=G.MATHML_TEXT_INTEGRATION_POINTS||Hn,Ct=G.HTML_INTEGRATION_POINTS||Ct,ue=G.CUSTOM_ELEMENT_HANDLING||{},G.CUSTOM_ELEMENT_HANDLING&&ci(G.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ue.tagNameCheck=G.CUSTOM_ELEMENT_HANDLING.tagNameCheck),G.CUSTOM_ELEMENT_HANDLING&&ci(G.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ue.attributeNameCheck=G.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),G.CUSTOM_ELEMENT_HANDLING&&typeof G.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ue.allowCustomizedBuiltInElements=G.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(Te=!1),ie&&(Dr=!0),In&&(re=Me({},jf),le=[],In.html===!0&&(Me(re,Wf),Me(le,Zf)),In.svg===!0&&(Me(re,nl),Me(le,sl),Me(le,Ba)),In.svgFilters===!0&&(Me(re,rl),Me(le,sl),Me(le,Ba)),In.mathMl===!0&&(Me(re,il),Me(le,Kf),Me(le,Ba))),G.ADD_TAGS&&(typeof G.ADD_TAGS=="function"?X.tagCheck=G.ADD_TAGS:(re===ce&&(re=On(re)),Me(re,G.ADD_TAGS,Be))),G.ADD_ATTR&&(typeof G.ADD_ATTR=="function"?X.attributeCheck=G.ADD_ATTR:(le===se&&(le=On(le)),Me(le,G.ADD_ATTR,Be))),G.ADD_URI_SAFE_ATTR&&Me(_e,G.ADD_URI_SAFE_ATTR,Be),G.FORBID_CONTENTS&&(Ft===ye&&(Ft=On(Ft)),Me(Ft,G.FORBID_CONTENTS,Be)),G.ADD_FORBID_CONTENTS&&(Ft===ye&&(Ft=On(Ft)),Me(Ft,G.ADD_FORBID_CONTENTS,Be)),we&&(re["#text"]=!0),Se&&Me(re,["html","head","body"]),re.table&&(Me(re,["tbody"]),delete ke.tbody),G.TRUSTED_TYPES_POLICY){if(typeof G.TRUSTED_TYPES_POLICY.createHTML!="function")throw Os('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof G.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Os('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');$=G.TRUSTED_TYPES_POLICY,J=$.createHTML("")}else $===void 0&&($=jw(k,u)),$!==null&&typeof J=="string"&&(J=$.createHTML(""));bt&&bt(G),oe=G}},ra=Me({},[...nl,...rl,...Bw]),ji=Me({},[...il,...Uw]),qo=function(G){let Q=Y(G);(!Q||!Q.tagName)&&(Q={namespaceURI:Fr,tagName:"template"});const ge=Ga(G.tagName),Ye=Ga(Q.tagName);return li[G.namespaceURI]?G.namespaceURI===Vi?Q.namespaceURI===me?ge==="svg":Q.namespaceURI===Gt?ge==="svg"&&(Ye==="annotation-xml"||Hn[Ye]):!!ra[ge]:G.namespaceURI===Gt?Q.namespaceURI===me?ge==="math":Q.namespaceURI===Vi?ge==="math"&&Ct[Ye]:!!ji[ge]:G.namespaceURI===me?Q.namespaceURI===Vi&&!Ct[Ye]||Q.namespaceURI===Gt&&!Hn[Ye]?!1:!ji[ge]&&(Uo[ge]||!ra[ge]):!!(Jn==="application/xhtml+xml"&&li[G.namespaceURI]):!1},ht=function(G){Ns(e.removed,{element:G});try{Y(G).removeChild(G)}catch{C(G)}},$n=function(G,Q){try{Ns(e.removed,{attribute:Q.getAttributeNode(G),from:Q})}catch{Ns(e.removed,{attribute:null,from:Q})}if(Q.removeAttribute(G),G==="is")if(Dr||ie)try{ht(Q)}catch{}else try{Q.setAttribute(G,"")}catch{}},hi=function(G){let Q=null,ge=null;if(oi)G="<remove></remove>"+G;else{const He=tl(G,/^[\r\n\t ]+/);ge=He&&He[0]}Jn==="application/xhtml+xml"&&Fr===me&&(G='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+G+"</body></html>");const Ye=$?$.createHTML(G):G;if(Fr===me)try{Q=new w().parseFromString(Ye,Jn)}catch{}if(!Q||!Q.documentElement){Q=q.createDocument(Fr,"template",null);try{Q.documentElement.innerHTML=na?J:Ye}catch{}}const nt=Q.body||Q.documentElement;return G&&ge&&nt.insertBefore(r.createTextNode(ge),nt.childNodes[0]||null),Fr===me?S.call(Q,Se?"html":"body")[0]:Se?Q.documentElement:nt},Yo=function(G){return W.call(G.ownerDocument||G,G,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Zi=function(G){return G instanceof _&&(typeof G.nodeName!="string"||typeof G.textContent!="string"||typeof G.removeChild!="function"||!(G.attributes instanceof v)||typeof G.removeAttribute!="function"||typeof G.setAttribute!="function"||typeof G.namespaceURI!="string"||typeof G.insertBefore!="function"||typeof G.hasChildNodes!="function")},Ho=function(G){return typeof h=="function"&&G instanceof h};function Qe(pe,G,Q){Fa(pe,ge=>{ge.call(e,G,Q,oe)})}const Ki=function(G){let Q=null;if(Qe(O.beforeSanitizeElements,G,null),Zi(G))return ht(G),!0;const ge=Be(G.nodeName);if(Qe(O.uponSanitizeElement,G,{tagName:ge,allowedTags:re}),Ge&&G.hasChildNodes()&&!Ho(G.firstElementChild)&&Tt(/<[/\w!]/g,G.innerHTML)&&Tt(/<[/\w!]/g,G.textContent)||G.nodeType===Ds.progressingInstruction||Ge&&G.nodeType===Ds.comment&&Tt(/<[/\w]/g,G.data))return ht(G),!0;if(!(X.tagCheck instanceof Function&&X.tagCheck(ge))&&(!re[ge]||ke[ge])){if(!ke[ge]&&Xn(ge)&&(ue.tagNameCheck instanceof RegExp&&Tt(ue.tagNameCheck,ge)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(ge)))return!1;if(we&&!Ft[ge]){const Ye=Y(G)||G.parentNode,nt=A(G)||G.childNodes;if(nt&&Ye){const He=nt.length;for(let ft=He-1;ft>=0;--ft){const Jt=R(nt[ft],!0);Jt.__removalCount=(G.__removalCount||0)+1,Ye.insertBefore(Jt,I(G))}}}return ht(G),!0}return G instanceof p&&!qo(G)||(ge==="noscript"||ge==="noembed"||ge==="noframes")&&Tt(/<\/no(script|embed|frames)/i,G.innerHTML)?(ht(G),!0):(Pe&&G.nodeType===Ds.text&&(Q=G.textContent,Fa([P,F,D],Ye=>{Q=Ps(Q,Ye," ")}),G.textContent!==Q&&(Ns(e.removed,{element:G.cloneNode()}),G.textContent=Q)),Qe(O.afterSanitizeElements,G,null),!1)},Gr=function(G,Q,ge){if(ta&&(Q==="id"||Q==="name")&&(ge in r||ge in Wi))return!1;if(!(Te&&!Ne[Q]&&Tt(L,Q))){if(!(qn&&Tt(B,Q))){if(!(X.attributeCheck instanceof Function&&X.attributeCheck(Q,G))){if(!le[Q]||Ne[Q]){if(!(Xn(G)&&(ue.tagNameCheck instanceof RegExp&&Tt(ue.tagNameCheck,G)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(G))&&(ue.attributeNameCheck instanceof RegExp&&Tt(ue.attributeNameCheck,Q)||ue.attributeNameCheck instanceof Function&&ue.attributeNameCheck(Q,G))||Q==="is"&&ue.allowCustomizedBuiltInElements&&(ue.tagNameCheck instanceof RegExp&&Tt(ue.tagNameCheck,ge)||ue.tagNameCheck instanceof Function&&ue.tagNameCheck(ge))))return!1}else if(!_e[Q]){if(!Tt(Z,Ps(ge,H,""))){if(!((Q==="src"||Q==="xlink:href"||Q==="href")&&G!=="script"&&Rw(ge,"data:")===0&&Xi[G])){if(!(fe&&!Tt(U,Ps(ge,H,"")))){if(ge)return!1}}}}}}}return!0},Xn=function(G){return G!=="annotation-xml"&&tl(G,j)},Vn=function(G){Qe(O.beforeSanitizeAttributes,G,null);const{attributes:Q}=G;if(!Q||Zi(G))return;const ge={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:le,forceKeepAttr:void 0};let Ye=Q.length;for(;Ye--;){const nt=Q[Ye],{name:He,namespaceURI:ft,value:Jt}=nt,yr=Be(He),sa=Jt;let De=He==="value"?sa:Dw(sa);if(ge.attrName=yr,ge.attrValue=De,ge.keepAttr=!0,ge.forceKeepAttr=void 0,Qe(O.uponSanitizeAttribute,G,ge),De=ge.attrValue,Yn&&(yr==="id"||yr==="name")&&($n(He,G),De=tc+De),Ge&&Tt(/((--!?|])>)|<\/(style|title|textarea)/i,De)){$n(He,G);continue}if(yr==="attributename"&&tl(De,"href")){$n(He,G);continue}if(ge.forceKeepAttr)continue;if(!ge.keepAttr){$n(He,G);continue}if(!N&&Tt(/\/>/i,De)){$n(He,G);continue}Pe&&Fa([P,F,D],Qi=>{De=Ps(De,Qi," ")});const _r=Be(G.nodeName);if(!Gr(_r,yr,De)){$n(He,G);continue}if($&&typeof k=="object"&&typeof k.getAttributeType=="function"&&!ft)switch(k.getAttributeType(_r,yr)){case"TrustedHTML":{De=$.createHTML(De);break}case"TrustedScriptURL":{De=$.createScriptURL(De);break}}if(De!==sa)try{ft?G.setAttributeNS(ft,He,De):G.setAttribute(He,De),Zi(G)?ht(G):Vf(e.removed)}catch{$n(He,G)}}Qe(O.afterSanitizeAttributes,G,null)},ia=function pe(G){let Q=null;const ge=Yo(G);for(Qe(O.beforeSanitizeShadowDOM,G,null);Q=ge.nextNode();)Qe(O.uponSanitizeShadowNode,Q,null),Ki(Q),Vn(Q),Q.content instanceof l&&pe(Q.content);Qe(O.afterSanitizeShadowDOM,G,null)};return e.sanitize=function(pe){let G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q=null,ge=null,Ye=null,nt=null;if(na=!pe,na&&(pe="<!-->"),typeof pe!="string"&&!Ho(pe))if(typeof pe.toString=="function"){if(pe=pe.toString(),typeof pe!="string")throw Os("dirty is not a string, aborting")}else throw Os("toString is not a function");if(!e.isSupported)return pe;if($i||vr(G),e.removed=[],typeof pe=="string"&&(Mn=!1),Mn){if(pe.nodeName){const Jt=Be(pe.nodeName);if(!re[Jt]||ke[Jt])throw Os("root node is forbidden and cannot be sanitized in-place")}}else if(pe instanceof h)Q=hi("<!---->"),ge=Q.ownerDocument.importNode(pe,!0),ge.nodeType===Ds.element&&ge.nodeName==="BODY"||ge.nodeName==="HTML"?Q=ge:Q.appendChild(ge);else{if(!Dr&&!Pe&&!Se&&pe.indexOf("<")===-1)return $&&ui?$.createHTML(pe):pe;if(Q=hi(pe),!Q)return Dr?null:ui?J:""}Q&&oi&&ht(Q.firstChild);const He=Yo(Mn?pe:Q);for(;Ye=He.nextNode();)Ki(Ye),Vn(Ye),Ye.content instanceof l&&ia(Ye.content);if(Mn)return pe;if(Dr){if(ie)for(nt=E.call(Q.ownerDocument);Q.firstChild;)nt.appendChild(Q.firstChild);else nt=Q;return(le.shadowroot||le.shadowrootmode)&&(nt=b.call(s,nt,!0)),nt}let ft=Se?Q.outerHTML:Q.innerHTML;return Se&&re["!doctype"]&&Q.ownerDocument&&Q.ownerDocument.doctype&&Q.ownerDocument.doctype.name&&Tt(eg,Q.ownerDocument.doctype.name)&&(ft="<!DOCTYPE "+Q.ownerDocument.doctype.name+`>
`+ft),Pe&&Fa([P,F,D],Jt=>{ft=Ps(ft,Jt," ")}),$&&ui?$.createHTML(ft):ft},e.setConfig=function(){let pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vr(pe),$i=!0},e.clearConfig=function(){oe=null,$i=!1},e.isValidAttribute=function(pe,G,Q){oe||vr({});const ge=Be(pe),Ye=Be(G);return Gr(ge,Ye,Q)},e.addHook=function(pe,G){typeof G=="function"&&Ns(O[pe],G)},e.removeHook=function(pe,G){if(G!==void 0){const Q=Pw(O[pe],G);return Q===-1?void 0:Ow(O[pe],Q,1)[0]}return Vf(O[pe])},e.removeHooks=function(pe){O[pe]=[]},e.removeAllHooks=function(){O=ng()},e}var ig=rg(),Zw=Qt("<div><!></div>"),Kw=Qt('<div><button type="button"><!></button> <!></div>');function Qw(t,e){bi(e,!0);const r=()=>Yf(ju,"$controlsStore",s),[s,u]=Hf(),l=_n(()=>e.controlOptions?.icon?ig.sanitize(e.controlOptions.icon.trim()):null),f=Yh("gm"),h=f.control.getDefaultPosition(),p=()=>{e.control&&e.controlOptions?f.options.toggleMode(e.control.type,e.control.targetMode):ne.error("Control or controlOptions not defined",e.control,e.controlOptions)};var d=ur(),v=vn(d);{var _=w=>{var k=Kw(),M=mn(k);let R;M.__click=p;var C=mn(M);{var I=J=>{var q=ur(),W=vn(q);Rf(W,()=>Ee(l)),We(J,q)},A=J=>{var q=ur(),W=vn(q);{var E=b=>{var O=Pf();wn(P=>Ni(O,P),[()=>e.controlOptions.title.slice(0,2)]),We(b,O)},S=b=>{var O=Pf();wn(()=>Ni(O,e.control.targetMode)),We(b,O)};Yt(W,b=>{e.controlOptions.title?b(E):b(S,!1)},!0)}We(J,q)};Yt(C,J=>{e.controlOptions.icon?J(I):J(A,!1)})}var Y=Es(M,2);{var $=J=>{var q=Zw();let W;var E=mn(q);Aw(E,{get control(){return e.control}}),wn(S=>W=Ls(q,1,"control-menu svelte-1q85gr9",null,W,S),[()=>({"menu-right":h.endsWith("left"),"menu-left":h.endsWith("right")})]),We(J,q)};Yt(Y,J=>{e.controlOptions.active&&J($)})}wn(()=>{Ls(k,1,sw(r().settings.controlsStyles.controlContainerClass),"svelte-1q85gr9"),br(M,"id",`id_${e.control.type}_${e.control.targetMode}`),R=Ls(M,1,`${r().settings.controlsStyles.controlButtonClass} ${e.control.type}-${e.control.targetMode}`,"svelte-1q85gr9",R,{active:e.controlOptions.active}),br(M,"title",e.controlOptions.title)}),We(w,k)};Yt(v,w=>{e.control&&e.controlOptions&&e.controlOptions.uiEnabled&&w(_)})}We(t,d),Ti(),u()}Oa(["click"]);function ex(t){const e=t-1;return e*e*e+1}function sg(t,{delay:e=0,duration:r=400,easing:s=ex,axis:u="y"}={}){const l=getComputedStyle(t),f=+l.opacity,h=u==="y"?"height":"width",p=parseFloat(l[h]),d=u==="y"?["top","bottom"]:["left","right"],v=d.map(I=>`${I[0].toUpperCase()}${I.slice(1)}`),_=parseFloat(l[`padding${v[0]}`]),w=parseFloat(l[`padding${v[1]}`]),k=parseFloat(l[`margin${v[0]}`]),M=parseFloat(l[`margin${v[1]}`]),R=parseFloat(l[`border${v[0]}Width`]),C=parseFloat(l[`border${v[1]}Width`]);return{delay:e,duration:r,easing:s,css:I=>`overflow: hidden;opacity: ${Math.min(I*20,1)*f};${h}: ${I*p}px;padding-${d[0]}: ${I*_}px;padding-${d[1]}: ${I*w}px;margin-${d[0]}: ${I*k}px;margin-${d[1]}: ${I*M}px;border-${d[0]}-width: ${I*R}px;border-${d[1]}-width: ${I*C}px;min-${h}: 0`}}var tx=Qt('<div><button class="gm-control-button"><!></button></div>'),nx=Qt("<div></div>"),rx=Qt("<div></div>"),ix=Qt('<div class="gm-reactive-controls"><!> <!></div>');function sx(t,e){bi(e,!0);const r=()=>Yf(ju,"$controlsStore",s),[s,u]=Hf();let l=Nn(!0),f=_n(()=>r().settings.controlsCollapsible),h=_n(()=>r().settings.controlsStyles);const p=(A,Y)=>r().controls?.[A]?.[Y]||null,d=(A,Y)=>Object.entries(Y).some(([$,J])=>p(A,$)&&J&&J.uiEnabled),v=()=>{Mt(l,!Ee(l))},_=()=>ig.sanitize(Ee(l)?_w:Ew),w=A=>Object.entries(A).map(([Y,$],J)=>({key:Y,options:$,originalIndex:J})).sort((Y,$)=>{const J=Y.options.order??1/0,q=$.options.order??1/0;return J!==q?J-q:Y.originalIndex-$.originalIndex}).map(({key:Y,options:$})=>[Y,$]);var k=ix(),M=mn(k);{var R=A=>{var Y=tx(),$=mn(Y);$.__click=v;var J=mn($);Rf(J,_),wn(()=>Ls(Y,1,`${Ee(h).controlGroupClass} group-settings`)),We(A,Y)};Yt(M,A=>{Ee(f)&&A(R)})}var C=Es(M,2);{var I=A=>{var Y=rx();Ts(Y,5,()=>Object.entries(r().options),([$,J])=>$,($,J)=>{var q=_n(()=>Ma(Ee(J),2));let W=()=>Ee(q)[0],E=()=>Ee(q)[1];var S=ur(),b=vn(S);{var O=P=>{var F=nx();Ts(F,21,()=>w(E()),([D,L])=>D,(D,L)=>{var B=_n(()=>Ma(Ee(L),2));let U=()=>Ee(B)[0],H=()=>Ee(B)[1];const j=_n(()=>p(W(),U()));var Z=ur(),re=vn(Z);{var ce=le=>{Qw(le,{get control(){return Ee(j)},get controlOptions(){return H()}})};Yt(re,le=>{Ee(j)&&le(ce)})}We(D,Z)}),wn(()=>Ls(F,1,`${Ee(h).controlGroupClass} group-${W()}`)),We(P,F)};Yt(b,P=>{d(W(),E())&&P(O)})}We($,S)}),Gf(1,Y,()=>sg,()=>({duration:180})),Gf(2,Y,()=>sg,()=>({duration:140})),We(A,Y)};Yt(C,A=>{Ee(l)&&A(I)})}We(t,k),Ti(),u()}Oa(["click"]);class ax{gm;constructor(e){this.gm=e}}const et=t=>Object.keys(t),al=t=>Object.values(t),cr=(t,e)=>e.includes(t);class ox extends ax{controls=Ut(pc);reactiveControls=null;container=void 0;eventHandlers={[`${ae}:draw`]:this.handleModeEvent.bind(this),[`${ae}:edit`]:this.handleModeEvent.bind(this),[`${ae}:helper`]:this.handleModeEvent.bind(this)};onAdd(){if(this.createControls(),this.gm.events.bus.attachEvents(this.eventHandlers),!this.container)throw new Error("Controls container is not initialized");return this.container}createControls(e=void 0){if(this.controlsAdded()){ne.warn("Can't add controls: controls already added");return}this.container=e||this.createHtmlContainer(),this.createReactivePanel()}onRemove(){this.gm.events.bus.detachEvents(this.eventHandlers),this.reactiveControls&&(VE(this.reactiveControls),this.reactiveControls=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=void 0}handleModeEvent(e){return Go(e)?(["mode_started","mode_ended"].includes(e.action)&&this.updateReactivePanel(),{next:!0}):{next:!0}}controlsAdded(){return!!this.reactiveControls}createReactivePanel(){if(!this.container){ne.error("Can't create reactive panel: container is not initialized");return}this.syncModeStates();const e=new Map;e.set("gm",this.gm),this.reactiveControls=$E(sx,{target:this.container,context:e}),this.updateReactivePanel()}updateReactivePanel(){ju.update(()=>({controls:this.controls,options:this.gm.options.controls,settings:this.gm.options.settings}))}createHtmlContainer(){const e=document.createElement("div");return e.classList.add("geoman-controls"),e}syncModeStates(){this.eachControlWithOptions(({control:e})=>{this.gm.options.syncModeState(e.type,e.targetMode)})}eachControlWithOptions(e){return et(this.controls).forEach(r=>{const s=this.controls[r];return Object.keys(s).forEach(u=>{const l=u,f=this.getControl({modeType:r,modeName:l}),h=this.gm.options.getControlOptions({modeType:r,modeName:l});f&&h&&e({control:f,controlOptions:h})})})}getControl({modeType:e,modeName:r}){return e&&r&&this.controls[e][r]||null}getDefaultPosition(){return this.gm.options.settings.controlsPosition}}class ux{gm;globalEventsListener=null;constructor(e){this.gm=e}get map(){return this.gm.mapAdapter.getMapInstance()}async processEvent(e,r){await this.fireToMap({type:"system",eventName:e.split(":")[1],payload:{...r,level:"user"}}),r.action==="mode_start"||r.action==="mode_end"?await this.forwardModeToggledEvent(r):r.action==="feature_created"?await this.forwardFeatureCreated(r):r.action==="feature_removed"?await this.forwardFeatureRemoved(r):r.action==="feature_updated"?await this.forwardFeatureUpdated(r):r.action==="feature_edit_start"?await this.forwardFeatureEditStart(r):r.action==="feature_edit_end"?await this.forwardFeatureEditEnd(r):(r.action==="loaded"||r.action==="unloaded")&&await this.forwardGeomanLoaded(r)}async forwardModeToggledEvent(e){const r=e.action==="mode_start";if(e.actionType==="draw"){const s="globaldrawmodetoggled",u={name:`${it}:${s}`,actionType:e.actionType,action:e.action,enabled:r,shape:e.mode,map:this.map};await this.fireToMap({type:"converted",eventName:s,payload:u});const l=r?"drawstart":"drawend",f={name:`${it}:${l}`,actionType:e.actionType,action:e.action,shape:e.mode,map:this.map};await this.fireToMap({type:"converted",eventName:l,payload:f})}else if(e.actionType==="edit"){const u=`global${this.getConvertedEditModeName(e.mode)}modetoggled`,l={name:`${it}:${u}`,actionType:e.actionType,action:e.action,enabled:r,map:this.map};await this.fireToMap({type:"converted",eventName:u,payload:l})}else if(e.actionType==="helper"){const s=`global${e.mode}modetoggled`,u={name:`${it}:${s}`,actionType:e.actionType,action:e.action,enabled:r,map:this.map};await this.fireToMap({type:"converted",eventName:s,payload:u})}}async forwardFeatureCreated(e){const r={name:`${it}:create`,actionType:e.actionType,action:e.action,shape:e.mode,feature:e.featureData,map:this.map};await this.fireToMap({type:"converted",eventName:"create",payload:r})}async forwardFeatureRemoved(e){const r={name:`${it}:remove`,actionType:e.actionType,action:e.action,shape:e.mode,feature:e.featureData,map:this.map};await this.fireToMap({type:"converted",eventName:"remove",payload:r})}async forwardFeatureUpdated(e){const r=this.getConvertedEditModeName(e.mode),s=["lasso"],u={name:`${it}:${r}`,actionType:e.actionType,action:e.action,map:this.map};e.sourceFeatures.length===1&&!s.includes(e.mode)?u.originalFeature=e.sourceFeatures[0]:u.originalFeatures=e.sourceFeatures,e.targetFeatures.length===1&&!s.includes(e.mode)?(u.feature=e.targetFeatures[0],u.shape=u.feature.shape):u.features=e.targetFeatures,await this.fireToMap({type:"converted",eventName:`${r}`,payload:u})}async forwardFeatureEditStart(e){const r=this.getConvertedEditModeName(e.mode),s={name:`${it}:${r}start`,actionType:e.actionType,action:e.action,shape:e.feature.shape,feature:e.feature,map:this.map};await this.fireToMap({type:"converted",eventName:`${r}start`,payload:s})}async forwardFeatureEditEnd(e){const r=this.getConvertedEditModeName(e.mode),s={name:`${it}:${r}end`,actionType:e.actionType,action:e.action,shape:e.feature.shape,feature:e.feature,map:this.map};await this.fireToMap({type:"converted",eventName:`${r}end`,payload:s})}async forwardGeomanLoaded(e){const r={name:`${it}:${e.action}`,actionType:e.actionType,action:e.action,map:this.map,[it]:this.gm};await this.fireToMap({type:"converted",eventName:`${r.action}`,payload:r})}async fireToMap({type:e,eventName:r,payload:s}){const l=`${e==="system"?ae:it}:${r}`;if(this.gm.options.settings.awaitDataUpdatesOnEvents&&"feature"in s&&s.feature?.source){const h=s.feature.source.id;await this.gm.features.updateManager.waitForPendingUpdates(h)}this.globalEventsListener?.(s),this.gm.mapAdapter.fire(l,s)}getConvertedEditModeName(e){return e==="change"?"edit":e}}const ol=t=>tn(t)&&t.name===`${ae}:control:switch`,tn=t=>!!(t&&typeof t=="object"&&["level","name","actionType","action"].every(r=>r in t)),lx=t=>!!(t&&typeof t=="object"&&["type","originalEvent","target"].every(r=>r in t));class cx{gm;forwarder;mapEventHandlers={};gmEventHandlers={};constructor(e){this.gm=e,this.forwarder=new ux(e)}pendingForward=Promise.resolve();fireEvent(e,r){const s=this.gmEventHandlers[e];if(!s)return;const{controlHandler:u}=s;u(r),this.pendingForward=this.pendingForward.then(()=>this.forwarder.processEvent(e,r))}attachEvents(e){et(e).forEach(r=>{const s=e[r];s&&this.on(r,s)})}detachEvents(e){et(e).forEach(r=>{const s=e[r];s&&this.off(r,s)})}detachAllEvents(){et(this.gmEventHandlers).forEach(e=>{Array.from(this.gmEventHandlers[e]?.handlers||[]).forEach(s=>{this.off(e,s)})}),et(this.mapEventHandlers).forEach(e=>{Array.from(this.mapEventHandlers[e]?.handlers||[]).forEach(s=>{this.off(e,s)})})}on(e,r){e.startsWith(ae)?this.onGmEvent(e,r):this.onMapEvent(e,r)}onGmEvent(e,r){this.gmEventHandlers[e]||(this.gmEventHandlers[e]=this.createEventSection(e)),this.gmEventHandlers[e]?.handlers.unshift(r)}onMapEvent(e,r){if(!this.mapEventHandlers[e]){const s=this.createEventSection(e);this.gm.mapAdapter.on(e,s.controlHandler),this.mapEventHandlers[e]=s}this.mapEventHandlers[e]?.handlers.unshift(r)}off(e,r){e.startsWith(`${ae}`)?this.offGmEvent(e,r):this.offMapEvent(e,r)}offGmEvent(e,r){const s=this.gmEventHandlers[e]?.handlers||[],u=s.findIndex(l=>r===l);u===-1?ne.warn("MapEvents: handler not found",e,r):(s.splice(u,1),s.length===0&&delete this.gmEventHandlers[e])}offMapEvent(e,r){const s=this.mapEventHandlers[e]?.handlers||[],u=s.findIndex(l=>r===l);if(u===-1)ne.warn("MapEvents: handler not found",e,r);else if(s.splice(u,1),s.length===0){const l=this.mapEventHandlers[e]?.controlHandler;l&&this.gm.mapAdapter.off(e,l),delete this.mapEventHandlers[e]}}createEventSection(e){return{handlers:[],controlHandler:r=>{let s;if(tn(r)&&e.startsWith(`${ae}`)?s=this.gmEventHandlers[e]:s=this.mapEventHandlers[e],!s){ne.debug(`No handlers for eventName: "${e}"`);return}s.handlers.some(u=>{let l;return tn(r)||lx(r)?l=u(r):ne.error("EventsBus: unknown event type",r),l&&typeof l=="object"&&"next"in l?!l.next:(ne.error('EventsBus: handler should return an object with a "next" property'),!1)})}}}}class Ua{gm;constructor(e){this.gm=e}trackExclusiveModes(e){if(e.action!=="mode_start")return;const{sectionName:r,modeName:s}=this.getControlIds(e)||{};this.getControl(e)?.settings.exclusive&&this.gm.control.eachControlWithOptions(l=>{const f=l.control.type,h=l.control.targetMode;f===r&&h===s||l.controlOptions.active&&l.control.settings.exclusive&&this.gm.options.disableMode(f,h)})}trackRelatedModes(e){Go(e)&&this.gm.control.eachControlWithOptions(r=>{const s=r.control,{type:u,targetMode:l}=s;s.settings.enabledBy?.includes(e.mode)&&(e.action==="mode_start"?(this.gm.options.isModeEnabled(u,l)&&this.gm.options.disableMode(u,l),this.gm.options.enableMode(u,l)):e.action==="mode_end"?this.gm.options.disableMode(u,l):ne.error("Unknown mode action",e.action))})}getControl(e){const{modeName:r,sectionName:s}=this.getControlIds(e)||{};return r&&s?this.gm.control.getControl({modeType:s,modeName:r}):null}getControlOptions(e){const{modeName:r,sectionName:s}=this.getControlIds(e)||{};return r&&s?this.gm.options.getControlOptions({modeType:s,modeName:r}):null}getControlIds(e){let r=null,s=null;return e.action==="mode_start"?(r=e.actionType,s=e.mode):ol(e)&&(r=e.section,s=e.mode),r&&s?{sectionName:r,modeName:s}:null}}class hx extends Ua{eventHandlers={[`${ae}:control`]:this.handleControlEvent.bind(this)};constructor(e,r){super(e),r.attachEvents(this.eventHandlers)}handleControlEvent(e){return ol(e)?(this.getControl(e)||ne.error("Control not found, event payload",e),{next:!0}):{next:!0}}}const ag=["draw","edit","helper"],fx=[...ag,"control"],Rn=["marker","circle","circle_marker","ellipse","text_marker","line","rectangle","polygon"],gx=["dom_marker","vertex_marker","center_marker","edge_marker","snap_guide"],og=[...Rn,...gx],ug=["freehand","custom_shape"],ul=[...Rn,...ug],ll=["shape_markers","pin","snapping","snap_guides","measurements","auto_trace","geofencing","zoom_to_features","click_to_edit"],cl=["drag","change","rotate","scale","copy","cut","split","union","difference","line_simplification","lasso","delete"],dx=t=>Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number",hl={id:t=>typeof t=="string"||typeof t=="number",shape:t=>typeof t=="string"&&cr(t,og),center:t=>dx(t),xSemiAxis:t=>typeof t=="number",ySemiAxis:t=>typeof t=="number",angle:t=>typeof t=="number",text:t=>typeof t=="string",disableEdit:t=>typeof t=="boolean"};class za{isMarkerInstanceAvailable(){return this.markerInstance?!0:(ne.error("Marker instance is not available"),!1)}}var ot=63710088e-1,lg={centimeters:ot*100,centimetres:ot*100,degrees:360/(2*Math.PI),feet:ot*3.28084,inches:ot*39.37,kilometers:ot/1e3,kilometres:ot/1e3,meters:ot,metres:ot,miles:ot/1609.344,millimeters:ot*1e3,millimetres:ot*1e3,nauticalmiles:ot/1852,radians:1,yards:ot*1.0936};function nn(t,e,r={}){const s={type:"Feature"};return(r.id===0||r.id)&&(s.id=r.id),r.bbox&&(s.bbox=r.bbox),s.properties=e||{},s.geometry=t,s}function kn(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qa(t[0])||!qa(t[1]))throw new Error("coordinates must contain numbers");return nn({type:"Point",coordinates:t},e,r)}function hr(t,e,r={}){for(const u of t){if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(u[u.length-1].length!==u[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<u[u.length-1].length;l++)if(u[u.length-1][l]!==u[0][l])throw new Error("First and last Position are not equivalent.")}return nn({type:"Polygon",coordinates:t},e,r)}function Tr(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return nn({type:"LineString",coordinates:t},e,r)}function rt(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function px(t,e,r={}){return nn({type:"MultiLineString",coordinates:t},e,r)}function fl(t,e,r={}){return nn({type:"MultiPolygon",coordinates:t},e,r)}function gl(t,e="kilometers"){const r=lg[e];if(!r)throw new Error(e+" units is invalid");return t*r}function dl(t,e="kilometers"){const r=lg[e];if(!r)throw new Error(e+" units is invalid");return t/r}function Qr(t){return t%(2*Math.PI)*180/Math.PI}function ut(t){return t%360*Math.PI/180}function cg(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return gl(dl(t,e),r)}function qa(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Ya(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Ar(t,e,r){if(t!==null)for(var s,u,l,f,h,p,d,v=0,_=0,w,k=t.type,M=k==="FeatureCollection",R=k==="Feature",C=M?t.features.length:1,I=0;I<C;I++){d=M?t.features[I].geometry:R?t.geometry:t,w=d?d.type==="GeometryCollection":!1,h=w?d.geometries.length:1;for(var A=0;A<h;A++){var Y=0,$=0;if(f=w?d.geometries[A]:d,f!==null){p=f.coordinates;var J=f.type;switch(v=r&&(J==="Polygon"||J==="MultiPolygon")?1:0,J){case null:break;case"Point":if(e(p,_,I,Y,$)===!1)return!1;_++,Y++;break;case"LineString":case"MultiPoint":for(s=0;s<p.length;s++){if(e(p[s],_,I,Y,$)===!1)return!1;_++,J==="MultiPoint"&&Y++}J==="LineString"&&Y++;break;case"Polygon":case"MultiLineString":for(s=0;s<p.length;s++){for(u=0;u<p[s].length-v;u++){if(e(p[s][u],_,I,Y,$)===!1)return!1;_++}J==="MultiLineString"&&Y++,J==="Polygon"&&$++}J==="Polygon"&&Y++;break;case"MultiPolygon":for(s=0;s<p.length;s++){for($=0,u=0;u<p[s].length;u++){for(l=0;l<p[s][u].length-v;l++){if(e(p[s][u][l],_,I,Y,$)===!1)return!1;_++}$++}Y++}break;case"GeometryCollection":for(s=0;s<f.geometries.length;s++)if(Ar(f.geometries[s],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Dn(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var r=0;r<t.features.length&&e(t.features[r],r)!==!1;r++);}function mx(t,e,r){var s=r;return Dn(t,function(u,l){l===0&&r===void 0?s=u:s=e(s,u,l)}),s}function Lr(t,e){var r,s,u,l,f,h,p,d,v,_,w=0,k=t.type==="FeatureCollection",M=t.type==="Feature",R=k?t.features.length:1;for(r=0;r<R;r++){for(h=k?t.features[r].geometry:M?t.geometry:t,d=k?t.features[r].properties:M?t.properties:{},v=k?t.features[r].bbox:M?t.bbox:void 0,_=k?t.features[r].id:M?t.id:void 0,p=h?h.type==="GeometryCollection":!1,f=p?h.geometries.length:1,u=0;u<f;u++){if(l=p?h.geometries[u]:h,l===null){if(e(null,w,d,v,_)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,w,d,v,_)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<l.geometries.length;s++)if(e(l.geometries[s],w,d,v,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function vx(t,e,r){var s=r;return Lr(t,function(u,l,f,h,p){s=e(s,u,l,f,h,p)}),s}function Cr(t,e){Lr(t,function(r,s,u,l,f){var h=r===null?null:r.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return e(nn(r,u,{bbox:l,id:f}),s,0)===!1?!1:void 0}var p;switch(h){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var d=0;d<r.coordinates.length;d++){var v=r.coordinates[d],_={type:p,coordinates:v};if(e(nn(_,u),s,d)===!1)return!1}})}function fr(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const r=[1/0,1/0,-1/0,-1/0];return Ar(t,s=>{r[0]>s[0]&&(r[0]=s[0]),r[1]>s[1]&&(r[1]=s[1]),r[2]<s[0]&&(r[2]=s[0]),r[3]<s[1]&&(r[3]=s[1])}),r}var hg=fr;function tt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ht(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Fs(t){return t.type==="Feature"?t.geometry:t}function fg(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function gg(t,e,r,s={}){const u=tt(t),l=ut(u[0]),f=ut(u[1]),h=ut(r),p=dl(e,s.units),d=Math.asin(Math.sin(f)*Math.cos(p)+Math.cos(f)*Math.sin(p)*Math.cos(h)),v=l+Math.atan2(Math.sin(h)*Math.sin(p)*Math.cos(f),Math.cos(p)-Math.sin(f)*Math.sin(d)),_=Qr(v),w=Qr(d);return u[2]!==void 0?kn([_,w,u[2]],s.properties):kn([_,w],s.properties)}function yx(t,e,r={}){const s=r.steps||64,u=r.properties?r.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},l=[];for(let f=0;f<s;f++)l.push(gg(t,e,f*-360/s,r).geometry.coordinates);return l.push(l[0]),hr([l],u)}var _x=yx;function dg(t,e={}){let r=0,s=0,u=0;return Ar(t,function(l){r+=l[0],s+=l[1],u++},!0),kn([r/u,s/u],e.properties)}var pl=dg;function Ex(t,e,r={}){let s;return r.final?s=pg(tt(e),tt(t)):s=pg(tt(t),tt(e)),s>180?-(360-s):s}function pg(t,e){const r=ut(t[1]),s=ut(e[1]);let u=ut(e[0]-t[0]);u>Math.PI&&(u-=2*Math.PI),u<-Math.PI&&(u+=2*Math.PI);const l=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),f=Math.atan2(u,l);return(Qr(f)+360)%360}function wx(t,e,r={}){const s=tt(t),u=tt(e);u[0]+=u[0]-s[0]>180?-360:s[0]-u[0]>180?360:0;const l=xx(s,u);return cg(l,"meters",r.units)}function xx(t,e,r){r=r===void 0?ot:Number(r);const s=r,u=t[1]*Math.PI/180,l=e[1]*Math.PI/180,f=l-u;let h=Math.abs(e[0]-t[0])*Math.PI/180;h>Math.PI&&(h-=2*Math.PI);const p=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(u/2+Math.PI/4)),d=Math.abs(p)>1e-11?f/p:Math.cos(u);return Math.sqrt(f*f+d*d*h*h)*s}function kx(t,e,r,s={}){const u=e<0;let l=cg(Math.abs(e),s.units,"meters");u&&(l=-Math.abs(l));const f=tt(t),h=Sx(f,l,r);return h[0]+=h[0]-f[0]>180?-360:f[0]-h[0]>180?360:0,kn(h,s.properties)}function Sx(t,e,r,s){s=s===void 0?ot:Number(s);const u=e/s,l=t[0]*Math.PI/180,f=ut(t[1]),h=ut(r),p=u*Math.cos(h);let d=f+p;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);const v=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(f/2+Math.PI/4)),_=Math.abs(v)>1e-11?p/v:Math.cos(f),w=u*Math.sin(h)/_;return[((l+w)*180/Math.PI+540)%360-180,d*180/Math.PI]}function Ha(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return mg(t);case"FeatureCollection":return Mx(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ml(t);default:throw new Error("unknown GeoJSON type")}}function mg(t){const e={type:"Feature"};return Object.keys(t).forEach(r=>{switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}}),e.properties=vg(t.properties),t.geometry==null?e.geometry=null:e.geometry=ml(t.geometry),e}function vg(t){const e={};return t&&Object.keys(t).forEach(r=>{const s=t[r];typeof s=="object"?s===null?e[r]=null:Array.isArray(s)?e[r]=s.map(u=>u):e[r]=vg(s):e[r]=s}),e}function Mx(t){const e={type:"FeatureCollection"};return Object.keys(t).forEach(r=>{switch(r){case"type":case"features":return;default:e[r]=t[r]}}),e.features=t.features.map(r=>mg(r)),e}function ml(t){const e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(r=>ml(r)),e):(e.coordinates=yg(t.coordinates),e)}function yg(t){const e=t;return typeof e[0]!="object"?e.slice():e.map(r=>yg(r))}var Ix=Ha;function _g(t,e,r){if(r=r||{},!Ya(r))throw new Error("options is invalid");const s=r.pivot,u=r.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return t;const l=s??dg(t);return(u===!1||u===void 0)&&(t=Ha(t)),Ar(t,function(f){const p=Ex(l,f)+e,d=wx(l,f),v=Ht(kx(l,d,p));f[0]=v[0],f[1]=v[1]}),t}var bx=_g;function Eg(t,e,r,s){s=s||{};let u=s.steps||64;const l=s.units||"kilometers";let f=s.angle||0;const h=s.pivot||t,p=s.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!r)throw new Error("ySemiAxis is required");if(!Ya(s))throw new Error("options must be an object");if(!qa(u))throw new Error("steps must be a number");if(!qa(f))throw new Error("angle must be a number");const d=tt(_g(kn(tt(t)),f,{pivot:h}));f=-90+f,u=Math.ceil(u/4);const v=[],_=[],w=e,k=r,M=k,R=(w-k)/(Math.PI/2),C=(w+k)*Math.PI/4,I=.5,A=u;let Y=0,$=0;for(let q=0;q<u;q++)$+=Y,R===0?Y=C/A/M:Y=(-(R*$+M)+Math.sqrt(Math.pow(R*$+M,2)-4*(I*R)*-(C/A)))/(2*(I*R)),$!=0&&v.push($);_.push(0);for(let q=0;q<v.length;q++)_.push(v[q]);_.push(Math.PI/2);for(let q=0;q<v.length;q++)_.push(Math.PI-v[v.length-q-1]);_.push(Math.PI);for(let q=0;q<v.length;q++)_.push(Math.PI+v[q]);_.push(3*Math.PI/2);for(let q=0;q<v.length;q++)_.push(2*Math.PI-v[v.length-q-1]);_.push(0);const J=[];for(const q of _){const W=Math.atan2(k*Math.sin(q),w*Math.cos(q)),E=Math.sqrt(Math.pow(w,2)*Math.pow(k,2)/(Math.pow(w*Math.sin(W),2)+Math.pow(k*Math.cos(W),2)));J.push(gg(d,E,f+Qr(W),{units:l}).geometry.coordinates)}return hr([J],p)}function wg(t,e,r={}){if(r.final===!0)return Tx(t,e);const s=tt(t),u=tt(e),l=ut(s[0]),f=ut(u[0]),h=ut(s[1]),p=ut(u[1]),d=Math.sin(f-l)*Math.cos(p),v=Math.cos(h)*Math.sin(p)-Math.sin(h)*Math.cos(p)*Math.cos(f-l);return Qr(Math.atan2(d,v))}function Tx(t,e){let r=wg(e,t);return r=(r+180)%360,r}var Ja=wg;function ei(t,e,r={}){var s=tt(t),u=tt(e),l=ut(u[1]-s[1]),f=ut(u[0]-s[0]),h=ut(s[1]),p=ut(u[1]),d=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(h)*Math.cos(p);return gl(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),r.units)}var xg=ei;function vl(t,e={}){const r=Fs(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),r.type){case"Polygon":return kg(r,e);case"MultiPolygon":return Sg(r,e);default:throw new Error("invalid poly")}}function kg(t,e={}){const s=Fs(t).coordinates,u=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Mg(s,u)}function Sg(t,e={}){const s=Fs(t).coordinates,u=e.properties?e.properties:t.type==="Feature"?t.properties:{},l=[];return s.forEach(f=>{l.push(Mg(f,u))}),rt(l)}function Mg(t,e){return t.length>1?px(t,e):Tr(t[0],e)}const yl=(t,e)=>t[0]===e[0]&&t[1]===e[1],Gs=t=>t.type==="Feature"&&t.geometry.type==="LineString",Ig=t=>t.type==="Feature"&&t.geometry.type==="MultiLineString",$a=t=>t.type==="Feature"&&t.geometry.type==="Polygon",Xa=t=>t.type==="Feature"&&t.geometry.type==="MultiPolygon",bg=t=>({type:"FeatureCollection",features:t.geometry.coordinates.map(e=>({type:"Feature",properties:t.properties,geometry:{type:"LineString",coordinates:e}}))}),Va=(t,e)=>({lng:e[0]-t[0],lat:e[1]-t[1]}),Wa=t=>Array.isArray(t)&&t.length>=2&&t.length<=3&&t.every(e=>typeof e=="number"),Ri=(t,e,r=!1)=>{let s=0;const u=["features","geometries","geometry","coordinates"],l=(f,h,p=!1)=>{Wa(f)?(e({coordinate:f,path:h},s),s+=1):Array.isArray(f)?f.forEach((d,v)=>{p&&r&&v===f.length-1&&Wa(d)||l(d,[...h,v],p)}):typeof f=="object"&&f!==null&&et(f).forEach(d=>{const v=f[d];if(u.includes(d)&&v){const _="type"in f&&f.type,w=_==="Polygon"||_==="MultiPolygon";l(v,[...h,d],w)}})};l(t,[])},Tg=(t,e)=>{let r={coordinate:[0,0],path:[]},s=-1;try{Ri(t,(u,l)=>{if(e[0]===u.coordinate[0]&&e[1]===u.coordinate[1])throw s=l,r=u,new Error("stop")})}catch{if(r)return{index:s,coordinate:r.coordinate,path:r.path}}return null},ja=(t,e)=>{let r=0;const s=["features","geometries","geometry","coordinates"],u=(l,f,h,p)=>{Wa(l)&&Wa(f)?(e({start:{coordinate:[...l],path:h},end:{coordinate:[...f],path:p}},r),r+=1):Array.isArray(l)?l.forEach((d,v)=>{u(d,l[v+1],[...h,v],[...h,v+1])}):typeof l=="object"&&l!==null&&et(l).forEach(d=>{const v=l[d];s.includes(d)&&v&&u(v,void 0,[...h,d],[])})};u(t,void 0,[],[])},Za=(t,e)=>{let r={absCoordIndex:-1,featureIndex:-1,multiFeatureIndex:-1,geometryIndex:-1};try{Ar(t,(s,u,l,f,h)=>{if(s[0]===e[0]&&s[1]===e[1])throw r={absCoordIndex:u,featureIndex:l,multiFeatureIndex:f,geometryIndex:h},new Error("found")})}catch{}return r},Ax=(t,e,r={})=>({type:"Feature",properties:r,geometry:{type:"LineString",coordinates:[t,e]}}),Di=(t,e)=>{const[r,s]=t,[u,l]=e,f=Math.min(r,u),h=Math.min(s,l),p=Math.max(r,u),d=Math.max(s,l);return[f,h,p,d]},_l=(t,e)=>{const r=Di(t,e),s=[r[0],r[1]],u=[r[2],r[3]],l=s[0],f=s[1],h=u[0],p=u[1];return{type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[l,f],[h,f],[h,p],[l,p],[l,f]]]}}},Ka=t=>[t.geometry.coordinates[0],t.geometry.coordinates[1]],El=t=>{const e=hg(t);return[[e[0],e[1]],[e[2],e[3]]]},Ag=t=>[t[0][0],t[0][1],t[1][0],t[1][1]],Lx=(t,e)=>{const[r,s,u,l]=t,[f,h]=e;return f>=r&&f<=u&&h>=s&&h<=l},Cx=(t,e)=>{const r=Ag(t);return Lx(r,e)},Qa=t=>{let e=0;return Ar(t,()=>{e+=1},!0),e},Nx=t=>{const e=[];return Ar(t,r=>{e.push([r[0],r[1]])},!0),e},wl=t=>{const e=Nx(t);return e.some(r=>!ki(e[0],r))},xl=t=>{let e=null;try{Ri(t,r=>{throw e=r.coordinate,new Error("found")})}catch{return e}return null},Bs=(t,e)=>Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2),Lg=(t,e,r)=>{const[s,u]=[t[0],t[1]],[l,f]=[e[0],e[1]],[h,p]=[r[0],r[1]],d=l-s,v=f-u,_=h-s,w=p-u,k=_*d+w*v,M=d*d+v*v;let R=k/M;return R=Math.max(0,Math.min(1,R)),[s+R*d,u+R*v]},Px=(t,e)=>{const{absCoordIndex:r}=Za(t,e);return r!==-1?(t.geometry.coordinates.splice(r,1),!0):!1},Ox=(t,e)=>{const r=Za(t,e);if(r.absCoordIndex!==-1){const s=[r.geometryIndex],u=Ei(t.geometry.coordinates,s),l=u.findIndex(f=>ki(f,e));return u.length<=4?(t.geometry.coordinates.splice(r.geometryIndex,1),!0):(u.splice(l,1),l===0&&(u[u.length-1]=[...u[0]]),!0)}return!1},Rx=(t,e)=>{const r=Za(t,e);if(r.absCoordIndex!==-1){const s=[r.multiFeatureIndex,r.geometryIndex],u=Ei(t.geometry.coordinates,s),l=u.findIndex(f=>ki(f,e));if(u.length<=4){s.pop();const f=Ei(t.geometry.coordinates,r.multiFeatureIndex);return f.splice(r.geometryIndex,1),f.length===0&&t.geometry.coordinates.splice(r.multiFeatureIndex,1),!0}return u.splice(l,1),l===0&&(u[u.length-1]=[...u[0]]),!0}return!1},Dx=(t,e)=>Gs(t)?Px(t,e):$a(t)?Ox(t,e):Xa(t)?Rx(t,e):!1,Fx=t=>{let e=0;return ja(t,r=>{e+=ei(r.start.coordinate,r.end.coordinate,{units:"meters"})}),e},Gx=t=>{const e={type:"FeatureCollection",features:[]};return t.features.forEach(r=>{if(Gs(r))e.features.push(r);else if($a(r)){const s=kg(r);Gs(s)?e.features.push(s):Ig(s)&&bg(s).features.forEach(l=>{e.features.push(l)})}else Xa(r)?Sg(r).features.forEach(u=>{Gs(u)?e.features.push(u):Ig(u)&&bg(u).features.forEach(f=>{e.features.push(f)})}):ne.warn("AutoTraceHelper.getFeaturesGeoJsonAsLines: Feature is not supported",r)}),e},Cg=(t,e="marker")=>({type:"Feature",properties:{shape:e},geometry:{type:"Point",coordinates:t}}),kl=({center:t,radius:e,steps:r=80})=>{const s=_x(t,e,{steps:r,units:"meters"});return s.geometry.coordinates[0][0]=[...s.geometry.coordinates[0][0]],s},Ng=({center:t,xSemiAxisLngLat:e,rimLngLat:r})=>{let s=ei(t,e,{units:"meters"});s===0&&(s=1);const u=Ja(t,e)-90;let l=0;if(r){const h=-u*Math.PI/180,d=-(Ja(t,r)-90)*Math.PI/180,v=ei(t,r,{units:"meters"}),_=v*Math.cos(d),w=v*Math.sin(d),k=_*Math.cos(h)+w*Math.sin(h),M=_*-Math.sin(h)+w*Math.cos(h),R=k*k/(s*s);l=Math.abs(M)/Math.sqrt(1-R),isNaN(l)&&(l=0)}return{xSemiAxis:s,ySemiAxis:l,angle:u}},Pg=80,eo=({center:t,xSemiAxis:e,ySemiAxis:r,angle:s,properties:u={}})=>{const l={steps:Pg,angle:s,units:"meters"};if(r===void 0||r===0){const h=Eg(t,e,1,l);return Tr(h.geometry.coordinates[0].slice(0,41),{shape:"line"})}const f=Eg(t,e,r,{...l,properties:{...u,[`${gt}shape`]:"ellipse",[`${gt}center`]:t,[`${gt}xSemiAxis`]:e,[`${gt}ySemiAxis`]:r,[`${gt}angle`]:s}});return f.geometry.coordinates[0][0]=[...f.geometry.coordinates[0][0]],f},Bx=["circle","ellipse","rectangle"];class Fi{gm;id="no-id";parent=null;markers;source;_geoJson=null;constructor(e){this.gm=e.gm,this.id=e.id,this.source=e.source,this.parent=e.parent,this.markers=new Map;const r={...e.geoJsonShapeFeature,properties:{...this.parseExtraProperties(e.geoJsonShapeFeature),...this.parseGmShapeProperties(e.geoJsonShapeFeature)}};if(e.skipSourceUpdate){if(this._geoJson={...r,id:this.id},this.shape==="circle"){const s=Ka(pl(this._geoJson));this._geoJson.properties[`${gt}center`]=s}}else this.addGeoJson(r)}get shape(){const e=this.getShapeProperty("shape");if(typeof e=="string"&&cr(e,og))return e;throw new Error(`Wrong shape type: "${e}"`)}set shape(e){this.setShapeProperty("shape",e)}get temporary(){return this.source.id===K.temporary}get sourceName(){return this.source.id}getShapeProperty(e,r){const s=r?.properties||this._geoJson?.properties||{},u=hl[e],l=s[`${gt}${e}`]??s[e];if(u&&u(l))return l}setShapeProperty(e,r){if(!this._geoJson){ne.error("FeatureData.setShapeProperty(): geojson is not set");return}this._geoJson.properties[`${gt}${e}`]=r,this._updateAllProperties(this._geoJson.properties)}deleteShapeProperty(e){if(!this._geoJson){ne.error("FeatureData.deleteShapeProperty(): geojson is not set");return}delete this._geoJson.properties[`${gt}${e}`],this._updateAllProperties(this._geoJson.properties)}parseGmShapeProperties(e){const r=this.getShapeProperty("shape",e)||this.gm.features.getFeatureShapeByGeoJson(e);r||ne.error(`FeatureData.importGmShapeProperties(): unknown shape: ${r}`);const u={...Object.fromEntries(et(hl).map(l=>[l,this.getShapeProperty(l,e)])),id:this.id,shape:r||void 0};return Object.fromEntries(et(u).filter(l=>u[l]!==void 0).map(l=>[`${gt}${l}`,u[l]]))}parseExtraProperties(e){const r=Ut(e.properties)||{};return et(hl).forEach(s=>{delete r[s],delete r[`${gt}${s}`]}),r}getGeoJson(){if(this._geoJson)return this._geoJson;throw new Error(`Missing GeoJSON for feature: "${this.shape}:${this.id}"`)}addGeoJson(e){if(this._geoJson={...e,id:this.id},this.shape==="circle"){const r=Ka(pl(this._geoJson));this._geoJson.properties[`${gt}center`]=r}this.gm.features.updateManager.updateSource({diff:{add:[this._geoJson]},sourceName:this.sourceName})}removeGeoJson(){if(!this._geoJson)throw new Error(`Feature not found: "${this.id}"`);this.gm.features.updateManager.updateSource({diff:{remove:[this.id]},sourceName:this.sourceName})}removeMarkers(){this.markers.forEach(e=>{e.instance instanceof za?e.instance.remove():this.gm.features.delete(e.instance)}),this.markers=new Map}updateGeometry(e){const r=this.getGeoJson();if(!r)throw new Error(`Feature not found: "${this.id}"`);this._geoJson={...r,geometry:e};const s={update:[this._geoJson]};this.gm.features.updateManager.updateSource({diff:s,sourceName:this.sourceName})}updateGeoJsonGeometry(e){this.updateGeometry(e)}updateProperties(e){if(!this._geoJson)throw new Error(`Feature not found: "${this.id}"`);const r=this.parseGmShapeProperties(this._geoJson),s=new Set(Object.keys(r)),u={};for(const[h,p]of Object.entries(this._geoJson.properties))h in e||(u[h]=p);for(const[h,p]of Object.entries(e))s.has(h)||p!==void 0&&(u[h]=p);Object.assign(u,r),this._geoJson.properties=u;const l={...u};for(const[h,p]of Object.entries(e))s.has(h)||p===void 0&&(l[h]=void 0);const f={update:[{...this._geoJson,properties:l}]};this.gm.features.updateManager.updateSource({diff:f,sourceName:this.sourceName})}setProperties(e){if(!this._geoJson)throw new Error(`Feature not found: "${this.id}"`);const r=this.parseGmShapeProperties(this._geoJson),s={};for(const[l,f]of Object.entries(e))f!==void 0&&!(l in r)&&(s[l]=f);this._geoJson.properties={...s,...r};const u={update:[this._geoJson]};this.gm.features.updateManager.updateSource({diff:u,sourceName:this.sourceName})}_updateAllProperties(e){if(!this._geoJson)throw new Error(`Feature not found: "${this.id}"`);this._geoJson.properties={...this._geoJson.properties,...e};const r={update:[this._geoJson]};this.gm.features.updateManager.updateSource({diff:r,sourceName:this.sourceName})}updateGeoJsonProperties(e){this._updateAllProperties(e)}setGeoJsonCustomProperties(e){this.setProperties(e||{})}updateGeoJsonCustomProperties(e){this.updateProperties(e||{})}deleteGeoJsonCustomProperties(e){const r={};for(const s of e)r[s]=void 0;this.updateProperties(r)}convertToPolygon(){return this.isConvertableToPolygon()?(this.shape="polygon",this.deleteShapeProperty("center"),this.deleteShapeProperty("angle"),this.deleteShapeProperty("xSemiAxis"),this.deleteShapeProperty("ySemiAxis"),!0):!1}isConvertableToPolygon(){return Bx.includes(this.shape)}changeSource({sourceName:e,atomic:r}){if(this.source.id===e){ne.error(`FeatureData.changeSource: feature "${this.id}" already has the source "${e}"`);return}const s=this.gm.features.sources[e];if(!s){ne.error(`FeatureData.changeSource: missing source "${e}"`);return}const u=this.getGeoJson();if(!u){ne.error("FeatureData.changeSource: missing shape GeoJSON");return}this.removeGeoJson(),this.source=s,this.addGeoJson(u),this.markers.forEach(l=>{l.instance instanceof Fi&&l.instance.changeSource({sourceName:e,atomic:r})})}fireFeatureUpdatedEvent({mode:e}){const r={name:`${ae}:edit:feature_updated`,level:"system",actionType:"edit",action:"feature_updated",mode:e,sourceFeatures:[this],targetFeatures:[this],markerData:null};this.gm.events.fire(`${ae}:edit`,r)}delete(){this.removeGeoJson(),this.removeMarkers()}}const to=t=>tn(t)&&t.actionType==="helper",Ux=t=>tn(t)&&t.name===`${ae}:helper:geofencing_violation`;class no{gm;options={};settings={};actions={};flags={featureCreateAllowed:!0,featureUpdateAllowed:!0,actionInProgress:!1};internalEventHandlers={[`${ae}:helper`]:this.handleHelperEvent.bind(this)};constructor(e){this.gm=e}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}startAction(){this.gm.events.bus.attachEvents(this.internalEventHandlers),this.gm.events.bus.attachEvents(this.eventHandlers),this.onStartAction()}endAction(){this.onEndAction(),this.gm.events.bus.detachEvents(this.eventHandlers),this.gm.events.bus.detachEvents(this.internalEventHandlers)}getOptionValue(e){const r=this.options[e];if(!r)throw new Error(`Option ${e} not found`);if(["toggle","hidden"].includes(r.type))return r.value;if(r.type==="select")return r.value.value;throw new Error(`Unknown option type: ${JSON.stringify(r)}`)}getSettingValue(e){if(e in this.settings)return this.settings[e]}applyOptionValue(e,r){const s=this.options[e];if(!s){ne.error("Option not found",e,r);return}if(s.type==="toggle"&&typeof r=="boolean")s.value=r;else if(s.type==="select"){const u=s.choices.find(l=>l.value===r);u&&(s.value=u)}else s.type==="hidden"?s.value=r:ne.error("Can't apply option value",e,r,s)}handleHelperEvent(e){return Ux(e)?this.handleGeofencingViolationEvent(e):{next:!0}}handleGeofencingViolationEvent(e){return e.actionType==="draw"?this.flags.featureCreateAllowed=!1:e.actionType==="edit"&&(this.flags.featureUpdateAllowed=!1),{next:!0}}}const ro=t=>tn(t)&&t.actionType==="draw",Sl=t=>tn(t)&&(t.name===`${ae}:draw:shape`||t.name===`${ae}:draw:shape_with_data`),Ml=t=>Sl(t)&&t.variant==="line_drawer",zx=t=>Sl(t)&&t.variant==="freehand_drawer";class Fn extends no{actionType="draw";shape=null;featureData=null;saveFeature(){if(this.featureData){const e=this.featureData.getGeoJson();this.removeTmpFeature(),this.gm.features.createFeature({sourceName:K.main,shapeGeoJson:e})}else ne.error("BaseDraw.saveFeature: no featureData to save")}removeTmpFeature(){this.featureData&&(this.featureData.temporary||ne.error("Not a temporary feature to remove",this.featureData),this.gm.features.delete(this.featureData),this.featureData=null)}fireBeforeFeatureCreate({geoJsonFeatures:e,forceMode:r=void 0}){this.flags.featureCreateAllowed=!0;const s={name:`${ae}:feature:before_create`,level:"system",actionType:"draw",mode:r||this.mode,action:"before_create",geoJsonFeatures:e};this.gm.events.fire(`${ae}:${this.actionType}`,s)}fireMarkerPointerStartEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,r={name:`${ae}:draw:shape_with_data`,level:"system",variant:null,actionType:"draw",mode:this.shape,action:"start",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${ae}:draw`,r)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,r={name:`${ae}:draw:shape_with_data`,level:"system",variant:null,actionType:"draw",mode:this.shape,action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${ae}:draw`,r)}fireMarkerPointerFinishEvent(){if(!this.shape)return;const e={name:`${ae}:draw:shape`,level:"system",variant:null,actionType:"draw",mode:this.shape,action:"finish"};this.gm.events.fire(`${ae}:draw`,e)}forwardLineDrawerEvent(e){if(!Ml(e)||!this.shape)return{next:!0};if(e.action==="start"||e.action==="update"){const r={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${ae}:draw`,r)}else if(e.action==="finish"||e.action==="cancel"){const r={name:`${ae}:draw:shape`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:e.action};this.gm.events.fire(`${ae}:draw`,r)}return{next:!0}}fireStartEvent(e,r=null){if(!this.shape)return;const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireUpdateEvent(e,r=null){if(!this.shape)return;const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireFinishEvent(){if(!this.shape)return;const e={name:`${ae}:draw:shape`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${ae}:draw`,e)}}class Il extends Fn{mode="circle";shape="circle";eventHandlers={mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)};circleCenterPoint=null;circleCenterLngLat=null;onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.gm.markerPointer.disable(),this.fireFinishEvent()}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}getControlMarkerData(){const e=this.gm.markerPointer.marker;return e?{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}}:null}createFeature(){const e=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(this.circleCenterLngLat||[0,0]),sourceName:K.temporary});return e&&this.circleCenterLngLat&&e.setShapeProperty("center",this.circleCenterLngLat),e}createMarker(){const e=document.createElement("div");e.innerHTML=mc;const r=e.firstChild;return r.style.color="#278cda",r.style.width="28px",r.style.height="28px",r.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"center",element:r},[0,0])}}class qx extends Il{mode="circle_marker";shape="circle_marker";onStartAction(){this.gm.markerPointer.enable({customMarker:this.createMarker()})}onEndAction(){this.fireMarkerPointerFinishEvent(),super.onEndAction()}onMouseMove(){return this.fireMarkerPointerUpdateEvent(),{next:!0}}onMouseClick(e){const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();return this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(),this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.updateFeaturePosition(this.circleCenterLngLat),this.saveFeature()),{next:!1}}updateFeaturePosition(e){if(!this.featureData)return;const r=this.getFeatureGeoJson(e);this.featureData.updateGeoJsonGeometry(r.geometry)}}const Yx=()=>window.PointerEvent&&"maxTouchPoints"in navigator?navigator.maxTouchPoints>0?!window.matchMedia("(hover: hover)").matches:!1:matchMedia("(hover: none)").matches||"ontouchstart"in window?!0:"msMaxTouchPoints"in navigator&&typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0,Nr=(t,e,r=10)=>{const s={...t};return et(t).forEach(u=>{const l=t[u];typeof l=="function"?s[u]=bh(l.bind(e),r,{leading:!0,trailing:!1}):ne.error("convertToThrottled: item is not a function",t[u])}),s},Hx=(t,e,r=10)=>{const s={...t};return et(t).forEach(u=>{const l=t[u];typeof l=="function"?s[u]=Sh(l.bind(e),r,{leading:!1,trailing:!0}):ne.error("convertToDebounced: item is not a function",t[u])}),s},Og=async(t,e)=>{const r="Promise race timeout";await Promise.race([t,new Promise((s,u)=>{setTimeout(()=>u(new Error(`Timeout ${vc/1e3} seconds: ${e||r}`)),vc)})])},Rg=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove","touchcancel"],Jx=["load"];function $x(t){return Rg.includes(t)}function Xx(t){return Jx.includes(t)}const Dg=t=>!!(t&&typeof t=="object"&&"once"in t&&typeof t.once=="function"),Xe=(t,e={warning:!1})=>{if(!t)return e.warning&&ne.warn("Empty event",t),!1;const r=typeof t=="object"&&"lngLat"in t&&"point"in t&&"type"in t&&"originalEvent"in t&&typeof t.type=="string"&&Rg.includes(t.type);return!r&&e.warning&&ne.warn("Not a pointer event",t),r},Vx=t=>t.originalEvent.ctrlKey||t.originalEvent.shiftKey||t.originalEvent.altKey||t.originalEvent.metaKey,Wx=t=>{const e=["symbol","fill","line","circle"];return!!t&&typeof t=="object"&&"type"in t&&e.includes(t.type)};class jx extends Il{mode="circle";shape="circle";throttledMethods=Nr({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay);onMouseClick(e){if(!Xe(e))return{next:!0};const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();if(this.circleCenterPoint&&this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,r)]}),this.flags.featureCreateAllowed&&(this.saveCircleFeature(r),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.fireFinishEvent());else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const s=this.getControlMarkerData();this.featureData&&s&&this.fireStartEvent(this.featureData,s)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterPoint||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(this.featureData&&this.circleCenterLngLat){const r=this.getCircleGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(r.geometry);const s=this.getControlMarkerData();s&&this.fireUpdateEvent(this.featureData,s)}}saveCircleFeature(e){if(this.circleCenterLngLat&&this.featureData){const r=this.gm.markerPointer.marker?.getLngLat()||e;this.updateFeatureGeoJson(r),this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?wl(this.featureData.getGeoJson()):!1}getCircleGeoJson(e,r){const s=this.gm.mapAdapter.getDistance(e,r);return{...kl({center:e,radius:s}),properties:{shape:this.shape}}}}class gr extends no{actionType="helper"}const Fg=t=>!!t&&typeof t=="object"&&t instanceof gr&&"removeSnapGuides"in t&&"updateSnapGuides"in t&&t.mode==="snap_guides"&&typeof t.removeSnapGuides=="function"&&typeof t.updateSnapGuides=="function",Zx=t=>!!t&&typeof t=="object"&&t instanceof gr&&"getShortestPath"in t&&t.mode==="auto_trace"&&typeof t.getShortestPath=="function",Kx=t=>!!t&&typeof t=="object"&&t instanceof gr&&"getSharedMarkers"in t&&t.mode==="pin"&&typeof t.getSharedMarkers=="function";function Qx(t,e={}){var r,s,u,l=e.properties,f=(r=e.autoComplete)!=null?r:!0,h=(s=e.orderCoords)!=null?s:!0,p=(u=e.mutate)!=null?u:!1;if(p||(t=Ha(t)),t.type==="FeatureCollection"){var d=[];return t.features.forEach(function(v){d.push(Ht(Gg(v,{},f,h)))}),fl(d,l)}else return Gg(t,l,f,h)}function Gg(t,e,r,s){e=e||(t.type==="Feature"?t.properties:{});var u=Fs(t),l=u.coordinates,f=u.type;if(!l.length)throw new Error("line must contain coordinates");switch(f){case"LineString":return r&&(l=Bg(l)),hr([l],e);case"MultiLineString":var h=[],p=0;return l.forEach(function(d){if(r&&(d=Bg(d)),s){var v=ek(fr(Tr(d)));v>p?(h.unshift(d),p=v):h.push(d)}else h.push(d)}),hr(h,e);default:throw new Error("geometry type "+f+" is not supported")}}function Bg(t){var e=t[0],r=e[0],s=e[1],u=t[t.length-1],l=u[0],f=u[1];return(r!==l||s!==f)&&t.push(e),t}function ek(t){var e=t[0],r=t[1],s=t[2],u=t[3];return Math.abs(e-s)*Math.abs(r-u)}var bl=Qx;class io extends Fn{mode="line";snappingKey="line_drawer";drawOptions;shapeLngLats=[];throttledMethods=Nr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay);eventHandlers={[`${ae}:helper`]:this.handleGmHelperEvent.bind(this),click:this.onMouseClick.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this)};drawerEventHandlers={firstMarkerClick:null,lastMarkerClick:null,nMarkerClick:null};constructor(e,r={snappingMarkers:"none",targetShape:"line"}){super(e),this.drawOptions=r}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return Fg(e)?e:null}get autoTraceEnabled(){return this.gm.options.controls.helper.auto_trace?.active||!1}get autoTraceHelperInstance(){return this.autoTraceEnabled&&Object.values(this.gm.actionInstances).find(Zx)||null}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.gm.markerPointer.disable(),this.endShape(),this.snapGuidesInstance?.removeSnapGuides(),this.clearDrawerHandlers()}clearDrawerHandlers(){this.drawerEventHandlers.firstMarkerClick=null,this.drawerEventHandlers.lastMarkerClick=null,this.drawerEventHandlers.nMarkerClick=null}handleGmHelperEvent(e){return to(e)?(e.mode==="snap_guides"&&e.action==="mode_start"&&this.updateSnapGuides(),{next:!0}):(ne.error("LineDrawer.handleGmHelperEvent: invalid event",e),{next:!0})}updateSnapGuides(){if(this.snapGuidesInstance){const e=this.featureData?.getGeoJson();e&&e.geometry.coordinates.pop(),this.snapGuidesInstance.updateSnapGuides(e||null,this.shapeLngLats.at(-1)||null,!0)}}on(e,r){this.drawerEventHandlers[e]=r}onMouseClick(e){if(!Xe(e,{warning:!0}))return{next:!0};const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();if(this.featureData){const s=this.getClickedMarkerInfo(e);this.handleNextVertex(r,s)}else this.isFeatureAllowed(Cg(r))&&this.startShape(r);return this.updateSnapGuides(),{next:!0}}handleNextVertex(e,r){if(!this.featureData){ne.error("LineDrawer.handleNextVertex: no featureData");return}const s=this.featureData.markers.size,u=this.getMarkerClickEventData(r.index);r.index<s-1&&this.addPoint(e,r),r.index!==-1&&(r.index===0?this.drawerEventHandlers.firstMarkerClick?.(u):r.index>0&&r.index===s-1&&this.drawerEventHandlers.lastMarkerClick?.(u),r.index>=0&&this.drawerEventHandlers.nMarkerClick?.(u))}getMarkerClickEventData(e){const r=this.getFeatureGeoJson({withControlMarker:!1});return{markerIndex:e,shapeCoordinates:this.getShapeCoordinates({withControlMarker:!1}),geoJson:r,bounds:El(r)}}onMouseMove(e){return Xe(e,{warning:!0})?(this.featureData&&this.shapeLngLats.length&&this.updateFeatureSource(),{next:!0}):{next:!0}}startShape(e){this.shapeLngLats=[e],this.featureData=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson({withControlMarker:!0}),sourceName:K.temporary});const r={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",0]}};this.featureData&&(this.featureData.markers.set(r.position.path.join("."),r),this.setSnapping(),this.fireStartEvent(this.featureData,r)),this.gm.mapAdapter.disableMapInteractions(["doubleClickZoom"])}endShape(){const e=this.getFeatureGeoJson({withControlMarker:!1});this.removeSnapping(),this.removeTmpFeature(),this.shapeLngLats=[],this.gm.mapAdapter.enableMapInteractions(["doubleClickZoom"]),this.fireStopEvent(e)}setSnapping(){if(!this.snappingHelper)return;const e=this.drawOptions.snappingMarkers;e==="none"?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[]):e==="all"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,this.shapeLngLats):e==="first"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[0]]):e==="last"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[this.shapeLngLats.length-1]]):ne.error("LineDrawer.setSnapping: invalid data",e,this.shapeLngLats)}removeSnapping(){this.snappingHelper&&this.snappingHelper.clearCustomSnappingCoordinates(this.snappingKey)}getClickedMarkerInfo(e){if(!this.featureData)return{index:-1,path:null};let r=0,s=null;try{this.featureData.markers.forEach((u,l)=>{if(u.instance instanceof za){const f=u.instance.getElement()||null,h=e.originalEvent.target,p=h instanceof Element?h:null;if(f&&f.contains(p))throw s=l,new Error("stop")}r+=1})}catch{if(s)return{index:r,path:s}}return{index:-1,path:null}}addPoint(e,r){const s=this.featureData;if(!s){ne.error("LineDrawer.addPoint: no featureData");return}const u=this.getAddedLngLats(e,r),l=this.getFeatureGeoJsonWithType({withControlMarker:!0,coordinates:this.shapeLngLats.concat(u)});this.isFeatureAllowed(l)&&(u.forEach(f=>{this.shapeLngLats.push(f);const h=this.addMarker(f,s);this.fireUpdateEvent(s,h)}),this.updateFeatureSource())}isFeatureAllowed(e){return this.gm.getActiveDrawModes().length?(this.fireBeforeFeatureCreate({geoJsonFeatures:[e]}),this.flags.featureCreateAllowed):!0}getAddedLngLats(e,r){if(!this.featureData)return ne.error("LineDrawer.getCurrentLngLats: no featureData"),[];const u=this.getMarkerInfoLngLat(r)||e;return[...this.getAutoTracePath(u)?.slice(1,-1)||[],u]}getAutoTracePath(e){const r=this.shapeLngLats.at(-1);return this.autoTraceEnabled&&this.autoTraceHelperInstance&&r&&this.autoTraceHelperInstance.getShortestPath(r,e)||null}getMarkerInfoLngLat(e){if(this.featureData&&e.path){const r=this.featureData.markers.get(e.path);if(r&&r.type==="dom")return r.instance.getLngLat();ne.error("LineDrawer.addPoint: no markerData",e)}return null}addMarker(e,r){const s={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",this.shapeLngLats.length]}};return r.markers.set(s.position.path.join("."),{type:"dom",instance:s.instance,position:{coordinate:e,path:[]}}),s}createMarker(e){return this.gm.mapAdapter.createDomMarker({element:this.gm.createSvgMarkerElement("control",{pointerEvents:"auto",cursor:"pointer"}),anchor:"center"},e)}updateFeatureSource(){if(this.featureData&&(this.featureData.updateGeoJsonGeometry(this.getFeatureGeoJson({withControlMarker:!0}).geometry),this.gm.markerPointer.marker)){const e={type:"dom",instance:this.gm.markerPointer.marker,position:{coordinate:this.gm.markerPointer.marker.getLngLat(),path:["geometry","coordinates",this.shapeLngLats.length]}};this.fireUpdateEvent(this.featureData,e)}}getFeatureGeoJson({withControlMarker:e,coordinates:r=void 0}){return{type:"Feature",properties:{shape:"line"},geometry:{type:"LineString",coordinates:r||this.getShapeCoordinates({withControlMarker:e})}}}getFeatureGeoJsonWithType({withControlMarker:e,coordinates:r=void 0}){const s=this.getFeatureGeoJson({withControlMarker:e,coordinates:r});return this.drawOptions.targetShape==="polygon"&&s.geometry.coordinates.length>3?bl(s,{properties:s.properties}):s}getShapeCoordinates({withControlMarker:e}){const r=[...this.shapeLngLats];return e&&this.gm.markerPointer.marker&&r.push(this.gm.markerPointer.marker.getLngLat()),r}fireStartEvent(e,r){const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:"line",variant:"line_drawer",action:"start",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireUpdateEvent(e,r){const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:"line",variant:"line_drawer",action:"update",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireStopEvent(e){const r={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:"line",action:"finish",variant:"line_drawer",geoJsonFeature:e,markerData:null,featureData:null};this.gm.events.fire(`${ae}:draw`,r)}}class tk extends Fn{mode="line";shape="line";lineDrawer=new io(this.gm,{snappingMarkers:"first",targetShape:"line"});eventHandlers={[`${ae}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)};onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("nMarkerClick",this.lineFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return Xe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}lineFinished(e){this.lineDrawer.endShape();let r=e.shapeCoordinates;return e.markerIndex>0&&(r=r.slice(0,e.markerIndex+1)),r.length<2?null:this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(r),sourceName:K.main})}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"LineString",coordinates:e}}}}class nk extends Fn{mode="marker";shape="marker";eventHandlers={click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)};onStartAction(){const e=this.createMarker();this.gm.markerPointer.enable({customMarker:e}),this.fireMarkerPointerStartEvent()}onEndAction(){this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseClick(e){return Xe(e)&&(this.featureData=this.createFeature(e),this.featureData&&this.saveFeature()),{next:!1}}onMouseMove(e){return!Xe(e)||!this.gm.markerPointer.marker?{next:!0}:(this.fireMarkerPointerUpdateEvent(),{next:!0})}createFeature(e){const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray(),s=this.getFeatureGeoJson(r);return s&&(this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed)?this.gm.features.createFeature({shapeGeoJson:s,sourceName:K.temporary}):null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}createMarker(e=K.temporary){const s=this.gm.options.layerStyles.marker[e]?.find(_=>_.type==="symbol"),u=s?.paint&&"icon-opacity"in s.paint?s.paint["icon-opacity"]:void 0,l=s?.layout&&"icon-size"in s.layout?s.layout["icon-size"]:void 0,f=36,d=`${l!==void 0?Math.round(f*(l/.18)):f}px`,v=this.gm.createSvgMarkerElement("default",{width:d,height:d,pointerEvents:"none",...u!==void 0&&{opacity:String(u)}});return this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"bottom",element:v},[0,0])}}function rk(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return Dn(t,r=>{var s;switch((s=r.geometry)==null?void 0:s.type){case"Point":e.MultiPoint.coordinates.push(r.geometry.coordinates),e.MultiPoint.properties.push(r.properties);break;case"MultiPoint":e.MultiPoint.coordinates.push(...r.geometry.coordinates),e.MultiPoint.properties.push(r.properties);break;case"LineString":e.MultiLineString.coordinates.push(r.geometry.coordinates),e.MultiLineString.properties.push(r.properties);break;case"MultiLineString":e.MultiLineString.coordinates.push(...r.geometry.coordinates),e.MultiLineString.properties.push(r.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(r.geometry.coordinates),e.MultiPolygon.properties.push(r.properties);break;case"MultiPolygon":e.MultiPolygon.coordinates.push(...r.geometry.coordinates),e.MultiPolygon.properties.push(r.properties);break}}),rt(Object.keys(e).filter(function(r){return e[r].coordinates.length}).sort().map(function(r){var s={type:r,coordinates:e[r].coordinates},u={collectedProperties:e[r].properties};return nn(s,u)}))}var ik=rk;function sk(t,e,r,s,u){Ug(t,e,r||0,s||t.length-1,u||ak)}function Ug(t,e,r,s,u){for(;s>r;){if(s-r>600){var l=s-r+1,f=e-r+1,h=Math.log(l),p=.5*Math.exp(2*h/3),d=.5*Math.sqrt(h*p*(l-p)/l)*(f-l/2<0?-1:1),v=Math.max(r,Math.floor(e-f*p/l+d)),_=Math.min(s,Math.floor(e+(l-f)*p/l+d));Ug(t,e,v,_,u)}var w=t[e],k=r,M=s;for(Us(t,r,e),u(t[s],w)>0&&Us(t,r,s);k<M;){for(Us(t,k,M),k++,M--;u(t[k],w)<0;)k++;for(;u(t[M],w)>0;)M--}u(t[r],w)===0?Us(t,r,M):(M++,Us(t,M,s)),M<=e&&(r=M+1),e<=M&&(s=M-1)}}function Us(t,e,r){var s=t[e];t[e]=t[r],t[r]=s}function ak(t,e){return t<e?-1:t>e?1:0}let Tl=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let r=this.data;const s=[];if(!ao(e,r))return s;const u=this.toBBox,l=[];for(;r;){for(let f=0;f<r.children.length;f++){const h=r.children[f],p=r.leaf?u(h):h;ao(e,p)&&(r.leaf?s.push(h):Ll(e,p)?this._all(h,s):l.push(h))}r=l.pop()}return s}collides(e){let r=this.data;if(!ao(e,r))return!1;const s=[];for(;r;){for(let u=0;u<r.children.length;u++){const l=r.children[u],f=r.leaf?this.toBBox(l):l;if(ao(e,f)){if(r.leaf||Ll(e,f))return!0;s.push(l)}}r=s.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let s=0;s<e.length;s++)this.insert(e[s]);return this}let r=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){const s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Bi([]),this}remove(e,r){if(!e)return this;let s=this.data;const u=this.toBBox(e),l=[],f=[];let h,p,d;for(;s||l.length;){if(s||(s=l.pop(),p=l[l.length-1],h=f.pop(),d=!0),s.leaf){const v=ok(e,s.children,r);if(v!==-1)return s.children.splice(v,1),l.push(s),this._condense(l),this}!d&&!s.leaf&&Ll(s,u)?(l.push(s),f.push(h),h=0,p=s,s=s.children[0]):p?(h++,s=p.children[h],d=!1):s=null}return this}toBBox(e){return e}compareMinX(e,r){return e.minX-r.minX}compareMinY(e,r){return e.minY-r.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,r){const s=[];for(;e;)e.leaf?r.push(...e.children):s.push(...e.children),e=s.pop();return r}_build(e,r,s,u){const l=s-r+1;let f=this._maxEntries,h;if(l<=f)return h=Bi(e.slice(r,s+1)),Gi(h,this.toBBox),h;u||(u=Math.ceil(Math.log(l)/Math.log(f)),f=Math.ceil(l/Math.pow(f,u-1))),h=Bi([]),h.leaf=!1,h.height=u;const p=Math.ceil(l/f),d=p*Math.ceil(Math.sqrt(f));zg(e,r,s,d,this.compareMinX);for(let v=r;v<=s;v+=d){const _=Math.min(v+d-1,s);zg(e,v,_,p,this.compareMinY);for(let w=v;w<=_;w+=p){const k=Math.min(w+p-1,_);h.children.push(this._build(e,w,k,u-1))}}return Gi(h,this.toBBox),h}_chooseSubtree(e,r,s,u){for(;u.push(r),!(r.leaf||u.length-1===s);){let l=1/0,f=1/0,h;for(let p=0;p<r.children.length;p++){const d=r.children[p],v=Al(d),_=ck(e,d)-v;_<f?(f=_,l=v<l?v:l,h=d):_===f&&v<l&&(l=v,h=d)}r=h||r.children[0]}return r}_insert(e,r,s){const u=s?e:this.toBBox(e),l=[],f=this._chooseSubtree(u,this.data,r,l);for(f.children.push(e),qs(f,u);r>=0&&l[r].children.length>this._maxEntries;)this._split(l,r),r--;this._adjustParentBBoxes(u,l,r)}_split(e,r){const s=e[r],u=s.children.length,l=this._minEntries;this._chooseSplitAxis(s,l,u);const f=this._chooseSplitIndex(s,l,u),h=Bi(s.children.splice(f,s.children.length-f));h.height=s.height,h.leaf=s.leaf,Gi(s,this.toBBox),Gi(h,this.toBBox),r?e[r-1].children.push(h):this._splitRoot(s,h)}_splitRoot(e,r){this.data=Bi([e,r]),this.data.height=e.height+1,this.data.leaf=!1,Gi(this.data,this.toBBox)}_chooseSplitIndex(e,r,s){let u,l=1/0,f=1/0;for(let h=r;h<=s-r;h++){const p=zs(e,0,h,this.toBBox),d=zs(e,h,s,this.toBBox),v=hk(p,d),_=Al(p)+Al(d);v<l?(l=v,u=h,f=_<f?_:f):v===l&&_<f&&(f=_,u=h)}return u||s-r}_chooseSplitAxis(e,r,s){const u=e.leaf?this.compareMinX:uk,l=e.leaf?this.compareMinY:lk,f=this._allDistMargin(e,r,s,u),h=this._allDistMargin(e,r,s,l);f<h&&e.children.sort(u)}_allDistMargin(e,r,s,u){e.children.sort(u);const l=this.toBBox,f=zs(e,0,r,l),h=zs(e,s-r,s,l);let p=so(f)+so(h);for(let d=r;d<s-r;d++){const v=e.children[d];qs(f,e.leaf?l(v):v),p+=so(f)}for(let d=s-r-1;d>=r;d--){const v=e.children[d];qs(h,e.leaf?l(v):v),p+=so(h)}return p}_adjustParentBBoxes(e,r,s){for(let u=s;u>=0;u--)qs(r[u],e)}_condense(e){for(let r=e.length-1,s;r>=0;r--)e[r].children.length===0?r>0?(s=e[r-1].children,s.splice(s.indexOf(e[r]),1)):this.clear():Gi(e[r],this.toBBox)}};function ok(t,e,r){if(!r)return e.indexOf(t);for(let s=0;s<e.length;s++)if(r(t,e[s]))return s;return-1}function Gi(t,e){zs(t,0,t.children.length,e,t)}function zs(t,e,r,s,u){u||(u=Bi(null)),u.minX=1/0,u.minY=1/0,u.maxX=-1/0,u.maxY=-1/0;for(let l=e;l<r;l++){const f=t.children[l];qs(u,t.leaf?s(f):f)}return u}function qs(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function uk(t,e){return t.minX-e.minX}function lk(t,e){return t.minY-e.minY}function Al(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function so(t){return t.maxX-t.minX+(t.maxY-t.minY)}function ck(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function hk(t,e){const r=Math.max(t.minX,e.minX),s=Math.max(t.minY,e.minY),u=Math.min(t.maxX,e.maxX),l=Math.min(t.maxY,e.maxY);return Math.max(0,u-r)*Math.max(0,l-s)}function Ll(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function ao(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Bi(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function zg(t,e,r,s,u){const l=[e,r];for(;l.length;){if(r=l.pop(),e=l.pop(),r-e<=s)continue;const f=e+Math.ceil((r-e)/s/2)*s;sk(t,f,e,r,u),l.push(e,f,f,r)}}function fk(t){return vx(t,(e,r)=>e+gk(r),0)}function gk(t){let e=0,r;switch(t.type){case"Polygon":return qg(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)e+=qg(t.coordinates[r]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function qg(t){let e=0;if(t&&t.length>0){e+=Math.abs(Yg(t[0]));for(let r=1;r<t.length;r++)e-=Math.abs(Yg(t[r]))}return e}var dk=ot*ot/2,Cl=Math.PI/180;function Yg(t){const e=t.length-1;if(e<=2)return 0;let r=0,s=0;for(;s<e;){const u=t[s],l=t[s+1===e?0:s+1],f=t[s+2>=e?(s+2)%e:s+2],h=u[0]*Cl,p=l[1]*Cl,d=f[0]*Cl;r+=(d-h)*Math.sin(p),s++}return r*dk}const dr=11102230246251565e-32,Et=134217729,pk=(3+8*dr)*dr;function Nl(t,e,r,s,u){let l,f,h,p,d=e[0],v=s[0],_=0,w=0;v>d==v>-d?(l=d,d=e[++_]):(l=v,v=s[++w]);let k=0;if(_<t&&w<r)for(v>d==v>-d?(f=d+l,h=l-(f-d),d=e[++_]):(f=v+l,h=l-(f-v),v=s[++w]),l=f,h!==0&&(u[k++]=h);_<t&&w<r;)v>d==v>-d?(f=l+d,p=f-l,h=l-(f-p)+(d-p),d=e[++_]):(f=l+v,p=f-l,h=l-(f-p)+(v-p),v=s[++w]),l=f,h!==0&&(u[k++]=h);for(;_<t;)f=l+d,p=f-l,h=l-(f-p)+(d-p),d=e[++_],l=f,h!==0&&(u[k++]=h);for(;w<r;)f=l+v,p=f-l,h=l-(f-p)+(v-p),v=s[++w],l=f,h!==0&&(u[k++]=h);return(l!==0||k===0)&&(u[k++]=l),k}function mk(t,e){let r=e[0];for(let s=1;s<t;s++)r+=e[s];return r}function Ys(t){return new Float64Array(t)}const vk=(3+16*dr)*dr,yk=(2+12*dr)*dr,_k=(9+64*dr)*dr*dr,Ui=Ys(4),Hg=Ys(8),Jg=Ys(12),$g=Ys(16),Lt=Ys(4);function Ek(t,e,r,s,u,l,f){let h,p,d,v,_,w,k,M,R,C,I,A,Y,$,J,q,W,E;const S=t-u,b=r-u,O=e-l,P=s-l;$=S*P,w=Et*S,k=w-(w-S),M=S-k,w=Et*P,R=w-(w-P),C=P-R,J=M*C-($-k*R-M*R-k*C),q=O*b,w=Et*O,k=w-(w-O),M=O-k,w=Et*b,R=w-(w-b),C=b-R,W=M*C-(q-k*R-M*R-k*C),I=J-W,_=J-I,Ui[0]=J-(I+_)+(_-W),A=$+I,_=A-$,Y=$-(A-_)+(I-_),I=Y-q,_=Y-I,Ui[1]=Y-(I+_)+(_-q),E=A+I,_=E-A,Ui[2]=A-(E-_)+(I-_),Ui[3]=E;let F=mk(4,Ui),D=yk*f;if(F>=D||-F>=D||(_=t-S,h=t-(S+_)+(_-u),_=r-b,d=r-(b+_)+(_-u),_=e-O,p=e-(O+_)+(_-l),_=s-P,v=s-(P+_)+(_-l),h===0&&p===0&&d===0&&v===0)||(D=_k*f+pk*Math.abs(F),F+=S*v+P*h-(O*d+b*p),F>=D||-F>=D))return F;$=h*P,w=Et*h,k=w-(w-h),M=h-k,w=Et*P,R=w-(w-P),C=P-R,J=M*C-($-k*R-M*R-k*C),q=p*b,w=Et*p,k=w-(w-p),M=p-k,w=Et*b,R=w-(w-b),C=b-R,W=M*C-(q-k*R-M*R-k*C),I=J-W,_=J-I,Lt[0]=J-(I+_)+(_-W),A=$+I,_=A-$,Y=$-(A-_)+(I-_),I=Y-q,_=Y-I,Lt[1]=Y-(I+_)+(_-q),E=A+I,_=E-A,Lt[2]=A-(E-_)+(I-_),Lt[3]=E;const L=Nl(4,Ui,4,Lt,Hg);$=S*v,w=Et*S,k=w-(w-S),M=S-k,w=Et*v,R=w-(w-v),C=v-R,J=M*C-($-k*R-M*R-k*C),q=O*d,w=Et*O,k=w-(w-O),M=O-k,w=Et*d,R=w-(w-d),C=d-R,W=M*C-(q-k*R-M*R-k*C),I=J-W,_=J-I,Lt[0]=J-(I+_)+(_-W),A=$+I,_=A-$,Y=$-(A-_)+(I-_),I=Y-q,_=Y-I,Lt[1]=Y-(I+_)+(_-q),E=A+I,_=E-A,Lt[2]=A-(E-_)+(I-_),Lt[3]=E;const B=Nl(L,Hg,4,Lt,Jg);$=h*v,w=Et*h,k=w-(w-h),M=h-k,w=Et*v,R=w-(w-v),C=v-R,J=M*C-($-k*R-M*R-k*C),q=p*d,w=Et*p,k=w-(w-p),M=p-k,w=Et*d,R=w-(w-d),C=d-R,W=M*C-(q-k*R-M*R-k*C),I=J-W,_=J-I,Lt[0]=J-(I+_)+(_-W),A=$+I,_=A-$,Y=$-(A-_)+(I-_),I=Y-q,_=Y-I,Lt[1]=Y-(I+_)+(_-q),E=A+I,_=E-A,Lt[2]=A-(E-_)+(I-_),Lt[3]=E;const U=Nl(B,Jg,4,Lt,$g);return $g[U-1]}function wk(t,e,r,s,u,l){const f=(e-l)*(r-u),h=(t-u)*(s-l),p=f-h,d=Math.abs(f+h);return Math.abs(p)>=vk*d?p:-Ek(t,e,r,s,u,l,d)}function xk(t,e){var r,s,u=0,l,f,h,p,d,v,_,w=t[0],k=t[1],M=e.length;for(r=0;r<M;r++){s=0;var R=e[r],C=R.length-1;if(v=R[0],v[0]!==R[C][0]&&v[1]!==R[C][1])throw new Error("First and last coordinates in a ring must be the same");for(f=v[0]-w,h=v[1]-k,s;s<C;s++){if(_=R[s+1],p=_[0]-w,d=_[1]-k,h===0&&d===0){if(p<=0&&f>=0||f<=0&&p>=0)return 0}else if(d>=0&&h<=0||d<=0&&h>=0){if(l=wk(f,p,h,d,0,0),l===0)return 0;(l>0&&d>0&&h<=0||l<0&&d<=0&&h>0)&&u++}v=_,h=d,f=p}}return u%2!==0}function ti(t,e,r={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const s=tt(t),u=Fs(e),l=u.type,f=e.bbox;let h=u.coordinates;if(f&&kk(s,f)===!1)return!1;l==="Polygon"&&(h=[h]);let p=!1;for(var d=0;d<h.length;++d){const v=xk(s,h[d]);if(v===0)return!r.ignoreBoundary;v&&(p=!0)}return p}function kk(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function Sk(t,e){if(t.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");for(var r=t.geometry.coordinates,s=[],u={},l=[],f=0;f<r.length;f++)for(var h=0;h<r[f].length-1;h++)l.push(k(f,h));var p=new Tl;p.load(l);for(var d=0;d<r.length;d++)for(var v=0;v<r[d].length-1;v++){var _=p.search(k(d,v));_.forEach(function(M){var R=M.ring,C=M.edge;w(d,v,R,C)})}return s;function w(M,R,C,I){var A=r[M][R],Y=r[M][R+1],$=r[C][I],J=r[C][I+1],q=Mk(A,Y,$,J);if(q!==null){var W,E;if(Y[0]!==A[0]?W=(q[0]-A[0])/(Y[0]-A[0]):W=(q[1]-A[1])/(Y[1]-A[1]),J[0]!==$[0]?E=(q[0]-$[0])/(J[0]-$[0]):E=(q[1]-$[1])/(J[1]-$[1]),!(W>=1||W<=0||E>=1||E<=0)){var S=q,b=!u[S.toString()];b&&(u[S.toString()]=!0),e&&s.push(e(q,M,R,A,Y,W,C,I,$,J,E,b))}}}function k(M,R){var C=r[M][R],I=r[M][R+1],A,Y,$,J;return C[0]<I[0]?(A=C[0],Y=I[0]):(A=I[0],Y=C[0]),C[1]<I[1]?($=C[1],J=I[1]):($=I[1],J=C[1]),{minX:A,minY:$,maxX:Y,maxY:J,ring:M,edge:R}}}function Mk(t,e,r,s){if(Hs(t,r)||Hs(t,s)||Hs(e,r)||Hs(s,r))return null;var u=t[0],l=t[1],f=e[0],h=e[1],p=r[0],d=r[1],v=s[0],_=s[1],w=(u-f)*(d-_)-(l-h)*(p-v);if(w===0)return null;var k=((u*h-l*f)*(p-v)-(u-f)*(p*_-d*v))/w,M=((u*h-l*f)*(d-_)-(l-h)*(p*_-d*v))/w;return[k,M]}function Hs(t,e){if(!t||!e||t.length!==e.length)return!1;for(var r=0,s=t.length;r<s;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!Hs(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return!0}function Ik(t){if(t.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(t.geometry===void 0||t.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(t.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,r=[],I=0;I<e;I++){var s=t.geometry.coordinates[I];Js(s[0],s[s.length-1])||s.push(s[0]);for(var u=0;u<s.length-1;u++)r.push(s[u])}if(!Tk(r))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var l=r.length,f=Sk(t,function(le,se,ue,ke,Ne,X,qn,Te,fe,N,Pe,Ge){return[le,se,ue,ke,Ne,X,qn,Te,fe,N,Pe,Ge]}),h=f.length;if(h==0){for(var q=[],I=0;I<e;I++)q.push(hr([t.geometry.coordinates[I]],{parent:-1,winding:bk(t.geometry.coordinates[I])}));let le=rt(q);return j(le),Z(le),le}for(var p=[],d=[],I=0;I<e;I++){p.push([]);for(var u=0;u<t.geometry.coordinates[I].length-1;u++)p[I].push([new Xg(t.geometry.coordinates[I][zi(u+1,t.geometry.coordinates[I].length-1)],1,[I,u],[I,zi(u+1,t.geometry.coordinates[I].length-1)],void 0)]),d.push(new Vg(t.geometry.coordinates[I][u],[I,zi(u-1,t.geometry.coordinates[I].length-1)],[I,u],void 0,void 0,!1,!0))}for(var I=0;I<h;I++)p[f[I][1]][f[I][2]].push(new Xg(f[I][0],f[I][5],[f[I][1],f[I][2]],[f[I][6],f[I][7]],void 0)),f[I][11]&&d.push(new Vg(f[I][0],[f[I][1],f[I][2]],[f[I][6],f[I][7]],void 0,void 0,!0,!0));for(var v=d.length,I=0;I<p.length;I++)for(var u=0;u<p[I].length;u++)p[I][u].sort(function(se,ue){return se.param<ue.param?-1:1});for(var _=[],I=0;I<v;I++)_.push({minX:d[I].coord[0],minY:d[I].coord[1],maxX:d[I].coord[0],maxY:d[I].coord[1],index:I});var w=new Tl;w.load(_);for(var I=0;I<p.length;I++)for(var u=0;u<p[I].length;u++)for(var k=0;k<p[I][u].length;k++){let se;k==p[I][u].length-1?se=p[I][zi(u+1,t.geometry.coordinates[I].length-1)][0].coord:se=p[I][u][k+1].coord;var M=w.search({minX:se[0],minY:se[1],maxX:se[0],maxY:se[1]})[0];p[I][u][k].nxtIsectAlongEdgeIn=M.index}for(var I=0;I<p.length;I++)for(var u=0;u<p[I].length;u++)for(var k=0;k<p[I][u].length;k++){let ue=p[I][u][k].coord;var M=w.search({minX:ue[0],minY:ue[1],maxX:ue[0],maxY:ue[1]})[0],R=M.index;R<l?d[R].nxtIsectAlongRingAndEdge2=p[I][u][k].nxtIsectAlongEdgeIn:Js(d[R].ringAndEdge1,p[I][u][k].ringAndEdgeIn)?d[R].nxtIsectAlongRingAndEdge1=p[I][u][k].nxtIsectAlongEdgeIn:d[R].nxtIsectAlongRingAndEdge2=p[I][u][k].nxtIsectAlongEdgeIn}for(var C=[],I=0,u=0;u<e;u++){for(var A=I,k=0;k<t.geometry.coordinates[u].length-1;k++)d[I].coord[0]<d[A].coord[0]&&(A=I),I++;for(var Y=d[A].nxtIsectAlongRingAndEdge2,k=0;k<d.length;k++)if(d[k].nxtIsectAlongRingAndEdge1==A||d[k].nxtIsectAlongRingAndEdge2==A){var $=k;break}var J=oo([d[$].coord,d[A].coord,d[Y].coord],!0)?1:-1;C.push({isect:A,parent:-1,winding:J})}C.sort(function(ce,le){return d[ce.isect].coord>d[le.isect].coord?-1:1});for(var q=[];C.length>0;){var W=C.pop(),E=W.isect,S=W.parent,b=W.winding,O=q.length,P=[d[E].coord],F=E;if(d[E].ringAndEdge1Walkable)var D=d[E].ringAndEdge1,L=d[E].nxtIsectAlongRingAndEdge1;else var D=d[E].ringAndEdge2,L=d[E].nxtIsectAlongRingAndEdge2;for(;!Js(d[E].coord,d[L].coord);){P.push(d[L].coord);for(var B=void 0,I=0;I<C.length;I++)if(C[I].isect==L){B=I;break}if(B!=null&&C.splice(B,1),Js(D,d[L].ringAndEdge1)){if(D=d[L].ringAndEdge2,d[L].ringAndEdge2Walkable=!1,d[L].ringAndEdge1Walkable){var U={isect:L};oo([d[F].coord,d[L].coord,d[d[L].nxtIsectAlongRingAndEdge2].coord],b==1)?(U.parent=S,U.winding=-b):(U.parent=O,U.winding=b),C.push(U)}F=L,L=d[L].nxtIsectAlongRingAndEdge2}else{if(D=d[L].ringAndEdge1,d[L].ringAndEdge1Walkable=!1,d[L].ringAndEdge2Walkable){var U={isect:L};oo([d[F].coord,d[L].coord,d[d[L].nxtIsectAlongRingAndEdge1].coord],b==1)?(U.parent=S,U.winding=-b):(U.parent=O,U.winding=b),C.push(U)}F=L,L=d[L].nxtIsectAlongRingAndEdge1}}P.push(d[L].coord),q.push(hr([P],{index:O,parent:S,winding:b,netWinding:void 0}))}let H=rt(q);j(H),Z(H);function j(ce){for(var le=[],se=0;se<ce.features.length;se++)ce.features[se].properties.parent==-1&&le.push(se);if(le.length>1)for(var se=0;se<le.length;se++){for(var ue=-1,ke=1/0,Ne=0;Ne<ce.features.length;Ne++)le[se]!=Ne&&ti(ce.features[le[se]].geometry.coordinates[0][0],ce.features[Ne],{ignoreBoundary:!0})&&fk(ce.features[Ne])<ke&&(ue=Ne);ce.features[le[se]].properties.parent=ue}}function Z(ce){for(var le=0;le<ce.features.length;le++)if(ce.features[le].properties.parent==-1){var se=ce.features[le].properties.winding;ce.features[le].properties.netWinding=se,re(ce,le,se)}}function re(ce,le,se){for(var ue=0;ue<ce.features.length;ue++)if(ce.features[ue].properties.parent==le){var ke=se+ce.features[ue].properties.winding;ce.features[ue].properties.netWinding=ke,re(ce,ue,ke)}}return H}var Xg=class{constructor(t,e,r,s,u){this.coord=t,this.param=e,this.ringAndEdgeIn=r,this.ringAndEdgeOut=s,this.nxtIsectAlongEdgeIn=u}},Vg=class{constructor(t,e,r,s,u,l,f){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=s,this.nxtIsectAlongRingAndEdge2=u,this.ringAndEdge1Walkable=l,this.ringAndEdge2Walkable=f}};function oo(t,e){if(typeof e>"u"&&(e=!0),t.length!=3)throw new Error("This function requires an array of three points [x,y]");var r=(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0]);return r>=0==e}function bk(t){for(var e=0,r=0;r<t.length-1;r++)t[r][0]<t[e][0]&&(e=r);if(oo([t[zi(e-1,t.length-1)],t[e],t[zi(e+1,t.length-1)]],!0))var s=1;else var s=-1;return s}function Js(t,e){if(!t||!e||t.length!=e.length)return!1;for(var r=0,s=t.length;r<s;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!Js(t[r],e[r]))return!1}else if(t[r]!=e[r])return!1;return!0}function zi(t,e){return(t%e+e)%e}function Tk(t){for(var e={},r=1,s=0,u=t.length;s<u;++s){if(Object.prototype.hasOwnProperty.call(e,t[s].toString())){r=0;break}e[t[s].toString()]=1}return r}function Ak(t){var e=[];return Cr(t,function(r){r.geometry.type==="Polygon"&&Dn(Ik(r),function(s){e.push(hr(s.geometry.coordinates,r.properties))})}),rt(e)}var Lk=Ak;class Ck extends Fn{mode="polygon";shape="polygon";lineDrawer=new io(this.gm,{snappingMarkers:"first",targetShape:"polygon"});eventHandlers={[`${ae}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)};onEndAction(){this.lineDrawer.endAction()}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.polygonFinished.bind(this))}onMouseMove(e){return Xe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}polygonFinished(e){if(this.lineDrawer.endShape(),e.shapeCoordinates.length<3)return;const r=this.fixShapeGeoJson(bl(e.geoJson));r&&this.gm.features.createFeature({shapeGeoJson:{...r,properties:{shape:this.shape}},sourceName:K.main})}fixShapeGeoJson(e){try{return Ix(ik(Lk(e))).features[0]}catch{return null}}}class Nk extends Fn{mode="rectangle";shape="rectangle";startLngLat=null;eventHandlers={mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)};throttledMethods=Nr({updateFeaturePosition:this.updateFeaturePosition},this,this.gm.options.settings.throttlingDelay);onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.startLngLat=null,this.gm.markerPointer.disable(),this.fireFinishEvent()}onMouseClick(e){if(!Xe(e,{warning:!0}))return{next:!1};const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();if(this.startLngLat){const s=this.getFeatureGeoJson(Di(this.startLngLat,r));this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed&&this.finishShape(r)}else{const s=this.getFeatureGeoJson(Di(r,r));if(this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed){const u=this.startShape(r);if(u){const l=this.getControlMarkerData(["geometry","coordinates",4]);this.fireStartEvent(u,l)}}}return{next:!1}}onMouseMove(e){if(!Xe(e,{warning:!0}))return{next:!1};if(!this.startLngLat)return this.fireMarkerPointerUpdateEvent(),{next:!1};const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray(),s=Di(this.startLngLat,r),u=this.getFeatureGeoJson(s);return this.fireBeforeFeatureCreate({geoJsonFeatures:[u]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeaturePosition(s),{next:!1}}startShape(e){this.startLngLat=e;const r=Di(this.startLngLat,this.startLngLat);return this.featureData=this.createFeature(r),this.featureData}finishShape(e){if(this.startLngLat){const r=Di(this.startLngLat,e);this.throttledMethods.updateFeaturePosition(r)}this.featureData&&(this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()),this.startLngLat=null,this.fireFinishEvent()}createFeature(e){return this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:K.temporary})}isFeatureGeoJsonValid(){return this.featureData?wl(this.featureData.getGeoJson()):!1}getFeatureGeoJson(e){return{..._l([e[0],e[1]],[e[2],e[3]]),properties:{shape:this.shape}}}updateFeaturePosition(e){if(!this.featureData)return;const r=_l([e[0],e[1]],[e[2],e[3]]);this.featureData.updateGeoJsonGeometry(r.geometry);const s=this.getControlMarkerData(["geometry","coordinates",4]);this.fireUpdateEvent(this.featureData,s)}getControlMarkerData(e){const r=this.gm.markerPointer.marker;return r?{type:"dom",instance:r,position:{coordinate:r.getLngLat(),path:e}}:null}fireStartEvent(e,r){const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireUpdateEvent(e,r){const s={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:r};this.gm.events.fire(`${ae}:draw`,s)}fireFinishEvent(){const e={name:`${ae}:draw:shape`,level:"system",actionType:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${ae}:draw`,e)}}class Pk extends Fn{mode="text_marker";shape="text_marker";textarea=null;eventHandlers={click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)};onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0})}onEndAction(){this.removeTextarea(),this.removeTmpFeature(),this.featureData=null,this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseMove(e){return Xe(e,{warning:!0})?(this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}onMouseClick(e){if(!Xe(e,{warning:!0}))return{next:!0};if(this.textarea)this.endShape(),this.gm.markerPointer.enable({invisibleMarker:!0,lngLat:e.lngLat.toArray()}),this.fireMarkerPointerUpdateEvent();else{const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(r),this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent())}return{next:!1}}createFeature(e){const r=this.gm.mapAdapter.project(e);return this.createTextarea(r),this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:K.temporary})}endShape(){const e=this.textarea?.value||"";this.removeTextarea(),e.trim()?(this.updateFeatureSource(e),this.saveFeature()):this.removeTmpFeature()}createTextarea(e){this.textarea=document.createElement("textarea"),this.textarea.style.position="absolute",this.textarea.style.left=`${e[0]}px`,this.textarea.style.top=`${e[1]}px`,this.textarea.style.opacity="0.7",this.gm.mapAdapter.getContainer().appendChild(this.textarea),this.textarea.focus()}removeTextarea(){this.textarea?.remove(),this.textarea=null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape,text:""},geometry:{type:"Point",coordinates:e}}}updateFeatureSource(e){this.featureData&&this.featureData._updateAllProperties({shape:this.shape,text:e})}}class Ok extends Il{mode="ellipse";shape="ellipse";xSemiAxisPoint=null;xSemiAxisLngLat=null;throttledMethods=Nr({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay);onMouseClick(e){if(!Xe(e))return{next:!0};const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();if(this.circleCenterLngLat&&this.xSemiAxisLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,r)]}),this.flags.featureCreateAllowed&&(this.saveEllipseFeature(r),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.xSemiAxisPoint=null,this.xSemiAxisLngLat=null,this.fireFinishEvent());else if(this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getEllipseGeoJson(this.circleCenterLngLat,r)]}),this.flags.featureCreateAllowed&&(this.xSemiAxisLngLat=r,this.xSemiAxisPoint=this.gm.mapAdapter.project(this.circleCenterLngLat));else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const s=this.getControlMarkerData();this.featureData&&s&&this.fireStartEvent(this.featureData,s)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.xSemiAxisLngLat?this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,e):this.getEllipseGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterLngLat||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(!this.featureData||!this.circleCenterLngLat)return;const r=this.xSemiAxisLngLat?this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,e):this.getEllipseGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(r.geometry),this.featureData._updateAllProperties({shape:r.properties.shape});const s=this.getControlMarkerData();s&&this.fireUpdateEvent(this.featureData,s)}saveEllipseFeature(e){if(!(!this.circleCenterLngLat||!this.xSemiAxisLngLat)&&this.featureData){const r=this.gm.markerPointer.marker?.getLngLat()||e;this.updateFeatureGeoJson(r);const{xSemiAxis:s,ySemiAxis:u,angle:l}=Ng({center:this.circleCenterLngLat,xSemiAxisLngLat:this.xSemiAxisLngLat,rimLngLat:r});this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.featureData.setShapeProperty("xSemiAxis",s),this.featureData.setShapeProperty("ySemiAxis",u),this.featureData.setShapeProperty("angle",l),this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?wl(this.featureData.getGeoJson()):!1}getEllipseGeoJson(e,r,s){const{xSemiAxis:u,ySemiAxis:l,angle:f}=Ng({center:e,xSemiAxisLngLat:r,rimLngLat:s});return eo({center:e,xSemiAxis:u,ySemiAxis:l,angle:f})}}const uo={marker:nk,ellipse:Ok,circle:jx,circle_marker:qx,text_marker:Pk,line:tk,rectangle:Nk,polygon:Ck,freehand:null,custom_shape:null},Rk=(t,e)=>uo[e]?new uo[e](t):(ne.error(`Draw "${e}" is not available`),null),ni=t=>tn(t)&&t.actionType==="edit",Dk=t=>ag.includes(t),Fk=t=>fx.includes(t),Wg=t=>ul.includes(t),jg=t=>cl.includes(t),Zg=t=>ll.includes(t),Kg=t=>Wg(t)||jg(t)||Zg(t);class Gk extends Ua{eventHandlers={[`${ae}:draw`]:this.handleDrawEvent.bind(this)};constructor(e,r){super(e),r.attachEvents(this.eventHandlers)}handleDrawEvent(e){if(!ro(e))return{next:!0};const r=`${e.actionType}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){const s=Rk(this.gm,r.mode);s&&(e in this.gm.actionInstances&&ne.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=s,s.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof Fn?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for draw event "${e}":`,r)}}class ri extends no{actionType="edit";featureData=null;cursorExcludedLayerIds=["rectangle-line","polygon-line","circle-line"];layerEventHandlersData=[];startAction(){this.setEventsForLayers("mouseenter",this.setCursorToPointer.bind(this)),this.setEventsForLayers("mouseleave",this.setCursorToEmpty.bind(this)),super.startAction()}endAction(){this.clearEventsForLayers(),super.endAction()}setCursorToPointer(){this.flags.actionInProgress||this.gm.mapAdapter.setCursor("pointer")}setCursorToEmpty(){this.flags.actionInProgress||this.gm.mapAdapter.setCursor("")}getFeatureByMouseEvent({event:e,sourceNames:r}){const s=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:r});return!s||s.getShapeProperty("disableEdit")===!0?null:s}setEventsForLayers(e,r){this.gm.features.layers.map(u=>u.id).filter(u=>!this.cursorExcludedLayerIds.some(l=>u.includes(l))).forEach(u=>{this.gm.mapAdapter.on(e,u,r),this.layerEventHandlersData.push({eventName:e,layerId:u,callback:r})})}clearEventsForLayers(){this.layerEventHandlersData.forEach(({eventName:e,layerId:r,callback:s})=>{this.gm.mapAdapter.off(e,r,s)}),this.layerEventHandlersData=[]}updateFeatureGeoJson({featureData:e,featureGeoJson:r,forceMode:s=void 0}){return this.flags.featureUpdateAllowed?(e.updateGeoJsonGeometry(r.geometry),ki(e.getGeoJson().properties,r.properties)||e._updateAllProperties(r.properties),this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:[e],forceMode:s}),!0):!1}fireBeforeFeatureUpdate({features:e,geoJsonFeatures:r,forceMode:s=void 0}){this.flags.featureUpdateAllowed=!0;const u={name:`${ae}:feature:before_update`,level:"system",actionType:"edit",mode:s||this.mode,action:"before_update",features:e,geoJsonFeatures:r};this.gm.events.fire(`${ae}:${this.actionType}`,u)}fireFeatureUpdatedEvent({sourceFeatures:e,targetFeatures:r,markerData:s=void 0,forceMode:u=void 0}){const l={name:`${ae}:edit:feature_updated`,level:"system",actionType:"edit",action:"feature_updated",mode:u||this.mode,sourceFeatures:e,targetFeatures:r,markerData:s||null};this.gm.events.fire(`${ae}:edit`,l)}fireFeatureEditStartEvent({feature:e,forceMode:r=void 0}){const s={name:`${ae}:edit:feature_edit_start`,level:"system",actionType:"edit",action:"feature_edit_start",mode:r||this.mode,feature:e};this.gm.events.fire(`${ae}:edit`,s)}fireFeatureEditEndEvent({feature:e,forceMode:r=void 0}){const s={name:`${ae}:edit:feature_edit_end`,level:"system",actionType:"edit",action:"feature_edit_end",mode:r||this.mode,feature:e};this.gm.events.fire(`${ae}:edit`,s)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker)return;const e=this.gm.markerPointer.marker,r={name:`${ae}:draw:shape_with_data`,level:"system",variant:null,actionType:"draw",mode:this.getLineDrawerMode(),action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:null};this.gm.events.fire(`${ae}:draw`,r)}forwardLineDrawerEvent(e){if(!Ml(e)||!["cut","split"].includes(this.mode))return{next:!0};if(e.action==="start"||e.action==="update"){const r={name:`${ae}:draw:shape_with_data`,level:"system",actionType:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${ae}:draw`,r)}else if(e.action==="finish"||e.action==="cancel"){const r={name:`${ae}:draw:shape`,level:"system",actionType:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action};this.gm.events.fire(`${ae}:draw`,r)}return{next:!0}}fireFeatureRemovedEvent(e){if(cr(e.shape,Rn)){const r={name:`${ae}:edit:feature_removed`,level:"system",actionType:"edit",mode:e.shape,action:"feature_removed",featureData:e};this.gm.events.fire(`${ae}:edit`,r)}}getLineDrawerMode(){return this.mode==="cut"?"polygon":(this.mode==="split","line")}}function Bk(t,e={}){const r=fr(t),s=(r[0]+r[2])/2,u=(r[1]+r[3])/2;return kn([s,u],e.properties,e)}var lo={exports:{}},Uk=lo.exports,Qg;function zk(){return Qg||(Qg=1,(function(t,e){(function(r,s){t.exports=s()})(Uk,(function(){function r(o,n){(n==null||n>o.length)&&(n=o.length);for(var i=0,a=Array(n);i<n;i++)a[i]=o[i];return a}function s(o,n,i){return n=v(n),(function(a,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g})(a)})(o,w()?Reflect.construct(n,i||[],v(o).constructor):n.apply(o,i))}function u(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function l(o,n,i){if(w())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,n);var c=new(o.bind.apply(o,a));return i&&k(c,i.prototype),c}function f(o,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,C(a.key),a)}}function h(o,n,i){return n&&f(o.prototype,n),i&&f(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o}function p(o,n){var i=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!i){if(Array.isArray(o)||(i=I(o))||n){i&&(o=i);var a=0,c=function(){};return{s:c,n:function(){return a>=o.length?{done:!0}:{done:!1,value:o[a++]}},e:function(x){throw x},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g,m=!0,y=!1;return{s:function(){i=i.call(o)},n:function(){var x=i.next();return m=x.done,x},e:function(x){y=!0,g=x},f:function(){try{m||i.return==null||i.return()}finally{if(y)throw g}}}}function d(){return d=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(o,n,i){var a=(function(g,m){for(;!{}.hasOwnProperty.call(g,m)&&(g=v(g))!==null;);return g})(o,n);if(a){var c=Object.getOwnPropertyDescriptor(a,n);return c.get?c.get.call(arguments.length<3?o:i):c.value}},d.apply(null,arguments)}function v(o){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},v(o)}function _(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),n&&k(o,n)}function w(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(w=function(){return!!o})()}function k(o,n){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},k(o,n)}function M(o,n,i,a){var c=d(v(1&a?o.prototype:o),n,i);return 2&a&&typeof c=="function"?function(g){return c.apply(i,g)}:c}function R(o){return(function(n){if(Array.isArray(n))return r(n)})(o)||(function(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)})(o)||I(o)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function C(o){var n=(function(i,a){if(typeof i!="object"||!i)return i;var c=i[Symbol.toPrimitive];if(c!==void 0){var g=c.call(i,a);if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)})(o,"string");return typeof n=="symbol"?n:n+""}function I(o,n){if(o){if(typeof o=="string")return r(o,n);var i={}.toString.call(o).slice(8,-1);return i==="Object"&&o.constructor&&(i=o.constructor.name),i==="Map"||i==="Set"?Array.from(o):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(o,n):void 0}}function A(o){var n=typeof Map=="function"?new Map:void 0;return A=function(i){if(i===null||!(function(c){try{return Function.toString.call(c).indexOf("[native code]")!==-1}catch{return typeof c=="function"}})(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(i))return n.get(i);n.set(i,a)}function a(){return l(i,arguments,v(this).constructor)}return a.prototype=Object.create(i.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),k(a,i)},A(o)}var Y=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(n){this._quadrantSegments=n,this._quadrantSegments===0&&(this._joinStyle=o.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=o.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),n<=0&&(this._quadrantSegments=1),this._joinStyle!==o.JOIN_ROUND&&(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(n){this._joinStyle=n}},{key:"setSimplifyFactor",value:function(n){this._simplifyFactor=n<0?0:n}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(n){this._endCapStyle=n}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(n){this._mitreLimit=n}},{key:"setSingleSided",value:function(n){this._isSingleSided=n}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=o.CAP_ROUND,this._joinStyle=o.JOIN_ROUND,this._mitreLimit=o.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=o.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.setQuadrantSegments(n)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(a)}else if(arguments.length===4){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3];this.setQuadrantSegments(c),this.setEndCapStyle(g),this.setJoinStyle(m),this.setMitreLimit(y)}}}},{key:"bufferDistanceError",value:function(n){var i=Math.PI/2/n;return 1-Math.cos(i/2)}}])})();Y.CAP_ROUND=1,Y.CAP_FLAT=2,Y.CAP_SQUARE=3,Y.JOIN_ROUND=1,Y.JOIN_MITRE=2,Y.JOIN_BEVEL=3,Y.DEFAULT_QUADRANT_SEGMENTS=8,Y.DEFAULT_MITRE_LIMIT=5,Y.DEFAULT_SIMPLIFY_FACTOR=.01;var $=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({Exception:n})[0],a}return _(n,o),h(n,[{key:"toString",value:function(){return this.message}}])})(A(Error)),J=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({IllegalArgumentException:n})[0],a}return _(n,o),h(n)})($),q=(function(){return h((function o(){u(this,o)}),[{key:"filter",value:function(o){}}])})();function W(){}function E(){}function S(){}var b,O,P,F,D,L,B,U,H=(function(){return h((function o(){u(this,o)}),null,[{key:"equalsWithTolerance",value:function(o,n,i){return Math.abs(o-n)<=i}}])})(),j=(function(){return h((function o(n,i){u(this,o),this.low=i||0,this.high=n||0}),null,[{key:"toBinaryString",value:function(o){var n,i="";for(n=2147483648;n>0;n>>>=1)i+=(o.high&n)===n?"1":"0";for(n=2147483648;n>0;n>>>=1)i+=(o.low&n)===n?"1":"0";return i}}])})();function Z(){}function re(){}Z.NaN=NaN,Z.isNaN=function(o){return Number.isNaN(o)},Z.isInfinite=function(o){return!Number.isFinite(o)},Z.MAX_VALUE=Number.MAX_VALUE,Z.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Z.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(L=2146435072,B=new Float64Array(1),U=new Int32Array(B.buffer),Z.doubleToLongBits=function(o){B[0]=o;var n=0|U[0],i=0|U[1];return(i&L)===L&&1048575&i&&n!==0&&(n=0,i=2146959360),new j(i,n)},Z.longBitsToDouble=function(o){return U[0]=o.low,U[1]=o.high,B[0]}):(b=1023,O=Math.log2,P=Math.floor,F=Math.pow,D=(function(){for(var o=53;o>0;o--){var n=F(2,o)-1;if(P(O(n))+1===o)return n}return 0})(),Z.doubleToLongBits=function(o){var n,i,a,c,g,m,y,x,T;if(o<0||1/o===Number.NEGATIVE_INFINITY?(m=1<<31,o=-o):m=0,o===0)return new j(x=m,T=0);if(o===1/0)return new j(x=2146435072|m,T=0);if(o!=o)return new j(x=2146959360,T=0);if(c=0,T=0,(n=P(o))>1)if(n<=D)(c=P(O(n)))<=20?(T=0,x=n<<20-c&1048575):(T=n%(i=F(2,a=c-20))<<32-a,x=n/i&1048575);else for(a=n,T=0;(a=P(i=a/2))!==0;)c++,T>>>=1,T|=(1&x)<<31,x>>>=1,i!==a&&(x|=524288);if(y=c+b,g=n===0,n=o-n,c<52&&n!==0)for(a=0;;){if((i=2*n)>=1?(n=i-1,g?(y--,g=!1):(a<<=1,a|=1,c++)):(n=i,g?--y==0&&(c++,g=!1):(a<<=1,c++)),c===20)x|=a,a=0;else if(c===52){T|=a;break}if(i===1){c<20?x|=a<<20-c:c<52&&(T|=a<<52-c);break}}return x|=y<<20,new j(x|=m,T)},Z.longBitsToDouble=function(o){var n,i,a,c,g=o.high,m=o.low,y=g&1<<31?-1:1;for(a=((2146435072&g)>>20)-b,c=0,i=1<<19,n=1;n<=20;n++)g&i&&(c+=F(2,-n)),i>>>=1;for(i=1<<31,n=21;n<=52;n++)m&i&&(c+=F(2,-n)),i>>>=1;if(a===-1023){if(c===0)return 0*y;a=-1022}else{if(a===1024)return c===0?y/0:NaN;c+=1}return y*c*F(2,a)});var ce=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({RuntimeException:n})[0],a}return _(n,o),h(n)})($),le=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,null,[{key:"constructor_",value:function(){if(arguments.length===0)ce.constructor_.call(this);else if(arguments.length===1){var i=arguments[0];ce.constructor_.call(this,i)}}}])})(ce),se=(function(){function o(){u(this,o)}return h(o,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)o.shouldNeverReachHere(null);else if(arguments.length===1){var n=arguments[0];throw new le("Should never reach here"+(n!==null?": "+n:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var n=arguments[0];o.isTrue(n,null)}else if(arguments.length===2){var i=arguments[1];if(!arguments[0])throw i===null?new le:new le(i)}}},{key:"equals",value:function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];o.equals(n,i,null)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];if(!c.equals(a))throw new le("Expected "+a+" but encountered "+c+(g!==null?": "+g:""))}}}])})(),ue=new ArrayBuffer(8),ke=new Float64Array(ue),Ne=new Int32Array(ue),X=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getM",value:function(){return Z.NaN}},{key:"setOrdinate",value:function(n,i){switch(n){case o.X:this.x=i;break;case o.Y:this.y=i;break;case o.Z:this.setZ(i);break;default:throw new J("Invalid ordinate index: "+n)}}},{key:"equals2D",value:function(){if(arguments.length===1){var n=arguments[0];return this.x===n.x&&this.y===n.y}if(arguments.length===2){var i=arguments[0],a=arguments[1];return!!H.equalsWithTolerance(this.x,i.x,a)&&!!H.equalsWithTolerance(this.y,i.y,a)}}},{key:"setM",value:function(n){throw new J("Invalid ordinate index: "+o.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(n){switch(n){case o.X:return this.x;case o.Y:return this.y;case o.Z:return this.getZ()}throw new J("Invalid ordinate index: "+n)}},{key:"equals3D",value:function(n){return this.x===n.x&&this.y===n.y&&(this.getZ()===n.getZ()||Z.isNaN(this.getZ())&&Z.isNaN(n.getZ()))}},{key:"equals",value:function(n){return n instanceof o&&this.equals2D(n)}},{key:"equalInZ",value:function(n,i){return H.equalsWithTolerance(this.getZ(),n.getZ(),i)}},{key:"setX",value:function(n){this.x=n}},{key:"compareTo",value:function(n){var i=n;return this.x<i.x?-1:this.x>i.x?1:this.y<i.y?-1:this.y>i.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(n){this.z=n}},{key:"clone",value:function(){try{return null}catch(n){if(n instanceof CloneNotSupportedException)return se.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw n}}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(n){var i=this.x-n.x,a=this.y-n.y,c=this.getZ()-n.getZ();return Math.sqrt(i*i+a*a+c*c)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(n){this.y=n}},{key:"distance",value:function(n){var i=this.x-n.x,a=this.y-n.y;return Math.sqrt(i*i+a*a)}},{key:"hashCode",value:function(){var n=17;return n=37*(n=37*n+o.hashCode(this.x))+o.hashCode(this.y)}},{key:"setCoordinate",value:function(n){this.x=n.x,this.y=n.y,this.z=n.getZ()}},{key:"interfaces_",get:function(){return[W,E,S]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)o.constructor_.call(this,0,0);else if(arguments.length===1){var n=arguments[0];o.constructor_.call(this,n.x,n.y,n.getZ())}else if(arguments.length===2){var i=arguments[0],a=arguments[1];o.constructor_.call(this,i,a,o.NULL_ORDINATE)}else if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];this.x=c,this.y=g,this.z=m}}},{key:"hashCode",value:function(n){return ke[0]=n,Ne[0]^Ne[1]}}])})(),qn=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compare",value:function(n,i){var a=o.compare(n.x,i.x);if(a!==0)return a;var c=o.compare(n.y,i.y);return c!==0?c:this._dimensionsToTest<=2?0:o.compare(n.getZ(),i.getZ())}},{key:"interfaces_",get:function(){return[re]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)o.constructor_.call(this,2);else if(arguments.length===1){var n=arguments[0];if(n!==2&&n!==3)throw new J("only 2 or 3 dimensions may be specified");this._dimensionsToTest=n}}},{key:"compare",value:function(n,i){return n<i?-1:n>i?1:Z.isNaN(n)?Z.isNaN(i)?0:-1:Z.isNaN(i)?1:0}}])})();X.DimensionalComparator=qn,X.NULL_ORDINATE=Z.NaN,X.X=0,X.Y=1,X.Z=2,X.M=3;var Te=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(n){if(!(n instanceof o))return!1;var i=n;return this.isNull()?i.isNull():this._maxx===i.getMaxX()&&this._maxy===i.getMaxY()&&this._minx===i.getMinX()&&this._miny===i.getMinY()}},{key:"intersection",value:function(n){if(this.isNull()||n.isNull()||!this.intersects(n))return new o;var i=this._minx>n._minx?this._minx:n._minx,a=this._miny>n._miny?this._miny:n._miny;return new o(i,this._maxx<n._maxx?this._maxx:n._maxx,a,this._maxy<n._maxy?this._maxy:n._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof X){var n=arguments[0];return this.covers(n.x,n.y)}if(arguments[0]instanceof o){var i=arguments[0];return!this.isNull()&&!i.isNull()&&i.getMinX()>=this._minx&&i.getMaxX()<=this._maxx&&i.getMinY()>=this._miny&&i.getMaxY()<=this._maxy}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return!this.isNull()&&a>=this._minx&&a<=this._maxx&&c>=this._miny&&c<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var n=arguments[0];return!this.isNull()&&!n.isNull()&&!(n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny)}if(arguments[0]instanceof X){var i=arguments[0];return this.intersects(i.x,i.y)}}else if(arguments.length===2){if(arguments[0]instanceof X&&arguments[1]instanceof X){var a=arguments[0],c=arguments[1];return!this.isNull()&&!((a.x<c.x?a.x:c.x)>this._maxx)&&!((a.x>c.x?a.x:c.x)<this._minx)&&!((a.y<c.y?a.y:c.y)>this._maxy)&&!((a.y>c.y?a.y:c.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var g=arguments[0],m=arguments[1];return!this.isNull()&&!(g>this._maxx||g<this._minx||m>this._maxy||m<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var n=this.getWidth(),i=this.getHeight();return Math.sqrt(n*n+i*i)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof X){var n=arguments[0];this.expandToInclude(n.x,n.y)}else if(arguments[0]instanceof o){var i=arguments[0];if(i.isNull())return null;this.isNull()?(this._minx=i.getMinX(),this._maxx=i.getMaxX(),this._miny=i.getMinY(),this._maxy=i.getMaxY()):(i._minx<this._minx&&(this._minx=i._minx),i._maxx>this._maxx&&(this._maxx=i._maxx),i._miny<this._miny&&(this._miny=i._miny),i._maxy>this._maxy&&(this._maxy=i._maxy))}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.isNull()?(this._minx=a,this._maxx=a,this._miny=c,this._maxy=c):(a<this._minx&&(this._minx=a),a>this._maxx&&(this._maxx=a),c<this._miny&&(this._miny=c),c>this._maxy&&(this._maxy=c))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var n=this.getWidth(),i=this.getHeight();return n<i?n:i}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(n){var i=n;return this.isNull()?i.isNull()?0:-1:i.isNull()?1:this._minx<i._minx?-1:this._minx>i._minx?1:this._miny<i._miny?-1:this._miny>i._miny?1:this._maxx<i._maxx?-1:this._maxx>i._maxx?1:this._maxy<i._maxy?-1:this._maxy>i._maxy?1:0}},{key:"translate",value:function(n,i){if(this.isNull())return null;this.init(this.getMinX()+n,this.getMaxX()+n,this.getMinY()+i,this.getMaxY()+i)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(n){return!(!this.isNull()&&!n.isNull())||n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var n=this.getWidth(),i=this.getHeight();return n>i?n:i}},{key:"expandBy",value:function(){if(arguments.length===1){var n=arguments[0];this.expandBy(n,n)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];if(this.isNull())return null;this._minx-=i,this._maxx+=i,this._miny-=a,this._maxy+=a,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var n=arguments[0];return this.covers(n)}if(arguments[0]instanceof X){var i=arguments[0];return this.covers(i)}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return this.covers(a,c)}}},{key:"centre",value:function(){return this.isNull()?null:new X((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof X){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof o){var i=arguments[0];this._minx=i._minx,this._maxx=i._maxx,this._miny=i._miny,this._maxy=i._maxy}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.init(a.x,c.x,a.y,c.y)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],y=arguments[2],x=arguments[3];g<m?(this._minx=g,this._maxx=m):(this._minx=m,this._maxx=g),y<x?(this._miny=y,this._maxy=x):(this._miny=x,this._maxy=y)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(n){if(this.intersects(n))return 0;var i=0;this._maxx<n._minx?i=n._minx-this._maxx:this._minx>n._maxx&&(i=this._minx-n._maxx);var a=0;return this._maxy<n._miny?a=n._miny-this._maxy:this._miny>n._maxy&&(a=this._miny-n._maxy),i===0?a:a===0?i:Math.sqrt(i*i+a*a)}},{key:"hashCode",value:function(){var n=17;return n=37*(n=37*(n=37*(n=37*n+X.hashCode(this._minx))+X.hashCode(this._maxx))+X.hashCode(this._miny))+X.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[W,S]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof X){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof o){var i=arguments[0];this.init(i)}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.init(a.x,c.x,a.y,c.y)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],y=arguments[2],x=arguments[3];this.init(g,m,y,x)}}},{key:"intersects",value:function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2];return a.x>=(n.x<i.x?n.x:i.x)&&a.x<=(n.x>i.x?n.x:i.x)&&a.y>=(n.y<i.y?n.y:i.y)&&a.y<=(n.y>i.y?n.y:i.y)}if(arguments.length===4){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],x=Math.min(m.x,y.x),T=Math.max(m.x,y.x),z=Math.min(c.x,g.x),V=Math.max(c.x,g.x);return!(z>T)&&!(V<x)&&(x=Math.min(m.y,y.y),T=Math.max(m.y,y.y),z=Math.min(c.y,g.y),V=Math.max(c.y,g.y),!(z>T)&&!(V<x))}}}])})(),fe=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(n){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(n){return this===n||this.equalsExact(n,0)}},{key:"geometryChanged",value:function(){this.apply(o.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(n){return n!==null&&this.norm().equalsExact(n.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var n;if(arguments.length===1){var i=arguments[0];return n=i,this.getTypeCode()!==n.getTypeCode()?this.getTypeCode()-n.getTypeCode():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(i)}if(arguments.length===2){var a=arguments[0],c=arguments[1];return n=a,this.getTypeCode()!==n.getTypeCode()?this.getTypeCode()-n.getTypeCode():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(a,c)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(n){if(n.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION)throw new J("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(n,i,a){return a===0?n.equals(i):n.distance(i)<=a}},{key:"norm",value:function(){var n=this.copy();return n.normalize(),n}},{key:"reverse",value:function(){var n=this.reverseInternal();return this.envelope!=null&&(n.envelope=this.envelope.copy()),n.setSRID(this.getSRID()),n}},{key:"copy",value:function(){var n=this.copyInternal();return n.envelope=this._envelope==null?null:this._envelope.copy(),n._SRID=this._SRID,n._userData=this._userData,n}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Te(this._envelope)}},{key:"setSRID",value:function(n){this._SRID=n}},{key:"setUserData",value:function(n){this._userData=n}},{key:"compare",value:function(n,i){for(var a=n.iterator(),c=i.iterator();a.hasNext()&&c.hasNext();){var g=a.next(),m=c.next(),y=g.compareTo(m);if(y!==0)return y}return a.hasNext()?1:c.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(n){return this.getClass()===n.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===o.TYPECODE_MULTIPOINT||this.getTypeCode()===o.TYPECODE_MULTILINESTRING||this.getTypeCode()===o.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[E,W,S]}},{key:"getClass",value:function(){return o}}],[{key:"hasNonEmptyElements",value:function(n){for(var i=0;i<n.length;i++)if(!n[i].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(n){for(var i=0;i<n.length;i++)if(n[i]===null)return!0;return!1}}])})();fe.constructor_=function(o){o&&(this._envelope=null,this._userData=null,this._factory=o,this._SRID=o.getSRID())},fe.TYPECODE_POINT=0,fe.TYPECODE_MULTIPOINT=1,fe.TYPECODE_LINESTRING=2,fe.TYPECODE_LINEARRING=3,fe.TYPECODE_MULTILINESTRING=4,fe.TYPECODE_POLYGON=5,fe.TYPECODE_MULTIPOLYGON=6,fe.TYPECODE_GEOMETRYCOLLECTION=7,fe.TYPENAME_POINT="Point",fe.TYPENAME_MULTIPOINT="MultiPoint",fe.TYPENAME_LINESTRING="LineString",fe.TYPENAME_LINEARRING="LinearRing",fe.TYPENAME_MULTILINESTRING="MultiLineString",fe.TYPENAME_POLYGON="Polygon",fe.TYPENAME_MULTIPOLYGON="MultiPolygon",fe.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",fe.geometryChangedFilter={get interfaces_(){return[q]},filter:function(o){o.geometryChangedAction()}};var N=(function(){function o(){u(this,o)}return h(o,null,[{key:"toLocationSymbol",value:function(n){switch(n){case o.EXTERIOR:return"e";case o.BOUNDARY:return"b";case o.INTERIOR:return"i";case o.NONE:return"-"}throw new J("Unknown location value: "+n)}}])})();N.INTERIOR=0,N.BOUNDARY=1,N.EXTERIOR=2,N.NONE=-1;var Pe=(function(){return h((function o(){u(this,o)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),Ge=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({NoSuchElementException:n})[0],a}return _(n,o),h(n)})($),Se=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({UnsupportedOperationException:n})[0],a}return _(n,o),h(n)})($),$i=(function(o){function n(){return u(this,n),s(this,n,arguments)}return _(n,o),h(n,[{key:"contains",value:function(){}}])})(Pe),oi=(function(o){function n(i){var a;return u(this,n),(a=s(this,n)).map=new Map,i instanceof Pe&&a.addAll(i),a}return _(n,o),h(n,[{key:"contains",value:function(i){var a=i.hashCode?i.hashCode():i;return!!this.map.has(a)}},{key:"add",value:function(i){var a=i.hashCode?i.hashCode():i;return!this.map.has(a)&&!!this.map.set(a,i)}},{key:"addAll",value:function(i){var a,c=p(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.add(g)}}catch(m){c.e(m)}finally{c.f()}return!0}},{key:"remove",value:function(){throw new Se}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Dr(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})($i),Dr=(function(){return h((function o(n){u(this,o),this.iterator=n.values();var i=this.iterator.next(),a=i.done,c=i.value;this.done=a,this.value=c}),[{key:"next",value:function(){if(this.done)throw new Ge;var o=this.value,n=this.iterator.next(),i=n.done,a=n.value;return this.done=i,this.value=a,o}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Se}}])})(),ie=(function(){function o(){u(this,o)}return h(o,null,[{key:"opposite",value:function(n){return n===o.LEFT?o.RIGHT:n===o.RIGHT?o.LEFT:n}}])})();ie.ON=0,ie.LEFT=1,ie.RIGHT=2;var ui=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({EmptyStackException:n})[0],a}return _(n,o),h(n)})($),ta=(function(o){function n(i){var a;return u(this,n),(a=s(this,n,[i])).name=Object.keys({IndexOutOfBoundsException:n})[0],a}return _(n,o),h(n)})($),Yn=(function(o){function n(){return u(this,n),s(this,n,arguments)}return _(n,o),h(n,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(Pe),tc=(function(o){function n(){var i;return u(this,n),(i=s(this,n)).array=[],i}return _(n,o),h(n,[{key:"add",value:function(i){return this.array.push(i),!0}},{key:"get",value:function(i){if(i<0||i>=this.size())throw new ta;return this.array[i]}},{key:"push",value:function(i){return this.array.push(i),i}},{key:"pop",value:function(){if(this.array.length===0)throw new ui;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new ui;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(i){return this.array.indexOf(i)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(Yn);function we(o,n){return o.interfaces_&&o.interfaces_.indexOf(n)>-1}var Mn=(function(){return h((function o(n){u(this,o),this.str=n}),[{key:"append",value:function(o){this.str+=o}},{key:"setCharAt",value:function(o,n){this.str=this.str.substr(0,o)+n+this.str.substr(o+1)}},{key:"toString",value:function(){return this.str}}])})(),In=(function(){function o(n){u(this,o),this.value=n}return h(o,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(n){return this.value<n?-1:this.value>n?1:0}}],[{key:"compare",value:function(n,i){return n<i?-1:n>i?1:0}},{key:"isNan",value:function(n){return Number.isNaN(n)}},{key:"valueOf",value:function(n){return new o(n)}}])})(),Ft=(function(){return h((function o(){u(this,o)}),null,[{key:"isWhitespace",value:function(o){return o<=32&&o>=0||o===127}},{key:"toUpperCase",value:function(o){return o.toUpperCase()}}])})(),ye=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"le",value:function(n){return this._hi<n._hi||this._hi===n._hi&&this._lo<=n._lo}},{key:"extractSignificantDigits",value:function(n,i){var a=this.abs(),c=o.magnitude(a._hi),g=o.TEN.pow(c);(a=a.divide(g)).gt(o.TEN)?(a=a.divide(o.TEN),c+=1):a.lt(o.ONE)&&(a=a.multiply(o.TEN),c-=1);for(var m=c+1,y=new Mn,x=o.MAX_PRINT_DIGITS-1,T=0;T<=x;T++){n&&T===m&&y.append(".");var z=Math.trunc(a._hi);if(z<0)break;var V=!1,ee=0;z>9?(V=!0,ee="9"):ee="0"+z,y.append(ee),a=a.subtract(o.valueOf(z)).multiply(o.TEN),V&&a.selfAdd(o.TEN);var he=!0,de=o.magnitude(a._hi);if(de<0&&Math.abs(de)>=x-T&&(he=!1),!he)break}return i[0]=c,y.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return this.add(n.negate())}if(typeof arguments[0]=="number"){var i=arguments[0];return this.add(-i)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof o){var n=arguments[0];return this._hi===n._hi&&this._lo===n._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n._hi,-n._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(n){return this.le(n)?this:n}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var n=arguments[0];return this.selfDivide(n._hi,n._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.selfDivide(i,0)}}else if(arguments.length===2){var a,c,g,m,y=arguments[0],x=arguments[1],T=null,z=null,V=null,ee=null;return g=this._hi/y,ee=(T=(V=o.SPLIT*g)-(T=V-g))*(z=(ee=o.SPLIT*y)-(z=ee-y))-(m=g*y)+T*(c=y-z)+(a=g-T)*z+a*c,ee=g+(V=(this._hi-m-ee+this._lo-g*x)/y),this._hi=ee,this._lo=g-ee+V,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof o){var n,i,a,c,g=arguments[0],m=null,y=null,x=null,T=null;return n=(a=this._hi/g._hi)-(m=(x=o.SPLIT*a)-(m=x-a)),T=m*(y=(T=o.SPLIT*g._hi)-(y=T-g._hi))-(c=a*g._hi)+m*(i=g._hi-y)+n*y+n*i,new o(T=a+(x=(this._hi-c-T+this._lo-a*g._lo)/g._hi),a-T+x)}if(typeof arguments[0]=="number"){var z=arguments[0];return Z.isNaN(z)?o.createNaN():o.copy(this).selfDivide(z,0)}}},{key:"ge",value:function(n){return this._hi>n._hi||this._hi===n._hi&&this._lo>=n._lo}},{key:"pow",value:function(n){if(n===0)return o.valueOf(1);var i=new o(this),a=o.valueOf(1),c=Math.abs(n);if(c>1)for(;c>0;)c%2==1&&a.selfMultiply(i),(c/=2)>0&&(i=i.sqr());else a=i;return n<0?a.reciprocal():a}},{key:"ceil",value:function(){if(this.isNaN())return o.NaN;var n=Math.ceil(this._hi),i=0;return n===this._hi&&(i=Math.ceil(this._lo)),new o(n,i)}},{key:"compareTo",value:function(n){var i=n;return this._hi<i._hi?-1:this._hi>i._hi?1:this._lo<i._lo?-1:this._lo>i._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return this.init(n),this}if(typeof arguments[0]=="number"){var i=arguments[0];return this.init(i),this}}},{key:"max",value:function(n){return this.ge(n)?this:n}},{key:"sqrt",value:function(){if(this.isZero())return o.valueOf(0);if(this.isNegative())return o.NaN;var n=1/Math.sqrt(this._hi),i=this._hi*n,a=o.valueOf(i),c=this.subtract(a.sqr())._hi*(.5*n);return a.add(c)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var n=arguments[0];return this.selfAdd(n._hi,n._lo)}if(typeof arguments[0]=="number"){var i,a,c,g,m,y=arguments[0],x=null;return x=(c=this._hi+y)-(g=c-this._hi),a=(m=(x=y-g+(this._hi-x))+this._lo)+(c-(i=c+m)),this._hi=i+a,this._lo=a+(i-this._hi),this}}else if(arguments.length===2){var T,z,V,ee,he=arguments[0],de=arguments[1],ve=null,Le=null,Ae=null;V=this._hi+he,z=this._lo+de,Le=V-(Ae=V-this._hi),ve=z-(ee=z-this._lo);var Ue=(T=V+(Ae=(Le=he-Ae+(this._hi-Le))+z))+(Ae=(ve=de-ee+(this._lo-ve))+(Ae+(V-T))),mt=Ae+(T-Ue);return this._hi=Ue,this._lo=mt,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var n=arguments[0];return this.selfMultiply(n._hi,n._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.selfMultiply(i,0)}}else if(arguments.length===2){var a,c,g=arguments[0],m=arguments[1],y=null,x=null,T=null,z=null;y=(T=o.SPLIT*this._hi)-this._hi,z=o.SPLIT*g,y=T-y,a=this._hi-y,x=z-g;var V=(T=this._hi*g)+(z=y*(x=z-x)-T+y*(c=g-x)+a*x+a*c+(this._hi*m+this._lo*g)),ee=z+(y=T-V);return this._hi=V,this._lo=ee,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return o.NaN;var n=Math.floor(this._hi),i=0;return n===this._hi&&(i=Math.floor(this._lo)),new o(n,i)}},{key:"negate",value:function(){return this.isNaN()?this:new o(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(n){if(n instanceof CloneNotSupportedException)return null;throw n}}},{key:"multiply",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return n.isNaN()?o.createNaN():o.copy(this).selfMultiply(n)}if(typeof arguments[0]=="number"){var i=arguments[0];return Z.isNaN(i)?o.createNaN():o.copy(this).selfMultiply(i,0)}}},{key:"isNaN",value:function(){return Z.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var n=o.magnitude(this._hi);return n>=-3&&n<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var n=this.getSpecialNumberString();if(n!==null)return n;var i=new Array(1).fill(null),a=this.extractSignificantDigits(!0,i),c=i[0]+1,g=a;if(a.charAt(0)===".")g="0"+a;else if(c<0)g="0."+o.stringOfChar("0",-c)+a;else if(a.indexOf(".")===-1){var m=c-a.length;g=a+o.stringOfChar("0",m)+".0"}return this.isNegative()?"-"+g:g}},{key:"reciprocal",value:function(){var n,i,a,c,g=null,m=null,y=null,x=null;n=(a=1/this._hi)-(g=(y=o.SPLIT*a)-(g=y-a)),m=(x=o.SPLIT*this._hi)-this._hi;var T=a+(y=(1-(c=a*this._hi)-(x=g*(m=x-m)-c+g*(i=this._hi-m)+n*m+n*i)-a*this._lo)/this._hi);return new o(T,a-T+y)}},{key:"toSciNotation",value:function(){if(this.isZero())return o.SCI_NOT_ZERO;var n=this.getSpecialNumberString();if(n!==null)return n;var i=new Array(1).fill(null),a=this.extractSignificantDigits(!1,i),c=o.SCI_NOT_EXPONENT_CHAR+i[0];if(a.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+a);var g="";a.length>1&&(g=a.substring(1));var m=a.charAt(0)+"."+g;return this.isNegative()?"-"+m+c:m+c}},{key:"abs",value:function(){return this.isNaN()?o.NaN:this.isNegative()?this.negate():new o(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(n){return this._hi<n._hi||this._hi===n._hi&&this._lo<n._lo}},{key:"add",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return o.copy(this).selfAdd(n)}if(typeof arguments[0]=="number"){var i=arguments[0];return o.copy(this).selfAdd(i)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this._hi=n,this._lo=0}else if(arguments[0]instanceof o){var i=arguments[0];this._hi=i._hi,this._lo=i._lo}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this._hi=a,this._lo=c}}},{key:"gt",value:function(n){return this._hi>n._hi||this._hi===n._hi&&this._lo>n._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?o.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[S,W,E]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this.init(n)}else if(arguments[0]instanceof o){var i=arguments[0];this.init(i)}else if(typeof arguments[0]=="string"){var a=arguments[0];o.constructor_.call(this,o.parse(a))}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.init(c,g)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1],a=arguments[2],c=arguments[3];return o.determinant(o.valueOf(n),o.valueOf(i),o.valueOf(a),o.valueOf(c))}if(arguments[3]instanceof o&&arguments[2]instanceof o&&arguments[0]instanceof o&&arguments[1]instanceof o){var g=arguments[1],m=arguments[2],y=arguments[3];return arguments[0].multiply(y).selfSubtract(g.multiply(m))}}},{key:"sqr",value:function(n){return o.valueOf(n).selfMultiply(n)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var n=arguments[0];return o.parse(n)}if(typeof arguments[0]=="number")return new o(arguments[0])}},{key:"sqrt",value:function(n){return o.valueOf(n).sqrt()}},{key:"parse",value:function(n){for(var i=0,a=n.length;Ft.isWhitespace(n.charAt(i));)i++;var c=!1;if(i<a){var g=n.charAt(i);g!=="-"&&g!=="+"||(i++,g==="-"&&(c=!0))}for(var m=new o,y=0,x=0,T=0,z=!1;!(i>=a);){var V=n.charAt(i);if(i++,Ft.isDigit(V)){var ee=V-"0";m.selfMultiply(o.TEN),m.selfAdd(ee),y++}else{if(V!=="."){if(V==="e"||V==="E"){var he=n.substring(i);try{T=In.parseInt(he)}catch(Ue){throw Ue instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+he+" in string "+n):Ue}break}throw new NumberFormatException("Unexpected character '"+V+"' at position "+i+" in string "+n)}x=y,z=!0}}var de=m;z||(x=y);var ve=y-x-T;if(ve===0)de=m;else if(ve>0){var Le=o.TEN.pow(ve);de=m.divide(Le)}else if(ve<0){var Ae=o.TEN.pow(-ve);de=m.multiply(Ae)}return c?de.negate():de}},{key:"createNaN",value:function(){return new o(Z.NaN,Z.NaN)}},{key:"copy",value:function(n){return new o(n)}},{key:"magnitude",value:function(n){var i=Math.abs(n),a=Math.log(i)/Math.log(10),c=Math.trunc(Math.floor(a));return 10*Math.pow(10,c)<=i&&(c+=1),c}},{key:"stringOfChar",value:function(n,i){for(var a=new Mn,c=0;c<i;c++)a.append(n);return a.toString()}}])})();ye.PI=new ye(3.141592653589793,12246467991473532e-32),ye.TWO_PI=new ye(6.283185307179586,24492935982947064e-32),ye.PI_2=new ye(1.5707963267948966,6123233995736766e-32),ye.E=new ye(2.718281828459045,14456468917292502e-32),ye.NaN=new ye(Z.NaN,Z.NaN),ye.EPS=123259516440783e-46,ye.SPLIT=134217729,ye.MAX_PRINT_DIGITS=32,ye.TEN=ye.valueOf(10),ye.ONE=ye.valueOf(1),ye.SCI_NOT_EXPONENT_CHAR="E",ye.SCI_NOT_ZERO="0.0E0";var Xi=(function(){function o(){u(this,o)}return h(o,null,[{key:"orientationIndex",value:function(n,i,a){var c=o.orientationIndexFilter(n,i,a);if(c<=1)return c;var g=ye.valueOf(i.x).selfAdd(-n.x),m=ye.valueOf(i.y).selfAdd(-n.y),y=ye.valueOf(a.x).selfAdd(-i.x),x=ye.valueOf(a.y).selfAdd(-i.y);return g.selfMultiply(x).selfSubtract(m.selfMultiply(y)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ye&&arguments[2]instanceof ye&&arguments[0]instanceof ye&&arguments[1]instanceof ye){var n=arguments[1],i=arguments[2],a=arguments[3];return arguments[0].multiply(a).selfSubtract(n.multiply(i)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],x=ye.valueOf(c),T=ye.valueOf(g),z=ye.valueOf(m),V=ye.valueOf(y);return x.multiply(V).selfSubtract(T.multiply(z)).signum()}}},{key:"intersection",value:function(n,i,a,c){var g=new ye(n.y).selfSubtract(i.y),m=new ye(i.x).selfSubtract(n.x),y=new ye(n.x).selfMultiply(i.y).selfSubtract(new ye(i.x).selfMultiply(n.y)),x=new ye(a.y).selfSubtract(c.y),T=new ye(c.x).selfSubtract(a.x),z=new ye(a.x).selfMultiply(c.y).selfSubtract(new ye(c.x).selfMultiply(a.y)),V=m.multiply(z).selfSubtract(T.multiply(y)),ee=x.multiply(y).selfSubtract(g.multiply(z)),he=g.multiply(T).selfSubtract(x.multiply(m)),de=V.selfDivide(he).doubleValue(),ve=ee.selfDivide(he).doubleValue();return Z.isNaN(de)||Z.isInfinite(de)||Z.isNaN(ve)||Z.isInfinite(ve)?null:new X(de,ve)}},{key:"orientationIndexFilter",value:function(n,i,a){var c=null,g=(n.x-a.x)*(i.y-a.y),m=(n.y-a.y)*(i.x-a.x),y=g-m;if(g>0){if(m<=0)return o.signum(y);c=g+m}else{if(!(g<0)||m>=0)return o.signum(y);c=-g-m}var x=o.DP_SAFE_EPSILON*c;return y>=x||-y>=x?o.signum(y):2}},{key:"signum",value:function(n){return n>0?1:n<0?-1:0}}])})();Xi.DP_SAFE_EPSILON=1e-15;var Ie=(function(){return h((function o(){u(this,o)}),[{key:"getM",value:function(o){if(this.hasM()){var n=this.getDimension()-this.getMeasures();return this.getOrdinate(o,n)}return Z.NaN}},{key:"setOrdinate",value:function(o,n,i){}},{key:"getZ",value:function(o){return this.hasZ()?this.getOrdinate(o,2):Z.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(o,n){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(o){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(o){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(o){}},{key:"copy",value:function(){}},{key:"getY",value:function(o){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[E]}}])})();Ie.X=0,Ie.Y=1,Ie.Z=2,Ie.M=3;var _e=(function(){function o(){u(this,o)}return h(o,null,[{key:"index",value:function(n,i,a){return Xi.orientationIndex(n,i,a)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var n=arguments[0],i=n.length-1;if(i<3)throw new J("Ring has fewer than 4 points, so orientation cannot be determined");for(var a=n[0],c=0,g=1;g<=i;g++){var m=n[g];m.y>a.y&&(a=m,c=g)}var y=c;do(y-=1)<0&&(y=i);while(n[y].equals2D(a)&&y!==c);var x=c;do x=(x+1)%i;while(n[x].equals2D(a)&&x!==c);var T=n[y],z=n[x];if(T.equals2D(a)||z.equals2D(a)||T.equals2D(z))return!1;var V=o.index(T,a,z);return V===0?T.x>z.x:V>0}if(we(arguments[0],Ie)){var ee=arguments[0],he=ee.size()-1;if(he<3)throw new J("Ring has fewer than 4 points, so orientation cannot be determined");for(var de=ee.getCoordinate(0),ve=0,Le=1;Le<=he;Le++){var Ae=ee.getCoordinate(Le);Ae.y>de.y&&(de=Ae,ve=Le)}var Ue=null,mt=ve;do(mt-=1)<0&&(mt=he),Ue=ee.getCoordinate(mt);while(Ue.equals2D(de)&&mt!==ve);var wt=null,di=ve;do di=(di+1)%he,wt=ee.getCoordinate(di);while(wt.equals2D(de)&&di!==ve);if(Ue.equals2D(de)||wt.equals2D(de)||Ue.equals2D(wt))return!1;var la=o.index(Ue,de,wt);return la===0?Ue.x>wt.x:la>0}}}])})();_e.CLOCKWISE=-1,_e.RIGHT=_e.CLOCKWISE,_e.COUNTERCLOCKWISE=1,_e.LEFT=_e.COUNTERCLOCKWISE,_e.COLLINEAR=0,_e.STRAIGHT=_e.COLLINEAR;var Bo=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(o,n){var i=this.getRightmostSideOfSegment(o,n);return i<0&&(i=this.getRightmostSideOfSegment(o,n-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(o)),i}},{key:"findRightmostEdgeAtVertex",value:function(){var o=this._minDe.getEdge().getCoordinates();se.isTrue(this._minIndex>0&&this._minIndex<o.length,"rightmost point expected to be interior vertex of edge");var n=o[this._minIndex-1],i=o[this._minIndex+1],a=_e.index(this._minCoord,i,n),c=!1;(n.y<this._minCoord.y&&i.y<this._minCoord.y&&a===_e.COUNTERCLOCKWISE||n.y>this._minCoord.y&&i.y>this._minCoord.y&&a===_e.CLOCKWISE)&&(c=!0),c&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(o,n){var i=o.getEdge().getCoordinates();if(n<0||n+1>=i.length||i[n].y===i[n+1].y)return-1;var a=ie.LEFT;return i[n].y<i[n+1].y&&(a=ie.RIGHT),a}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(o){for(var n=o.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(this._minCoord===null||n[i].x>this._minCoord.x)&&(this._minDe=o,this._minIndex=i,this._minCoord=n[i])}},{key:"findRightmostEdgeAtNode",value:function(){var o=this._minDe.getNode().getEdges();this._minDe=o.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(o){for(var n=o.iterator();n.hasNext();){var i=n.next();i.isForward()&&this.checkForRightmostCoordinate(i)}se.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ie.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),Gt=(function(o){function n(i,a){var c;return u(this,n),(c=s(this,n,[a?i+" [ "+a+" ]":i])).pt=a?new X(a):void 0,c.name=Object.keys({TopologyException:n})[0],c}return _(n,o),h(n,[{key:"getCoordinate",value:function(){return this.pt}}])})(ce),Vi=(function(){return h((function o(){u(this,o),this.array=[]}),[{key:"addLast",value:function(o){this.array.push(o)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),me=(function(o){function n(i){var a;return u(this,n),(a=s(this,n)).array=[],i instanceof Pe&&a.addAll(i),a}return _(n,o),h(n,[{key:"interfaces_",get:function(){return[Yn,Pe]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(i){return arguments.length===1?this.array.push(i):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(i){var a,c=p(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.array.push(g)}}catch(m){c.e(m)}finally{c.f()}}},{key:"set",value:function(i,a){var c=this.array[i];return this.array[i]=a,c}},{key:"iterator",value:function(){return new Fr(this)}},{key:"get",value:function(i){if(i<0||i>=this.size())throw new ta;return this.array[i]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(i){i?this.array.sort((function(a,c){return i.compare(a,c)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(i){for(var a=0,c=this.array.length;a<c;a++)if(this.array[a]===i)return!!this.array.splice(a,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(Yn),Fr=(function(){return h((function o(n){u(this,o),this.arrayList=n,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ge;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(o){return this.arrayList.set(this.position-1,o)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),na=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var o=this._dirEdgeList.iterator();o.hasNext();)o.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(o){for(var n=null,i=o.getEdges().iterator();i.hasNext();){var a=i.next();if(a.isVisited()||a.getSym().isVisited()){n=a;break}}if(n===null)throw new Gt("unable to find edge to compute depths at "+o.getCoordinate());o.getEdges().computeDepths(n);for(var c=o.getEdges().iterator();c.hasNext();){var g=c.next();g.setVisited(!0),this.copySymDepths(g)}}},{key:"computeDepth",value:function(o){this.clearVisitedEdges();var n=this._finder.getEdge();n.getNode(),n.getLabel(),n.setEdgeDepths(ie.RIGHT,o),this.copySymDepths(n),this.computeDepths(n)}},{key:"create",value:function(o){this.addReachable(o),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var o=this._dirEdgeList.iterator();o.hasNext();){var n=o.next();n.getDepth(ie.RIGHT)>=1&&n.getDepth(ie.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}}},{key:"computeDepths",value:function(o){var n=new oi,i=new Vi,a=o.getNode();for(i.addLast(a),n.add(a),o.setVisited(!0);!i.isEmpty();){var c=i.removeFirst();n.add(c),this.computeNodeDepth(c);for(var g=c.getEdges().iterator();g.hasNext();){var m=g.next().getSym();if(!m.isVisited()){var y=m.getNode();n.contains(y)||(i.addLast(y),n.add(y))}}}}},{key:"compareTo",value:function(o){var n=o;return this._rightMostCoord.x<n._rightMostCoord.x?-1:this._rightMostCoord.x>n._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var o=new Te,n=this._dirEdgeList.iterator();n.hasNext();)for(var i=n.next().getEdge().getCoordinates(),a=0;a<i.length-1;a++)o.expandToInclude(i[a]);this._env=o}return this._env}},{key:"addReachable",value:function(o){var n=new tc;for(n.add(o);!n.empty();){var i=n.pop();this.add(i,n)}}},{key:"copySymDepths",value:function(o){var n=o.getSym();n.setDepth(ie.LEFT,o.getDepth(ie.RIGHT)),n.setDepth(ie.RIGHT,o.getDepth(ie.LEFT))}},{key:"add",value:function(o,n){o.setVisited(!0),this._nodes.add(o);for(var i=o.getEdges().iterator();i.hasNext();){var a=i.next();this._dirEdgeList.add(a);var c=a.getSym().getNode();c.isVisited()||n.push(c)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new me,this._nodes=new me,this._rightMostCoord=null,this._env=null,this._finder=new Bo}}])})(),li=(function(){return h((function o(){u(this,o)}),null,[{key:"intersection",value:function(o,n,i,a){var c=o.x<n.x?o.x:n.x,g=o.y<n.y?o.y:n.y,m=o.x>n.x?o.x:n.x,y=o.y>n.y?o.y:n.y,x=i.x<a.x?i.x:a.x,T=i.y<a.y?i.y:a.y,z=i.x>a.x?i.x:a.x,V=i.y>a.y?i.y:a.y,ee=((c>x?c:x)+(m<z?m:z))/2,he=((g>T?g:T)+(y<V?y:V))/2,de=o.x-ee,ve=o.y-he,Le=n.x-ee,Ae=n.y-he,Ue=i.x-ee,mt=i.y-he,wt=a.x-ee,di=a.y-he,la=ve-Ae,Qp=Le-de,em=de*Ae-Le*ve,tm=mt-di,nm=wt-Ue,rm=Ue*di-wt*mt,im=la*nm-tm*Qp,fc=(Qp*rm-nm*em)/im,gc=(tm*em-la*rm)/im;return Z.isNaN(fc)||Z.isInfinite(fc)||Z.isNaN(gc)||Z.isInfinite(gc)?null:new X(fc+ee,gc+he)}}])})(),Bt=(function(){return h((function o(){u(this,o)}),null,[{key:"arraycopy",value:function(o,n,i,a,c){for(var g=0,m=n;m<n+c;m++)i[a+g]=o[m],g++}},{key:"getProperty",value:function(o){return{"line.separator":`
`}[o]}}])})(),Hn=(function(){function o(){u(this,o)}return h(o,null,[{key:"log10",value:function(n){var i=Math.log(n);return Z.isInfinite(i)||Z.isNaN(i)?i:i/o.LOG_10}},{key:"min",value:function(n,i,a,c){var g=n;return i<g&&(g=i),a<g&&(g=a),c<g&&(g=c),g}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1],a=arguments[2];return n<i?i:n>a?a:n}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var c=arguments[0],g=arguments[1],m=arguments[2];return c<g?g:c>m?m:c}}},{key:"wrap",value:function(n,i){return n<0?i- -n%i:n%i}},{key:"max",value:function(){if(arguments.length===3){var n=arguments[1],i=arguments[2],a=arguments[0];return n>a&&(a=n),i>a&&(a=i),a}if(arguments.length===4){var c=arguments[1],g=arguments[2],m=arguments[3],y=arguments[0];return c>y&&(y=c),g>y&&(y=g),m>y&&(y=m),y}}},{key:"average",value:function(n,i){return(n+i)/2}}])})();Hn.LOG_10=Math.log(10);var Ct=(function(){function o(){u(this,o)}return h(o,null,[{key:"segmentToSegment",value:function(n,i,a,c){if(n.equals(i))return o.pointToSegment(n,a,c);if(a.equals(c))return o.pointToSegment(c,n,i);var g=!1;if(Te.intersects(n,i,a,c)){var m=(i.x-n.x)*(c.y-a.y)-(i.y-n.y)*(c.x-a.x);if(m===0)g=!0;else{var y=(n.y-a.y)*(c.x-a.x)-(n.x-a.x)*(c.y-a.y),x=((n.y-a.y)*(i.x-n.x)-(n.x-a.x)*(i.y-n.y))/m,T=y/m;(T<0||T>1||x<0||x>1)&&(g=!0)}}else g=!0;return g?Hn.min(o.pointToSegment(n,a,c),o.pointToSegment(i,a,c),o.pointToSegment(a,n,i),o.pointToSegment(c,n,i)):0}},{key:"pointToSegment",value:function(n,i,a){if(i.x===a.x&&i.y===a.y)return n.distance(i);var c=(a.x-i.x)*(a.x-i.x)+(a.y-i.y)*(a.y-i.y),g=((n.x-i.x)*(a.x-i.x)+(n.y-i.y)*(a.y-i.y))/c;if(g<=0)return n.distance(i);if(g>=1)return n.distance(a);var m=((i.y-n.y)*(a.x-i.x)-(i.x-n.x)*(a.y-i.y))/c;return Math.abs(m)*Math.sqrt(c)}},{key:"pointToLinePerpendicular",value:function(n,i,a){var c=(a.x-i.x)*(a.x-i.x)+(a.y-i.y)*(a.y-i.y),g=((i.y-n.y)*(a.x-i.x)-(i.x-n.x)*(a.y-i.y))/c;return Math.abs(g)*Math.sqrt(c)}},{key:"pointToSegmentString",value:function(n,i){if(i.length===0)throw new J("Line array must contain at least one vertex");for(var a=n.distance(i[0]),c=0;c<i.length-1;c++){var g=o.pointToSegment(n,i[c],i[c+1]);g<a&&(a=g)}return a}}])})(),Uo=(function(){return h((function o(){u(this,o)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||we(arguments[0],Ie);else if(arguments.length!==2){if(arguments.length===3){var o=arguments[0],n=arguments[1];return this.create(o,n)}}}}])})(),Jn=(function(){return h((function o(){u(this,o)}),[{key:"filter",value:function(o){}}])})(),nc=(function(){return h((function o(){u(this,o)}),null,[{key:"ofLine",value:function(o){var n=o.size();if(n<=1)return 0;var i=0,a=new X;o.getCoordinate(0,a);for(var c=a.x,g=a.y,m=1;m<n;m++){o.getCoordinate(m,a);var y=a.x,x=a.y,T=y-c,z=x-g;i+=Math.sqrt(T*T+z*z),c=y,g=x}return i}}])})(),zo=h((function o(){u(this,o)})),Be=(function(){function o(){u(this,o)}return h(o,null,[{key:"copyCoord",value:function(n,i,a,c){for(var g=Math.min(n.getDimension(),a.getDimension()),m=0;m<g;m++)a.setOrdinate(c,m,n.getOrdinate(i,m))}},{key:"isRing",value:function(n){var i=n.size();return i===0||!(i<=3)&&n.getOrdinate(0,Ie.X)===n.getOrdinate(i-1,Ie.X)&&n.getOrdinate(0,Ie.Y)===n.getOrdinate(i-1,Ie.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(we(arguments[0],Ie)&&Number.isInteger(arguments[1])){var n=arguments[0],i=arguments[1];o.scroll(n,i,o.isRing(n))}else if(we(arguments[0],Ie)&&arguments[1]instanceof X){var a=arguments[0],c=arguments[1],g=o.indexOf(c,a);if(g<=0)return null;o.scroll(a,g)}}else if(arguments.length===3){var m=arguments[0],y=arguments[1],x=arguments[2];if(y<=0)return null;for(var T=m.copy(),z=x?m.size()-1:m.size(),V=0;V<z;V++)for(var ee=0;ee<m.getDimension();ee++)m.setOrdinate(V,ee,T.getOrdinate((y+V)%z,ee));if(x)for(var he=0;he<m.getDimension();he++)m.setOrdinate(z,he,m.getOrdinate(0,he))}}},{key:"isEqual",value:function(n,i){var a=n.size();if(a!==i.size())return!1;for(var c=Math.min(n.getDimension(),i.getDimension()),g=0;g<a;g++)for(var m=0;m<c;m++){var y=n.getOrdinate(g,m),x=i.getOrdinate(g,m);if(n.getOrdinate(g,m)!==i.getOrdinate(g,m)&&(!Z.isNaN(y)||!Z.isNaN(x)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var n=arguments[0];return o.minCoordinateIndex(n,0,n.size()-1)}if(arguments.length===3){for(var i=arguments[0],a=arguments[2],c=-1,g=null,m=arguments[1];m<=a;m++){var y=i.getCoordinate(m);(g===null||g.compareTo(y)>0)&&(g=y,c=m)}return c}}},{key:"extend",value:function(n,i,a){var c=n.create(a,i.getDimension()),g=i.size();if(o.copy(i,0,c,0,g),g>0)for(var m=g;m<a;m++)o.copy(i,g-1,c,m,1);return c}},{key:"reverse",value:function(n){for(var i=n.size()-1,a=Math.trunc(i/2),c=0;c<=a;c++)o.swap(n,c,i-c)}},{key:"swap",value:function(n,i,a){if(i===a)return null;for(var c=0;c<n.getDimension();c++){var g=n.getOrdinate(i,c);n.setOrdinate(i,c,n.getOrdinate(a,c)),n.setOrdinate(a,c,g)}}},{key:"copy",value:function(n,i,a,c,g){for(var m=0;m<g;m++)o.copyCoord(n,i+m,a,c+m)}},{key:"ensureValidRing",value:function(n,i){var a=i.size();return a===0?i:a<=3?o.createClosedRing(n,i,4):i.getOrdinate(0,Ie.X)===i.getOrdinate(a-1,Ie.X)&&i.getOrdinate(0,Ie.Y)===i.getOrdinate(a-1,Ie.Y)?i:o.createClosedRing(n,i,a+1)}},{key:"indexOf",value:function(n,i){for(var a=0;a<i.size();a++)if(n.x===i.getOrdinate(a,Ie.X)&&n.y===i.getOrdinate(a,Ie.Y))return a;return-1}},{key:"createClosedRing",value:function(n,i,a){var c=n.create(a,i.getDimension()),g=i.size();o.copy(i,0,c,0,g);for(var m=g;m<a;m++)o.copy(i,0,c,m,1);return c}},{key:"minCoordinate",value:function(n){for(var i=null,a=0;a<n.size();a++){var c=n.getCoordinate(a);(i===null||i.compareTo(c)>0)&&(i=c)}return i}}])})(),oe=(function(){function o(){u(this,o)}return h(o,null,[{key:"toDimensionSymbol",value:function(n){switch(n){case o.FALSE:return o.SYM_FALSE;case o.TRUE:return o.SYM_TRUE;case o.DONTCARE:return o.SYM_DONTCARE;case o.P:return o.SYM_P;case o.L:return o.SYM_L;case o.A:return o.SYM_A}throw new J("Unknown dimension value: "+n)}},{key:"toDimensionValue",value:function(n){switch(Ft.toUpperCase(n)){case o.SYM_FALSE:return o.FALSE;case o.SYM_TRUE:return o.TRUE;case o.SYM_DONTCARE:return o.DONTCARE;case o.SYM_P:return o.P;case o.SYM_L:return o.L;case o.SYM_A:return o.A}throw new J("Unknown dimension symbol: "+n)}}])})();oe.P=0,oe.L=1,oe.A=2,oe.FALSE=-1,oe.TRUE=-2,oe.DONTCARE=-3,oe.SYM_FALSE="F",oe.SYM_TRUE="T",oe.SYM_DONTCARE="*",oe.SYM_P="0",oe.SYM_L="1",oe.SYM_A="2";var Wi=(function(){return h((function o(){u(this,o)}),[{key:"filter",value:function(o){}}])})(),ci=(function(){return h((function o(){u(this,o)}),[{key:"filter",value:function(o,n){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),vr=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Te:this._points.expandEnvelope(new Te)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new n(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._points.size()!==c._points.size())return!1;for(var g=0;g<this._points.size();g++)if(!this.equal(this._points.getCoordinate(g),c._points.getCoordinate(g),a))return!1;return!0}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var i=0;i<Math.trunc(this._points.size()/2);i++){var a=this._points.size()-1-i;if(!this._points.getCoordinate(i).equals(this._points.getCoordinate(a))){if(this._points.getCoordinate(i).compareTo(this._points.getCoordinate(a))>0){var c=this._points.copy();Be.reverse(c),this._points=c}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?oe.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var i=this._points.copy();return Be.reverse(i),this.getFactory().createLineString(i)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return nc.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var i=arguments[0],a=0,c=0;a<this._points.size()&&c<i._points.size();){var g=this._points.getCoordinate(a).compareTo(i._points.getCoordinate(c));if(g!==0)return g;a++,c++}return a<this._points.size()?1:c<i._points.size()?-1:0}if(arguments.length===2){var m=arguments[0];return arguments[1].compare(this._points,m._points)}}},{key:"apply",value:function(){if(we(arguments[0],Jn))for(var i=arguments[0],a=0;a<this._points.size();a++)i.filter(this._points.getCoordinate(a));else if(we(arguments[0],ci)){var c=arguments[0];if(this._points.size()===0)return null;for(var g=0;g<this._points.size()&&(c.filter(this._points,g),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else we(arguments[0],Wi)?arguments[0].filter(this):we(arguments[0],q)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Se}},{key:"isEquivalentClass",value:function(i){return i instanceof n}},{key:"getCoordinateN",value:function(i){return this._points.getCoordinate(i)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new J("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i}},{key:"isCoordinate",value:function(i){for(var a=0;a<this._points.size();a++)if(this._points.getCoordinate(a).equals(i))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))}},{key:"interfaces_",get:function(){return[zo]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var i=arguments[0],a=arguments[1];fe.constructor_.call(this,a),this.init(i)}}}}])})(fe),ra=h((function o(){u(this,o)})),ji=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Te;var i=new Te;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new n(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&(!(!this.isEmpty()||!i.isEmpty())||this.isEmpty()===i.isEmpty()&&this.equal(i.getCoordinate(),this.getCoordinate(),a))}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return oe.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0];return this.getCoordinate().compareTo(i.getCoordinate())}if(arguments.length===2){var a=arguments[0];return arguments[1].compare(this._coordinates,a._coordinates)}}},{key:"apply",value:function(){if(we(arguments[0],Jn)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(we(arguments[0],ci)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else we(arguments[0],Wi)?arguments[0].filter(this):we(arguments[0],q)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),se.isTrue(i.size()<=1),this._coordinates=i}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[ra]}}],[{key:"constructor_",value:function(){this._coordinates=null;var i=arguments[0],a=arguments[1];fe.constructor_.call(this,a),this.init(i)}}])})(fe),qo=(function(){function o(){u(this,o)}return h(o,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var n=arguments[0];return Math.abs(o.ofRingSigned(n))}if(we(arguments[0],Ie)){var i=arguments[0];return Math.abs(o.ofRingSigned(i))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var n=arguments[0];if(n.length<3)return 0;for(var i=0,a=n[0].x,c=1;c<n.length-1;c++){var g=n[c].x-a,m=n[c+1].y;i+=g*(n[c-1].y-m)}return i/2}if(we(arguments[0],Ie)){var y=arguments[0],x=y.size();if(x<3)return 0;var T=new X,z=new X,V=new X;y.getCoordinate(0,z),y.getCoordinate(1,V);var ee=z.x;V.x-=ee;for(var he=0,de=1;de<x-1;de++)T.y=z.y,z.x=V.x,z.y=V.y,y.getCoordinate(de+1,V),V.x-=ee,he+=z.x*(T.y-V.y);return he/2}}}])})(),ht=(function(){return h((function o(){u(this,o)}),null,[{key:"sort",value:function(){var o=arguments,n=arguments[0];if(arguments.length===1)n.sort((function(ee,he){return ee.compareTo(he)}));else if(arguments.length===2)n.sort((function(ee,he){return o[1].compare(ee,he)}));else if(arguments.length===3){var i=n.slice(arguments[1],arguments[2]);i.sort();var a=n.slice(0,arguments[1]).concat(i,n.slice(arguments[2],n.length));n.splice(0,n.length);var c,g=p(a);try{for(g.s();!(c=g.n()).done;){var m=c.value;n.push(m)}}catch(ee){g.e(ee)}finally{g.f()}}else if(arguments.length===4){var y=n.slice(arguments[1],arguments[2]);y.sort((function(ee,he){return o[3].compare(ee,he)}));var x=n.slice(0,arguments[1]).concat(y,n.slice(arguments[2],n.length));n.splice(0,n.length);var T,z=p(x);try{for(z.s();!(T=z.n()).done;){var V=T.value;n.push(V)}}catch(ee){z.e(ee)}finally{z.f()}}}},{key:"asList",value:function(o){var n,i=new me,a=p(o);try{for(a.s();!(n=a.n()).done;){var c=n.value;i.add(c)}}catch(g){a.e(g)}finally{a.f()}return i}},{key:"copyOf",value:function(o,n){return o.slice(0,n)}}])})(),$n=h((function o(){u(this,o)})),hi=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),a=-1,c=this._shell.getCoordinates(),g=0;g<c.length;g++)i[++a]=c[g];for(var m=0;m<this._holes.length;m++)for(var y=this._holes[m].getCoordinates(),x=0;x<y.length;x++)i[++a]=y[x];return i}},{key:"getArea",value:function(){var i=0;i+=qo.ofRing(this._shell.getCoordinateSequence());for(var a=0;a<this._holes.length;a++)i-=qo.ofRing(this._holes[a].getCoordinateSequence());return i}},{key:"copyInternal",value:function(){for(var i=this._shell.copy(),a=new Array(this._holes.length).fill(null),c=0;c<this._holes.length;c++)a[c]=this._holes[c].copy();return new n(i,a,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),c=0;c<5;c++){var g=i.getX(c);if(g!==a.getMinX()&&g!==a.getMaxX())return!1;var m=i.getY(c);if(m!==a.getMinY()&&m!==a.getMaxY())return!1}for(var y=i.getX(0),x=i.getY(0),T=1;T<=4;T++){var z=i.getX(T),V=i.getY(T);if(z!==y==(V!==x))return!1;y=z,x=V}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i,g=this._shell,m=c._shell;if(!g.equalsExact(m,a)||this._holes.length!==c._holes.length)return!1;for(var y=0;y<this._holes.length;y++)if(!this._holes[y].equalsExact(c._holes[y],a))return!1;return!0}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var i=0;i<this._holes.length;i++)this._holes[i]=this.normalized(this._holes[i],!1);ht.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];if(a.isEmpty())return null;var g=a.getCoordinateSequence(),m=Be.minCoordinateIndex(g,0,g.size()-2);Be.scroll(g,m,!0),_e.isCCW(g)===c&&Be.reverse(g)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var i=this.getExteriorRing().reverse(),a=new Array(this.getNumInteriorRing()).fill(null),c=0;c<a.length;c++)a[c]=this.getInteriorRingN(c).reverse();return this.getFactory().createPolygon(i,a)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var i=0;i+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)i+=this._holes[a].getLength();return i}},{key:"getNumPoints",value:function(){for(var i=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)i+=this._holes[a].getNumPoints();return i}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(i,a){var c=i.copy();return this.normalize(c,a),c}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0],a=this._shell,c=i._shell;return a.compareToSameClass(c)}if(arguments.length===2){var g=arguments[1],m=arguments[0],y=this._shell,x=m._shell,T=y.compareToSameClass(x,g);if(T!==0)return T;for(var z=this.getNumInteriorRing(),V=m.getNumInteriorRing(),ee=0;ee<z&&ee<V;){var he=this.getInteriorRingN(ee),de=m.getInteriorRingN(ee),ve=he.compareToSameClass(de,g);if(ve!==0)return ve;ee++}return ee<z?1:ee<V?-1:0}}},{key:"apply",value:function(){if(we(arguments[0],Jn)){var i=arguments[0];this._shell.apply(i);for(var a=0;a<this._holes.length;a++)this._holes[a].apply(i)}else if(we(arguments[0],ci)){var c=arguments[0];if(this._shell.apply(c),!c.isDone())for(var g=0;g<this._holes.length&&(this._holes[g].apply(c),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else if(we(arguments[0],Wi))arguments[0].filter(this);else if(we(arguments[0],q)){var m=arguments[0];m.filter(this),this._shell.apply(m);for(var y=0;y<this._holes.length;y++)this._holes[y].apply(m)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var a=0;a<this._holes.length;a++)i[a+1]=this._holes[a];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(i){return this._holes[i]}},{key:"interfaces_",get:function(){return[$n]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var i=arguments[0],a=arguments[1],c=arguments[2];if(fe.constructor_.call(this,c),i===null&&(i=this.getFactory().createLinearRing()),a===null&&(a=[]),fe.hasNullElements(a))throw new J("holes must not contain null elements");if(i.isEmpty()&&fe.hasNonEmptyElements(a))throw new J("shell is empty but holes are not");this._shell=i,this._holes=a}}])})(fe),Yo=(function(o){function n(){return u(this,n),s(this,n,arguments)}return _(n,o),h(n)})($i),Zi=(function(o){function n(i){var a;return u(this,n),(a=s(this,n)).array=[],i instanceof Pe&&a.addAll(i),a}return _(n,o),h(n,[{key:"contains",value:function(i){var a,c=p(this.array);try{for(c.s();!(a=c.n()).done;)if(a.value.compareTo(i)===0)return!0}catch(g){c.e(g)}finally{c.f()}return!1}},{key:"add",value:function(i){if(this.contains(i))return!1;for(var a=0,c=this.array.length;a<c;a++)if(this.array[a].compareTo(i)===1)return!!this.array.splice(a,0,i);return this.array.push(i),!0}},{key:"addAll",value:function(i){var a,c=p(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.add(g)}}catch(m){c.e(m)}finally{c.f()}return!0}},{key:"remove",value:function(){throw new Se}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Ho(this.array)}}])})(Yo),Ho=(function(){return h((function o(n){u(this,o),this.array=n,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new Ge;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Se}}])})(),Qe=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"computeEnvelopeInternal",value:function(){for(var i=new Te,a=0;a<this._geometries.length;a++)i.expandToInclude(this._geometries[a].getEnvelopeInternal());return i}},{key:"getGeometryN",value:function(i){return this._geometries[i]}},{key:"getCoordinates",value:function(){for(var i=new Array(this.getNumPoints()).fill(null),a=-1,c=0;c<this._geometries.length;c++)for(var g=this._geometries[c].getCoordinates(),m=0;m<g.length;m++)i[++a]=g[m];return i}},{key:"getArea",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getArea();return i}},{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new n(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._geometries.length!==c._geometries.length)return!1;for(var g=0;g<this._geometries.length;g++)if(!this._geometries[g].equalsExact(c._geometries[g],a))return!1;return!0}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var i=0;i<this._geometries.length;i++)this._geometries[i].normalize();ht.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var i=oe.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,this._geometries[a].getBoundaryDimension());return i}},{key:"reverseInternal",value:function(){for(var i=this._geometries.length,a=new me(i),c=0;c<i;c++)a.add(this._geometries[c].reverse());return this.getFactory().buildGeometry(a)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var i=oe.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,this._geometries[a].getDimension());return i}},{key:"getLength",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getLength();return i}},{key:"getNumPoints",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getNumPoints();return i}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0],a=new Zi(ht.asList(this._geometries)),c=new Zi(ht.asList(i._geometries));return this.compare(a,c)}if(arguments.length===2){for(var g=arguments[1],m=arguments[0],y=this.getNumGeometries(),x=m.getNumGeometries(),T=0;T<y&&T<x;){var z=this.getGeometryN(T),V=m.getGeometryN(T),ee=z.compareToSameClass(V,g);if(ee!==0)return ee;T++}return T<y?1:T<x?-1:0}}},{key:"apply",value:function(){if(we(arguments[0],Jn))for(var i=arguments[0],a=0;a<this._geometries.length;a++)this._geometries[a].apply(i);else if(we(arguments[0],ci)){var c=arguments[0];if(this._geometries.length===0)return null;for(var g=0;g<this._geometries.length&&(this._geometries[g].apply(c),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else if(we(arguments[0],Wi)){var m=arguments[0];m.filter(this);for(var y=0;y<this._geometries.length;y++)this._geometries[y].apply(m)}else if(we(arguments[0],q)){var x=arguments[0];x.filter(this);for(var T=0;T<this._geometries.length;T++)this._geometries[T].apply(x)}}},{key:"getBoundary",value:function(){return fe.checkNotGeometryCollection(this),se.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return fe.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var i=arguments[0],a=arguments[1];if(fe.constructor_.call(this,a),i===null&&(i=[]),fe.hasNullElements(i))throw new J("geometries must not contain null elements");this._geometries=i}}}}])})(fe),Ki=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new n(i,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(n,"equalsExact",this,1).call(this,i,a)}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var i=arguments[0];return this._geometries[i].getCoordinate()}return M(n,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return oe.FALSE}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[ra]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];Qe.constructor_.call(this,i,a)}}])})(Qe),Gr=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"copyInternal",value:function(){return new n(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return oe.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||M(n,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var i=this._points.copy();return Be.reverse(i),this.getFactory().createLinearRing(i)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!M(n,"isClosed",this,1).call(this))throw new J("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<n.MINIMUM_VALID_SIZE)throw new J("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];vr.constructor_.call(this,i,a),this.validateConstruction()}}])})(vr);Gr.MINIMUM_VALID_SIZE=4;var Xn=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"setOrdinate",value:function(i,a){switch(i){case n.X:this.x=a;break;case n.Y:this.y=a;break;default:throw new J("Invalid ordinate index: "+i)}}},{key:"getZ",value:function(){return X.NULL_ORDINATE}},{key:"getOrdinate",value:function(i){switch(i){case n.X:return this.x;case n.Y:return this.y}throw new J("Invalid ordinate index: "+i)}},{key:"setZ",value:function(i){throw new J("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)X.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof n){var i=arguments[0];X.constructor_.call(this,i.x,i.y)}else if(arguments[0]instanceof X){var a=arguments[0];X.constructor_.call(this,a.x,a.y)}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];X.constructor_.call(this,c,g,X.NULL_ORDINATE)}}}])})(X);Xn.X=0,Xn.Y=1,Xn.Z=-1,Xn.M=-1;var Vn=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(i,a){switch(i){case n.X:this.x=a;break;case n.Y:this.y=a;break;case n.M:this._m=a;break;default:throw new J("Invalid ordinate index: "+i)}}},{key:"setM",value:function(i){this._m=i}},{key:"getZ",value:function(){return X.NULL_ORDINATE}},{key:"getOrdinate",value:function(i){switch(i){case n.X:return this.x;case n.Y:return this.y;case n.M:return this._m}throw new J("Invalid ordinate index: "+i)}},{key:"setZ",value:function(i){throw new J("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ(),this._m=i.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)X.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof n){var i=arguments[0];X.constructor_.call(this,i.x,i.y),this._m=i._m}else if(arguments[0]instanceof X){var a=arguments[0];X.constructor_.call(this,a.x,a.y),this._m=this.getM()}}else if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];X.constructor_.call(this,c,g,X.NULL_ORDINATE),this._m=m}}}])})(X);Vn.X=0,Vn.Y=1,Vn.Z=-1,Vn.M=2;var ia=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(i,a){switch(i){case X.X:this.x=a;break;case X.Y:this.y=a;break;case X.Z:this.z=a;break;case X.M:this._m=a;break;default:throw new J("Invalid ordinate index: "+i)}}},{key:"setM",value:function(i){this._m=i}},{key:"getOrdinate",value:function(i){switch(i){case X.X:return this.x;case X.Y:return this.y;case X.Z:return this.getZ();case X.M:return this.getM()}throw new J("Invalid ordinate index: "+i)}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ(),this._m=i.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)X.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof n){var i=arguments[0];X.constructor_.call(this,i),this._m=i._m}else if(arguments[0]instanceof X){var a=arguments[0];X.constructor_.call(this,a),this._m=this.getM()}}else if(arguments.length===4){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3];X.constructor_.call(this,c,g,m),this._m=y}}}])})(X),pe=(function(){function o(){u(this,o)}return h(o,null,[{key:"measures",value:function(n){return n instanceof Xn?0:n instanceof Vn||n instanceof ia?1:0}},{key:"dimension",value:function(n){return n instanceof Xn?2:n instanceof Vn?3:n instanceof ia?4:3}},{key:"create",value:function(){if(arguments.length===1){var n=arguments[0];return o.create(n,0)}if(arguments.length===2){var i=arguments[0],a=arguments[1];return i===2?new Xn:i===3&&a===0?new X:i===3&&a===1?new Vn:i===4&&a===1?new ia:new X}}}])})(),G=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getCoordinate",value:function(i){return this.get(i)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&we(arguments[0],Pe)){for(var i=arguments[1],a=!1,c=arguments[0].iterator();c.hasNext();)this.add(c.next(),i),a=!0;return a}return M(n,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var i=M(n,"clone",this,1).call(this),a=0;a<this.size();a++)i.add(a,this.get(a).clone());return i}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(n.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(n.coordArrayType);for(var i=this.size(),a=new Array(i).fill(null),c=0;c<i;c++)a[c]=this.get(i-c-1);return a}}},{key:"add",value:function(){if(arguments.length===1){var i=arguments[0];return M(n,"add",this,1).call(this,i)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],c=arguments[1];return this.add(a,c,!0),!0}if(arguments[0]instanceof X&&typeof arguments[1]=="boolean"){var g=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(g))return null;M(n,"add",this,1).call(this,g)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var m=arguments[0],y=arguments[1];return this.add(m,y),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var x=arguments[0],T=arguments[1];if(arguments[2])for(var z=0;z<x.length;z++)this.add(x[z],T);else for(var V=x.length-1;V>=0;V--)this.add(x[V],T);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof X){var ee=arguments[0],he=arguments[1];if(!arguments[2]){var de=this.size();if(de>0&&(ee>0&&this.get(ee-1).equals2D(he)||ee<de&&this.get(ee).equals2D(he)))return null}M(n,"add",this,1).call(this,ee,he)}}else if(arguments.length===4){var ve=arguments[0],Le=arguments[1],Ae=arguments[2],Ue=arguments[3],mt=1;Ae>Ue&&(mt=-1);for(var wt=Ae;wt!==Ue;wt+=mt)this.add(ve[wt],Le);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var i=this.get(0).copy();this.add(i,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.ensureCapacity(a.length),this.add(a,c)}}}}])})(me);G.coordArrayType=new Array(0).fill(null);var Q=(function(){function o(){u(this,o)}return h(o,null,[{key:"isRing",value:function(n){return!(n.length<4)&&!!n[0].equals2D(n[n.length-1])}},{key:"ptNotInList",value:function(n,i){for(var a=0;a<n.length;a++){var c=n[a];if(o.indexOf(c,i)<0)return c}return null}},{key:"scroll",value:function(n,i){var a=o.indexOf(i,n);if(a<0)return null;var c=new Array(n.length).fill(null);Bt.arraycopy(n,a,c,0,n.length-a),Bt.arraycopy(n,0,c,n.length-a,a),Bt.arraycopy(c,0,n,0,n.length)}},{key:"equals",value:function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];if(n===i)return!0;if(n===null||i===null||n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(!n[a].equals(i[a]))return!1;return!0}if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];if(c===g)return!0;if(c===null||g===null||c.length!==g.length)return!1;for(var y=0;y<c.length;y++)if(m.compare(c[y],g[y])!==0)return!1;return!0}}},{key:"intersection",value:function(n,i){for(var a=new G,c=0;c<n.length;c++)i.intersects(n[c])&&a.add(n[c],!0);return a.toCoordinateArray()}},{key:"measures",value:function(n){if(n===null||n.length===0)return 0;var i,a=0,c=p(n);try{for(c.s();!(i=c.n()).done;){var g=i.value;a=Math.max(a,pe.measures(g))}}catch(m){c.e(m)}finally{c.f()}return a}},{key:"hasRepeatedPoints",value:function(n){for(var i=1;i<n.length;i++)if(n[i-1].equals(n[i]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(n){return o.hasRepeatedPoints(n)?new G(n,!1).toCoordinateArray():n}},{key:"reverse",value:function(n){for(var i=n.length-1,a=Math.trunc(i/2),c=0;c<=a;c++){var g=n[c];n[c]=n[i-c],n[i-c]=g}}},{key:"removeNull",value:function(n){for(var i=0,a=0;a<n.length;a++)n[a]!==null&&i++;var c=new Array(i).fill(null);if(i===0)return c;for(var g=0,m=0;m<n.length;m++)n[m]!==null&&(c[g++]=n[m]);return c}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var n=arguments[0],i=new Array(n.length).fill(null),a=0;a<n.length;a++)i[a]=n[a].copy();return i}if(arguments.length===5)for(var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],x=arguments[4],T=0;T<x;T++)m[y+T]=c[g+T].copy()}},{key:"isEqualReversed",value:function(n,i){for(var a=0;a<n.length;a++){var c=n[a],g=i[n.length-a-1];if(c.compareTo(g)!==0)return!1}return!0}},{key:"envelope",value:function(n){for(var i=new Te,a=0;a<n.length;a++)i.expandToInclude(n[a]);return i}},{key:"toCoordinateArray",value:function(n){return n.toArray(o.coordArrayType)}},{key:"dimension",value:function(n){if(n===null||n.length===0)return 3;var i,a=0,c=p(n);try{for(c.s();!(i=c.n()).done;){var g=i.value;a=Math.max(a,pe.dimension(g))}}catch(m){c.e(m)}finally{c.f()}return a}},{key:"atLeastNCoordinatesOrNothing",value:function(n,i){return i.length>=n?i:[]}},{key:"indexOf",value:function(n,i){for(var a=0;a<i.length;a++)if(n.equals(i[a]))return a;return-1}},{key:"increasingDirection",value:function(n){for(var i=0;i<Math.trunc(n.length/2);i++){var a=n.length-1-i,c=n[i].compareTo(n[a]);if(c!==0)return c}return 1}},{key:"compare",value:function(n,i){for(var a=0;a<n.length&&a<i.length;){var c=n[a].compareTo(i[a]);if(c!==0)return c;a++}return a<i.length?-1:a<n.length?1:0}},{key:"minCoordinate",value:function(n){for(var i=null,a=0;a<n.length;a++)(i===null||i.compareTo(n[a])>0)&&(i=n[a]);return i}},{key:"extract",value:function(n,i,a){i=Hn.clamp(i,0,n.length);var c=(a=Hn.clamp(a,-1,n.length))-i+1;a<0&&(c=0),i>=n.length&&(c=0),a<i&&(c=0);var g=new Array(c).fill(null);if(c===0)return g;for(var m=0,y=i;y<=a;y++)g[m++]=n[y];return g}}])})(),ge=(function(){return h((function o(){u(this,o)}),[{key:"compare",value:function(o,n){var i=o,a=n;return Q.compare(i,a)}},{key:"interfaces_",get:function(){return[re]}}])})(),Ye=(function(){return h((function o(){u(this,o)}),[{key:"compare",value:function(o,n){var i=o,a=n;if(i.length<a.length)return-1;if(i.length>a.length)return 1;if(i.length===0)return 0;var c=Q.compare(i,a);return Q.isEqualReversed(i,a)?0:c}},{key:"OLDcompare",value:function(o,n){var i=o,a=n;if(i.length<a.length)return-1;if(i.length>a.length)return 1;if(i.length===0)return 0;for(var c=Q.increasingDirection(i),g=Q.increasingDirection(a),m=c>0?0:i.length-1,y=g>0?0:i.length-1,x=0;x<i.length;x++){var T=i[m].compareTo(a[y]);if(T!==0)return T;m+=c,y+=g}return 0}},{key:"interfaces_",get:function(){return[re]}}])})();Q.ForwardComparator=ge,Q.BidirectionalComparator=Ye,Q.coordArrayType=new Array(0).fill(null);var nt=(function(){return h((function o(n){u(this,o),this.str=n}),[{key:"append",value:function(o){this.str+=o}},{key:"setCharAt",value:function(o,n){this.str=this.str.substr(0,o)+n+this.str.substr(o+1)}},{key:"toString",value:function(){return this.str}}])})(),He=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getM",value:function(n){return this.hasM()?this._coordinates[n].getM():Z.NaN}},{key:"setOrdinate",value:function(n,i,a){switch(i){case Ie.X:this._coordinates[n].x=a;break;case Ie.Y:this._coordinates[n].y=a;break;default:this._coordinates[n].setOrdinate(i,a)}}},{key:"getZ",value:function(n){return this.hasZ()?this._coordinates[n].getZ():Z.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(n,i){switch(i){case Ie.X:return this._coordinates[n].x;case Ie.Y:return this._coordinates[n].y;default:return this._coordinates[n].getOrdinate(i)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var n=arguments[0];return this._coordinates[n]}if(arguments.length===2){var i=arguments[0];arguments[1].setCoordinate(this._coordinates[i])}}},{key:"getCoordinateCopy",value:function(n){var i=this.createCoordinate();return i.setCoordinate(this._coordinates[n]),i}},{key:"createCoordinate",value:function(){return pe.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(n){return this._coordinates[n].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(n){for(var i=0;i<this._coordinates.length;i++)n.expandToInclude(this._coordinates[i]);return n}},{key:"copy",value:function(){for(var n=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++){var a=this.createCoordinate();a.setCoordinate(this._coordinates[i]),n[i]=a}return new o(n,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var n=new nt(17*this._coordinates.length);n.append("("),n.append(this._coordinates[0]);for(var i=1;i<this._coordinates.length;i++)n.append(", "),n.append(this._coordinates[i]);return n.append(")"),n.toString()}return"()"}},{key:"getY",value:function(n){return this._coordinates[n].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Ie,S]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];o.constructor_.call(this,n,Q.dimension(n),Q.measures(n))}else if(Number.isInteger(arguments[0])){var i=arguments[0];this._coordinates=new Array(i).fill(null);for(var a=0;a<i;a++)this._coordinates[a]=new X}else if(we(arguments[0],Ie)){var c=arguments[0];if(c===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=c.getDimension(),this._measures=c.getMeasures(),this._coordinates=new Array(c.size()).fill(null);for(var g=0;g<this._coordinates.length;g++)this._coordinates[g]=c.getCoordinateCopy(g)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var m=arguments[0],y=arguments[1];o.constructor_.call(this,m,y,Q.measures(m))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x=arguments[0],T=arguments[1];this._coordinates=new Array(x).fill(null),this._dimension=T;for(var z=0;z<x;z++)this._coordinates[z]=pe.create(T)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var V=arguments[0],ee=arguments[1],he=arguments[2];this._dimension=ee,this._measures=he,this._coordinates=V===null?new Array(0).fill(null):V}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var de=arguments[0],ve=arguments[1],Le=arguments[2];this._coordinates=new Array(de).fill(null),this._dimension=ve,this._measures=Le;for(var Ae=0;Ae<de;Ae++)this._coordinates[Ae]=this.createCoordinate()}}}}])})(),ft=(function(){function o(){u(this,o)}return h(o,[{key:"readResolve",value:function(){return o.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new He(arguments[0]);if(we(arguments[0],Ie))return new He(arguments[0])}else{if(arguments.length===2){var n=arguments[1];return n>3&&(n=3),n<2&&(n=2),new He(arguments[0],n)}if(arguments.length===3){var i=arguments[2],a=arguments[1]-i;return i>1&&(i=1),a>3&&(a=3),a<2&&(a=2),new He(arguments[0],a+i,i)}}}},{key:"interfaces_",get:function(){return[Uo,S]}}],[{key:"instance",value:function(){return o.instanceObject}}])})();ft.instanceObject=new ft;var Jt=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new n(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(n,"equalsExact",this,1).call(this,i,a)}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new me,a=0;a<this._geometries.length;a++)for(var c=this._geometries[a].getBoundary(),g=0;g<c.getNumGeometries();g++)i.add(c.getGeometryN(g));var m=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(m))}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[$n]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];Qe.constructor_.call(this,i,a)}}])})(Qe),yr=(function(){return h((function o(){u(this,o)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),sa=(function(o){function n(){var i;return u(this,n),(i=s(this,n)).map=new Map,i}return _(n,o),h(n,[{key:"get",value:function(i){return this.map.get(i)||null}},{key:"put",value:function(i,a){return this.map.set(i,a),a}},{key:"values",value:function(){for(var i=new me,a=this.map.values(),c=a.next();!c.done;)i.add(c.value),c=a.next();return i}},{key:"entrySet",value:function(){var i=new oi;return this.map.entries().forEach((function(a){return i.add(a)})),i}},{key:"size",value:function(){return this.map.size()}}])})(yr),De=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"equals",value:function(n){if(!(n instanceof o))return!1;var i=n;return this._modelType===i._modelType&&this._scale===i._scale}},{key:"compareTo",value:function(n){var i=n,a=this.getMaximumSignificantDigits(),c=i.getMaximumSignificantDigits();return In.compare(a,c)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===o.FLOATING||this._modelType===o.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var n="UNKNOWN";return this._modelType===o.FLOATING?n="Floating":this._modelType===o.FLOATING_SINGLE?n="Floating-Single":this._modelType===o.FIXED&&(n="Fixed (Scale="+this.getScale()+")"),n}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var n=arguments[0];return Z.isNaN(n)||this._modelType===o.FLOATING_SINGLE?n:this._modelType===o.FIXED?Math.round(n*this._scale)/this._scale:n}if(arguments[0]instanceof X){var i=arguments[0];if(this._modelType===o.FLOATING)return null;i.x=this.makePrecise(i.x),i.y=this.makePrecise(i.y)}}},{key:"getMaximumSignificantDigits",value:function(){var n=16;return this._modelType===o.FLOATING?n=16:this._modelType===o.FLOATING_SINGLE?n=6:this._modelType===o.FIXED&&(n=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),n}},{key:"setScale",value:function(n){this._scale=Math.abs(n)}},{key:"interfaces_",get:function(){return[S,W]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=o.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof _r){var n=arguments[0];this._modelType=n,n===o.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var i=arguments[0];this._modelType=o.FIXED,this.setScale(i)}else if(arguments[0]instanceof o){var a=arguments[0];this._modelType=a._modelType,this._scale=a._scale}}}},{key:"mostPrecise",value:function(n,i){return n.compareTo(i)>=0?n:i}}])})(),_r=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"readResolve",value:function(){return o.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[S]}}],[{key:"constructor_",value:function(){this._name=null;var n=arguments[0];this._name=n,o.nameToTypeMap.put(n,this)}}])})();_r.nameToTypeMap=new sa,De.Type=_r,De.FIXED=new _r("FIXED"),De.FLOATING=new _r("FLOATING"),De.FLOATING_SINGLE=new _r("FLOATING SINGLE"),De.maximumPreciseValue=9007199254740992;var Qi=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new n(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(n,"equalsExact",this,1).call(this,i,a)}return M(n,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?oe.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Se}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[zo]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];Qe.constructor_.call(this,i,a)}}])})(Qe),es=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"createEmpty",value:function(n){switch(n){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new J("Invalid dimension: "+n)}}},{key:"toGeometry",value:function(n){return n.isNull()?this.createPoint():n.getMinX()===n.getMaxX()&&n.getMinY()===n.getMaxY()?this.createPoint(new X(n.getMinX(),n.getMinY())):n.getMinX()===n.getMaxX()||n.getMinY()===n.getMaxY()?this.createLineString([new X(n.getMinX(),n.getMinY()),new X(n.getMaxX(),n.getMaxY())]):this.createPolygon(this.createLinearRing([new X(n.getMinX(),n.getMinY()),new X(n.getMinX(),n.getMaxY()),new X(n.getMaxX(),n.getMaxY()),new X(n.getMaxX(),n.getMinY()),new X(n.getMinX(),n.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLineString(n!==null?this.getCoordinateSequenceFactory().create(n):null)}if(we(arguments[0],Ie))return new vr(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new Qi(null,this):arguments.length===1?new Qi(arguments[0],this):void 0}},{key:"buildGeometry",value:function(n){for(var i=null,a=!1,c=!1,g=n.iterator();g.hasNext();){var m=g.next(),y=m.getTypeCode();i===null&&(i=y),y!==i&&(a=!0),m instanceof Qe&&(c=!0)}if(i===null)return this.createGeometryCollection();if(a||c)return this.createGeometryCollection(o.toGeometryArray(n));var x=n.iterator().next();if(n.size()>1){if(x instanceof hi)return this.createMultiPolygon(o.toPolygonArray(n));if(x instanceof vr)return this.createMultiLineString(o.toLineStringArray(n));if(x instanceof ji)return this.createMultiPoint(o.toPointArray(n));se.shouldNeverReachHere("Unhandled geometry type: "+x.getGeometryType())}return x}},{key:"createMultiPointFromCoords",value:function(n){return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof X){var n=arguments[0];return this.createPoint(n!==null?this.getCoordinateSequenceFactory().create([n]):null)}if(we(arguments[0],Ie))return new ji(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(we(arguments[0],Ie)){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}if(arguments[0]instanceof Array){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof Gr){var a=arguments[0];return this.createPolygon(a,null)}}else if(arguments.length===2)return new hi(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Qe(null,this):arguments.length===1?new Qe(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLinearRing(n!==null?this.getCoordinateSequenceFactory().create(n):null)}if(we(arguments[0],Ie))return new Gr(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Jt(null,this):arguments.length===1?new Jt(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Ki(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Ki(arguments[0],this);if(we(arguments[0],Ie)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(n.size()).fill(null),a=0;a<n.size();a++){var c=this.getCoordinateSequenceFactory().create(1,n.getDimension(),n.getMeasures());Be.copy(n,a,c,0,1),i[a]=this.createPoint(c)}return this.createMultiPoint(i)}}}},{key:"interfaces_",get:function(){return[S]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)o.constructor_.call(this,new De,0);else if(arguments.length===1){if(we(arguments[0],Uo)){var n=arguments[0];o.constructor_.call(this,new De,0,n)}else if(arguments[0]instanceof De){var i=arguments[0];o.constructor_.call(this,i,0,o.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];o.constructor_.call(this,a,c,o.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var g=arguments[0],m=arguments[1],y=arguments[2];this._precisionModel=g,this._coordinateSequenceFactory=y,this._SRID=m}}},{key:"toMultiPolygonArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toGeometryArray",value:function(n){if(n===null)return null;var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return ft.instance()}},{key:"toMultiLineStringArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toLineStringArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toMultiPointArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toLinearRingArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toPointArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"toPolygonArray",value:function(n){var i=new Array(n.size()).fill(null);return n.toArray(i)}},{key:"createPointFromInternalCoord",value:function(n,i){return i.getPrecisionModel().makePrecise(n),i.getFactory().createPoint(n)}}])})(),rc="XY",uM="XYZ",lM="XYM",cM="XYZM",wp={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},xp="EMPTY",Jo=1,Er=2,Br=3,kp=4,ts=5,hM=6;for(var fM in wp)wp[fM].toUpperCase();var gM=(function(){return h((function o(n){u(this,o),this.wkt=n,this.index_=-1}),[{key:"isAlpha_",value:function(o){return o>="a"&&o<="z"||o>="A"&&o<="Z"}},{key:"isNumeric_",value:function(o,n){return o>="0"&&o<="9"||o=="."&&!(n!==void 0&&n)}},{key:"isWhiteSpace_",value:function(o){return o==" "||o=="	"||o=="\r"||o==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var o,n=this.nextChar_(),i=this.index_,a=n;if(n=="(")o=Er;else if(n==",")o=ts;else if(n==")")o=Br;else if(this.isNumeric_(n)||n=="-")o=kp,a=this.readNumber_();else if(this.isAlpha_(n))o=Jo,a=this.readText_();else{if(this.isWhiteSpace_(n))return this.nextToken();if(n!=="")throw new Error("Unexpected character: "+n);o=hM}return{position:i,value:a,type:o}}},{key:"readNumber_",value:function(){var o,n=this.index_,i=!1,a=!1;do o=="."?i=!0:o!="e"&&o!="E"||(a=!0),o=this.nextChar_();while(this.isNumeric_(o,i)||!a&&(o=="e"||o=="E")||a&&(o=="-"||o=="+"));return parseFloat(this.wkt.substring(n,this.index_--))}},{key:"readText_",value:function(){var o,n=this.index_;do o=this.nextChar_();while(this.isAlpha_(o));return this.wkt.substring(n,this.index_--).toUpperCase()}}])})(),dM=(function(){return h((function o(n,i){u(this,o),this.lexer_=n,this.token_,this.layout_=rc,this.factory=i}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(o){return this.token_.type==o}},{key:"match",value:function(o){var n=this.isTokenType(o);return n&&this.consume_(),n}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var o=rc,n=this.token_;if(this.isTokenType(Jo)){var i=n.value;i==="Z"?o=uM:i==="M"?o=lM:i==="ZM"&&(o=cM),o!==rc&&this.consume_()}return o}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Er)){var o=[];do o.push(this.parseGeometry_());while(this.match(ts));if(this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Er)){var o=this.parsePoint_();if(this.match(Br))return o}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Er)){var o=this.parsePointList_();if(this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Er)){var o=this.parseLineStringTextList_();if(this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var o;if(this.match(Er)){if(o=this.token_.type==Er?this.parsePointTextList_():this.parsePointList_(),this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Er)){var o=this.parseLineStringTextList_();if(this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Er)){var o=this.parsePolygonTextList_();if(this.match(Br))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var o=[],n=this.layout_.length,i=0;i<n;++i){var a=this.token_;if(!this.match(kp))break;o.push(a.value)}if(o.length==n)return o;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var o=[this.parsePoint_()];this.match(ts);)o.push(this.parsePoint_());return o}},{key:"parsePointTextList_",value:function(){for(var o=[this.parsePointText_()];this.match(ts);)o.push(this.parsePointText_());return o}},{key:"parseLineStringTextList_",value:function(){for(var o=[this.parseLineStringText_()];this.match(ts);)o.push(this.parseLineStringText_());return o}},{key:"parsePolygonTextList_",value:function(){for(var o=[this.parsePolygonText_()];this.match(ts);)o.push(this.parsePolygonText_());return o}},{key:"isEmptyGeometry_",value:function(){var o=this.isTokenType(Jo)&&this.token_.value==xp;return o&&this.consume_(),o}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var o=this.factory,n=function(ve){return l(X,R(ve))},i=function(ve){var Le=ve.map((function(Ae){return o.createLinearRing(Ae.map(n))}));return Le.length>1?o.createPolygon(Le[0],Le.slice(1)):o.createPolygon(Le[0])},a=this.token_;if(this.match(Jo)){var c=a.value;if(this.layout_=this.parseGeometryLayout_(),c=="GEOMETRYCOLLECTION"){var g=this.parseGeometryCollectionText_();return o.createGeometryCollection(g)}switch(c){case"POINT":var m=this.parsePointText_();return m?o.createPoint(l(X,R(m))):o.createPoint();case"LINESTRING":var y=this.parseLineStringText_().map(n);return o.createLineString(y);case"LINEARRING":var x=this.parseLineStringText_().map(n);return o.createLinearRing(x);case"POLYGON":var T=this.parsePolygonText_();return T&&T.length!==0?i(T):o.createPolygon();case"MULTIPOINT":var z=this.parseMultiPointText_();if(!z||z.length===0)return o.createMultiPoint();var V=z.map(n).map((function(ve){return o.createPoint(ve)}));return o.createMultiPoint(V);case"MULTILINESTRING":var ee=this.parseMultiLineStringText_().map((function(ve){return o.createLineString(ve.map(n))}));return o.createMultiLineString(ee);case"MULTIPOLYGON":var he=this.parseMultiPolygonText_();if(!he||he.length===0)return o.createMultiPolygon();var de=he.map(i);return o.createMultiPolygon(de);default:throw new Error("Invalid geometry type: "+c)}}throw new Error(this.formatErrorMessage_())}}])})();function Sp(o){if(o.isEmpty())return"";var n=o.getCoordinate(),i=[n.x,n.y];return n.z===void 0||Number.isNaN(n.z)||i.push(n.z),n.m===void 0||Number.isNaN(n.m)||i.push(n.m),i.join(" ")}function aa(o){for(var n=o.getCoordinates().map((function(g){var m=[g.x,g.y];return g.z===void 0||Number.isNaN(g.z)||m.push(g.z),g.m===void 0||Number.isNaN(g.m)||m.push(g.m),m})),i=[],a=0,c=n.length;a<c;++a)i.push(n[a].join(" "));return i.join(", ")}function Mp(o){var n=[];n.push("("+aa(o.getExteriorRing())+")");for(var i=0,a=o.getNumInteriorRing();i<a;++i)n.push("("+aa(o.getInteriorRingN(i))+")");return n.join(", ")}var pM={Point:Sp,LineString:aa,LinearRing:aa,Polygon:Mp,MultiPoint:function(o){for(var n=[],i=0,a=o.getNumGeometries();i<a;++i)n.push("("+Sp(o.getGeometryN(i))+")");return n.join(", ")},MultiLineString:function(o){for(var n=[],i=0,a=o.getNumGeometries();i<a;++i)n.push("("+aa(o.getGeometryN(i))+")");return n.join(", ")},MultiPolygon:function(o){for(var n=[],i=0,a=o.getNumGeometries();i<a;++i)n.push("("+Mp(o.getGeometryN(i))+")");return n.join(", ")},GeometryCollection:function(o){for(var n=[],i=0,a=o.getNumGeometries();i<a;++i)n.push(Ip(o.getGeometryN(i)));return n.join(", ")}};function Ip(o){var n=o.getGeometryType(),i=pM[n];n=n.toUpperCase();var a=(function(c){var g="";if(c.isEmpty())return g;var m=c.getCoordinate();return m.z===void 0||Number.isNaN(m.z)||(g+="Z"),m.m===void 0||Number.isNaN(m.m)||(g+="M"),g})(o);return a.length>0&&(n+=" "+a),o.isEmpty()?n+" "+xp:n+" ("+i(o)+")"}var mM=(function(){return h((function o(n){u(this,o),this.geometryFactory=n||new es,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(o){var n=new gM(o);return new dM(n,this.geometryFactory).parse()}},{key:"write",value:function(o){return Ip(o)}}])})(),ic=(function(){return h((function o(n){u(this,o),this.parser=new mM(n)}),[{key:"write",value:function(o){return this.parser.write(o)}}],[{key:"toLineString",value:function(o,n){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+o.x+" "+o.y+", "+n.x+" "+n.y+" )"}}])})(),Ve=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getIndexAlongSegment",value:function(n,i){return this.computeIntLineIndex(),this._intLineIndex[n][i]}},{key:"getTopologySummary",value:function(){var n=new nt;return this.isEndPoint()&&n.append(" endpoint"),this._isProper&&n.append(" proper"),this.isCollinear()&&n.append(" collinear"),n.toString()}},{key:"computeIntersection",value:function(n,i,a,c){this._inputLines[0][0]=n,this._inputLines[0][1]=i,this._inputLines[1][0]=a,this._inputLines[1][1]=c,this._result=this.computeIntersect(n,i,a,c)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var n=arguments[0];this.getEdgeDistance(n,0)>this.getEdgeDistance(n,1)?(this._intLineIndex[n][0]=0,this._intLineIndex[n][1]=1):(this._intLineIndex[n][0]=1,this._intLineIndex[n][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(n){this._precisionModel=n}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var n=arguments[0],i=0;i<this._result;i++)if(!this._intPt[i].equals2D(this._inputLines[n][0])&&!this._intPt[i].equals2D(this._inputLines[n][1]))return!0;return!1}}},{key:"getIntersection",value:function(n){return this._intPt[n]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==o.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(n,i){return o.computeEdgeDistance(this._intPt[i],this._inputLines[n][0],this._inputLines[n][1])}},{key:"isCollinear",value:function(){return this._result===o.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return ic.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+ic.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(n,i){return this._inputLines[n][i]}},{key:"isIntersection",value:function(n){for(var i=0;i<this._result;i++)if(this._intPt[i].equals2D(n))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(n,i){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[n][i]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new X,this._intPt[1]=new X,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(n,i,a){var c=Math.abs(a.x-i.x),g=Math.abs(a.y-i.y),m=-1;if(n.equals(i))m=0;else if(n.equals(a))m=c>g?c:g;else{var y=Math.abs(n.x-i.x),x=Math.abs(n.y-i.y);(m=c>g?y:x)!==0||n.equals(i)||(m=Math.max(y,x))}return se.isTrue(!(m===0&&!n.equals(i)),"Bad distance calculation"),m}},{key:"nonRobustComputeEdgeDistance",value:function(n,i,a){var c=n.x-i.x,g=n.y-i.y,m=Math.sqrt(c*c+g*g);return se.isTrue(!(m===0&&!n.equals(i)),"Invalid distance calculation"),m}}])})();Ve.DONT_INTERSECT=0,Ve.DO_INTERSECT=1,Ve.COLLINEAR=2,Ve.NO_INTERSECTION=0,Ve.POINT_INTERSECTION=1,Ve.COLLINEAR_INTERSECTION=2;var fi=(function(o){function n(){return u(this,n),s(this,n)}return _(n,o),h(n,[{key:"isInSegmentEnvelopes",value:function(i){var a=new Te(this._inputLines[0][0],this._inputLines[0][1]),c=new Te(this._inputLines[1][0],this._inputLines[1][1]);return a.contains(i)&&c.contains(i)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return M(n,"computeIntersection",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1],c=arguments[2];if(this._isProper=!1,Te.intersects(a,c,i)&&_e.index(a,c,i)===0&&_e.index(c,a,i)===0)return this._isProper=!0,(i.equals(a)||i.equals(c))&&(this._isProper=!1),this._result=Ve.POINT_INTERSECTION,null;this._result=Ve.NO_INTERSECTION}},{key:"intersection",value:function(i,a,c,g){var m=this.intersectionSafe(i,a,c,g);return this.isInSegmentEnvelopes(m)||(m=new X(n.nearestEndpoint(i,a,c,g))),this._precisionModel!==null&&this._precisionModel.makePrecise(m),m}},{key:"checkDD",value:function(i,a,c,g,m){var y=Xi.intersection(i,a,c,g),x=this.isInSegmentEnvelopes(y);Bt.out.println("DD in env = "+x+"  --------------------- "+y),m.distance(y)>1e-4&&Bt.out.println("Distance = "+m.distance(y))}},{key:"intersectionSafe",value:function(i,a,c,g){var m=li.intersection(i,a,c,g);return m===null&&(m=n.nearestEndpoint(i,a,c,g)),m}},{key:"computeCollinearIntersection",value:function(i,a,c,g){var m=Te.intersects(i,a,c),y=Te.intersects(i,a,g),x=Te.intersects(c,g,i),T=Te.intersects(c,g,a);return m&&y?(this._intPt[0]=c,this._intPt[1]=g,Ve.COLLINEAR_INTERSECTION):x&&T?(this._intPt[0]=i,this._intPt[1]=a,Ve.COLLINEAR_INTERSECTION):m&&x?(this._intPt[0]=c,this._intPt[1]=i,!c.equals(i)||y||T?Ve.COLLINEAR_INTERSECTION:Ve.POINT_INTERSECTION):m&&T?(this._intPt[0]=c,this._intPt[1]=a,!c.equals(a)||y||x?Ve.COLLINEAR_INTERSECTION:Ve.POINT_INTERSECTION):y&&x?(this._intPt[0]=g,this._intPt[1]=i,!g.equals(i)||m||T?Ve.COLLINEAR_INTERSECTION:Ve.POINT_INTERSECTION):y&&T?(this._intPt[0]=g,this._intPt[1]=a,!g.equals(a)||m||x?Ve.COLLINEAR_INTERSECTION:Ve.POINT_INTERSECTION):Ve.NO_INTERSECTION}},{key:"computeIntersect",value:function(i,a,c,g){if(this._isProper=!1,!Te.intersects(i,a,c,g))return Ve.NO_INTERSECTION;var m=_e.index(i,a,c),y=_e.index(i,a,g);if(m>0&&y>0||m<0&&y<0)return Ve.NO_INTERSECTION;var x=_e.index(c,g,i),T=_e.index(c,g,a);return x>0&&T>0||x<0&&T<0?Ve.NO_INTERSECTION:m===0&&y===0&&x===0&&T===0?this.computeCollinearIntersection(i,a,c,g):(m===0||y===0||x===0||T===0?(this._isProper=!1,i.equals2D(c)||i.equals2D(g)?this._intPt[0]=i:a.equals2D(c)||a.equals2D(g)?this._intPt[0]=a:m===0?this._intPt[0]=new X(c):y===0?this._intPt[0]=new X(g):x===0?this._intPt[0]=new X(i):T===0&&(this._intPt[0]=new X(a))):(this._isProper=!0,this._intPt[0]=this.intersection(i,a,c,g)),Ve.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(i,a,c,g){var m=i,y=Ct.pointToSegment(i,c,g),x=Ct.pointToSegment(a,c,g);return x<y&&(y=x,m=a),(x=Ct.pointToSegment(c,i,a))<y&&(y=x,m=c),(x=Ct.pointToSegment(g,i,a))<y&&(y=x,m=g),m}}])})(Ve),vM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"countSegment",value:function(n,i){if(n.x<this._p.x&&i.x<this._p.x)return null;if(this._p.x===i.x&&this._p.y===i.y)return this._isPointOnSegment=!0,null;if(n.y===this._p.y&&i.y===this._p.y){var a=n.x,c=i.x;return a>c&&(a=i.x,c=n.x),this._p.x>=a&&this._p.x<=c&&(this._isPointOnSegment=!0),null}if(n.y>this._p.y&&i.y<=this._p.y||i.y>this._p.y&&n.y<=this._p.y){var g=_e.index(n,i,this._p);if(g===_e.COLLINEAR)return this._isPointOnSegment=!0,null;i.y<n.y&&(g=-g),g===_e.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==N.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?N.BOUNDARY:this._crossingCount%2==1?N.INTERIOR:N.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var n=arguments[0];this._p=n}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof X&&we(arguments[1],Ie)){for(var n=arguments[1],i=new o(arguments[0]),a=new X,c=new X,g=1;g<n.size();g++)if(n.getCoordinate(g,a),n.getCoordinate(g-1,c),i.countSegment(a,c),i.isOnSegment())return i.getLocation();return i.getLocation()}if(arguments[0]instanceof X&&arguments[1]instanceof Array){for(var m=arguments[1],y=new o(arguments[0]),x=1;x<m.length;x++){var T=m[x],z=m[x-1];if(y.countSegment(T,z),y.isOnSegment())return y.getLocation()}return y.getLocation()}}}])})(),sc=(function(){function o(){u(this,o)}return h(o,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof X&&we(arguments[1],Ie)){for(var n=arguments[0],i=arguments[1],a=new fi,c=new X,g=new X,m=i.size(),y=1;y<m;y++)if(i.getCoordinate(y-1,c),i.getCoordinate(y,g),a.computeIntersection(n,c,g),a.hasIntersection())return!0;return!1}if(arguments[0]instanceof X&&arguments[1]instanceof Array){for(var x=arguments[0],T=arguments[1],z=new fi,V=1;V<T.length;V++){var ee=T[V-1],he=T[V];if(z.computeIntersection(x,ee,he),z.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(n,i){return vM.locatePointInRing(n,i)}},{key:"isInRing",value:function(n,i){return o.locateInRing(n,i)!==N.EXTERIOR}}])})(),un=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"setAllLocations",value:function(n){for(var i=0;i<this.location.length;i++)this.location[i]=n}},{key:"isNull",value:function(){for(var n=0;n<this.location.length;n++)if(this.location[n]!==N.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(n){for(var i=0;i<this.location.length;i++)this.location[i]===N.NONE&&(this.location[i]=n)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(n){if(n.location.length>this.location.length){var i=new Array(3).fill(null);i[ie.ON]=this.location[ie.ON],i[ie.LEFT]=N.NONE,i[ie.RIGHT]=N.NONE,this.location=i}for(var a=0;a<this.location.length;a++)this.location[a]===N.NONE&&a<n.location.length&&(this.location[a]=n.location[a])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var n=this.location[ie.LEFT];this.location[ie.LEFT]=this.location[ie.RIGHT],this.location[ie.RIGHT]=n}},{key:"toString",value:function(){var n=new Mn;return this.location.length>1&&n.append(N.toLocationSymbol(this.location[ie.LEFT])),n.append(N.toLocationSymbol(this.location[ie.ON])),this.location.length>1&&n.append(N.toLocationSymbol(this.location[ie.RIGHT])),n.toString()}},{key:"setLocations",value:function(n,i,a){this.location[ie.ON]=n,this.location[ie.LEFT]=i,this.location[ie.RIGHT]=a}},{key:"get",value:function(n){return n<this.location.length?this.location[n]:N.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var n=0;n<this.location.length;n++)if(this.location[n]===N.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var n=arguments[0];this.setLocation(ie.ON,n)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.location[i]=a}}},{key:"init",value:function(n){this.location=new Array(n).fill(null),this.setAllLocations(N.NONE)}},{key:"isEqualOnSide",value:function(n,i){return this.location[i]===n.location[i]}},{key:"allPositionsEqual",value:function(n){for(var i=0;i<this.location.length;i++)if(this.location[i]!==n)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[ie.ON]=i}else if(arguments[0]instanceof o){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var c=0;c<this.location.length;c++)this.location[c]=a.location[c]}}else if(arguments.length===3){var g=arguments[0],m=arguments[1],y=arguments[2];this.init(3),this.location[ie.ON]=g,this.location[ie.LEFT]=m,this.location[ie.RIGHT]=y}}}])})(),ln=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getGeometryCount",value:function(){var n=0;return this.elt[0].isNull()||n++,this.elt[1].isNull()||n++,n}},{key:"setAllLocations",value:function(n,i){this.elt[n].setAllLocations(i)}},{key:"isNull",value:function(n){return this.elt[n].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var n=arguments[0];this.setAllLocationsIfNull(0,n),this.setAllLocationsIfNull(1,n)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.elt[i].setAllLocationsIfNull(a)}}},{key:"isLine",value:function(n){return this.elt[n].isLine()}},{key:"merge",value:function(n){for(var i=0;i<2;i++)this.elt[i]===null&&n.elt[i]!==null?this.elt[i]=new un(n.elt[i]):this.elt[i].merge(n.elt[i])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var n=arguments[0];return this.elt[n].get(ie.ON)}if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.elt[i].get(a)}}},{key:"toString",value:function(){var n=new Mn;return this.elt[0]!==null&&(n.append("A:"),n.append(this.elt[0].toString())),this.elt[1]!==null&&(n.append(" B:"),n.append(this.elt[1].toString())),n.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var n=arguments[0];return this.elt[n].isArea()}}},{key:"isAnyNull",value:function(n){return this.elt[n].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this.elt[n].setLocation(ie.ON,i)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];this.elt[a].setLocation(c,g)}}},{key:"isEqualOnSide",value:function(n,i){return this.elt[0].isEqualOnSide(n.elt[0],i)&&this.elt[1].isEqualOnSide(n.elt[1],i)}},{key:"allPositionsEqual",value:function(n,i){return this.elt[n].allPositionsEqual(i)}},{key:"toLine",value:function(n){this.elt[n].isArea()&&(this.elt[n]=new un(this.elt[n].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var n=arguments[0];this.elt[0]=new un(n),this.elt[1]=new un(n)}else if(arguments[0]instanceof o){var i=arguments[0];this.elt[0]=new un(i.elt[0]),this.elt[1]=new un(i.elt[1])}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.elt[0]=new un(N.NONE),this.elt[1]=new un(N.NONE),this.elt[a].setLocation(c)}else if(arguments.length===3){var g=arguments[0],m=arguments[1],y=arguments[2];this.elt[0]=new un(g,m,y),this.elt[1]=new un(g,m,y)}else if(arguments.length===4){var x=arguments[0],T=arguments[1],z=arguments[2],V=arguments[3];this.elt[0]=new un(N.NONE,N.NONE,N.NONE),this.elt[1]=new un(N.NONE,N.NONE,N.NONE),this.elt[x].setLocations(T,z,V)}}},{key:"toLineLabel",value:function(n){for(var i=new o(N.NONE),a=0;a<2;a++)i.setLocation(a,n.getLocation(a));return i}}])})(),$o=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var o=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)o[n]=this._pts.get(n);this._ring=this._geometryFactory.createLinearRing(o),this._isHole=_e.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(o){this._startDe=o;var n=o,i=!0;do{if(n===null)throw new Gt("Found null DirectedEdge");if(n.getEdgeRing()===this)throw new Gt("Directed Edge visited twice during ring-building at "+n.getCoordinate());this._edges.add(n);var a=n.getLabel();se.isTrue(a.isArea()),this.mergeLabel(a),this.addPoints(n.getEdge(),n.isForward(),i),i=!1,this.setEdgeRing(n,this),n=this.getNext(n)}while(n!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(o){return this._pts.get(o)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var o=this._startDe;do{var n=o.getNode().getEdges().getOutgoingDegree(this);n>this._maxNodeDegree&&(this._maxNodeDegree=n),o=this.getNext(o)}while(o!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(o,n,i){var a=o.getCoordinates();if(n){var c=1;i&&(c=0);for(var g=c;g<a.length;g++)this._pts.add(a[g])}else{var m=a.length-2;i&&(m=a.length-1);for(var y=m;y>=0;y--)this._pts.add(a[y])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var o=this._startDe;do o.getEdge().setInResult(!0),o=o.getNext();while(o!==this._startDe)}},{key:"containsPoint",value:function(o){var n=this.getLinearRing();if(!n.getEnvelopeInternal().contains(o)||!sc.isInRing(o,n.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(o))return!1;return!0}},{key:"addHole",value:function(o){this._holes.add(o)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var o=arguments[0];this.mergeLabel(o,0),this.mergeLabel(o,1)}else if(arguments.length===2){var n=arguments[1],i=arguments[0].getLocation(n,ie.RIGHT);if(i===N.NONE)return null;if(this._label.getLocation(n)===N.NONE)return this._label.setLocation(n,i),null}}},{key:"setShell",value:function(o){this._shell=o,o!==null&&o.addHole(this)}},{key:"toPolygon",value:function(o){for(var n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=this._holes.get(i).getLinearRing();return o.createPolygon(this.getLinearRing(),n)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new me,this._pts=new me,this._label=new ln(N.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new me,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var o=arguments[0],n=arguments[1];this._geometryFactory=n,this.computePoints(o),this.computeRing()}}}}])})(),yM=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"setEdgeRing",value:function(i,a){i.setMinEdgeRing(a)}},{key:"getNext",value:function(i){return i.getNextMin()}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];$o.constructor_.call(this,i,a)}}])})($o),_M=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"buildMinimalRings",value:function(){var i=new me,a=this._startDe;do{if(a.getMinEdgeRing()===null){var c=new yM(a,this._geometryFactory);i.add(c)}a=a.getNext()}while(a!==this._startDe);return i}},{key:"setEdgeRing",value:function(i,a){i.setEdgeRing(a)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var i=this._startDe;do i.getNode().getEdges().linkMinimalDirectedEdges(this),i=i.getNext();while(i!==this._startDe)}},{key:"getNext",value:function(i){return i.getNext()}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];$o.constructor_.call(this,i,a)}}])})($o),bp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(o){this._isVisited=o}},{key:"setInResult",value:function(o){this._isInResult=o}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(o){this._label=o}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(o){this._isCovered=o,this._isCoveredSet=!0}},{key:"updateIM",value:function(o){se.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(o)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this._label=o}}}}])})(),Xo=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"isIncidentEdgeInResult",value:function(){for(var i=this.getEdges().getEdges().iterator();i.hasNext();)if(i.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(i){i.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(i){}},{key:"computeMergedLocation",value:function(i,a){var c=N.NONE;if(c=this._label.getLocation(a),!i.isNull(a)){var g=i.getLocation(a);c!==N.BOUNDARY&&(c=g)}return c}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return M(n,"setLabel",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1];this._label===null?this._label=new ln(i,a):this._label.setLocation(i,a)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof n){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof ln)for(var a=arguments[0],c=0;c<2;c++){var g=this.computeMergedLocation(a,c);this._label.getLocation(c)===N.NONE&&this._label.setLocation(c,g)}}},{key:"add",value:function(i){this._edges.insert(i),i.setNode(this)}},{key:"setLabelBoundary",value:function(i){if(this._label===null)return null;var a=N.NONE;this._label!==null&&(a=this._label.getLocation(i));var c=null;switch(a){case N.BOUNDARY:c=N.INTERIOR;break;case N.INTERIOR:default:c=N.BOUNDARY}this._label.setLocation(i,c)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var i=arguments[0],a=arguments[1];this._coord=i,this._edges=a,this._label=new ln(0,N.NONE)}}])})(bp),EM=(function(o){function n(){return u(this,n),s(this,n,arguments)}return _(n,o),h(n)})(yr);function Tp(o){return o==null?0:o.color}function Oe(o){return o==null?null:o.parent}function Wn(o,n){o!==null&&(o.color=n)}function ac(o){return o==null?null:o.left}function Ap(o){return o==null?null:o.right}var oa=(function(o){function n(){var i;return u(this,n),(i=s(this,n)).root_=null,i.size_=0,i}return _(n,o),h(n,[{key:"get",value:function(i){for(var a=this.root_;a!==null;){var c=i.compareTo(a.key);if(c<0)a=a.left;else{if(!(c>0))return a.value;a=a.right}}return null}},{key:"put",value:function(i,a){if(this.root_===null)return this.root_={key:i,value:a,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var c,g,m=this.root_;do if(c=m,(g=i.compareTo(m.key))<0)m=m.left;else{if(!(g>0)){var y=m.value;return m.value=a,y}m=m.right}while(m!==null);var x={key:i,left:null,right:null,value:a,parent:c,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return g<0?c.left=x:c.right=x,this.fixAfterInsertion(x),this.size_++,null}},{key:"fixAfterInsertion",value:function(i){var a;for(i.color=1;i!=null&&i!==this.root_&&i.parent.color===1;)Oe(i)===ac(Oe(Oe(i)))?Tp(a=Ap(Oe(Oe(i))))===1?(Wn(Oe(i),0),Wn(a,0),Wn(Oe(Oe(i)),1),i=Oe(Oe(i))):(i===Ap(Oe(i))&&(i=Oe(i),this.rotateLeft(i)),Wn(Oe(i),0),Wn(Oe(Oe(i)),1),this.rotateRight(Oe(Oe(i)))):Tp(a=ac(Oe(Oe(i))))===1?(Wn(Oe(i),0),Wn(a,0),Wn(Oe(Oe(i)),1),i=Oe(Oe(i))):(i===ac(Oe(i))&&(i=Oe(i),this.rotateRight(i)),Wn(Oe(i),0),Wn(Oe(Oe(i)),1),this.rotateLeft(Oe(Oe(i))));this.root_.color=0}},{key:"values",value:function(){var i=new me,a=this.getFirstEntry();if(a!==null)for(i.add(a.value);(a=n.successor(a))!==null;)i.add(a.value);return i}},{key:"entrySet",value:function(){var i=new oi,a=this.getFirstEntry();if(a!==null)for(i.add(a);(a=n.successor(a))!==null;)i.add(a);return i}},{key:"rotateLeft",value:function(i){if(i!=null){var a=i.right;i.right=a.left,a.left!=null&&(a.left.parent=i),a.parent=i.parent,i.parent==null?this.root_=a:i.parent.left===i?i.parent.left=a:i.parent.right=a,a.left=i,i.parent=a}}},{key:"rotateRight",value:function(i){if(i!=null){var a=i.left;i.left=a.right,a.right!=null&&(a.right.parent=i),a.parent=i.parent,i.parent==null?this.root_=a:i.parent.right===i?i.parent.right=a:i.parent.left=a,a.right=i,i.parent=a}}},{key:"getFirstEntry",value:function(){var i=this.root_;if(i!=null)for(;i.left!=null;)i=i.left;return i}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(i){for(var a=this.root_;a!==null;){var c=i.compareTo(a.key);if(c<0)a=a.left;else{if(!(c>0))return!0;a=a.right}}return!1}}],[{key:"successor",value:function(i){var a;if(i===null)return null;if(i.right!==null){for(a=i.right;a.left!==null;)a=a.left;return a}a=i.parent;for(var c=i;a!==null&&c===a.right;)c=a,a=a.parent;return a}}])})(EM),Lp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"find",value:function(o){return this.nodeMap.get(o)}},{key:"addNode",value:function(){if(arguments[0]instanceof X){var o=arguments[0],n=this.nodeMap.get(o);return n===null&&(n=this.nodeFact.createNode(o),this.nodeMap.put(o,n)),n}if(arguments[0]instanceof Xo){var i=arguments[0],a=this.nodeMap.get(i.getCoordinate());return a===null?(this.nodeMap.put(i.getCoordinate(),i),i):(a.mergeLabel(i),a)}}},{key:"print",value:function(o){for(var n=this.iterator();n.hasNext();)n.next().print(o)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(o){for(var n=new me,i=this.iterator();i.hasNext();){var a=i.next();a.getLabel().getLocation(o)===N.BOUNDARY&&n.add(a)}return n}},{key:"add",value:function(o){var n=o.getCoordinate();this.addNode(n).add(o)}}],[{key:"constructor_",value:function(){this.nodeMap=new oa,this.nodeFact=null;var o=arguments[0];this.nodeFact=o}}])})(),Nt=(function(){function o(){u(this,o)}return h(o,null,[{key:"isNorthern",value:function(n){return n===o.NE||n===o.NW}},{key:"isOpposite",value:function(n,i){return n!==i&&(n-i+4)%4===2}},{key:"commonHalfPlane",value:function(n,i){if(n===i)return n;if((n-i+4)%4===2)return-1;var a=n<i?n:i;return a===0&&(n>i?n:i)===3?3:a}},{key:"isInHalfPlane",value:function(n,i){return i===o.SE?n===o.SE||n===o.SW:n===i||n===i+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];if(n===0&&i===0)throw new J("Cannot compute the quadrant for point ( "+n+", "+i+" )");return n>=0?i>=0?o.NE:o.SE:i>=0?o.NW:o.SW}if(arguments[0]instanceof X&&arguments[1]instanceof X){var a=arguments[0],c=arguments[1];if(c.x===a.x&&c.y===a.y)throw new J("Cannot compute the quadrant for two identical points "+a);return c.x>=a.x?c.y>=a.y?o.NE:o.SE:c.y>=a.y?o.NW:o.SW}}}])})();Nt.NE=0,Nt.NW=1,Nt.SW=2,Nt.SE=3;var Cp=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compareDirection",value:function(n){return this._dx===n._dx&&this._dy===n._dy?0:this._quadrant>n._quadrant?1:this._quadrant<n._quadrant?-1:_e.index(n._p0,n._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(n){this._node=n}},{key:"print",value:function(n){var i=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),c=a.lastIndexOf("."),g=a.substring(c+1);n.print("  "+g+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label)}},{key:"compareTo",value:function(n){var i=n;return this.compareDirection(i)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var n=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),a=i.lastIndexOf(".");return"  "+i.substring(a+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label}},{key:"computeLabel",value:function(n){}},{key:"init",value:function(n,i){this._p0=n,this._p1=i,this._dx=i.x-n.x,this._dy=i.y-n.y,this._quadrant=Nt.quadrant(this._dx,this._dy),se.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var n=arguments[0];this._edge=n}else if(arguments.length===3){var i=arguments[0],a=arguments[1],c=arguments[2];o.constructor_.call(this,i,a,c,null)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],y=arguments[2],x=arguments[3];o.constructor_.call(this,g),this.init(m,y),this._label=x}}}])})(),oc=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(i){return this._depth[i]}},{key:"setVisited",value:function(i){this._isVisited=i}},{key:"computeDirectedLabel",value:function(){this._label=new ln(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(i,a){if(this._depth[i]!==-999&&this._depth[i]!==a)throw new Gt("assigned depths do not match",this.getCoordinate());this._depth[i]=a}},{key:"isInteriorAreaEdge",value:function(){for(var i=!0,a=0;a<2;a++)this._label.isArea(a)&&this._label.getLocation(a,ie.LEFT)===N.INTERIOR&&this._label.getLocation(a,ie.RIGHT)===N.INTERIOR||(i=!1);return i}},{key:"setNextMin",value:function(i){this._nextMin=i}},{key:"print",value:function(i){M(n,"print",this,1).call(this,i),i.print(" "+this._depth[ie.LEFT]+"/"+this._depth[ie.RIGHT]),i.print(" ("+this.getDepthDelta()+")"),this._isInResult&&i.print(" inResult")}},{key:"setMinEdgeRing",value:function(i){this._minEdgeRing=i}},{key:"isLineEdge",value:function(){var i=this._label.isLine(0)||this._label.isLine(1),a=!this._label.isArea(0)||this._label.allPositionsEqual(0,N.EXTERIOR),c=!this._label.isArea(1)||this._label.allPositionsEqual(1,N.EXTERIOR);return i&&a&&c}},{key:"setEdgeRing",value:function(i){this._edgeRing=i}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var i=this._edge.getDepthDelta();return this._isForward||(i=-i),i}},{key:"setInResult",value:function(i){this._isInResult=i}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(i){this.print(i),i.print(" "),this._isForward?this._edge.print(i):this._edge.printReverse(i)}},{key:"setSym",value:function(i){this._sym=i}},{key:"setVisitedEdge",value:function(i){this.setVisited(i),this._sym.setVisited(i)}},{key:"setEdgeDepths",value:function(i,a){var c=this.getEdge().getDepthDelta();this._isForward||(c=-c);var g=1;i===ie.LEFT&&(g=-1);var m=ie.opposite(i),y=a+c*g;this.setDepth(i,a),this.setDepth(m,y)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(i){this._next=i}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var i=arguments[0],a=arguments[1];if(Cp.constructor_.call(this,i),this._isForward=a,a)this.init(i.getCoordinate(0),i.getCoordinate(1));else{var c=i.getNumPoints()-1;this.init(i.getCoordinate(c),i.getCoordinate(c-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(i,a){return i===N.EXTERIOR&&a===N.INTERIOR?1:i===N.INTERIOR&&a===N.EXTERIOR?-1:0}}])})(Cp),Np=(function(){return h((function o(){u(this,o)}),[{key:"createNode",value:function(o){return new Xo(o,null)}}])})(),Pp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(o){o.println("Edges:");for(var n=0;n<this._edges.size();n++){o.println("edge "+n+":");var i=this._edges.get(n);i.print(o),i.eiList.print(o)}}},{key:"find",value:function(o){return this._nodes.find(o)}},{key:"addNode",value:function(){if(arguments[0]instanceof Xo){var o=arguments[0];return this._nodes.addNode(o)}if(arguments[0]instanceof X){var n=arguments[0];return this._nodes.addNode(n)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var o=this._nodes.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(o){Bt.out.println(o)}},{key:"isBoundaryNode",value:function(o,n){var i=this._nodes.find(n);if(i===null)return!1;var a=i.getLabel();return a!==null&&a.getLocation(o)===N.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var o=this._nodes.iterator();o.hasNext();)o.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(o,n,i,a){return!!o.equals(i)&&_e.index(o,n,a)===_e.COLLINEAR&&Nt.quadrant(o,n)===Nt.quadrant(i,a)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(o){Bt.out.print(o)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(o,n){for(var i=0;i<this._edges.size();i++){var a=this._edges.get(i),c=a.getCoordinates();if(this.matchInSameDirection(o,n,c[0],c[1])||this.matchInSameDirection(o,n,c[c.length-1],c[c.length-2]))return a}return null}},{key:"insertEdge",value:function(o){this._edges.add(o)}},{key:"findEdgeEnd",value:function(o){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var i=n.next();if(i.getEdge()===o)return i}return null}},{key:"addEdges",value:function(o){for(var n=o.iterator();n.hasNext();){var i=n.next();this._edges.add(i);var a=new oc(i,!0),c=new oc(i,!1);a.setSym(c),c.setSym(a),this.add(a),this.add(c)}}},{key:"add",value:function(o){this._nodes.add(o),this._edgeEndList.add(o)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(o,n){for(var i=0;i<this._edges.size();i++){var a=this._edges.get(i),c=a.getCoordinates();if(o.equals(c[0])&&n.equals(c[1]))return a}return null}}],[{key:"constructor_",value:function(){if(this._edges=new me,this._nodes=null,this._edgeEndList=new me,arguments.length===0)this._nodes=new Lp(new Np);else if(arguments.length===1){var o=arguments[0];this._nodes=new Lp(o)}}},{key:"linkResultDirectedEdges",value:function(o){for(var n=o.iterator();n.hasNext();)n.next().getEdges().linkResultDirectedEdges()}}])})(),wM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"sortShellsAndHoles",value:function(n,i,a){for(var c=n.iterator();c.hasNext();){var g=c.next();g.isHole()?a.add(g):i.add(g)}}},{key:"computePolygons",value:function(n){for(var i=new me,a=n.iterator();a.hasNext();){var c=a.next().toPolygon(this._geometryFactory);i.add(c)}return i}},{key:"placeFreeHoles",value:function(n,i){for(var a=i.iterator();a.hasNext();){var c=a.next();if(c.getShell()===null){var g=o.findEdgeRingContaining(c,n);if(g===null)throw new Gt("unable to assign hole to a shell",c.getCoordinate(0));c.setShell(g)}}}},{key:"buildMinimalEdgeRings",value:function(n,i,a){for(var c=new me,g=n.iterator();g.hasNext();){var m=g.next();if(m.getMaxNodeDegree()>2){m.linkDirectedEdgesForMinimalEdgeRings();var y=m.buildMinimalRings(),x=this.findShell(y);x!==null?(this.placePolygonHoles(x,y),i.add(x)):a.addAll(y)}else c.add(m)}return c}},{key:"buildMaximalEdgeRings",value:function(n){for(var i=new me,a=n.iterator();a.hasNext();){var c=a.next();if(c.isInResult()&&c.getLabel().isArea()&&c.getEdgeRing()===null){var g=new _M(c,this._geometryFactory);i.add(g),g.setInResult()}}return i}},{key:"placePolygonHoles",value:function(n,i){for(var a=i.iterator();a.hasNext();){var c=a.next();c.isHole()&&c.setShell(n)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(n){for(var i=0,a=null,c=n.iterator();c.hasNext();){var g=c.next();g.isHole()||(a=g,i++)}return se.isTrue(i<=1,"found two shells in MinimalEdgeRing list"),a}},{key:"add",value:function(){if(arguments.length===1){var n=arguments[0];this.add(n.getEdgeEnds(),n.getNodes())}else if(arguments.length===2){var i=arguments[0],a=arguments[1];Pp.linkResultDirectedEdges(a);var c=this.buildMaximalEdgeRings(i),g=new me,m=this.buildMinimalEdgeRings(c,this._shellList,g);this.sortShellsAndHoles(m,this._shellList,g),this.placeFreeHoles(this._shellList,g)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new me;var n=arguments[0];this._geometryFactory=n}},{key:"findEdgeRingContaining",value:function(n,i){for(var a=n.getLinearRing(),c=a.getEnvelopeInternal(),g=a.getCoordinateN(0),m=null,y=null,x=i.iterator();x.hasNext();){var T=x.next(),z=T.getLinearRing(),V=z.getEnvelopeInternal();if(!V.equals(c)&&V.contains(c)){g=Q.ptNotInList(a.getCoordinates(),z.getCoordinates());var ee=!1;sc.isInRing(g,z.getCoordinates())&&(ee=!0),ee&&(m===null||y.contains(V))&&(y=(m=T).getLinearRing().getEnvelopeInternal())}}return m}}])})(),Op=(function(){return h((function o(){u(this,o)}),[{key:"getBounds",value:function(){}}])})(),wr=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Op,S]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var o=arguments[0],n=arguments[1];this._bounds=o,this._item=n}}])})(),Vo=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var o=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),o}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(o){for(var n=null,i=this._items.get(o);2*o<=this._size&&((n=2*o)!==this._size&&this._items.get(n+1).compareTo(this._items.get(n))<0&&n++,this._items.get(n).compareTo(i)<0);o=n)this._items.set(o,this._items.get(n));this._items.set(o,i)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(o){this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,o);o.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)this._items.set(n,this._items.get(Math.trunc(n/2)));this._items.set(n,o)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new me,this._items.add(null)}}])})(),xM=(function(){return h((function o(){u(this,o)}),[{key:"insert",value:function(o,n){}},{key:"remove",value:function(o,n){}},{key:"query",value:function(){}}])})(),cn=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(o){se.isTrue(this._bounds===null),this._childBoundables.add(o)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Op,S]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new me,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this._level=o}}}}])})(),ns={reverseOrder:function(){return{compare:function(o,n){return n.compareTo(o)}}},min:function(o){return ns.sort(o),o.get(0)},sort:function(o,n){var i=o.toArray();n?ht.sort(i,n):ht.sort(i);for(var a=o.iterator(),c=0,g=i.length;c<g;c++)a.next(),a.set(i[c])},singletonList:function(o){var n=new me;return n.add(o),n}},kM=(function(){function o(){u(this,o)}return h(o,null,[{key:"maxDistance",value:function(n,i,a,c,g,m,y,x){var T=o.distance(n,i,g,m);return T=Math.max(T,o.distance(n,i,y,x)),T=Math.max(T,o.distance(a,c,g,m)),T=Math.max(T,o.distance(a,c,y,x))}},{key:"distance",value:function(n,i,a,c){var g=a-n,m=c-i;return Math.sqrt(g*g+m*m)}},{key:"maximumDistance",value:function(n,i){var a=Math.min(n.getMinX(),i.getMinX()),c=Math.min(n.getMinY(),i.getMinY()),g=Math.max(n.getMaxX(),i.getMaxX()),m=Math.max(n.getMaxY(),i.getMaxY());return o.distance(a,c,g,m)}},{key:"minMaxDistance",value:function(n,i){var a=n.getMinX(),c=n.getMinY(),g=n.getMaxX(),m=n.getMaxY(),y=i.getMinX(),x=i.getMinY(),T=i.getMaxX(),z=i.getMaxY(),V=o.maxDistance(a,c,a,m,y,x,y,z);return V=Math.min(V,o.maxDistance(a,c,a,m,y,x,T,x)),V=Math.min(V,o.maxDistance(a,c,a,m,T,z,y,z)),V=Math.min(V,o.maxDistance(a,c,a,m,T,z,T,x)),V=Math.min(V,o.maxDistance(a,c,g,c,y,x,y,z)),V=Math.min(V,o.maxDistance(a,c,g,c,y,x,T,x)),V=Math.min(V,o.maxDistance(a,c,g,c,T,z,y,z)),V=Math.min(V,o.maxDistance(a,c,g,c,T,z,T,x)),V=Math.min(V,o.maxDistance(g,m,a,m,y,x,y,z)),V=Math.min(V,o.maxDistance(g,m,a,m,y,x,T,x)),V=Math.min(V,o.maxDistance(g,m,a,m,T,z,y,z)),V=Math.min(V,o.maxDistance(g,m,a,m,T,z,T,x)),V=Math.min(V,o.maxDistance(g,m,g,c,y,x,y,z)),V=Math.min(V,o.maxDistance(g,m,g,c,y,x,T,x)),V=Math.min(V,o.maxDistance(g,m,g,c,T,z,y,z)),V=Math.min(V,o.maxDistance(g,m,g,c,T,z,T,x))}}])})(),rs=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"maximumDistance",value:function(){return kM.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(n,i){var a=o.isComposite(this._boundable1),c=o.isComposite(this._boundable2);if(a&&c)return o.area(this._boundable1)>o.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,n,i),null):(this.expand(this._boundable2,this._boundable1,!0,n,i),null);if(a)return this.expand(this._boundable1,this._boundable2,!1,n,i),null;if(c)return this.expand(this._boundable2,this._boundable1,!0,n,i),null;throw new J("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(o.isComposite(this._boundable1)||o.isComposite(this._boundable2))}},{key:"compareTo",value:function(n){var i=n;return this._distance<i._distance?-1:this._distance>i._distance?1:0}},{key:"expand",value:function(n,i,a,c,g){for(var m=n.getChildBoundables().iterator();m.hasNext();){var y=m.next(),x=null;(x=a?new o(i,y,this._itemDistance):new o(y,i,this._itemDistance)).getDistance()<g&&c.add(x)}}},{key:"getBoundable",value:function(n){return n===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var n=arguments[0],i=arguments[1],a=arguments[2];this._boundable1=n,this._boundable2=i,this._itemDistance=a,this._distance=this.distance()}},{key:"area",value:function(n){return n.getBounds().getArea()}},{key:"isComposite",value:function(n){return n instanceof cn}}])})(),Rp=(function(){return h((function o(){u(this,o)}),[{key:"visitItem",value:function(o){}}])})(),is=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"queryInternal",value:function(){if(we(arguments[2],Rp)&&arguments[0]instanceof Object&&arguments[1]instanceof cn)for(var n=arguments[0],i=arguments[2],a=arguments[1].getChildBoundables(),c=0;c<a.size();c++){var g=a.get(c);this.getIntersectsOp().intersects(g.getBounds(),n)&&(g instanceof cn?this.queryInternal(n,g,i):g instanceof wr?i.visitItem(g.getItem()):se.shouldNeverReachHere())}else if(we(arguments[2],Yn)&&arguments[0]instanceof Object&&arguments[1]instanceof cn)for(var m=arguments[0],y=arguments[2],x=arguments[1].getChildBoundables(),T=0;T<x.size();T++){var z=x.get(T);this.getIntersectsOp().intersects(z.getBounds(),m)&&(z instanceof cn?this.queryInternal(m,z,y):z instanceof wr?y.add(z.getItem()):se.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(n){return n.get(n.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var n=0,i=arguments[0].getChildBoundables().iterator();i.hasNext();){var a=i.next();a instanceof cn?n+=this.size(a):a instanceof wr&&(n+=1)}return n}}},{key:"removeItem",value:function(n,i){for(var a=null,c=n.getChildBoundables().iterator();c.hasNext();){var g=c.next();g instanceof wr&&g.getItem()===i&&(a=g)}return a!==null&&(n.getChildBoundables().remove(a),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var n=this.itemsTree(this._root);return n===null?new me:n}if(arguments.length===1){for(var i=arguments[0],a=new me,c=i.getChildBoundables().iterator();c.hasNext();){var g=c.next();if(g instanceof cn){var m=this.itemsTree(g);m!==null&&a.add(m)}else g instanceof wr?a.add(g.getItem()):se.shouldNeverReachHere()}return a.size()<=0?null:a}}},{key:"insert",value:function(n,i){se.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new wr(n,i))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var n=arguments[0],i=new me;return this.boundablesAtLevel(n,this._root,i),i}if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];if(se.isTrue(a>-2),c.getLevel()===a)return g.add(c),null;for(var m=c.getChildBoundables().iterator();m.hasNext();){var y=m.next();y instanceof cn?this.boundablesAtLevel(a,y,g):(se.isTrue(y instanceof wr),a===-1&&g.add(y))}return null}}},{key:"query",value:function(){if(arguments.length===1){var n=arguments[0];this.build();var i=new me;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,i),i}if(arguments.length===2){var a=arguments[0],c=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.queryInternal(a,this._root,c)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.remove(n,this._root,i)}if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2],m=this.removeItem(c,g);if(m)return!0;for(var y=null,x=c.getChildBoundables().iterator();x.hasNext();){var T=x.next();if(this.getIntersectsOp().intersects(T.getBounds(),a)&&T instanceof cn&&(m=this.remove(a,T,g))){y=T;break}}return y!==null&&y.getChildBoundables().isEmpty()&&c.getChildBoundables().remove(y),m}}},{key:"createHigherLevels",value:function(n,i){se.isTrue(!n.isEmpty());var a=this.createParentBoundables(n,i+1);return a.size()===1?a.get(0):this.createHigherLevels(a,i+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var n=0,i=arguments[0].getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof cn){var c=this.depth(a);c>n&&(n=c)}}return n+1}}},{key:"createParentBoundables",value:function(n,i){se.isTrue(!n.isEmpty());var a=new me;a.add(this.createNode(i));var c=new me(n);ns.sort(c,this.getComparator());for(var g=c.iterator();g.hasNext();){var m=g.next();this.lastNode(a).getChildBoundables().size()===this.getNodeCapacity()&&a.add(this.createNode(i)),this.lastNode(a).addChildBoundable(m)}return a}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[S]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new me,this._nodeCapacity=null,arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var n=arguments[0];se.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}}},{key:"compareDoubles",value:function(n,i){return n>i?1:n<i?-1:0}}])})();is.IntersectsOp=function(){},is.DEFAULT_NODE_CAPACITY=10;var SM=(function(){return h((function o(){u(this,o)}),[{key:"distance",value:function(o,n){}}])})(),jn=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"createParentBoundablesFromVerticalSlices",value:function(i,a){se.isTrue(i.length>0);for(var c=new me,g=0;g<i.length;g++)c.addAll(this.createParentBoundablesFromVerticalSlice(i[g],a));return c}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.nearestNeighbourK(i,Z.POSITIVE_INFINITY,a)}if(arguments.length===3){var c=arguments[0],g=arguments[2],m=arguments[1],y=new Vo;y.add(c);for(var x=new Vo;!y.isEmpty()&&m>=0;){var T=y.poll(),z=T.getDistance();if(z>=m)break;T.isLeaves()?x.size()<g?x.add(T):(x.peek().getDistance()>z&&(x.poll(),x.add(T)),m=x.peek().getDistance()):T.expandToQueue(y,m)}return n.getItems(x)}}},{key:"createNode",value:function(i){return new Dp(i)}},{key:"size",value:function(){return arguments.length===0?M(n,"size",this,1).call(this):M(n,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Te))return M(n,"insert",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1];if(i.isNull())return null;M(n,"insert",this,1).call(this,i,a)}},{key:"getIntersectsOp",value:function(){return n.intersectsOp}},{key:"verticalSlices",value:function(i,a){for(var c=Math.trunc(Math.ceil(i.size()/a)),g=new Array(a).fill(null),m=i.iterator(),y=0;y<a;y++){g[y]=new me;for(var x=0;m.hasNext()&&x<c;){var T=m.next();g[y].add(T),x++}}return g}},{key:"query",value:function(){if(arguments.length===1){var i=arguments[0];return M(n,"query",this,1).call(this,i)}if(arguments.length===2){var a=arguments[0],c=arguments[1];M(n,"query",this,1).call(this,a,c)}}},{key:"getComparator",value:function(){return n.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(i,a){return M(n,"createParentBoundables",this,1).call(this,i,a)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Te){var i=arguments[0],a=arguments[1];return M(n,"remove",this,1).call(this,i,a)}return M(n,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?M(n,"depth",this,1).call(this):M(n,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(i,a){se.isTrue(!i.isEmpty());var c=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),g=new me(i);ns.sort(g,n.xComparator);var m=this.verticalSlices(g,Math.trunc(Math.ceil(Math.sqrt(c))));return this.createParentBoundablesFromVerticalSlices(m,a)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(we(arguments[0],SM)){var i=arguments[0];if(this.isEmpty())return null;var a=new rs(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(a)}if(arguments[0]instanceof rs){var c=arguments[0],g=Z.POSITIVE_INFINITY,m=null,y=new Vo;for(y.add(c);!y.isEmpty()&&g>0;){var x=y.poll(),T=x.getDistance();if(T>=g)break;x.isLeaves()?(g=T,m=x):x.expandToQueue(y,g)}return m===null?null:[m.getBoundable(0).getItem(),m.getBoundable(1).getItem()]}}else{if(arguments.length===2){var z=arguments[0],V=arguments[1];if(this.isEmpty()||z.isEmpty())return null;var ee=new rs(this.getRoot(),z.getRoot(),V);return this.nearestNeighbour(ee)}if(arguments.length===3){var he=arguments[2],de=new wr(arguments[0],arguments[1]),ve=new rs(this.getRoot(),de,he);return this.nearestNeighbour(ve)[0]}if(arguments.length===4){var Le=arguments[2],Ae=arguments[3],Ue=new wr(arguments[0],arguments[1]),mt=new rs(this.getRoot(),Ue,Le);return this.nearestNeighbourK(mt,Ae)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var i=arguments[0],a=arguments[1],c=Z.POSITIVE_INFINITY,g=new Vo;for(g.add(i);!g.isEmpty();){var m=g.poll(),y=m.getDistance();if(y>a)return!1;if(m.maximumDistance()<=a)return!0;if(m.isLeaves()){if((c=y)<=a)return!0}else m.expandToQueue(g,c)}return!1}if(arguments.length===3){var x=arguments[0],T=arguments[1],z=arguments[2],V=new rs(this.getRoot(),x.getRoot(),T);return this.isWithinDistance(V,z)}}},{key:"interfaces_",get:function(){return[xM,S]}}],[{key:"constructor_",value:function(){if(arguments.length===0)n.constructor_.call(this,n.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var i=arguments[0];is.constructor_.call(this,i)}}},{key:"centreX",value:function(i){return n.avg(i.getMinX(),i.getMaxX())}},{key:"avg",value:function(i,a){return(i+a)/2}},{key:"getItems",value:function(i){for(var a=new Array(i.size()).fill(null),c=0;!i.isEmpty();){var g=i.poll();a[c]=g.getBoundable(0).getItem(),c++}return a}},{key:"centreY",value:function(i){return n.avg(i.getMinY(),i.getMaxY())}}])})(is),Dp=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"computeBounds",value:function(){for(var i=null,a=this.getChildBoundables().iterator();a.hasNext();){var c=a.next();i===null?i=new Te(c.getBounds()):i.expandToInclude(c.getBounds())}return i}}],[{key:"constructor_",value:function(){var i=arguments[0];cn.constructor_.call(this,i)}}])})(cn);jn.STRtreeNode=Dp,jn.xComparator=new((function(){return h((function o(){u(this,o)}),[{key:"interfaces_",get:function(){return[re]}},{key:"compare",value:function(o,n){return is.compareDoubles(jn.centreX(o.getBounds()),jn.centreX(n.getBounds()))}}])})()),jn.yComparator=new((function(){return h((function o(){u(this,o)}),[{key:"interfaces_",get:function(){return[re]}},{key:"compare",value:function(o,n){return is.compareDoubles(jn.centreY(o.getBounds()),jn.centreY(n.getBounds()))}}])})()),jn.intersectsOp=new((function(){return h((function o(){u(this,o)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(o,n){return o.intersects(n)}}])})()),jn.DEFAULT_NODE_CAPACITY=10;var MM=(function(){function o(){u(this,o)}return h(o,null,[{key:"relativeSign",value:function(n,i){return n<i?-1:n>i?1:0}},{key:"compare",value:function(n,i,a){if(i.equals2D(a))return 0;var c=o.relativeSign(i.x,a.x),g=o.relativeSign(i.y,a.y);switch(n){case 0:return o.compareValue(c,g);case 1:return o.compareValue(g,c);case 2:return o.compareValue(g,-c);case 3:return o.compareValue(-c,g);case 4:return o.compareValue(-c,-g);case 5:return o.compareValue(-g,-c);case 6:return o.compareValue(-g,c);case 7:return o.compareValue(c,-g)}return se.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(n,i){return n<0?-1:n>0?1:i<0?-1:i>0?1:0}}])})(),IM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(o){o.print(this.coord),o.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(o){var n=o;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:this._isInterior?n._isInterior?MM.compare(this._segmentOctant,this.coord,n.coord):1:-1}},{key:"isEndPoint",value:function(o){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===o}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var o=arguments[0],n=arguments[1],i=arguments[2],a=arguments[3];this._segString=o,this.coord=new X(n),this.segmentIndex=i,this._segmentOctant=a,this._isInterior=!n.equals2D(o.getCoordinate(i))}}])})(),bM=(function(){return h((function o(){u(this,o)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),TM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var o=new G;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next();this.addEdgeCoordinates(i,a,o),i=a}return o.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var o=new me;this.findCollapsesFromInsertedNodes(o),this.findCollapsesFromExistingVertices(o);for(var n=o.iterator();n.hasNext();){var i=n.next().intValue();this.add(this._edge.getCoordinate(i),i)}}},{key:"createSplitEdgePts",value:function(o,n){var i=n.segmentIndex-o.segmentIndex+2;if(i===2)return[new X(o.coord),new X(n.coord)];var a=this._edge.getCoordinate(n.segmentIndex),c=n.isInterior()||!n.coord.equals2D(a);c||i--;var g=new Array(i).fill(null),m=0;g[m++]=new X(o.coord);for(var y=o.segmentIndex+1;y<=n.segmentIndex;y++)g[m++]=this._edge.getCoordinate(y);return c&&(g[m]=new X(n.coord)),g}},{key:"print",value:function(o){o.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(o)}},{key:"findCollapsesFromExistingVertices",value:function(o){for(var n=0;n<this._edge.size()-2;n++){var i=this._edge.getCoordinate(n);this._edge.getCoordinate(n+1);var a=this._edge.getCoordinate(n+2);i.equals2D(a)&&o.add(In.valueOf(n+1))}}},{key:"addEdgeCoordinates",value:function(o,n,i){var a=this.createSplitEdgePts(o,n);i.add(a,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(o){this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next(),c=this.createSplitEdge(i,a);o.add(c),i=a}}},{key:"findCollapseIndex",value:function(o,n,i){if(!o.coord.equals2D(n.coord))return!1;var a=n.segmentIndex-o.segmentIndex;return n.isInterior()||a--,a===1&&(i[0]=o.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(o){for(var n=new Array(1).fill(null),i=this.iterator(),a=i.next();i.hasNext();){var c=i.next();this.findCollapseIndex(a,c,n)&&o.add(In.valueOf(n[0])),a=c}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var o=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(o),o)}},{key:"createSplitEdge",value:function(o,n){var i=this.createSplitEdgePts(o,n);return new gi(i,this._edge.getData())}},{key:"add",value:function(o,n){var i=new IM(this._edge,o,n,this._edge.getSegmentOctant(n)),a=this._nodeMap.get(i);return a!==null?(se.isTrue(a.coord.equals2D(o),"Found equal nodes with different coordinates"),a):(this._nodeMap.put(i,i),i)}},{key:"checkSplitEdgesCorrectness",value:function(o){var n=this._edge.getCoordinates(),i=o.get(0).getCoordinate(0);if(!i.equals2D(n[0]))throw new ce("bad split edge start point at "+i);var a=o.get(o.size()-1).getCoordinates(),c=a[a.length-1];if(!c.equals2D(n[n.length-1]))throw new ce("bad split edge end point at "+c)}}],[{key:"constructor_",value:function(){this._nodeMap=new oa,this._edge=null;var o=arguments[0];this._edge=o}}])})(),AM=(function(){function o(){u(this,o)}return h(o,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];if(n===0&&i===0)throw new J("Cannot compute the octant for point ( "+n+", "+i+" )");var a=Math.abs(n),c=Math.abs(i);return n>=0?i>=0?a>=c?0:1:a>=c?7:6:i>=0?a>=c?3:2:a>=c?4:5}if(arguments[0]instanceof X&&arguments[1]instanceof X){var g=arguments[0],m=arguments[1],y=m.x-g.x,x=m.y-g.y;if(y===0&&x===0)throw new J("Cannot compute the octant for two identical points "+g);return o.octant(y,x)}}}])})(),LM=(function(){return h((function o(){u(this,o)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(o){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(o){}},{key:"getData",value:function(){}}])})(),CM=(function(){return h((function o(){u(this,o)}),[{key:"addIntersection",value:function(o,n){}},{key:"interfaces_",get:function(){return[LM]}}])})(),gi=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(n){return this._pts[n]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(n){return n===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(n),this.getCoordinate(n+1))}},{key:"setData",value:function(n){this._data=n}},{key:"safeOctant",value:function(n,i){return n.equals2D(i)?0:AM.octant(n,i)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this.addIntersectionNode(n,i)}else if(arguments.length===4){var a=arguments[1],c=arguments[3],g=new X(arguments[0].getIntersection(c));this.addIntersection(g,a)}}},{key:"toString",value:function(){return ic.toLineString(new He(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(n,i){var a=i,c=a+1;if(c<this._pts.length){var g=this._pts[c];n.equals2D(g)&&(a=c)}return this._nodeList.add(n,a)}},{key:"addIntersections",value:function(n,i,a){for(var c=0;c<n.getIntersectionNum();c++)this.addIntersection(n,i,a,c)}},{key:"interfaces_",get:function(){return[CM]}}],[{key:"constructor_",value:function(){this._nodeList=new TM(this),this._pts=null,this._data=null;var n=arguments[0],i=arguments[1];this._pts=n,this._data=i}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var n=arguments[0],i=new me;return o.getNodedSubstrings(n,i),i}if(arguments.length===2)for(var a=arguments[1],c=arguments[0].iterator();c.hasNext();)c.next().getNodeList().addSplitEdges(a)}}])})(),$t=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof o){var n=arguments[0],i=_e.index(this.p0,this.p1,n.p0),a=_e.index(this.p0,this.p1,n.p1);return i>=0&&a>=0||i<=0&&a<=0?Math.max(i,a):0}if(arguments[0]instanceof X){var c=arguments[0];return _e.index(this.p0,this.p1,c)}}},{key:"toGeometry",value:function(n){return n.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(n){if(!(n instanceof o))return!1;var i=n;return this.p0.equals(i.p0)&&this.p1.equals(i.p1)}},{key:"intersection",value:function(n){var i=new fi;return i.computeIntersection(this.p0,this.p1,n.p0,n.p1),i.hasIntersection()?i.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof X){var n=arguments[0];if(n.equals(this.p0)||n.equals(this.p1))return new X(n);var i=this.projectionFactor(n),a=new X;return a.x=this.p0.x+i*(this.p1.x-this.p0.x),a.y=this.p0.y+i*(this.p1.y-this.p0.y),a}if(arguments[0]instanceof o){var c=arguments[0],g=this.projectionFactor(c.p0),m=this.projectionFactor(c.p1);if(g>=1&&m>=1||g<=0&&m<=0)return null;var y=this.project(c.p0);g<0&&(y=this.p0),g>1&&(y=this.p1);var x=this.project(c.p1);return m<0&&(x=this.p0),m>1&&(x=this.p1),new o(y,x)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(n){return n===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(n){return Ct.pointToLinePerpendicular(n,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return o.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(n){if(n.equals(this.p0))return 0;if(n.equals(this.p1))return 1;var i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,c=i*i+a*a;return c<=0?Z.NaN:((n.x-this.p0.x)*i+(n.y-this.p0.y)*a)/c}},{key:"closestPoints",value:function(n){var i=this.intersection(n);if(i!==null)return[i,i];var a=new Array(2).fill(null),c=Z.MAX_VALUE,g=null,m=this.closestPoint(n.p0);c=m.distance(n.p0),a[0]=m,a[1]=n.p0;var y=this.closestPoint(n.p1);(g=y.distance(n.p1))<c&&(c=g,a[0]=y,a[1]=n.p1);var x=n.closestPoint(this.p0);(g=x.distance(this.p0))<c&&(c=g,a[0]=this.p0,a[1]=x);var T=n.closestPoint(this.p1);return(g=T.distance(this.p1))<c&&(c=g,a[0]=this.p1,a[1]=T),a}},{key:"closestPoint",value:function(n){var i=this.projectionFactor(n);return i>0&&i<1?this.project(n):this.p0.distance(n)<this.p1.distance(n)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(n){var i=n,a=this.p0.compareTo(i.p0);return a!==0?a:this.p1.compareTo(i.p1)}},{key:"reverse",value:function(){var n=this.p0;this.p0=this.p1,this.p1=n}},{key:"equalsTopo",value:function(n){return this.p0.equals(n.p0)&&this.p1.equals(n.p1)||this.p0.equals(n.p1)&&this.p1.equals(n.p0)}},{key:"lineIntersection",value:function(n){return li.intersection(this.p0,this.p1,n.p0,n.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(n,i){var a=this.p0.x+n*(this.p1.x-this.p0.x),c=this.p0.y+n*(this.p1.y-this.p0.y),g=this.p1.x-this.p0.x,m=this.p1.y-this.p0.y,y=Math.sqrt(g*g+m*m),x=0,T=0;if(i!==0){if(y<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");x=i*g/y,T=i*m/y}return new X(a-T,c+x)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var n=arguments[0];this.setCoordinates(n.p0,n.p1)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.p0.x=i.x,this.p0.y=i.y,this.p1.x=a.x,this.p1.y=a.y}}},{key:"segmentFraction",value:function(n){var i=this.projectionFactor(n);return i<0?i=0:(i>1||Z.isNaN(i))&&(i=1),i}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(n){var i=this.p1.getY()-this.p0.getY(),a=this.p0.getX()-this.p1.getX(),c=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),g=i*i+a*a,m=i*i-a*a,y=n.getX(),x=n.getY();return new X((-m*y-2*i*a*x-2*i*c)/g,(m*x-2*i*a*y-2*a*c)/g)}},{key:"distance",value:function(){if(arguments[0]instanceof o){var n=arguments[0];return Ct.segmentToSegment(this.p0,this.p1,n.p0,n.p1)}if(arguments[0]instanceof X){var i=arguments[0];return Ct.pointToSegment(i,this.p0,this.p1)}}},{key:"pointAlong",value:function(n){var i=new X;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}},{key:"hashCode",value:function(){var n=Z.doubleToLongBits(this.p0.x);n^=31*Z.doubleToLongBits(this.p0.y);var i=Math.trunc(n)^Math.trunc(n>>32),a=Z.doubleToLongBits(this.p1.x);return a^=31*Z.doubleToLongBits(this.p1.y),i^(Math.trunc(a)^Math.trunc(a>>32))}},{key:"interfaces_",get:function(){return[W,S]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)o.constructor_.call(this,new X,new X);else if(arguments.length===1){var n=arguments[0];o.constructor_.call(this,n.p0,n.p1)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.p0=i,this.p1=a}else if(arguments.length===4){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3];o.constructor_.call(this,new X(c,g),new X(m,y))}}},{key:"midPoint",value:function(n,i){return new X((n.x+i.x)/2,(n.y+i.y)/2)}}])})(),NM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var o=arguments[1],n=arguments[2],i=arguments[3];arguments[0].getLineSegment(o,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new $t,this._overlapSeg2=new $t}}])})(),Fp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(o,n){n.p0=this._pts[o],n.p1=this._pts[o+1]}},{key:"computeSelect",value:function(o,n,i,a){var c=this._pts[n],g=this._pts[i];if(i-n==1)return a.select(this,n),null;if(!o.intersects(c,g))return null;var m=Math.trunc((n+i)/2);n<m&&this.computeSelect(o,n,m,a),m<i&&this.computeSelect(o,m,i,a)}},{key:"getCoordinates",value:function(){for(var o=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)o[n++]=this._pts[i];return o}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var o=arguments[0],n=arguments[1];this.computeOverlaps(this._start,this._end,o,o._start,o._end,n)}else if(arguments.length===6){var i=arguments[0],a=arguments[1],c=arguments[2],g=arguments[3],m=arguments[4],y=arguments[5];if(a-i==1&&m-g==1)return y.overlap(this,i,c,g),null;if(!this.overlaps(i,a,c,g,m))return null;var x=Math.trunc((i+a)/2),T=Math.trunc((g+m)/2);i<x&&(g<T&&this.computeOverlaps(i,x,c,g,T,y),T<m&&this.computeOverlaps(i,x,c,T,m,y)),x<a&&(g<T&&this.computeOverlaps(x,a,c,g,T,y),T<m&&this.computeOverlaps(x,a,c,T,m,y))}}},{key:"setId",value:function(o){this._id=o}},{key:"select",value:function(o,n){this.computeSelect(o,this._start,this._end,n)}},{key:"getEnvelope",value:function(){if(this._env===null){var o=this._pts[this._start],n=this._pts[this._end];this._env=new Te(o,n)}return this._env}},{key:"overlaps",value:function(o,n,i,a,c){return Te.intersects(this._pts[o],this._pts[n],i._pts[a],i._pts[c])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var o=arguments[0],n=arguments[1],i=arguments[2],a=arguments[3];this._pts=o,this._start=n,this._end=i,this._context=a}}])})(),PM=(function(){function o(){u(this,o)}return h(o,null,[{key:"findChainEnd",value:function(n,i){for(var a=i;a<n.length-1&&n[a].equals2D(n[a+1]);)a++;if(a>=n.length-1)return n.length-1;for(var c=Nt.quadrant(n[a],n[a+1]),g=i+1;g<n.length&&!(!n[g-1].equals2D(n[g])&&Nt.quadrant(n[g-1],n[g])!==c);)g++;return g-1}},{key:"getChains",value:function(){if(arguments.length===1){var n=arguments[0];return o.getChains(n,null)}if(arguments.length===2){var i=arguments[0],a=arguments[1],c=new me,g=0;do{var m=o.findChainEnd(i,g),y=new Fp(i,g,m,a);c.add(y),g=m}while(g<i.length-1);return c}}}])})(),uc=(function(){return h((function o(){u(this,o)}),[{key:"computeNodes",value:function(o){}},{key:"getNodedSubstrings",value:function(){}}])})(),Gp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(o){this._segInt=o}},{key:"interfaces_",get:function(){return[uc]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setSegmentIntersector(o)}}}}])})(),lc=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return gi.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(i){for(var a=PM.getChains(i.getCoordinates(),i).iterator();a.hasNext();){var c=a.next();c.setId(this._idCounter++),this._index.insert(c.getEnvelope(),c),this._monoChains.add(c)}}},{key:"computeNodes",value:function(i){this._nodedSegStrings=i;for(var a=i.iterator();a.hasNext();)this.add(a.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var i=new Bp(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var c=a.next(),g=this._index.query(c.getEnvelope()).iterator();g.hasNext();){var m=g.next();if(m.getId()>c.getId()&&(c.computeOverlaps(m,i),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new me,this._index=new jn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var i=arguments[0];Gp.constructor_.call(this,i)}}}}])})(Gp),Bp=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"overlap",value:function(){if(arguments.length!==4)return M(n,"overlap",this,1).apply(this,arguments);var i=arguments[1],a=arguments[2],c=arguments[3],g=arguments[0].getContext(),m=a.getContext();this._si.processIntersections(g,i,m,c)}}],[{key:"constructor_",value:function(){this._si=null;var i=arguments[0];this._si=i}}])})(NM);lc.SegmentOverlapAction=Bp;var bn=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isDeletable",value:function(n,i,a,c){var g=this._inputLine[n],m=this._inputLine[i],y=this._inputLine[a];return!!this.isConcave(g,m,y)&&!!this.isShallow(g,m,y,c)&&this.isShallowSampled(g,m,n,a,c)}},{key:"deleteShallowConcavities",value:function(){for(var n=1,i=this.findNextNonDeletedIndex(n),a=this.findNextNonDeletedIndex(i),c=!1;a<this._inputLine.length;){var g=!1;this.isDeletable(n,i,a,this._distanceTol)&&(this._isDeleted[i]=o.DELETE,g=!0,c=!0),n=g?a:i,i=this.findNextNonDeletedIndex(n),a=this.findNextNonDeletedIndex(i)}return c}},{key:"isShallowConcavity",value:function(n,i,a,c){return _e.index(n,i,a)===this._angleOrientation&&Ct.pointToSegment(i,n,a)<c}},{key:"isShallowSampled",value:function(n,i,a,c,g){var m=Math.trunc((c-a)/o.NUM_PTS_TO_CHECK);m<=0&&(m=1);for(var y=a;y<c;y+=m)if(!this.isShallow(n,i,this._inputLine[y],g))return!1;return!0}},{key:"isConcave",value:function(n,i,a){var c=_e.index(n,i,a)===this._angleOrientation;return c}},{key:"simplify",value:function(n){this._distanceTol=Math.abs(n),n<0&&(this._angleOrientation=_e.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var i=!1;do i=this.deleteShallowConcavities();while(i);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(n){for(var i=n+1;i<this._inputLine.length&&this._isDeleted[i]===o.DELETE;)i++;return i}},{key:"isShallow",value:function(n,i,a,c){return Ct.pointToSegment(i,n,a)<c}},{key:"collapseLine",value:function(){for(var n=new G,i=0;i<this._inputLine.length;i++)this._isDeleted[i]!==o.DELETE&&n.add(this._inputLine[i]);return n.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=_e.COUNTERCLOCKWISE;var n=arguments[0];this._inputLine=n}},{key:"simplify",value:function(n,i){return new o(n).simplify(i)}}])})();bn.INIT=0,bn.DELETE=1,bn.KEEP=1,bn.NUM_PTS_TO_CHECK=10;var Up=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getCoordinates",value:function(){return this._ptList.toArray(o.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(n){this._precisionModel=n}},{key:"addPt",value:function(n){var i=new X(n);if(this._precisionModel.makePrecise(i),this.isRedundant(i))return null;this._ptList.add(i)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(n,i){if(i)for(var a=0;a<n.length;a++)this.addPt(n[a]);else for(var c=n.length-1;c>=0;c--)this.addPt(n[c])}},{key:"isRedundant",value:function(n){if(this._ptList.size()<1)return!1;var i=this._ptList.get(this._ptList.size()-1);return n.distance(i)<this._minimimVertexDistance}},{key:"toString",value:function(){return new es().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var n=new X(this._ptList.get(0)),i=this._ptList.get(this._ptList.size()-1);if(n.equals(i))return null;this._ptList.add(n)}},{key:"setMinimumVertexDistance",value:function(n){this._minimimVertexDistance=n}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new me}}])})();Up.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Xt=(function(){function o(){u(this,o)}return h(o,null,[{key:"toDegrees",value:function(n){return 180*n/Math.PI}},{key:"normalize",value:function(n){for(;n>Math.PI;)n-=o.PI_TIMES_2;for(;n<=-Math.PI;)n+=o.PI_TIMES_2;return n}},{key:"angle",value:function(){if(arguments.length===1){var n=arguments[0];return Math.atan2(n.y,n.x)}if(arguments.length===2){var i=arguments[0],a=arguments[1],c=a.x-i.x,g=a.y-i.y;return Math.atan2(g,c)}}},{key:"isAcute",value:function(n,i,a){var c=n.x-i.x,g=n.y-i.y;return c*(a.x-i.x)+g*(a.y-i.y)>0}},{key:"isObtuse",value:function(n,i,a){var c=n.x-i.x,g=n.y-i.y;return c*(a.x-i.x)+g*(a.y-i.y)<0}},{key:"interiorAngle",value:function(n,i,a){var c=o.angle(i,n),g=o.angle(i,a);return Math.abs(g-c)}},{key:"normalizePositive",value:function(n){if(n<0){for(;n<0;)n+=o.PI_TIMES_2;n>=o.PI_TIMES_2&&(n=0)}else{for(;n>=o.PI_TIMES_2;)n-=o.PI_TIMES_2;n<0&&(n=0)}return n}},{key:"angleBetween",value:function(n,i,a){var c=o.angle(i,n),g=o.angle(i,a);return o.diff(c,g)}},{key:"diff",value:function(n,i){var a=null;return(a=n<i?i-n:n-i)>Math.PI&&(a=2*Math.PI-a),a}},{key:"toRadians",value:function(n){return n*Math.PI/180}},{key:"getTurn",value:function(n,i){var a=Math.sin(i-n);return a>0?o.COUNTERCLOCKWISE:a<0?o.CLOCKWISE:o.NONE}},{key:"angleBetweenOriented",value:function(n,i,a){var c=o.angle(i,n),g=o.angle(i,a)-c;return g<=-Math.PI?g+o.PI_TIMES_2:g>Math.PI?g-o.PI_TIMES_2:g}}])})();Xt.PI_TIMES_2=2*Math.PI,Xt.PI_OVER_2=Math.PI/2,Xt.PI_OVER_4=Math.PI/4,Xt.COUNTERCLOCKWISE=_e.COUNTERCLOCKWISE,Xt.CLOCKWISE=_e.CLOCKWISE,Xt.NONE=_e.COLLINEAR;var ua=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"addNextSegment",value:function(n,i){if(this._s0=this._s1,this._s1=this._s2,this._s2=n,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var a=_e.index(this._s0,this._s1,this._s2),c=a===_e.CLOCKWISE&&this._side===ie.LEFT||a===_e.COUNTERCLOCKWISE&&this._side===ie.RIGHT;a===0?this.addCollinear(i):c?this.addOutsideTurn(a,i):this.addInsideTurn(a,i)}},{key:"addLineEndCap",value:function(n,i){var a=new $t(n,i),c=new $t;this.computeOffsetSegment(a,ie.LEFT,this._distance,c);var g=new $t;this.computeOffsetSegment(a,ie.RIGHT,this._distance,g);var m=i.x-n.x,y=i.y-n.y,x=Math.atan2(y,m);switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:this._segList.addPt(c.p1),this.addDirectedFillet(i,x+Math.PI/2,x-Math.PI/2,_e.CLOCKWISE,this._distance),this._segList.addPt(g.p1);break;case Y.CAP_FLAT:this._segList.addPt(c.p1),this._segList.addPt(g.p1);break;case Y.CAP_SQUARE:var T=new X;T.x=Math.abs(this._distance)*Math.cos(x),T.y=Math.abs(this._distance)*Math.sin(x);var z=new X(c.p1.x+T.x,c.p1.y+T.y),V=new X(g.p1.x+T.x,g.p1.y+T.y);this._segList.addPt(z),this._segList.addPt(V)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(n,i,a,c){var g=li.intersection(i.p0,i.p1,a.p0,a.p1);if(g!==null&&(c<=0?1:g.distance(n)/Math.abs(c))<=this._bufParams.getMitreLimit())return this._segList.addPt(g),null;this.addLimitedMitreJoin(i,a,c,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(n,i){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*o.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Y.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Y.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(i&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,n,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(n){this._segList.addPt(new X(n.x+this._distance,n.y+this._distance)),this._segList.addPt(new X(n.x+this._distance,n.y-this._distance)),this._segList.addPt(new X(n.x-this._distance,n.y-this._distance)),this._segList.addPt(new X(n.x-this._distance,n.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(n,i){this._segList.addPts(n,i)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(n,i,a,c,g){var m=i.x-n.x,y=i.y-n.y,x=Math.atan2(y,m),T=a.x-n.x,z=a.y-n.y,V=Math.atan2(z,T);c===_e.CLOCKWISE?x<=V&&(x+=2*Math.PI):x>=V&&(x-=2*Math.PI),this._segList.addPt(i),this.addDirectedFillet(n,x,V,c,g),this._segList.addPt(a)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(n,i,a){this._s1=n,this._s2=i,this._side=a,this._seg1.setCoordinates(n,i),this.computeOffsetSegment(this._seg1,a,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(n,i,a,c){var g=this._seg0.p1,m=Xt.angle(g,this._seg0.p0),y=Xt.angleBetweenOriented(this._seg0.p0,g,this._seg1.p1)/2,x=Xt.normalize(m+y),T=Xt.normalize(x+Math.PI),z=c*a,V=a-z*Math.abs(Math.sin(y)),ee=g.x+z*Math.cos(T),he=g.y+z*Math.sin(T),de=new X(ee,he),ve=new $t(g,de),Le=ve.pointAlongOffset(1,V),Ae=ve.pointAlongOffset(1,-V);this._side===ie.LEFT?(this._segList.addPt(Le),this._segList.addPt(Ae)):(this._segList.addPt(Ae),this._segList.addPt(Le))}},{key:"addDirectedFillet",value:function(n,i,a,c,g){var m=c===_e.CLOCKWISE?-1:1,y=Math.abs(i-a),x=Math.trunc(y/this._filletAngleQuantum+.5);if(x<1)return null;for(var T=y/x,z=new X,V=0;V<x;V++){var ee=i+m*V*T;z.x=n.x+g*Math.cos(ee),z.y=n.y+g*Math.sin(ee),this._segList.addPt(z)}}},{key:"computeOffsetSegment",value:function(n,i,a,c){var g=i===ie.LEFT?1:-1,m=n.p1.x-n.p0.x,y=n.p1.y-n.p0.y,x=Math.sqrt(m*m+y*y),T=g*a*m/x,z=g*a*y/x;c.p0.x=n.p0.x-z,c.p0.y=n.p0.y+T,c.p1.x=n.p1.x-z,c.p1.y=n.p1.y+T}},{key:"addInsideTurn",value:function(n,i){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var a=new X((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(a);var c=new X((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(c)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(n){var i=new X(n.x+this._distance,n.y);this._segList.addPt(i),this.addDirectedFillet(n,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(n,i){this._segList.addPt(n.p1),this._segList.addPt(i.p0)}},{key:"init",value:function(n){this._distance=n,this._maxCurveSegmentError=n*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Up,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(n*o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(n){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Y.JOIN_BEVEL||this._bufParams.getJoinStyle()===Y.JOIN_MITRE?(n&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,_e.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new $t,this._seg1=new $t,this._offset0=new $t,this._offset1=new $t,this._side=0,this._hasNarrowConcaveAngle=!1;var n=arguments[0],i=arguments[1],a=arguments[2];this._precisionModel=n,this._bufParams=i,this._li=new fi,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===Y.JOIN_ROUND&&(this._closingSegLengthFactor=o.MAX_CLOSING_SEG_LEN_FACTOR),this.init(a)}}])})();ua.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,ua.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,ua.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,ua.MAX_CLOSING_SEG_LEN_FACTOR=80;var OM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getOffsetCurve",value:function(n,i){if(this._distance=i,i===0)return null;var a=i<0,c=Math.abs(i),g=this.getSegGen(c);n.length<=1?this.computePointCurve(n[0],g):this.computeOffsetCurve(n,a,g);var m=g.getCoordinates();return a&&Q.reverse(m),m}},{key:"computeSingleSidedBufferCurve",value:function(n,i,a){var c=this.simplifyTolerance(this._distance);if(i){a.addSegments(n,!0);var g=bn.simplify(n,-c),m=g.length-1;a.initSideSegments(g[m],g[m-1],ie.LEFT),a.addFirstSegment();for(var y=m-2;y>=0;y--)a.addNextSegment(g[y],!0)}else{a.addSegments(n,!1);var x=bn.simplify(n,c),T=x.length-1;a.initSideSegments(x[0],x[1],ie.LEFT),a.addFirstSegment();for(var z=2;z<=T;z++)a.addNextSegment(x[z],!0)}a.addLastSegment(),a.closeRing()}},{key:"computeRingBufferCurve",value:function(n,i,a){var c=this.simplifyTolerance(this._distance);i===ie.RIGHT&&(c=-c);var g=bn.simplify(n,c),m=g.length-1;a.initSideSegments(g[m-1],g[0],i);for(var y=1;y<=m;y++){var x=y!==1;a.addNextSegment(g[y],x)}a.closeRing()}},{key:"computeLineBufferCurve",value:function(n,i){var a=this.simplifyTolerance(this._distance),c=bn.simplify(n,a),g=c.length-1;i.initSideSegments(c[0],c[1],ie.LEFT);for(var m=2;m<=g;m++)i.addNextSegment(c[m],!0);i.addLastSegment(),i.addLineEndCap(c[g-1],c[g]);var y=bn.simplify(n,-a),x=y.length-1;i.initSideSegments(y[x],y[x-1],ie.LEFT);for(var T=x-2;T>=0;T--)i.addNextSegment(y[T],!0);i.addLastSegment(),i.addLineEndCap(y[1],y[0]),i.closeRing()}},{key:"computePointCurve",value:function(n,i){switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:i.createCircle(n);break;case Y.CAP_SQUARE:i.createSquare(n)}}},{key:"getLineCurve",value:function(n,i){if(this._distance=i,this.isLineOffsetEmpty(i))return null;var a=Math.abs(i),c=this.getSegGen(a);if(n.length<=1)this.computePointCurve(n[0],c);else if(this._bufParams.isSingleSided()){var g=i<0;this.computeSingleSidedBufferCurve(n,g,c)}else this.computeLineBufferCurve(n,c);return c.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(n){return n*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(n,i,a){if(this._distance=a,n.length<=2)return this.getLineCurve(n,a);if(a===0)return o.copyCoordinates(n);var c=this.getSegGen(a);return this.computeRingBufferCurve(n,i,c),c.getCoordinates()}},{key:"computeOffsetCurve",value:function(n,i,a){var c=this.simplifyTolerance(this._distance);if(i){var g=bn.simplify(n,-c),m=g.length-1;a.initSideSegments(g[m],g[m-1],ie.LEFT),a.addFirstSegment();for(var y=m-2;y>=0;y--)a.addNextSegment(g[y],!0)}else{var x=bn.simplify(n,c),T=x.length-1;a.initSideSegments(x[0],x[1],ie.LEFT),a.addFirstSegment();for(var z=2;z<=T;z++)a.addNextSegment(x[z],!0)}a.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(n){return n===0||n<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(n){return new ua(this._precisionModel,this._bufParams,n)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var n=arguments[0],i=arguments[1];this._precisionModel=n,this._bufParams=i}},{key:"copyCoordinates",value:function(n){for(var i=new Array(n.length).fill(null),a=0;a<i.length;a++)i[a]=new X(n[a]);return i}}])})(),zp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var o=arguments[0],n=new me,i=this._subgraphs.iterator();i.hasNext();){var a=i.next(),c=a.getEnvelope();o.y<c.getMinY()||o.y>c.getMaxY()||this.findStabbedSegments(o,a.getDirectedEdges(),n)}return n}if(arguments.length===3){if(we(arguments[2],Yn)&&arguments[0]instanceof X&&arguments[1]instanceof oc){for(var g=arguments[0],m=arguments[1],y=arguments[2],x=m.getEdge().getCoordinates(),T=0;T<x.length-1;T++)if(this._seg.p0=x[T],this._seg.p1=x[T+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<g.x||this._seg.isHorizontal()||g.y<this._seg.p0.y||g.y>this._seg.p1.y||_e.index(this._seg.p0,this._seg.p1,g)===_e.RIGHT)){var z=m.getDepth(ie.LEFT);this._seg.p0.equals(x[T])||(z=m.getDepth(ie.RIGHT));var V=new qp(this._seg,z);y.add(V)}}else if(we(arguments[2],Yn)&&arguments[0]instanceof X&&we(arguments[1],Yn))for(var ee=arguments[0],he=arguments[2],de=arguments[1].iterator();de.hasNext();){var ve=de.next();ve.isForward()&&this.findStabbedSegments(ee,ve,he)}}}},{key:"getDepth",value:function(o){var n=this.findStabbedSegments(o);return n.size()===0?0:ns.min(n)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new $t;var o=arguments[0];this._subgraphs=o}}])})(),qp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(o){var n=o;if(this._upwardSeg.minX()>=n._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=n._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(n._upwardSeg);return i!==0||(i=-1*n._upwardSeg.orientationIndex(this._upwardSeg))!==0?i:this._upwardSeg.compareTo(n._upwardSeg)}},{key:"compareX",value:function(o,n){var i=o.p0.compareTo(n.p0);return i!==0?i:o.p1.compareTo(n.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var o=arguments[0],n=arguments[1];this._upwardSeg=new $t(o),this._leftDepth=n}}])})();zp.DepthSegment=qp;var Yp=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,null,[{key:"constructor_",value:function(){$.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})($),cc=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getY",value:function(){var n=this.y/this.w;if(Z.isNaN(n)||Z.isInfinite(n))throw new Yp;return n}},{key:"getX",value:function(){var n=this.x/this.w;if(Z.isNaN(n)||Z.isInfinite(n))throw new Yp;return n}},{key:"getCoordinate",value:function(){var n=new X;return n.x=this.getX(),n.y=this.getY(),n}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var n=arguments[0];this.x=n.x,this.y=n.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],a=arguments[1];this.x=i,this.y=a,this.w=1}else if(arguments[0]instanceof o&&arguments[1]instanceof o){var c=arguments[0],g=arguments[1];this.x=c.y*g.w-g.y*c.w,this.y=g.x*c.w-c.x*g.w,this.w=c.x*g.y-g.x*c.y}else if(arguments[0]instanceof X&&arguments[1]instanceof X){var m=arguments[0],y=arguments[1];this.x=m.y-y.y,this.y=y.x-m.x,this.w=m.x*y.y-y.x*m.y}}else if(arguments.length===3){var x=arguments[0],T=arguments[1],z=arguments[2];this.x=x,this.y=T,this.w=z}else if(arguments.length===4){var V=arguments[0],ee=arguments[1],he=arguments[2],de=arguments[3],ve=V.y-ee.y,Le=ee.x-V.x,Ae=V.x*ee.y-ee.x*V.y,Ue=he.y-de.y,mt=de.x-he.x,wt=he.x*de.y-de.x*he.y;this.x=Le*wt-mt*Ae,this.y=Ue*Ae-ve*wt,this.w=ve*mt-Ue*Le}}}])})(),RM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"area",value:function(){return o.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return o.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(n){if(n===null)throw new J("Supplied point is null.");return o.interpolateZ(n,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return o.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return o.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return o.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return o.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return o.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return o.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var n=arguments[0],i=arguments[1],a=arguments[2];this.p0=n,this.p1=i,this.p2=a}},{key:"area",value:function(n,i,a){return Math.abs(((a.x-n.x)*(i.y-n.y)-(i.x-n.x)*(a.y-n.y))/2)}},{key:"signedArea",value:function(n,i,a){return((a.x-n.x)*(i.y-n.y)-(i.x-n.x)*(a.y-n.y))/2}},{key:"det",value:function(n,i,a,c){return n*c-i*a}},{key:"interpolateZ",value:function(n,i,a,c){var g=i.x,m=i.y,y=a.x-g,x=c.x-g,T=a.y-m,z=c.y-m,V=y*z-x*T,ee=n.x-g,he=n.y-m,de=(z*ee-x*he)/V,ve=(-T*ee+y*he)/V;return i.getZ()+de*(a.getZ()-i.getZ())+ve*(c.getZ()-i.getZ())}},{key:"longestSideLength",value:function(n,i,a){var c=n.distance(i),g=i.distance(a),m=a.distance(n),y=c;return g>y&&(y=g),m>y&&(y=m),y}},{key:"circumcentreDD",value:function(n,i,a){var c=ye.valueOf(n.x).subtract(a.x),g=ye.valueOf(n.y).subtract(a.y),m=ye.valueOf(i.x).subtract(a.x),y=ye.valueOf(i.y).subtract(a.y),x=ye.determinant(c,g,m,y).multiply(2),T=c.sqr().add(g.sqr()),z=m.sqr().add(y.sqr()),V=ye.determinant(g,T,y,z),ee=ye.determinant(c,T,m,z),he=ye.valueOf(a.x).subtract(V.divide(x)).doubleValue(),de=ye.valueOf(a.y).add(ee.divide(x)).doubleValue();return new X(he,de)}},{key:"isAcute",value:function(n,i,a){return!!Xt.isAcute(n,i,a)&&!!Xt.isAcute(i,a,n)&&!!Xt.isAcute(a,n,i)}},{key:"circumcentre",value:function(n,i,a){var c=a.x,g=a.y,m=n.x-c,y=n.y-g,x=i.x-c,T=i.y-g,z=2*o.det(m,y,x,T),V=o.det(y,m*m+y*y,T,x*x+T*T),ee=o.det(m,m*m+y*y,x,x*x+T*T);return new X(c-V/z,g+ee/z)}},{key:"perpendicularBisector",value:function(n,i){var a=i.x-n.x,c=i.y-n.y,g=new cc(n.x+a/2,n.y+c/2,1),m=new cc(n.x-c+a/2,n.y+a+c/2,1);return new cc(g,m)}},{key:"angleBisector",value:function(n,i,a){var c=i.distance(n),g=c/(c+i.distance(a)),m=a.x-n.x,y=a.y-n.y;return new X(n.x+g*m,n.y+g*y)}},{key:"area3D",value:function(n,i,a){var c=i.x-n.x,g=i.y-n.y,m=i.getZ()-n.getZ(),y=a.x-n.x,x=a.y-n.y,T=a.getZ()-n.getZ(),z=g*T-m*x,V=m*y-c*T,ee=c*x-g*y,he=z*z+V*V+ee*ee,de=Math.sqrt(he)/2;return de}},{key:"centroid",value:function(n,i,a){var c=(n.x+i.x+a.x)/3,g=(n.y+i.y+a.y)/3;return new X(c,g)}},{key:"inCentre",value:function(n,i,a){var c=i.distance(a),g=n.distance(a),m=n.distance(i),y=c+g+m,x=(c*n.x+g*i.x+m*a.x)/y,T=(c*n.y+g*i.y+m*a.y)/y;return new X(x,T)}}])})(),DM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(o,n,i,a,c){if(n===0&&o.length<Gr.MINIMUM_VALID_SIZE)return null;var g=a,m=c;o.length>=Gr.MINIMUM_VALID_SIZE&&_e.isCCW(o)&&(g=c,m=a,i=ie.opposite(i));var y=this._curveBuilder.getRingCurve(o,i,n);this.addCurve(y,g,m)}},{key:"addRingBothSides",value:function(o,n){this.addRingSide(o,n,ie.LEFT,N.EXTERIOR,N.INTERIOR),this.addRingSide(o,n,ie.RIGHT,N.INTERIOR,N.EXTERIOR)}},{key:"addPoint",value:function(o){if(this._distance<=0)return null;var n=o.getCoordinates(),i=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(i,N.EXTERIOR,N.INTERIOR)}},{key:"addPolygon",value:function(o){var n=this._distance,i=ie.LEFT;this._distance<0&&(n=-this._distance,i=ie.RIGHT);var a=o.getExteriorRing(),c=Q.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&c.length<3)return null;this.addRingSide(c,n,i,N.EXTERIOR,N.INTERIOR);for(var g=0;g<o.getNumInteriorRing();g++){var m=o.getInteriorRingN(g),y=Q.removeRepeatedPoints(m.getCoordinates());this._distance>0&&this.isErodedCompletely(m,-this._distance)||this.addRingSide(y,n,ie.opposite(i),N.INTERIOR,N.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(o,n){var i=new RM(o[0],o[1],o[2]),a=i.inCentre();return Ct.pointToSegment(a,i.p0,i.p1)<Math.abs(n)}},{key:"addLineString",value:function(o){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var n=Q.removeRepeatedPoints(o.getCoordinates());if(Q.isRing(n)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(n,this._distance);else{var i=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(i,N.EXTERIOR,N.INTERIOR)}}},{key:"addCurve",value:function(o,n,i){if(o===null||o.length<2)return null;var a=new gi(o,new ln(0,N.BOUNDARY,n,i));this._curveList.add(a)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(o){if(o.isEmpty())return null;if(o instanceof hi)this.addPolygon(o);else if(o instanceof vr)this.addLineString(o);else if(o instanceof ji)this.addPoint(o);else if(o instanceof Ki)this.addCollection(o);else if(o instanceof Qi)this.addCollection(o);else if(o instanceof Jt)this.addCollection(o);else{if(!(o instanceof Qe))throw new Se(o.getGeometryType());this.addCollection(o)}}},{key:"isErodedCompletely",value:function(o,n){var i=o.getCoordinates();if(i.length<4)return n<0;if(i.length===4)return this.isTriangleErodedCompletely(i,n);var a=o.getEnvelopeInternal(),c=Math.min(a.getHeight(),a.getWidth());return n<0&&2*Math.abs(n)>c}},{key:"addCollection",value:function(o){for(var n=0;n<o.getNumGeometries();n++){var i=o.getGeometryN(n);this.add(i)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new me;var o=arguments[0],n=arguments[1],i=arguments[2];this._inputGeom=o,this._distance=n,this._curveBuilder=i}}])})(),FM=(function(){return h((function o(){u(this,o)}),[{key:"locate",value:function(o){}}])})(),GM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,o.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ge;var n=this._parent.getGeometryN(this._index++);return n instanceof Qe?(this._subcollectionIterator=new o(n),this._subcollectionIterator.next()):n}},{key:"remove",value:function(){throw new Se(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[bM]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var n=arguments[0];this._parent=n,this._atStart=!0,this._index=0,this._max=n.getNumGeometries()}},{key:"isAtomic",value:function(n){return!(n instanceof Qe)}}])})(),BM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"locate",value:function(n){return o.locate(n,this._geom)}},{key:"interfaces_",get:function(){return[FM]}}],[{key:"constructor_",value:function(){this._geom=null;var n=arguments[0];this._geom=n}},{key:"locatePointInPolygon",value:function(n,i){if(i.isEmpty())return N.EXTERIOR;var a=i.getExteriorRing(),c=o.locatePointInRing(n,a);if(c!==N.INTERIOR)return c;for(var g=0;g<i.getNumInteriorRing();g++){var m=i.getInteriorRingN(g),y=o.locatePointInRing(n,m);if(y===N.BOUNDARY)return N.BOUNDARY;if(y===N.INTERIOR)return N.EXTERIOR}return N.INTERIOR}},{key:"locatePointInRing",value:function(n,i){return i.getEnvelopeInternal().intersects(n)?sc.locateInRing(n,i.getCoordinates()):N.EXTERIOR}},{key:"containsPointInPolygon",value:function(n,i){return N.EXTERIOR!==o.locatePointInPolygon(n,i)}},{key:"locateInGeometry",value:function(n,i){if(i instanceof hi)return o.locatePointInPolygon(n,i);if(i instanceof Qe)for(var a=new GM(i);a.hasNext();){var c=a.next();if(c!==i){var g=o.locateInGeometry(n,c);if(g!==N.EXTERIOR)return g}}return N.EXTERIOR}},{key:"isContained",value:function(n,i){return N.EXTERIOR!==o.locate(n,i)}},{key:"locate",value:function(n,i){return i.isEmpty()?N.EXTERIOR:i.getEnvelopeInternal().intersects(n)?o.locateInGeometry(n,i):N.EXTERIOR}}])})(),UM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(o){this.getEdges();var n=this._edgeList.indexOf(o),i=n-1;return n===0&&(i=this._edgeList.size()-1),this._edgeList.get(i)}},{key:"propagateSideLabels",value:function(o){for(var n=N.NONE,i=this.iterator();i.hasNext();){var a=i.next().getLabel();a.isArea(o)&&a.getLocation(o,ie.LEFT)!==N.NONE&&(n=a.getLocation(o,ie.LEFT))}if(n===N.NONE)return null;for(var c=n,g=this.iterator();g.hasNext();){var m=g.next(),y=m.getLabel();if(y.getLocation(o,ie.ON)===N.NONE&&y.setLocation(o,ie.ON,c),y.isArea(o)){var x=y.getLocation(o,ie.LEFT),T=y.getLocation(o,ie.RIGHT);if(T!==N.NONE){if(T!==c)throw new Gt("side location conflict",m.getCoordinate());x===N.NONE&&se.shouldNeverReachHere("found single null side (at "+m.getCoordinate()+")"),c=x}else se.isTrue(y.getLocation(o,ie.LEFT)===N.NONE,"found single null side"),y.setLocation(o,ie.RIGHT,c),y.setLocation(o,ie.LEFT,c)}}}},{key:"getCoordinate",value:function(){var o=this.iterator();return o.hasNext()?o.next().getCoordinate():null}},{key:"print",value:function(o){Bt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();)n.next().print(o)}},{key:"isAreaLabelsConsistent",value:function(o){return this.computeEdgeEndLabels(o.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(o){var n=this.getEdges();if(n.size()<=0)return!0;var i=n.size()-1,a=n.get(i).getLabel().getLocation(o,ie.LEFT);se.isTrue(a!==N.NONE,"Found unlabelled area edge");for(var c=a,g=this.iterator();g.hasNext();){var m=g.next().getLabel();se.isTrue(m.isArea(o),"Found non-area edge");var y=m.getLocation(o,ie.LEFT),x=m.getLocation(o,ie.RIGHT);if(y===x||x!==c)return!1;c=y}return!0}},{key:"findIndex",value:function(o){this.iterator();for(var n=0;n<this._edgeList.size();n++)if(this._edgeList.get(n)===o)return n;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new me(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(o,n,i){return this._ptInAreaLocation[o]===N.NONE&&(this._ptInAreaLocation[o]=BM.locate(n,i[o].getGeometry())),this._ptInAreaLocation[o]}},{key:"toString",value:function(){var o=new Mn;o.append("EdgeEndStar:   "+this.getCoordinate()),o.append(`
`);for(var n=this.iterator();n.hasNext();){var i=n.next();o.append(i),o.append(`
`)}return o.toString()}},{key:"computeEdgeEndLabels",value:function(o){for(var n=this.iterator();n.hasNext();)n.next().computeLabel(o)}},{key:"computeLabelling",value:function(o){this.computeEdgeEndLabels(o[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var a=i.next().getLabel(),c=0;c<2;c++)a.isLine(c)&&a.getLocation(c)===N.BOUNDARY&&(n[c]=!0);for(var g=this.iterator();g.hasNext();)for(var m=g.next(),y=m.getLabel(),x=0;x<2;x++)if(y.isAnyNull(x)){var T=N.NONE;if(n[x])T=N.EXTERIOR;else{var z=m.getCoordinate();T=this.getLocation(x,z,o)}y.setAllLocationsIfNull(x,T)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(o,n){this._edgeMap.put(o,n),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new oa,this._edgeList=null,this._ptInAreaLocation=[N.NONE,N.NONE]}}])})(),zM=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var i=null,a=null,c=this._SCANNING_FOR_INCOMING,g=0;g<this._resultAreaEdgeList.size();g++){var m=this._resultAreaEdgeList.get(g),y=m.getSym();if(m.getLabel().isArea())switch(i===null&&m.isInResult()&&(i=m),c){case this._SCANNING_FOR_INCOMING:if(!y.isInResult())continue;a=y,c=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!m.isInResult())continue;a.setNext(m),c=this._SCANNING_FOR_INCOMING}}if(c===this._LINKING_TO_OUTGOING){if(i===null)throw new Gt("no outgoing dirEdge found",this.getCoordinate());se.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),a.setNext(i)}}},{key:"insert",value:function(i){var a=i;this.insertEdgeEnd(a,a)}},{key:"getRightmostEdge",value:function(){var i=this.getEdges(),a=i.size();if(a<1)return null;var c=i.get(0);if(a===1)return c;var g=i.get(a-1),m=c.getQuadrant(),y=g.getQuadrant();return Nt.isNorthern(m)&&Nt.isNorthern(y)?c:Nt.isNorthern(m)||Nt.isNorthern(y)?c.getDy()!==0?c:g.getDy()!==0?g:(se.shouldNeverReachHere("found two horizontal edges incident on node"),null):g}},{key:"print",value:function(i){Bt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var a=this.iterator();a.hasNext();){var c=a.next();i.print("out "),c.print(i),i.println(),i.print("in "),c.getSym().print(i),i.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new me;for(var i=this.iterator();i.hasNext();){var a=i.next();(a.isInResult()||a.getSym().isInResult())&&this._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(i){for(var a=this.iterator();a.hasNext();){var c=a.next().getLabel();c.setAllLocationsIfNull(0,i.getLocation(0)),c.setAllLocationsIfNull(1,i.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var i=null,a=null,c=this._edgeList.size()-1;c>=0;c--){var g=this._edgeList.get(c),m=g.getSym();a===null&&(a=m),i!==null&&m.setNext(i),i=g}a.setNext(i)}},{key:"computeDepths",value:function(){if(arguments.length===1){var i=arguments[0],a=this.findIndex(i),c=i.getDepth(ie.LEFT),g=i.getDepth(ie.RIGHT),m=this.computeDepths(a+1,this._edgeList.size(),c);if(this.computeDepths(0,a,m)!==g)throw new Gt("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var y=arguments[1],x=arguments[2],T=arguments[0];T<y;T++){var z=this._edgeList.get(T);z.setEdgeDepths(ie.RIGHT,x),x=z.getDepth(ie.LEFT)}return x}}},{key:"mergeSymLabels",value:function(){for(var i=this.iterator();i.hasNext();){var a=i.next();a.getLabel().merge(a.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(i){for(var a=null,c=null,g=this._SCANNING_FOR_INCOMING,m=this._resultAreaEdgeList.size()-1;m>=0;m--){var y=this._resultAreaEdgeList.get(m),x=y.getSym();switch(a===null&&y.getEdgeRing()===i&&(a=y),g){case this._SCANNING_FOR_INCOMING:if(x.getEdgeRing()!==i)continue;c=x,g=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(y.getEdgeRing()!==i)continue;c.setNextMin(y),g=this._SCANNING_FOR_INCOMING}}g===this._LINKING_TO_OUTGOING&&(se.isTrue(a!==null,"found null for first outgoing dirEdge"),se.isTrue(a.getEdgeRing()===i,"unable to link last incoming dirEdge"),c.setNextMin(a))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var i=0,a=this.iterator();a.hasNext();)a.next().isInResult()&&i++;return i}if(arguments.length===1){for(var c=arguments[0],g=0,m=this.iterator();m.hasNext();)m.next().getEdgeRing()===c&&g++;return g}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var i=N.NONE,a=this.iterator();a.hasNext();){var c=a.next(),g=c.getSym();if(!c.isLineEdge()){if(c.isInResult()){i=N.INTERIOR;break}if(g.isInResult()){i=N.EXTERIOR;break}}}if(i===N.NONE)return null;for(var m=i,y=this.iterator();y.hasNext();){var x=y.next(),T=x.getSym();x.isLineEdge()?x.getEdge().setCovered(m===N.INTERIOR):(x.isInResult()&&(m=N.EXTERIOR),T.isInResult()&&(m=N.INTERIOR))}}},{key:"computeLabelling",value:function(i){M(n,"computeLabelling",this,1).call(this,i),this._label=new ln(N.NONE);for(var a=this.iterator();a.hasNext();)for(var c=a.next().getEdge().getLabel(),g=0;g<2;g++){var m=c.getLocation(g);m!==N.INTERIOR&&m!==N.BOUNDARY||this._label.setLocation(g,N.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(UM),qM=(function(o){function n(){return u(this,n),s(this,n)}return _(n,o),h(n,[{key:"createNode",value:function(i){return new Xo(i,new zM)}}])})(Np),Hp=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compareTo",value:function(n){var i=n;return o.compareOriented(this._pts,this._orientation,i._pts,i._orientation)}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var n=arguments[0];this._pts=n,this._orientation=o.orientation(n)}},{key:"orientation",value:function(n){return Q.increasingDirection(n)===1}},{key:"compareOriented",value:function(n,i,a,c){for(var g=i?1:-1,m=c?1:-1,y=i?n.length:-1,x=c?a.length:-1,T=i?0:n.length-1,z=c?0:a.length-1;;){var V=n[T].compareTo(a[z]);if(V!==0)return V;var ee=(T+=g)===y,he=(z+=m)===x;if(ee&&!he)return-1;if(!ee&&he)return 1;if(ee&&he)return 0}}}])})(),YM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"print",value:function(o){o.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n);n>0&&o.print(","),o.print("(");for(var a=i.getCoordinates(),c=0;c<a.length;c++)c>0&&o.print(","),o.print(a[c].x+" "+a[c].y);o.println(")")}o.print(")  ")}},{key:"addAll",value:function(o){for(var n=o.iterator();n.hasNext();)this.add(n.next())}},{key:"findEdgeIndex",value:function(o){for(var n=0;n<this._edges.size();n++)if(this._edges.get(n).equals(o))return n;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(o){return this._edges.get(o)}},{key:"findEqualEdge",value:function(o){var n=new Hp(o.getCoordinates());return this._ocaMap.get(n)}},{key:"add",value:function(o){this._edges.add(o);var n=new Hp(o.getCoordinates());this._ocaMap.put(n,o)}}],[{key:"constructor_",value:function(){this._edges=new me,this._ocaMap=new oa}}])})(),Jp=(function(){return h((function o(){u(this,o)}),[{key:"processIntersections",value:function(o,n,i,a){}},{key:"isDone",value:function(){}}])})(),HM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isTrivialIntersection",value:function(n,i,a,c){if(n===a&&this._li.getIntersectionNum()===1){if(o.isAdjacentSegments(i,c))return!0;if(n.isClosed()){var g=n.size()-1;if(i===0&&c===g||c===0&&i===g)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(n,i,a,c){if(n===a&&i===c)return null;this.numTests++;var g=n.getCoordinates()[i],m=n.getCoordinates()[i+1],y=a.getCoordinates()[c],x=a.getCoordinates()[c+1];this._li.computeIntersection(g,m,y,x),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(n,i,a,c)||(this._hasIntersection=!0,n.addIntersections(this._li,i,0),a.addIntersections(this._li,c,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Jp]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var n=arguments[0];this._li=n}},{key:"isAdjacentSegments",value:function(n,i){return Math.abs(n-i)===1}}])})(),JM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(o){o.print(this.coord),o.print(" seg # = "+this.segmentIndex),o.println(" dist = "+this.dist)}},{key:"compareTo",value:function(o){var n=o;return this.compare(n.segmentIndex,n.dist)}},{key:"isEndPoint",value:function(o){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===o}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(o,n){return this.segmentIndex<o?-1:this.segmentIndex>o?1:this.dist<n?-1:this.dist>n?1:0}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var o=arguments[0],n=arguments[1],i=arguments[2];this.coord=new X(o),this.segmentIndex=n,this.dist=i}}])})(),$M=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"print",value:function(o){o.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(o)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(o){this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var a=n.next(),c=this.createSplitEdge(i,a);o.add(c),i=a}}},{key:"addEndpoints",value:function(){var o=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[o],o,0)}},{key:"createSplitEdge",value:function(o,n){var i=n.segmentIndex-o.segmentIndex+2,a=this.edge.pts[n.segmentIndex],c=n.dist>0||!n.coord.equals2D(a);c||i--;var g=new Array(i).fill(null),m=0;g[m++]=new X(o.coord);for(var y=o.segmentIndex+1;y<=n.segmentIndex;y++)g[m++]=this.edge.pts[y];return c&&(g[m]=n.coord),new Xp(g,new ln(this.edge._label))}},{key:"add",value:function(o,n,i){var a=new JM(o,n,i),c=this._nodeMap.get(a);return c!==null?c:(this._nodeMap.put(a,a),a)}},{key:"isIntersection",value:function(o){for(var n=this.iterator();n.hasNext();)if(n.next().coord.equals(o))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new oa,this.edge=null;var o=arguments[0];this.edge=o}}])})(),XM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])||o.isTrue(this._matrix[N.INTERIOR][N.BOUNDARY])||o.isTrue(this._matrix[N.BOUNDARY][N.INTERIOR])||o.isTrue(this._matrix[N.BOUNDARY][N.BOUNDARY]))&&this._matrix[N.EXTERIOR][N.INTERIOR]===oe.FALSE&&this._matrix[N.EXTERIOR][N.BOUNDARY]===oe.FALSE}},{key:"isCoveredBy",value:function(){return(o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])||o.isTrue(this._matrix[N.INTERIOR][N.BOUNDARY])||o.isTrue(this._matrix[N.BOUNDARY][N.INTERIOR])||o.isTrue(this._matrix[N.BOUNDARY][N.BOUNDARY]))&&this._matrix[N.INTERIOR][N.EXTERIOR]===oe.FALSE&&this._matrix[N.BOUNDARY][N.EXTERIOR]===oe.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var n=arguments[0],i=0;i<n.length;i++){var a=Math.trunc(i/3),c=i%3;this._matrix[a][c]=oe.toDimensionValue(n.charAt(i))}else if(arguments.length===3){var g=arguments[0],m=arguments[1],y=arguments[2];this._matrix[g][m]=y}}},{key:"isContains",value:function(){return o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&this._matrix[N.EXTERIOR][N.INTERIOR]===oe.FALSE&&this._matrix[N.EXTERIOR][N.BOUNDARY]===oe.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var n=arguments[0],i=0;i<n.length;i++){var a=Math.trunc(i/3),c=i%3;this.setAtLeast(a,c,oe.toDimensionValue(n.charAt(i)))}else if(arguments.length===3){var g=arguments[0],m=arguments[1],y=arguments[2];this._matrix[g][m]<y&&(this._matrix[g][m]=y)}}},{key:"setAtLeastIfValid",value:function(n,i,a){n>=0&&i>=0&&this.setAtLeast(n,i,a)}},{key:"isWithin",value:function(){return o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&this._matrix[N.INTERIOR][N.EXTERIOR]===oe.FALSE&&this._matrix[N.BOUNDARY][N.EXTERIOR]===oe.FALSE}},{key:"isTouches",value:function(n,i){return n>i?this.isTouches(i,n):(n===oe.A&&i===oe.A||n===oe.L&&i===oe.L||n===oe.L&&i===oe.A||n===oe.P&&i===oe.A||n===oe.P&&i===oe.L)&&this._matrix[N.INTERIOR][N.INTERIOR]===oe.FALSE&&(o.isTrue(this._matrix[N.INTERIOR][N.BOUNDARY])||o.isTrue(this._matrix[N.BOUNDARY][N.INTERIOR])||o.isTrue(this._matrix[N.BOUNDARY][N.BOUNDARY]))}},{key:"isOverlaps",value:function(n,i){return n===oe.P&&i===oe.P||n===oe.A&&i===oe.A?o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&o.isTrue(this._matrix[N.INTERIOR][N.EXTERIOR])&&o.isTrue(this._matrix[N.EXTERIOR][N.INTERIOR]):n===oe.L&&i===oe.L&&this._matrix[N.INTERIOR][N.INTERIOR]===1&&o.isTrue(this._matrix[N.INTERIOR][N.EXTERIOR])&&o.isTrue(this._matrix[N.EXTERIOR][N.INTERIOR])}},{key:"isEquals",value:function(n,i){return n===i&&o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&this._matrix[N.INTERIOR][N.EXTERIOR]===oe.FALSE&&this._matrix[N.BOUNDARY][N.EXTERIOR]===oe.FALSE&&this._matrix[N.EXTERIOR][N.INTERIOR]===oe.FALSE&&this._matrix[N.EXTERIOR][N.BOUNDARY]===oe.FALSE}},{key:"toString",value:function(){for(var n=new nt("123456789"),i=0;i<3;i++)for(var a=0;a<3;a++)n.setCharAt(3*i+a,oe.toDimensionSymbol(this._matrix[i][a]));return n.toString()}},{key:"setAll",value:function(n){for(var i=0;i<3;i++)for(var a=0;a<3;a++)this._matrix[i][a]=n}},{key:"get",value:function(n,i){return this._matrix[n][i]}},{key:"transpose",value:function(){var n=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=n,n=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=n,n=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=n,this}},{key:"matches",value:function(n){if(n.length!==9)throw new J("Should be length 9: "+n);for(var i=0;i<3;i++)for(var a=0;a<3;a++)if(!o.matches(this._matrix[i][a],n.charAt(3*i+a)))return!1;return!0}},{key:"add",value:function(n){for(var i=0;i<3;i++)for(var a=0;a<3;a++)this.setAtLeast(i,a,n.get(i,a))}},{key:"isDisjoint",value:function(){return this._matrix[N.INTERIOR][N.INTERIOR]===oe.FALSE&&this._matrix[N.INTERIOR][N.BOUNDARY]===oe.FALSE&&this._matrix[N.BOUNDARY][N.INTERIOR]===oe.FALSE&&this._matrix[N.BOUNDARY][N.BOUNDARY]===oe.FALSE}},{key:"isCrosses",value:function(n,i){return n===oe.P&&i===oe.L||n===oe.P&&i===oe.A||n===oe.L&&i===oe.A?o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&o.isTrue(this._matrix[N.INTERIOR][N.EXTERIOR]):n===oe.L&&i===oe.P||n===oe.A&&i===oe.P||n===oe.A&&i===oe.L?o.isTrue(this._matrix[N.INTERIOR][N.INTERIOR])&&o.isTrue(this._matrix[N.EXTERIOR][N.INTERIOR]):n===oe.L&&i===oe.L&&this._matrix[N.INTERIOR][N.INTERIOR]===0}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(oe.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var n=arguments[0];o.constructor_.call(this),this.set(n)}else if(arguments[0]instanceof o){var i=arguments[0];o.constructor_.call(this),this._matrix[N.INTERIOR][N.INTERIOR]=i._matrix[N.INTERIOR][N.INTERIOR],this._matrix[N.INTERIOR][N.BOUNDARY]=i._matrix[N.INTERIOR][N.BOUNDARY],this._matrix[N.INTERIOR][N.EXTERIOR]=i._matrix[N.INTERIOR][N.EXTERIOR],this._matrix[N.BOUNDARY][N.INTERIOR]=i._matrix[N.BOUNDARY][N.INTERIOR],this._matrix[N.BOUNDARY][N.BOUNDARY]=i._matrix[N.BOUNDARY][N.BOUNDARY],this._matrix[N.BOUNDARY][N.EXTERIOR]=i._matrix[N.BOUNDARY][N.EXTERIOR],this._matrix[N.EXTERIOR][N.INTERIOR]=i._matrix[N.EXTERIOR][N.INTERIOR],this._matrix[N.EXTERIOR][N.BOUNDARY]=i._matrix[N.EXTERIOR][N.BOUNDARY],this._matrix[N.EXTERIOR][N.EXTERIOR]=i._matrix[N.EXTERIOR][N.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var n=arguments[0],i=arguments[1];return i===oe.SYM_DONTCARE||i===oe.SYM_TRUE&&(n>=0||n===oe.TRUE)||i===oe.SYM_FALSE&&n===oe.FALSE||i===oe.SYM_P&&n===oe.P||i===oe.SYM_L&&n===oe.L||i===oe.SYM_A&&n===oe.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var a=arguments[1];return new o(arguments[0]).matches(a)}}},{key:"isTrue",value:function(n){return n>=0||n===oe.TRUE}}])})(),VM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(n){return n===null||n.length===0?null:(this.ensureCapacity(this._size+n.length),Bt.arraycopy(n,0,this._data,this._size,n.length),void(this._size+=n.length))}},{key:"ensureCapacity",value:function(n){if(n<=this._data.length)return null;var i=Math.max(n,2*this._data.length);this._data=ht.copyOf(this._data,i)}},{key:"toArray",value:function(){var n=new Array(this._size).fill(null);return Bt.arraycopy(this._data,0,n,0,this._size),n}},{key:"add",value:function(n){this.ensureCapacity(this._size+1),this._data[this._size]=n,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)o.constructor_.call(this,10);else if(arguments.length===1){var n=arguments[0];this._data=new Array(n).fill(null)}}}])})(),WM=(function(){function o(){u(this,o)}return h(o,[{key:"getChainStartIndices",value:function(n){var i=0,a=new VM(Math.trunc(n.length/2));a.add(i);do{var c=this.findChainEnd(n,i);a.add(c),i=c}while(i<n.length-1);return a.toArray()}},{key:"findChainEnd",value:function(n,i){for(var a=Nt.quadrant(n[i],n[i+1]),c=i+1;c<n.length&&Nt.quadrant(n[c-1],n[c])===a;)c++;return c-1}},{key:"OLDgetChainStartIndices",value:function(n){var i=0,a=new me;a.add(i);do{var c=this.findChainEnd(n,i);a.add(c),i=c}while(i<n.length-1);return o.toIntArray(a)}}],[{key:"toIntArray",value:function(n){for(var i=new Array(n.size()).fill(null),a=0;a<i.length;a++)i[a]=n.get(a).intValue();return i}}])})(),jM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(o){var n=this.pts[this.startIndex[o]].x,i=this.pts[this.startIndex[o+1]].x;return n>i?n:i}},{key:"getMinX",value:function(o){var n=this.pts[this.startIndex[o]].x,i=this.pts[this.startIndex[o+1]].x;return n<i?n:i}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var o=arguments[0],n=arguments[1],i=arguments[2],a=arguments[3];this.computeIntersectsForChain(this.startIndex[o],this.startIndex[o+1],n,n.startIndex[i],n.startIndex[i+1],a)}else if(arguments.length===6){var c=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],x=arguments[4],T=arguments[5];if(g-c==1&&x-y==1)return T.addIntersections(this.e,c,m.e,y),null;if(!this.overlaps(c,g,m,y,x))return null;var z=Math.trunc((c+g)/2),V=Math.trunc((y+x)/2);c<z&&(y<V&&this.computeIntersectsForChain(c,z,m,y,V,T),V<x&&this.computeIntersectsForChain(c,z,m,V,x,T)),z<g&&(y<V&&this.computeIntersectsForChain(z,g,m,y,V,T),V<x&&this.computeIntersectsForChain(z,g,m,V,x,T))}}},{key:"overlaps",value:function(o,n,i,a,c){return Te.intersects(this.pts[o],this.pts[n],i.pts[a],i.pts[c])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(o,n){for(var i=0;i<this.startIndex.length-1;i++)for(var a=0;a<o.startIndex.length-1;a++)this.computeIntersectsForChain(i,o,a,n)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var o=arguments[0];this.e=o,this.pts=o.getCoordinates();var n=new WM;this.startIndex=n.getChainStartIndices(this.pts)}}])})(),$p=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getDepth",value:function(n,i){return this._depth[n][i]}},{key:"setDepth",value:function(n,i,a){this._depth[n][i]=a}},{key:"isNull",value:function(){if(arguments.length===0){for(var n=0;n<2;n++)for(var i=0;i<3;i++)if(this._depth[n][i]!==o.NULL_VALUE)return!1;return!0}if(arguments.length===1){var a=arguments[0];return this._depth[a][1]===o.NULL_VALUE}if(arguments.length===2){var c=arguments[0],g=arguments[1];return this._depth[c][g]===o.NULL_VALUE}}},{key:"normalize",value:function(){for(var n=0;n<2;n++)if(!this.isNull(n)){var i=this._depth[n][1];this._depth[n][2]<i&&(i=this._depth[n][2]),i<0&&(i=0);for(var a=1;a<3;a++){var c=0;this._depth[n][a]>i&&(c=1),this._depth[n][a]=c}}}},{key:"getDelta",value:function(n){return this._depth[n][ie.RIGHT]-this._depth[n][ie.LEFT]}},{key:"getLocation",value:function(n,i){return this._depth[n][i]<=0?N.EXTERIOR:N.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var n=arguments[0],i=0;i<2;i++)for(var a=1;a<3;a++){var c=n.getLocation(i,a);c!==N.EXTERIOR&&c!==N.INTERIOR||(this.isNull(i,a)?this._depth[i][a]=o.depthAtLocation(c):this._depth[i][a]+=o.depthAtLocation(c))}else if(arguments.length===3){var g=arguments[0],m=arguments[1];arguments[2]===N.INTERIOR&&this._depth[g][m]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var n=0;n<2;n++)for(var i=0;i<3;i++)this._depth[n][i]=o.NULL_VALUE}},{key:"depthAtLocation",value:function(n){return n===N.EXTERIOR?0:n===N.INTERIOR?1:o.NULL_VALUE}}])})();$p.NULL_VALUE=-1;var Xp=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var i=new Array(2).fill(null);return i[0]=this.pts[0],i[1]=this.pts[1],new n(i,ln.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(i){this._isIsolated=i}},{key:"setName",value:function(i){this._name=i}},{key:"equals",value:function(i){if(!(i instanceof n))return!1;var a=i;if(this.pts.length!==a.pts.length)return!1;for(var c=!0,g=!0,m=this.pts.length,y=0;y<this.pts.length;y++)if(this.pts[y].equals2D(a.pts[y])||(c=!1),this.pts[y].equals2D(a.pts[--m])||(g=!1),!c&&!g)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var i=arguments[0];return this.pts[i]}}},{key:"print",value:function(i){i.print("edge "+this._name+": "),i.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&i.print(","),i.print(this.pts[a].x+" "+this.pts[a].y);i.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(i){n.updateIM(this._label,i)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(i){i.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)i.print(this.pts[a]+" ");i.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new jM(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Te;for(var i=0;i<this.pts.length;i++)this._env.expandToInclude(this.pts[i])}return this._env}},{key:"addIntersection",value:function(i,a,c,g){var m=new X(i.getIntersection(g)),y=a,x=i.getEdgeDistance(c,g),T=y+1;if(T<this.pts.length){var z=this.pts[T];m.equals2D(z)&&(y=T,x=0)}this.eiList.add(m,y,x)}},{key:"toString",value:function(){var i=new nt;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&i.append(","),i.append(this.pts[a].x+" "+this.pts[a].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()}},{key:"isPointwiseEqual",value:function(i){if(this.pts.length!==i.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!this.pts[a].equals2D(i.pts[a]))return!1;return!0}},{key:"setDepthDelta",value:function(i){this._depthDelta=i}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(i,a,c){for(var g=0;g<i.getIntersectionNum();g++)this.addIntersection(i,a,c,g)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new $M(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new $p,this._depthDelta=0,arguments.length===1){var i=arguments[0];n.constructor_.call(this,i,null)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.pts=a,this._label=c}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof XM&&arguments[0]instanceof ln))return M(n,"updateIM",this).apply(this,arguments);var i=arguments[0],a=arguments[1];a.setAtLeastIfValid(i.getLocation(0,ie.ON),i.getLocation(1,ie.ON),1),i.isArea()&&(a.setAtLeastIfValid(i.getLocation(0,ie.LEFT),i.getLocation(1,ie.LEFT),2),a.setAtLeastIfValid(i.getLocation(0,ie.RIGHT),i.getLocation(1,ie.RIGHT),2))}}])})(bp),Vp=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"setWorkingPrecisionModel",value:function(n){this._workingPrecisionModel=n}},{key:"insertUniqueEdge",value:function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var a=i.getLabel(),c=n.getLabel();i.isPointwiseEqual(n)||(c=new ln(n.getLabel())).flip(),a.merge(c);var g=o.depthDelta(c),m=i.getDepthDelta()+g;i.setDepthDelta(m)}else this._edgeList.add(n),n.setDepthDelta(o.depthDelta(n.getLabel()))}},{key:"buildSubgraphs",value:function(n,i){for(var a=new me,c=n.iterator();c.hasNext();){var g=c.next(),m=g.getRightmostCoordinate(),y=new zp(a).getDepth(m);g.computeDepth(y),g.findResultEdges(),a.add(g),i.add(g.getDirectedEdges(),g.getNodes())}}},{key:"createSubgraphs",value:function(n){for(var i=new me,a=n.getNodes().iterator();a.hasNext();){var c=a.next();if(!c.isVisited()){var g=new na;g.create(c),i.add(g)}}return ns.sort(i,ns.reverseOrder()),i}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(n){if(this._workingNoder!==null)return this._workingNoder;var i=new lc,a=new fi;return a.setPrecisionModel(n),i.setSegmentIntersector(new HM(a)),i}},{key:"buffer",value:function(n,i){var a=this._workingPrecisionModel;a===null&&(a=n.getPrecisionModel()),this._geomFact=n.getFactory();var c=new OM(a,this._bufParams),g=new DM(n,i,c).getCurves();if(g.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(g,a),this._graph=new Pp(new qM),this._graph.addEdges(this._edgeList.getEdges());var m=this.createSubgraphs(this._graph),y=new wM(this._geomFact);this.buildSubgraphs(m,y);var x=y.getPolygons();return x.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(x)}},{key:"computeNodedEdges",value:function(n,i){var a=this.getNoder(i);a.computeNodes(n);for(var c=a.getNodedSubstrings().iterator();c.hasNext();){var g=c.next(),m=g.getCoordinates();if(m.length!==2||!m[0].equals2D(m[1])){var y=g.getData(),x=new Xp(g.getCoordinates(),new ln(y));this.insertUniqueEdge(x)}}}},{key:"setNoder",value:function(n){this._workingNoder=n}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new YM;var n=arguments[0];this._bufParams=n}},{key:"depthDelta",value:function(n){var i=n.getLocation(0,ie.LEFT),a=n.getLocation(0,ie.RIGHT);return i===N.INTERIOR&&a===N.EXTERIOR?1:i===N.EXTERIOR&&a===N.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(n){for(var i=new es,a=new me;n.hasNext();){var c=n.next(),g=i.createLineString(c.getCoordinates());a.add(g)}return i.buildGeometry(a)}}])})(),ZM=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"rescale",value:function(){if(we(arguments[0],Pe))for(var n=arguments[0].iterator();n.hasNext();){var i=n.next();this.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],c=0;c<a.length;c++)a[c].x=a[c].x/this._scaleFactor+this._offsetX,a[c].y=a[c].y/this._scaleFactor+this._offsetY;a.length===2&&a[0].equals2D(a[1])&&Bt.out.println(a)}}},{key:"scale",value:function(){if(we(arguments[0],Pe)){for(var n=arguments[0],i=new me(n.size()),a=n.iterator();a.hasNext();){var c=a.next();i.add(new gi(this.scale(c.getCoordinates()),c.getData()))}return i}if(arguments[0]instanceof Array){for(var g=arguments[0],m=new Array(g.length).fill(null),y=0;y<g.length;y++)m[y]=new X(Math.round((g[y].x-this._offsetX)*this._scaleFactor),Math.round((g[y].y-this._offsetY)*this._scaleFactor),g[y].getZ());return Q.removeRepeatedPoints(m)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var n=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(n),n}},{key:"computeNodes",value:function(n){var i=n;this._isScaled&&(i=this.scale(n)),this._noder.computeNodes(i)}},{key:"interfaces_",get:function(){return[uc]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var n=arguments[0],i=arguments[1];o.constructor_.call(this,n,i,0,0)}else if(arguments.length===4){var a=arguments[0],c=arguments[1];this._noder=a,this._scaleFactor=c,this._isScaled=!this.isIntegerPrecision()}}}])})(),Wp=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var i=n.next().getCoordinates();this.checkEndPtVertexIntersections(i[0],this._segStrings),this.checkEndPtVertexIntersections(i[i.length-1],this._segStrings)}else if(arguments.length===2){for(var a=arguments[0],c=arguments[1].iterator();c.hasNext();)for(var g=c.next().getCoordinates(),m=1;m<g.length-1;m++)if(g[m].equals(a))throw new ce("found endpt/interior pt intersection at index "+m+" :pt "+a)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();)for(var i=n.next(),a=this._segStrings.iterator();a.hasNext();){var c=a.next();this.checkInteriorIntersections(i,c)}else if(arguments.length===2)for(var g=arguments[0],m=arguments[1],y=g.getCoordinates(),x=m.getCoordinates(),T=0;T<y.length-1;T++)for(var z=0;z<x.length-1;z++)this.checkInteriorIntersections(g,T,m,z);else if(arguments.length===4){var V=arguments[0],ee=arguments[1],he=arguments[2],de=arguments[3];if(V===he&&ee===de)return null;var ve=V.getCoordinates()[ee],Le=V.getCoordinates()[ee+1],Ae=he.getCoordinates()[de],Ue=he.getCoordinates()[de+1];if(this._li.computeIntersection(ve,Le,Ae,Ue),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ve,Le)||this.hasInteriorIntersection(this._li,Ae,Ue)))throw new ce("found non-noded intersection at "+ve+"-"+Le+" and "+Ae+"-"+Ue)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var i=n.next();this.checkCollapses(i)}else if(arguments.length===1)for(var a=arguments[0].getCoordinates(),c=0;c<a.length-2;c++)this.checkCollapse(a[c],a[c+1],a[c+2])}},{key:"hasInteriorIntersection",value:function(n,i,a){for(var c=0;c<n.getIntersectionNum();c++){var g=n.getIntersection(c);if(!g.equals(i)&&!g.equals(a))return!0}return!1}},{key:"checkCollapse",value:function(n,i,a){if(n.equals(a))throw new ce("found non-noded collapse at "+o.fact.createLineString([n,i,a]))}}],[{key:"constructor_",value:function(){this._li=new fi,this._segStrings=null;var n=arguments[0];this._segStrings=n}}])})();Wp.fact=new es;var hc=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"intersectsScaled",value:function(n,i){var a=Math.min(n.x,i.x),c=Math.max(n.x,i.x),g=Math.min(n.y,i.y),m=Math.max(n.y,i.y),y=this._maxx<a||this._minx>c||this._maxy<g||this._miny>m;if(y)return!1;var x=this.intersectsToleranceSquare(n,i);return se.isTrue(!(y&&x),"Found bad envelope test"),x}},{key:"initCorners",value:function(n){var i=.5;this._minx=n.x-i,this._maxx=n.x+i,this._miny=n.y-i,this._maxy=n.y+i,this._corner[0]=new X(this._maxx,this._maxy),this._corner[1]=new X(this._minx,this._maxy),this._corner[2]=new X(this._minx,this._miny),this._corner[3]=new X(this._maxx,this._miny)}},{key:"intersects",value:function(n,i){return this._scaleFactor===1?this.intersectsScaled(n,i):(this.copyScaled(n,this._p0Scaled),this.copyScaled(i,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(n){return Math.round(n*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(n,i){i.x=this.scale(n.x),i.y=this.scale(n.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var n=o.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Te(this._originalPt.x-n,this._originalPt.x+n,this._originalPt.y-n,this._originalPt.y+n)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(n,i){return this._li.computeIntersection(n,i,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,i,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,i,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,i,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(n,i){var a=!1,c=!1;return this._li.computeIntersection(n,i,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(n,i,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(a=!0),this._li.computeIntersection(n,i,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(c=!0),this._li.computeIntersection(n,i,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!a||!c)||!!n.equals(this._pt)||!!i.equals(this._pt))))}},{key:"addSnappedNode",value:function(n,i){var a=n.getCoordinate(i),c=n.getCoordinate(i+1);return!!this.intersects(a,c)&&(n.addIntersection(this.getCoordinate(),i),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var n=arguments[0],i=arguments[1],a=arguments[2];if(this._originalPt=n,this._pt=n,this._scaleFactor=i,this._li=a,i<=0)throw new J("Scale factor must be non-zero");i!==1&&(this._pt=new X(this.scale(n.x),this.scale(n.y)),this._p0Scaled=new X,this._p1Scaled=new X),this.initCorners(this._pt)}}])})();hc.SAFE_ENV_EXPANSION_FACTOR=.75;var KM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var o=arguments[1];arguments[0].getLineSegment(o,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new $t}}])})(),jp=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var o=arguments[0];return this.snap(o,null,-1)}if(arguments.length===3){var n=arguments[0],i=arguments[1],a=arguments[2],c=n.getSafeEnvelope(),g=new Zp(n,i,a);return this._index.query(c,new((function(){return h((function m(){u(this,m)}),[{key:"interfaces_",get:function(){return[Rp]}},{key:"visitItem",value:function(m){m.select(c,g)}}])})())),g.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var o=arguments[0];this._index=o}}])})(),Zp=(function(o){function n(){var i;return u(this,n),i=s(this,n),n.constructor_.apply(i,arguments),i}return _(n,o),h(n,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Fp))return M(n,"select",this,1).apply(this,arguments);var i=arguments[1],a=arguments[0].getContext();if(this._parentEdge===a&&(i===this._hotPixelVertexIndex||i+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(a,i)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var i=arguments[0],a=arguments[1],c=arguments[2];this._hotPixel=i,this._parentEdge=a,this._hotPixelVertexIndex=c}}])})(KM);jp.HotPixelSnapAction=Zp;var QM=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(o,n,i,a){if(o===i&&n===a)return null;var c=o.getCoordinates()[n],g=o.getCoordinates()[n+1],m=i.getCoordinates()[a],y=i.getCoordinates()[a+1];if(this._li.computeIntersection(c,g,m,y),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var x=0;x<this._li.getIntersectionNum();x++)this._interiorIntersections.add(this._li.getIntersection(x));o.addIntersections(this._li,n,0),i.addIntersections(this._li,a,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Jp]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var o=arguments[0];this._li=o,this._interiorIntersections=new me}}])})(),eI=(function(){return h((function o(){u(this,o),o.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(o){var n=gi.getNodedSubstrings(o),i=new Wp(n);try{i.checkValid()}catch(a){if(!(a instanceof $))throw a;a.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return gi.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(o,n){var i=this.findInteriorIntersections(o,n);this.computeIntersectionSnaps(i),this.computeVertexSnaps(o)}},{key:"findInteriorIntersections",value:function(o,n){var i=new QM(n);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(o),i.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(we(arguments[0],Pe))for(var o=arguments[0].iterator();o.hasNext();){var n=o.next();this.computeVertexSnaps(n)}else if(arguments[0]instanceof gi)for(var i=arguments[0],a=i.getCoordinates(),c=0;c<a.length;c++){var g=new hc(a[c],this._scaleFactor,this._li);this._pointSnapper.snap(g,i,c)&&i.addIntersection(a[c],c)}}},{key:"computeNodes",value:function(o){this._nodedSegStrings=o,this._noder=new lc,this._pointSnapper=new jp(this._noder.getIndex()),this.snapRound(o,this._li)}},{key:"computeIntersectionSnaps",value:function(o){for(var n=o.iterator();n.hasNext();){var i=n.next(),a=new hc(i,this._scaleFactor,this._li);this._pointSnapper.snap(a)}}},{key:"interfaces_",get:function(){return[uc]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var o=arguments[0];this._pm=o,this._li=new fi,this._li.setPrecisionModel(o),this._scaleFactor=o.getScale()}}])})(),ss=(function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"bufferFixedPrecision",value:function(n){var i=new ZM(new eI(new De(1)),n.getScale()),a=new Vp(this._bufParams);a.setWorkingPrecisionModel(n),a.setNoder(i),this._resultGeometry=a.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var n=o.MAX_PRECISION_DIGITS;n>=0;n--){try{this.bufferReducedPrecision(n)}catch(g){if(!(g instanceof Gt))throw g;this._saveException=g}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var i=arguments[0],a=o.precisionScaleFactor(this._argGeom,this._distance,i),c=new De(a);this.bufferFixedPrecision(c)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var n=this._argGeom.getFactory().getPrecisionModel();n.getType()===De.FIXED?this.bufferFixedPrecision(n):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(n){this._bufParams.setQuadrantSegments(n)}},{key:"bufferOriginalPrecision",value:function(){try{var n=new Vp(this._bufParams);this._resultGeometry=n.buffer(this._argGeom,this._distance)}catch(i){if(!(i instanceof ce))throw i;this._saveException=i}}},{key:"getResultGeometry",value:function(n){return this._distance=n,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(n){this._bufParams.setEndCapStyle(n)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Y,this._resultGeometry=null,this._saveException=null,arguments.length===1){var n=arguments[0];this._argGeom=n}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this._argGeom=i,this._bufParams=a}}},{key:"bufferOp",value:function(){if(arguments.length===2){var n=arguments[1];return new o(arguments[0]).getResultGeometry(n)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var i=arguments[1],a=arguments[2],c=new o(arguments[0]);return c.setQuadrantSegments(a),c.getResultGeometry(i)}if(arguments[2]instanceof Y&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var g=arguments[1];return new o(arguments[0],arguments[2]).getResultGeometry(g)}}else if(arguments.length===4){var m=arguments[1],y=arguments[2],x=arguments[3],T=new o(arguments[0]);return T.setQuadrantSegments(y),T.setEndCapStyle(x),T.getResultGeometry(m)}}},{key:"precisionScaleFactor",value:function(n,i,a){var c=n.getEnvelopeInternal(),g=Hn.max(Math.abs(c.getMaxX()),Math.abs(c.getMaxY()),Math.abs(c.getMinX()),Math.abs(c.getMinY()))+2*(i>0?i:0),m=a-Math.trunc(Math.log(g)/Math.log(10)+1);return Math.pow(10,m)}}])})();ss.CAP_ROUND=Y.CAP_ROUND,ss.CAP_BUTT=Y.CAP_FLAT,ss.CAP_FLAT=Y.CAP_FLAT,ss.CAP_SQUARE=Y.CAP_SQUARE,ss.MAX_PRECISION_DIGITS=12;var tI=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Kp=(function(){return h((function o(n){u(this,o),this.geometryFactory=n||new es}),[{key:"read",value:function(o){var n,i=(n=typeof o=="string"?JSON.parse(o):o).type;if(!hn[i])throw new Error("Unknown GeoJSON type: "+n.type);return tI.indexOf(i)!==-1?hn[i].call(this,n.coordinates):i==="GeometryCollection"?hn[i].call(this,n.geometries):hn[i].call(this,n)}},{key:"write",value:function(o){var n=o.getGeometryType();if(!Zn[n])throw new Error("Geometry is not supported");return Zn[n].call(this,o)}}])})(),hn={Feature:function(o){var n={};for(var i in o)n[i]=o[i];if(o.geometry){var a=o.geometry.type;if(!hn[a])throw new Error("Unknown GeoJSON type: "+o.type);n.geometry=this.read(o.geometry)}return o.bbox&&(n.bbox=hn.bbox.call(this,o.bbox)),n},FeatureCollection:function(o){var n={};if(o.features){n.features=[];for(var i=0;i<o.features.length;++i)n.features.push(this.read(o.features[i]))}return o.bbox&&(n.bbox=this.parse.bbox.call(this,o.bbox)),n},coordinates:function(o){for(var n=[],i=0;i<o.length;++i){var a=o[i];n.push(l(X,R(a)))}return n},bbox:function(o){return this.geometryFactory.createLinearRing([new X(o[0],o[1]),new X(o[2],o[1]),new X(o[2],o[3]),new X(o[0],o[3]),new X(o[0],o[1])])},Point:function(o){var n=l(X,R(o));return this.geometryFactory.createPoint(n)},MultiPoint:function(o){for(var n=[],i=0;i<o.length;++i)n.push(hn.Point.call(this,o[i]));return this.geometryFactory.createMultiPoint(n)},LineString:function(o){var n=hn.coordinates.call(this,o);return this.geometryFactory.createLineString(n)},MultiLineString:function(o){for(var n=[],i=0;i<o.length;++i)n.push(hn.LineString.call(this,o[i]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(o){for(var n=hn.coordinates.call(this,o[0]),i=this.geometryFactory.createLinearRing(n),a=[],c=1;c<o.length;++c){var g=o[c],m=hn.coordinates.call(this,g),y=this.geometryFactory.createLinearRing(m);a.push(y)}return this.geometryFactory.createPolygon(i,a)},MultiPolygon:function(o){for(var n=[],i=0;i<o.length;++i){var a=o[i];n.push(hn.Polygon.call(this,a))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(o){for(var n=[],i=0;i<o.length;++i){var a=o[i];n.push(this.read(a))}return this.geometryFactory.createGeometryCollection(n)}},Zn={coordinate:function(o){var n=[o.x,o.y];return o.z&&n.push(o.z),o.m&&n.push(o.m),n},Point:function(o){return{type:"Point",coordinates:Zn.coordinate.call(this,o.getCoordinate())}},MultiPoint:function(o){for(var n=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Zn.Point.call(this,a);n.push(c.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(o){for(var n=[],i=o.getCoordinates(),a=0;a<i.length;++a){var c=i[a];n.push(Zn.coordinate.call(this,c))}return{type:"LineString",coordinates:n}},MultiLineString:function(o){for(var n=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Zn.LineString.call(this,a);n.push(c.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(o){var n=[],i=Zn.LineString.call(this,o._shell);n.push(i.coordinates);for(var a=0;a<o._holes.length;++a){var c=o._holes[a],g=Zn.LineString.call(this,c);n.push(g.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(o){for(var n=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Zn.Polygon.call(this,a);n.push(c.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(o){for(var n=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=a.getGeometryType();n.push(Zn[c].call(this,a))}return{type:"GeometryCollection",geometries:n}}};return{BufferOp:ss,GeoJSONReader:(function(){return h((function o(n){u(this,o),this.parser=new Kp(n||new es)}),[{key:"read",value:function(o){return this.parser.read(o)}}])})(),GeoJSONWriter:(function(){return h((function o(){u(this,o),this.parser=new Kp(this.geometryFactory)}),[{key:"write",value:function(o){return this.parser.write(o)}}])})()}}))})(lo)),lo.exports}var qk=zk();const Yk=Ah(qk);function Pr(){return new co}function co(){this.reset()}co.prototype={constructor:co,reset:function(){this.s=this.t=0},add:function(t){ed(ho,t,this.t),ed(this,ho.s,this.s),this.s?this.t+=ho.t:this.s=ho.t},valueOf:function(){return this.s}};var ho=new co;function ed(t,e,r){var s=t.s=e+r,u=s-e,l=s-u;t.t=e-l+(r-u)}var qe=1e-6,Ce=Math.PI,Gn=Ce/2,td=Ce/4,Bn=Ce*2,Or=180/Ce,rn=Ce/180,lt=Math.abs,Hk=Math.atan,qi=Math.atan2,je=Math.cos,Ze=Math.sin,Yi=Math.sqrt;function nd(t){return t>1?0:t<-1?Ce:Math.acos(t)}function ii(t){return t>1?Gn:t<-1?-Gn:Math.asin(t)}function $s(){}function fo(t,e){t&&id.hasOwnProperty(t.type)&&id[t.type](t,e)}var rd={Feature:function(t,e){fo(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,s=-1,u=r.length;++s<u;)fo(r[s].geometry,e)}},id={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,s=-1,u=r.length;++s<u;)t=r[s],e.point(t[0],t[1],t[2])},LineString:function(t,e){Pl(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,s=-1,u=r.length;++s<u;)Pl(r[s],e,0)},Polygon:function(t,e){sd(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,s=-1,u=r.length;++s<u;)sd(r[s],e)},GeometryCollection:function(t,e){for(var r=t.geometries,s=-1,u=r.length;++s<u;)fo(r[s],e)}};function Pl(t,e,r){var s=-1,u=t.length-r,l;for(e.lineStart();++s<u;)l=t[s],e.point(l[0],l[1],l[2]);e.lineEnd()}function sd(t,e){var r=-1,s=t.length;for(e.polygonStart();++r<s;)Pl(t[r],e,1);e.polygonEnd()}function Jk(t,e){t&&rd.hasOwnProperty(t.type)?rd[t.type](t,e):fo(t,e)}Pr(),Pr();function Ol(t){return[qi(t[1],t[0]),ii(t[2])]}function Hi(t){var e=t[0],r=t[1],s=je(r);return[s*je(e),s*Ze(e),Ze(r)]}function go(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function po(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Rl(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function mo(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Dl(t){var e=Yi(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}Pr();function ad(t,e){function r(s,u){return s=t(s,u),e(s[0],s[1])}return t.invert&&e.invert&&(r.invert=function(s,u){return s=e.invert(s,u),s&&t.invert(s[0],s[1])}),r}function Fl(t,e){return[t>Ce?t-Bn:t<-Ce?t+Bn:t,e]}Fl.invert=Fl;function $k(t,e,r){return(t%=Bn)?e||r?ad(ud(t),ld(e,r)):ud(t):e||r?ld(e,r):Fl}function od(t){return function(e,r){return e+=t,[e>Ce?e-Bn:e<-Ce?e+Bn:e,r]}}function ud(t){var e=od(t);return e.invert=od(-t),e}function ld(t,e){var r=je(t),s=Ze(t),u=je(e),l=Ze(e);function f(h,p){var d=je(p),v=je(h)*d,_=Ze(h)*d,w=Ze(p),k=w*r+v*s;return[qi(_*u-k*l,v*r-w*s),ii(k*u+_*l)]}return f.invert=function(h,p){var d=je(p),v=je(h)*d,_=Ze(h)*d,w=Ze(p),k=w*u-_*l;return[qi(_*u+w*l,v*r+k*s),ii(k*r-v*s)]},f}function Xk(t,e,r,s,u,l){if(r){var f=je(e),h=Ze(e),p=s*r;u==null?(u=e+s*Bn,l=e-p/2):(u=cd(f,u),l=cd(f,l),(s>0?u<l:u>l)&&(u+=s*Bn));for(var d,v=u;s>0?v>l:v<l;v-=p)d=Ol([f,-h*je(v),-h*Ze(v)]),t.point(d[0],d[1])}}function cd(t,e){e=Hi(e),e[0]-=t,Dl(e);var r=nd(-e[1]);return((-e[2]<0?-r:r)+Bn-qe)%Bn}function hd(){var t=[],e;return{point:function(r,s){e.push([r,s])},lineStart:function(){t.push(e=[])},lineEnd:$s,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],e=null,r}}}function Vk(t,e,r,s,u,l){var f=t[0],h=t[1],p=e[0],d=e[1],v=0,_=1,w=p-f,k=d-h,M;if(M=r-f,!(!w&&M>0)){if(M/=w,w<0){if(M<v)return;M<_&&(_=M)}else if(w>0){if(M>_)return;M>v&&(v=M)}if(M=u-f,!(!w&&M<0)){if(M/=w,w<0){if(M>_)return;M>v&&(v=M)}else if(w>0){if(M<v)return;M<_&&(_=M)}if(M=s-h,!(!k&&M>0)){if(M/=k,k<0){if(M<v)return;M<_&&(_=M)}else if(k>0){if(M>_)return;M>v&&(v=M)}if(M=l-h,!(!k&&M<0)){if(M/=k,k<0){if(M>_)return;M>v&&(v=M)}else if(k>0){if(M<v)return;M<_&&(_=M)}return v>0&&(t[0]=f+v*w,t[1]=h+v*k),_<1&&(e[0]=f+_*w,e[1]=h+_*k),!0}}}}}function vo(t,e){return lt(t[0]-e[0])<qe&&lt(t[1]-e[1])<qe}function yo(t,e,r,s){this.x=t,this.z=e,this.o=r,this.e=s,this.v=!1,this.n=this.p=null}function fd(t,e,r,s,u){var l=[],f=[],h,p;if(t.forEach(function(M){if(!((R=M.length-1)<=0)){var R,C=M[0],I=M[R],A;if(vo(C,I)){for(u.lineStart(),h=0;h<R;++h)u.point((C=M[h])[0],C[1]);u.lineEnd();return}l.push(A=new yo(C,M,null,!0)),f.push(A.o=new yo(C,null,A,!1)),l.push(A=new yo(I,M,null,!1)),f.push(A.o=new yo(I,null,A,!0))}}),!!l.length){for(f.sort(e),gd(l),gd(f),h=0,p=f.length;h<p;++h)f[h].e=r=!r;for(var d=l[0],v,_;;){for(var w=d,k=!0;w.v;)if((w=w.n)===d)return;v=w.z,u.lineStart();do{if(w.v=w.o.v=!0,w.e){if(k)for(h=0,p=v.length;h<p;++h)u.point((_=v[h])[0],_[1]);else s(w.x,w.n.x,1,u);w=w.n}else{if(k)for(v=w.p.z,h=v.length-1;h>=0;--h)u.point((_=v[h])[0],_[1]);else s(w.x,w.p.x,-1,u);w=w.p}w=w.o,v=w.z,k=!k}while(!w.v);u.lineEnd()}}}function gd(t){if(e=t.length){for(var e,r=0,s=t[0],u;++r<e;)s.n=u=t[r],u.p=s,s=u;s.n=u=t[0],u.p=s}}function dd(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Wk(t){return t.length===1&&(t=jk(t)),{left:function(e,r,s,u){for(s==null&&(s=0),u==null&&(u=e.length);s<u;){var l=s+u>>>1;t(e[l],r)<0?s=l+1:u=l}return s},right:function(e,r,s,u){for(s==null&&(s=0),u==null&&(u=e.length);s<u;){var l=s+u>>>1;t(e[l],r)>0?u=l:s=l+1}return s}}}function jk(t){return function(e,r){return dd(t(e),r)}}Wk(dd);function pd(t){for(var e=t.length,r,s=-1,u=0,l,f;++s<e;)u+=t[s].length;for(l=new Array(u);--e>=0;)for(f=t[e],r=f.length;--r>=0;)l[--u]=f[r];return l}var Xs=1e9,_o=-Xs;function Zk(t,e,r,s){function u(d,v){return t<=d&&d<=r&&e<=v&&v<=s}function l(d,v,_,w){var k=0,M=0;if(d==null||(k=f(d,_))!==(M=f(v,_))||p(d,v)<0^_>0)do w.point(k===0||k===3?t:r,k>1?s:e);while((k=(k+_+4)%4)!==M);else w.point(v[0],v[1])}function f(d,v){return lt(d[0]-t)<qe?v>0?0:3:lt(d[0]-r)<qe?v>0?2:1:lt(d[1]-e)<qe?v>0?1:0:v>0?3:2}function h(d,v){return p(d.x,v.x)}function p(d,v){var _=f(d,1),w=f(v,1);return _!==w?_-w:_===0?v[1]-d[1]:_===1?d[0]-v[0]:_===2?d[1]-v[1]:v[0]-d[0]}return function(d){var v=d,_=hd(),w,k,M,R,C,I,A,Y,$,J,q,W={point:E,lineStart:P,lineEnd:F,polygonStart:b,polygonEnd:O};function E(L,B){u(L,B)&&v.point(L,B)}function S(){for(var L=0,B=0,U=k.length;B<U;++B)for(var H=k[B],j=1,Z=H.length,re=H[0],ce,le,se=re[0],ue=re[1];j<Z;++j)ce=se,le=ue,re=H[j],se=re[0],ue=re[1],le<=s?ue>s&&(se-ce)*(s-le)>(ue-le)*(t-ce)&&++L:ue<=s&&(se-ce)*(s-le)<(ue-le)*(t-ce)&&--L;return L}function b(){v=_,w=[],k=[],q=!0}function O(){var L=S(),B=q&&L,U=(w=pd(w)).length;(B||U)&&(d.polygonStart(),B&&(d.lineStart(),l(null,null,1,d),d.lineEnd()),U&&fd(w,h,L,l,d),d.polygonEnd()),v=d,w=k=M=null}function P(){W.point=D,k&&k.push(M=[]),J=!0,$=!1,A=Y=NaN}function F(){w&&(D(R,C),I&&$&&_.rejoin(),w.push(_.result())),W.point=E,$&&v.lineEnd()}function D(L,B){var U=u(L,B);if(k&&M.push([L,B]),J)R=L,C=B,I=U,J=!1,U&&(v.lineStart(),v.point(L,B));else if(U&&$)v.point(L,B);else{var H=[A=Math.max(_o,Math.min(Xs,A)),Y=Math.max(_o,Math.min(Xs,Y))],j=[L=Math.max(_o,Math.min(Xs,L)),B=Math.max(_o,Math.min(Xs,B))];Vk(H,j,t,e,r,s)?($||(v.lineStart(),v.point(H[0],H[1])),v.point(j[0],j[1]),U||v.lineEnd(),q=!1):U&&(v.lineStart(),v.point(L,B),q=!1)}A=L,Y=B,$=U}return W}}var Gl=Pr();function Kk(t,e){var r=e[0],s=e[1],u=[Ze(r),-je(r),0],l=0,f=0;Gl.reset();for(var h=0,p=t.length;h<p;++h)if(v=(d=t[h]).length)for(var d,v,_=d[v-1],w=_[0],k=_[1]/2+td,M=Ze(k),R=je(k),C=0;C<v;++C,w=A,M=$,R=J,_=I){var I=d[C],A=I[0],Y=I[1]/2+td,$=Ze(Y),J=je(Y),q=A-w,W=q>=0?1:-1,E=W*q,S=E>Ce,b=M*$;if(Gl.add(qi(b*W*Ze(E),R*J+b*je(E))),l+=S?q+W*Bn:q,S^w>=r^A>=r){var O=po(Hi(_),Hi(I));Dl(O);var P=po(u,O);Dl(P);var F=(S^q>=0?-1:1)*ii(P[2]);(s>F||s===F&&(O[0]||O[1]))&&(f+=S^q>=0?1:-1)}}return(l<-qe||l<qe&&Gl<-qe)^f&1}Pr();function md(t){return t}Pr(),Pr();var Ji=1/0,Eo=Ji,Vs=-Ji,wo=Vs,vd={point:Qk,lineStart:$s,lineEnd:$s,polygonStart:$s,polygonEnd:$s,result:function(){var t=[[Ji,Eo],[Vs,wo]];return Vs=wo=-(Eo=Ji=1/0),t}};function Qk(t,e){t<Ji&&(Ji=t),t>Vs&&(Vs=t),e<Eo&&(Eo=e),e>wo&&(wo=e)}Pr();function yd(t,e,r,s){return function(u,l){var f=e(l),h=u.invert(s[0],s[1]),p=hd(),d=e(p),v=!1,_,w,k,M={point:R,lineStart:I,lineEnd:A,polygonStart:function(){M.point=Y,M.lineStart=$,M.lineEnd=J,w=[],_=[]},polygonEnd:function(){M.point=R,M.lineStart=I,M.lineEnd=A,w=pd(w);var q=Kk(_,h);w.length?(v||(l.polygonStart(),v=!0),fd(w,t2,q,r,l)):q&&(v||(l.polygonStart(),v=!0),l.lineStart(),r(null,null,1,l),l.lineEnd()),v&&(l.polygonEnd(),v=!1),w=_=null},sphere:function(){l.polygonStart(),l.lineStart(),r(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function R(q,W){var E=u(q,W);t(q=E[0],W=E[1])&&l.point(q,W)}function C(q,W){var E=u(q,W);f.point(E[0],E[1])}function I(){M.point=C,f.lineStart()}function A(){M.point=R,f.lineEnd()}function Y(q,W){k.push([q,W]);var E=u(q,W);d.point(E[0],E[1])}function $(){d.lineStart(),k=[]}function J(){Y(k[0][0],k[0][1]),d.lineEnd();var q=d.clean(),W=p.result(),E,S=W.length,b,O,P;if(k.pop(),_.push(k),k=null,!!S){if(q&1){if(O=W[0],(b=O.length-1)>0){for(v||(l.polygonStart(),v=!0),l.lineStart(),E=0;E<b;++E)l.point((P=O[E])[0],P[1]);l.lineEnd()}return}S>1&&q&2&&W.push(W.pop().concat(W.shift())),w.push(W.filter(e2))}}return M}}function e2(t){return t.length>1}function t2(t,e){return((t=t.x)[0]<0?t[1]-Gn-qe:Gn-t[1])-((e=e.x)[0]<0?e[1]-Gn-qe:Gn-e[1])}const _d=yd(function(){return!0},n2,i2,[-Ce,-Gn]);function n2(t){var e=NaN,r=NaN,s=NaN,u;return{lineStart:function(){t.lineStart(),u=1},point:function(l,f){var h=l>0?Ce:-Ce,p=lt(l-e);lt(p-Ce)<qe?(t.point(e,r=(r+f)/2>0?Gn:-Gn),t.point(s,r),t.lineEnd(),t.lineStart(),t.point(h,r),t.point(l,r),u=0):s!==h&&p>=Ce&&(lt(e-s)<qe&&(e-=s*qe),lt(l-h)<qe&&(l-=h*qe),r=r2(e,r,l,f),t.point(s,r),t.lineEnd(),t.lineStart(),t.point(h,r),u=0),t.point(e=l,r=f),s=h},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-u}}}function r2(t,e,r,s){var u,l,f=Ze(t-r);return lt(f)>qe?Hk((Ze(e)*(l=je(s))*Ze(r)-Ze(s)*(u=je(e))*Ze(t))/(u*l*f)):(e+s)/2}function i2(t,e,r,s){var u;if(t==null)u=r*Gn,s.point(-Ce,u),s.point(0,u),s.point(Ce,u),s.point(Ce,0),s.point(Ce,-u),s.point(0,-u),s.point(-Ce,-u),s.point(-Ce,0),s.point(-Ce,u);else if(lt(t[0]-e[0])>qe){var l=t[0]<e[0]?Ce:-Ce;u=r*l/2,s.point(-l,u),s.point(0,u),s.point(l,u)}else s.point(e[0],e[1])}function s2(t,e){var r=je(t),s=r>0,u=lt(r)>qe;function l(v,_,w,k){Xk(k,t,e,w,v,_)}function f(v,_){return je(v)*je(_)>r}function h(v){var _,w,k,M,R;return{lineStart:function(){M=k=!1,R=1},point:function(C,I){var A=[C,I],Y,$=f(C,I),J=s?$?0:d(C,I):$?d(C+(C<0?Ce:-Ce),I):0;if(!_&&(M=k=$)&&v.lineStart(),$!==k&&(Y=p(_,A),(!Y||vo(_,Y)||vo(A,Y))&&(A[0]+=qe,A[1]+=qe,$=f(A[0],A[1]))),$!==k)R=0,$?(v.lineStart(),Y=p(A,_),v.point(Y[0],Y[1])):(Y=p(_,A),v.point(Y[0],Y[1]),v.lineEnd()),_=Y;else if(u&&_&&s^$){var q;!(J&w)&&(q=p(A,_,!0))&&(R=0,s?(v.lineStart(),v.point(q[0][0],q[0][1]),v.point(q[1][0],q[1][1]),v.lineEnd()):(v.point(q[1][0],q[1][1]),v.lineEnd(),v.lineStart(),v.point(q[0][0],q[0][1])))}$&&(!_||!vo(_,A))&&v.point(A[0],A[1]),_=A,k=$,w=J},lineEnd:function(){k&&v.lineEnd(),_=null},clean:function(){return R|(M&&k)<<1}}}function p(v,_,w){var k=Hi(v),M=Hi(_),R=[1,0,0],C=po(k,M),I=go(C,C),A=C[0],Y=I-A*A;if(!Y)return!w&&v;var $=r*I/Y,J=-r*A/Y,q=po(R,C),W=mo(R,$),E=mo(C,J);Rl(W,E);var S=q,b=go(W,S),O=go(S,S),P=b*b-O*(go(W,W)-1);if(!(P<0)){var F=Yi(P),D=mo(S,(-b-F)/O);if(Rl(D,W),D=Ol(D),!w)return D;var L=v[0],B=_[0],U=v[1],H=_[1],j;B<L&&(j=L,L=B,B=j);var Z=B-L,re=lt(Z-Ce)<qe,ce=re||Z<qe;if(!re&&H<U&&(j=U,U=H,H=j),ce?re?U+H>0^D[1]<(lt(D[0]-L)<qe?U:H):U<=D[1]&&D[1]<=H:Z>Ce^(L<=D[0]&&D[0]<=B)){var le=mo(S,(-b+F)/O);return Rl(le,W),[D,Ol(le)]}}}function d(v,_){var w=s?t:Ce-t,k=0;return v<-w?k|=1:v>w&&(k|=2),_<-w?k|=4:_>w&&(k|=8),k}return yd(f,h,l,s?[0,-t]:[-Ce,t-Ce])}function Ed(t){return function(e){var r=new Bl;for(var s in t)r[s]=t[s];return r.stream=e,r}}function Bl(){}Bl.prototype={constructor:Bl,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function wd(t,e,r){var s=e[1][0]-e[0][0],u=e[1][1]-e[0][1],l=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),l!=null&&t.clipExtent(null),Jk(r,t.stream(vd));var f=vd.result(),h=Math.min(s/(f[1][0]-f[0][0]),u/(f[1][1]-f[0][1])),p=+e[0][0]+(s-h*(f[1][0]+f[0][0]))/2,d=+e[0][1]+(u-h*(f[1][1]+f[0][1]))/2;return l!=null&&t.clipExtent(l),t.scale(h*150).translate([p,d])}function a2(t,e,r){return wd(t,[[0,0],e],r)}var xd=16,o2=je(30*rn);function kd(t,e){return+e?l2(t,e):u2(t)}function u2(t){return Ed({point:function(e,r){e=t(e,r),this.stream.point(e[0],e[1])}})}function l2(t,e){function r(s,u,l,f,h,p,d,v,_,w,k,M,R,C){var I=d-s,A=v-u,Y=I*I+A*A;if(Y>4*e&&R--){var $=f+w,J=h+k,q=p+M,W=Yi($*$+J*J+q*q),E=ii(q/=W),S=lt(lt(q)-1)<qe||lt(l-_)<qe?(l+_)/2:qi(J,$),b=t(S,E),O=b[0],P=b[1],F=O-s,D=P-u,L=A*F-I*D;(L*L/Y>e||lt((I*F+A*D)/Y-.5)>.3||f*w+h*k+p*M<o2)&&(r(s,u,l,f,h,p,O,P,S,$/=W,J/=W,q,R,C),C.point(O,P),r(O,P,S,$,J,q,d,v,_,w,k,M,R,C))}}return function(s){var u,l,f,h,p,d,v,_,w,k,M,R,C={point:I,lineStart:A,lineEnd:$,polygonStart:function(){s.polygonStart(),C.lineStart=J},polygonEnd:function(){s.polygonEnd(),C.lineStart=A}};function I(E,S){E=t(E,S),s.point(E[0],E[1])}function A(){_=NaN,C.point=Y,s.lineStart()}function Y(E,S){var b=Hi([E,S]),O=t(E,S);r(_,w,v,k,M,R,_=O[0],w=O[1],v=E,k=b[0],M=b[1],R=b[2],xd,s),s.point(_,w)}function $(){C.point=I,s.lineEnd()}function J(){A(),C.point=q,C.lineEnd=W}function q(E,S){Y(u=E,S),l=_,f=w,h=k,p=M,d=R,C.point=Y}function W(){r(_,w,v,k,M,R,l,f,u,h,p,d,xd,s),C.lineEnd=$,$()}return C}}var c2=Ed({point:function(t,e){this.stream.point(t*rn,e*rn)}});function h2(t){return f2(function(){return t})()}function f2(t){var e,r=150,s=480,u=250,l,f,h=0,p=0,d=0,v=0,_=0,w,k,M=null,R=_d,C=null,I,A,Y,$=md,J=.5,q=kd(O,J),W,E;function S(D){return D=k(D[0]*rn,D[1]*rn),[D[0]*r+l,f-D[1]*r]}function b(D){return D=k.invert((D[0]-l)/r,(f-D[1])/r),D&&[D[0]*Or,D[1]*Or]}function O(D,L){return D=e(D,L),[D[0]*r+l,f-D[1]*r]}S.stream=function(D){return W&&E===D?W:W=c2(R(w,q($(E=D))))},S.clipAngle=function(D){return arguments.length?(R=+D?s2(M=D*rn,6*rn):(M=null,_d),F()):M*Or},S.clipExtent=function(D){return arguments.length?($=D==null?(C=I=A=Y=null,md):Zk(C=+D[0][0],I=+D[0][1],A=+D[1][0],Y=+D[1][1]),F()):C==null?null:[[C,I],[A,Y]]},S.scale=function(D){return arguments.length?(r=+D,P()):r},S.translate=function(D){return arguments.length?(s=+D[0],u=+D[1],P()):[s,u]},S.center=function(D){return arguments.length?(h=D[0]%360*rn,p=D[1]%360*rn,P()):[h*Or,p*Or]},S.rotate=function(D){return arguments.length?(d=D[0]%360*rn,v=D[1]%360*rn,_=D.length>2?D[2]%360*rn:0,P()):[d*Or,v*Or,_*Or]},S.precision=function(D){return arguments.length?(q=kd(O,J=D*D),F()):Yi(J)},S.fitExtent=function(D,L){return wd(S,D,L)},S.fitSize=function(D,L){return a2(S,D,L)};function P(){k=ad(w=$k(d,v,_),e);var D=e(h,p);return l=s-D[0]*r,f=u+D[1]*r,F()}function F(){return W=E=null,S}return function(){return e=t.apply(this,arguments),S.invert=e.invert&&b,P()}}function Sd(t){return function(e,r){var s=je(e),u=je(r),l=t(s*u);return[l*u*Ze(e),l*Ze(r)]}}function Md(t){return function(e,r){var s=Yi(e*e+r*r),u=t(s),l=Ze(u),f=je(u);return[qi(e*l,s*f),ii(s&&r*l/s)]}}var g2=Sd(function(t){return Yi(2/(1+t))});g2.invert=Md(function(t){return 2*ii(t/2)});var Id=Sd(function(t){return(t=nd(t))&&t/Ze(t)});Id.invert=Md(function(t){return t});function d2(){return h2(Id).scale(79.4188).clipAngle(180-.001)}function bd(t,e){return[t,e]}bd.invert=bd;var{BufferOp:p2,GeoJSONReader:m2,GeoJSONWriter:v2}=Yk;function y2(t,e,r){r=r||{};var s=r.units||"kilometers",u=r.steps||8;if(!t)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof u!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(u<=0)throw new Error("steps must be greater than 0");var l=[];switch(t.type){case"GeometryCollection":return Lr(t,function(f){var h=xo(f,e,s,u);h&&l.push(h)}),rt(l);case"FeatureCollection":return Dn(t,function(f){var h=xo(f,e,s,u);h&&Dn(h,function(p){p&&l.push(p)})}),rt(l)}return xo(t,e,s,u)}function xo(t,e,r,s){var u=t.properties||{},l=t.type==="Feature"?t.geometry:t;if(l.type==="GeometryCollection"){var f=[];return Lr(t,function(R){var C=xo(R,e,r,s);C&&f.push(C)}),rt(f)}var h=_2(l),p={type:l.type,coordinates:Ad(l.coordinates,h)},d=new m2,v=d.read(p),_=gl(dl(e,r),"meters"),w=p2.bufferOp(v,_,s),k=new v2;if(w=k.write(w),!Td(w.coordinates)){var M={type:w.type,coordinates:Ld(w.coordinates,h)};return nn(M,u)}}function Td(t){return Array.isArray(t[0])?Td(t[0]):isNaN(t[0])}function Ad(t,e){return typeof t[0]!="object"?e(t):t.map(function(r){return Ad(r,e)})}function Ld(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(r){return Ld(r,e)})}function _2(t){var e=Bk(t).geometry.coordinates,r=[-e[0],-e[1]];return d2().rotate(r).scale(ot)}var E2=y2;class Cd{constructor(e=[],r=w2){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,u=r[e];for(;e>0;){const l=e-1>>1,f=r[l];if(s(u,f)>=0)break;r[e]=f,e=l}r[e]=u}_down(e){const{data:r,compare:s}=this,u=this.length>>1,l=r[e];for(;e<u;){let f=(e<<1)+1,h=r[f];const p=f+1;if(p<this.length&&s(r[p],h)<0&&(f=p,h=r[p]),s(h,l)>=0)break;r[e]=h,e=f}r[e]=l}}function w2(t,e){return t<e?-1:t>e?1:0}function Nd(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function x2(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class Pd{constructor(e,r,s,u){this.p={x:e[0],y:e[1]},this.featureId=r,this.ringId=s,this.eventId=u,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function k2(t,e){if(t.type==="FeatureCollection"){const r=t.features;for(let s=0;s<r.length;s++)Od(r[s],e)}else Od(t,e)}let ko=0,So=0,Mo=0;function Od(t,e){const r=t.type==="Feature"?t.geometry:t;let s=r.coordinates;(r.type==="Polygon"||r.type==="MultiLineString")&&(s=[s]),r.type==="LineString"&&(s=[[s]]);for(let u=0;u<s.length;u++)for(let l=0;l<s[u].length;l++){let f=s[u][l][0],h=null;So=So+1;for(let p=0;p<s[u][l].length-1;p++){h=s[u][l][p+1];const d=new Pd(f,ko,So,Mo),v=new Pd(h,ko,So,Mo+1);d.otherEvent=v,v.otherEvent=d,Nd(d,v)>0?(v.isLeftEndpoint=!0,d.isLeftEndpoint=!1):(d.isLeftEndpoint=!0,v.isLeftEndpoint=!1),e.push(d),e.push(v),f=h,Mo=Mo+1}}ko=ko+1}let S2=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};function M2(t,e){if(t===null||e===null||t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const r=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,u=t.rightSweepEvent.p.x,l=t.rightSweepEvent.p.y,f=e.leftSweepEvent.p.x,h=e.leftSweepEvent.p.y,p=e.rightSweepEvent.p.x,d=e.rightSweepEvent.p.y,v=(d-h)*(u-r)-(p-f)*(l-s),_=(p-f)*(s-h)-(d-h)*(r-f),w=(u-r)*(s-h)-(l-s)*(r-f);if(v===0)return!1;const k=_/v,M=w/v;if(k>=0&&k<=1&&M>=0&&M<=1){const R=r+k*(u-r),C=s+k*(l-s);return[R,C]}return!1}function I2(t,e){e=e||!1;const r=[],s=new Cd([],x2);for(;t.length;){const u=t.pop();if(u.isLeftEndpoint){const l=new S2(u);for(let f=0;f<s.data.length;f++){const h=s.data[f];if(e&&h.leftSweepEvent.featureId===u.featureId)continue;const p=M2(l,h);p!==!1&&r.push(p)}s.push(l)}else u.isLeftEndpoint===!1&&s.pop()}return r}function b2(t,e){const r=new Cd([],Nd);return k2(t,r),I2(r,e)}var T2=b2;function Ws(t,e,r={}){const{removeDuplicates:s=!0,ignoreSelfIntersections:u=!0}=r;let l=[];t.type==="FeatureCollection"?l=l.concat(t.features):t.type==="Feature"?l.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&l.push(nn(t)),e.type==="FeatureCollection"?l=l.concat(e.features):e.type==="Feature"?l.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&l.push(nn(e));const f=T2(rt(l),u);let h=[];if(s){const p={};f.forEach(d=>{const v=d.join(",");p[v]||(p[v]=!0,h.push(d))})}else h=f;return rt(h.map(p=>kn(p)))}var A2=Ws;function Ul(t){const e=Ht(t);let r=0,s=1,u,l;for(;s<e.length;)u=l||e[0],l=e[s],r+=(l[0]-u[0])*(l[1]+u[1]),s++;return r>0}function L2(t,e={}){var r,s;if(e=e||{},!Ya(e))throw new Error("options is invalid");const u=(r=e.mutate)!=null?r:!1,l=(s=e.reverse)!=null?s:!1;if(!t)throw new Error("<geojson> is required");if(typeof l!="boolean")throw new Error("<reverse> must be a boolean");if(typeof u!="boolean")throw new Error("<mutate> must be a boolean");!u&&t.type!=="Point"&&t.type!=="MultiPoint"&&(t=Ha(t));const f=[];switch(t.type){case"GeometryCollection":return Lr(t,function(h){Io(h,l)}),t;case"FeatureCollection":return Dn(t,function(h){const p=Io(h,l);Dn(p,function(d){f.push(d)})}),rt(f)}return Io(t,l)}function Io(t,e){switch(t.type==="Feature"?t.geometry.type:t.type){case"GeometryCollection":return Lr(t,function(s){Io(s,e)}),t;case"LineString":return Rd(Ht(t),e),t;case"Polygon":return Dd(Ht(t),e),t;case"MultiLineString":return Ht(t).forEach(function(s){Rd(s,e)}),t;case"MultiPolygon":return Ht(t).forEach(function(s){Dd(s,e)}),t;case"Point":case"MultiPoint":return t}}function Rd(t,e){Ul(t)===e&&t.reverse()}function Dd(t,e){Ul(t[0])!==e&&t[0].reverse();for(let r=1;r<t.length;r++)Ul(t[r])===e&&t[r].reverse()}var C2=L2;const N2=["Point","MultiPoint"],P2=["LineString","MultiLineString","Polygon","MultiPolygon"],Fd=t=>N2.includes(t.geometry.type),zl=t=>P2.includes(t.geometry.type),Gd=(t,e)=>(Ri(t,r=>{const s=r.coordinate;s[0]+=e.lng,s[1]+=e.lat}),t),O2=(t,e)=>{const s=t.getBounds(),u=xg(s[0],s[1],{units:"meters"});return E2(e,u*1e-4,{units:"meters"})||null},Bd=(t,e)=>{const r=Ut(t.getGeoJson());return Gd(r,e),r},R2=(t,e)=>{const r=Bd(t,e),s=t.getShapeProperty("center");s&&(t.setShapeProperty("center",s[0]+e.lng),t.setShapeProperty("center",s[1]+e.lat)),t.updateGeoJsonGeometry(r.geometry)},D2=(t,e)=>{try{Ri(t,r=>{if(!ti(r.coordinate,e))throw new Error("stop")})}catch{return!1}return!0},js=(t,e)=>{const r=D2(t,e);return Fd(t)?r:r&&zl(t)?!A2(t,e,{ignoreSelfIntersections:!0}).features.length:!1},ql=t=>{const e=t.getGeoJson();return typeof e!="object"?null:xl(e)},F2=t=>{if(zl(t)){const e=C2(t,{mutate:!1});if(e.type==="Feature"&&zl(e))return{...e,properties:t.properties||{}}}return Fd(t)?t:null},G2=(t,e)=>{const r=t.properties?.[e];return typeof r=="string"||typeof r=="number"?r:null};class bo extends ri{mode="drag";previousLngLat=null;pointBasedShapes=["marker","circle_marker","text_marker"];throttledMethods=Nr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay);eventHandlers={[`${ae}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this),touchmove:this.throttledMethods.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this)};getUpdatedGeoJsonHandlers={marker:this.moveSource.bind(this),ellipse:this.moveEllipse.bind(this),circle:this.moveCircle.bind(this),circle_marker:this.moveSource.bind(this),text_marker:this.moveSource.bind(this),line:this.moveSource.bind(this),rectangle:this.moveSource.bind(this),polygon:this.moveSource.bind(this)};onMouseDown(e){if(!Xe(e))return{next:!0};const r=this.getFeatureByMouseEvent({event:e,sourceNames:[K.main]});return r&&this.getUpdatedGeoJsonHandlers[r.shape]?(this.featureData=r,this.featureData.changeSource({sourceName:K.temporary,atomic:!0}),this.gm.mapAdapter.setDragPan(!1),this.snappingHelper?.addExcludedFeature(this.featureData),this.fireFeatureEditStartEvent({feature:this.featureData,forceMode:"drag"}),this.flags.actionInProgress=!0,this.isPointBasedShape()&&this.alignShapeCenterWithControlMarker(this.featureData,e),{next:!1}):{next:!0}}onMouseUp(e){return!this.featureData||!Xe(e,{warning:!0})?{next:!0}:(this.snappingHelper?.clearExcludedFeatures(),this.featureData.changeSource({sourceName:K.main,atomic:!0}),this.previousLngLat=null,this.gm.mapAdapter.setDragPan(!0),this.fireFeatureEditEndEvent({feature:this.featureData,forceMode:"drag"}),this.flags.actionInProgress=!1,this.featureData=null,{next:!0})}onMouseMove(e){if(!this.flags.actionInProgress||!Xe(e,{warning:!0}))return{next:!0};if(this.featureData){const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();this.moveFeature(this.featureData,r)}return{next:!1}}isPointBasedShape(){return!!this.featureData&&this.pointBasedShapes.includes(this.featureData.shape)}alignShapeCenterWithControlMarker(e,r){const s=ql(e);s&&(this.gm.markerPointer.marker?.setLngLat(s),this.onMouseMove(r))}moveFeature(e,r){if(!this.flags.actionInProgress)return;if(!this.previousLngLat){this.previousLngLat=r;return}const s=this.getUpdatedGeoJsonHandlers[e.shape];if(s){const u=s(e,this.previousLngLat,r);if(!u){ne.error("BaseDrag.moveFeature: invalid updatedGeoJson",e);return}this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[u],forceMode:"drag"});const l=this.updateFeatureGeoJson({featureData:e,featureGeoJson:u,forceMode:"drag"});ki(e.getGeoJson().properties,u.properties)||e._updateAllProperties(u.properties),l&&(this.previousLngLat=r)}}moveSource(e,r,s){const u=Va(r,s);return Bd(e,u)}moveEllipse(e,r,s){if(e.shape!=="ellipse")return ne.error("BaseDrag.moveCircle: invalid shape type",e),null;const u=e.getShapeProperty("center"),l=e.getShapeProperty("xSemiAxis"),f=e.getShapeProperty("ySemiAxis"),h=e.getShapeProperty("angle");if(!Array.isArray(u)||typeof l!="number"||typeof f!="number"||typeof h!="number")return ne.error("BaseDrag.moveEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",e),null;const p=Va(r,s),d=[u[0]+p.lng,u[1]+p.lat];return eo({center:d,xSemiAxis:l,ySemiAxis:f,angle:h})}moveCircle(e,r,s){if(e.shape!=="circle")return ne.error("BaseDrag.moveCircle: invalid shape type",e),null;const u=e.getShapeProperty("center");if(!Array.isArray(u))return ne.error("BaseDrag.moveCircle: missing center in the featureData",e),null;const l=e.getGeoJson(),f=Va(r,s),h=xl(l);if(!h)return ne.error("BaseDrag.moveCircle: missing center circleRimLngLat"),null;const p=[u[0]+f.lng,u[1]+f.lat];e.setShapeProperty("center",p);const d=kl({center:p,radius:this.gm.mapAdapter.getDistance(u,h)});return{type:"Feature",properties:{shape:"circle"},geometry:d.geometry}}}const B2={imperial:"en-US",metric:"nb-NO"},Ud={distance:{metric:[{range:[0,1],unit:"cm",factor:100},{range:[1,1e4],unit:"m",factor:1},{range:[1e4,1/0],unit:"km",factor:.001}],imperial:[{range:[0,.3048],factor:39.3701,unit:"in"},{range:[.3048,1609.344],factor:3.28084,unit:"ft"},{range:[1609.344,1/0],factor:621371e-9,unit:"mi"}]},area:{metric:[{range:[0,1],unit:"cm",factor:1e4},{range:[1,1e4],unit:"m",factor:1},{range:[1e5,1/0],unit:"km",factor:1e-6}],imperial:[{range:[0,.092903],factor:1550.0031,unit:"in"},{range:[.092903,4046.856],factor:10.7639,unit:"ft"},{range:[4046.856,2589988],factor:247105e-9,unit:"ac"},{range:[2589988,1/0],factor:3861e-10,unit:"mi"}]}},zd=(t,e)=>(t%e+e)%e,To=(t,e)=>new Intl.NumberFormat(B2[e.units],{minimumFractionDigits:e.minimumFractionDigits??0,maximumFractionDigits:e.maximumFractionDigits??2}).format(t),U2=(t,e)=>{const s=Ud.distance[e.units].find(u=>t>=u.range[0]&&t<u.range[1]);return s?`${To(t*s.factor,e)} ${s.unit}`:To(t,e)},z2=(t,e)=>{const s=Ud.area[e.units].find(u=>t>=u.range[0]&&t<u.range[1]);return s?`${To(t*s.factor,e)} ${s.unit}`:To(t,e)};class q2 extends bo{mode="change";cutVertexShapeTypes=["line","polygon","rectangle"];markerData=null;shapeUpdateHandlers={marker:this.updateSingleVertex.bind(this),circle:this.updateCircle.bind(this),circle_marker:this.updateSingleVertex.bind(this),ellipse:this.updateEllipse.bind(this),text_marker:this.updateSingleVertex.bind(this),line:this.updateSingleVertex.bind(this),rectangle:this.updateRectangle.bind(this),polygon:this.updateSingleVertex.bind(this)};get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return Fg(e)?e:null}onStartAction(){}onEndAction(){this.snapGuidesInstance?.removeSnapGuides()}handleGmEdit(e){if(!ni(e))return{next:!0};if(e.action==="marker_move"&&e.lngLatStart&&e.markerData){if(e.markerData.type==="vertex")return this.moveVertex(e),{next:!1};if(e.lngLatEnd)return this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}}return e.action==="marker_right_click"?(this.cutVertex(e),this.fireFeatureEditEndEvent({feature:e.featureData})):e.action==="edge_marker_click"?this.insertVertex(e):e.action==="marker_captured"?(this.setCursorToPointer(),e.featureData.changeSource({sourceName:K.temporary,atomic:!0}),this.flags.actionInProgress=!0,this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.markerData=null,this.snapGuidesInstance?.removeSnapGuides(),e.featureData.changeSource({sourceName:K.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData}),this.flags.actionInProgress=!1),{next:!0}}moveVertex(e){this.markerData||(this.markerData=e.markerData||null,this.snapGuidesInstance?.updateSnapGuides(e.featureData.getGeoJson(),e.lngLatStart));const r=e.featureData,s=r.shape,u=this.shapeUpdateHandlers[s]?.(e)||null;u?(this.fireBeforeFeatureUpdate({features:[r],geoJsonFeatures:[u]}),this.updateFeatureGeoJson({featureData:r,featureGeoJson:u})):ne.error("EditChange.moveVertex: invalid geojson",u,e)}cutVertex(e){const r=e.featureData;if(e.markerData.type!=="vertex"||!this.cutVertexShapeTypes.includes(r.shape))return;let s=!1;const u=r.getGeoJson(),l=e.markerData.instance;if(Gs(u)){if(Qa(u)<=2){this.gm.features.delete(r);return}}else if(Xa(u)){if(Qa(u)<=3){this.gm.features.delete(r);return}}else if($a(u)&&Qa(u)<=3){this.gm.features.delete(r);return}const f=ql(l);f&&(s=Dx(u,f)),s?(r.convertToPolygon(),r.updateGeoJsonGeometry(u.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[r],targetFeatures:[r],markerData:e.markerData})):ne.error("EditChange.cutVertex: feature not updated",e)}insertVertex(e){if(e.markerData.type!=="edge")return;const r=e.featureData.getGeoJson(),s=e.markerData.segment.end.path,u=s.pop(),l=Ei(r,s);typeof u=="number"&&(l.splice(u,0,[...e.markerData.position.coordinate]),e.featureData.updateGeoJsonGeometry(r.geometry),e.featureData.convertToPolygon(),this.fireFeatureUpdatedEvent({sourceFeatures:[e.featureData],targetFeatures:[e.featureData],markerData:e.markerData}))}updateSingleVertex({featureData:e,lngLatEnd:r,markerData:s}){const u=Ut(e.getGeoJson()),l=Ut(s.position.path),f=l.pop(),h=Ei(u,l);return Array.isArray(h)&&typeof f=="number"?(h[f]=[...r],f===0&&e.shape==="polygon"&&(h[h.length-1]=[...r])):ne.error("BaseDrag.moveSingleVertex: invalid coordinates",u,l),u}updateCircle({featureData:e,lngLatEnd:r}){const s=e.getShapeProperty("center");if(e.shape!=="circle"||!s)return ne.error("BaseDrag.moveCircle: invalid shape type / missing center",e),null;const u=kl({center:s,radius:this.gm.mapAdapter.getDistance(s,r)});return{type:"Feature",properties:{shape:"circle"},geometry:u.geometry}}updateEllipse(e){const{featureData:r,lngLatEnd:s,markerData:u}=e;if(r.shape!=="ellipse")return ne.error("EditChange.updateEllipse: invalid shape type",r),null;const l=r.getShapeProperty("center");let f=r.getShapeProperty("xSemiAxis"),h=r.getShapeProperty("ySemiAxis");const p=r.getShapeProperty("angle");if(!Array.isArray(l)||typeof f!="number"||typeof h!="number"||typeof p!="number")return ne.error("updateEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",r),null;const d=this.gm.mapAdapter.getDistance(l,s),v=u.position.path[3],_=Math.floor(v/Pg*4);return(_===0||_===2?"x":"y")==="x"?f=d:h=d,eo({center:l,xSemiAxis:f,ySemiAxis:h,angle:p})}updateRectangle({featureData:e,lngLatStart:r,lngLatEnd:s}){const l=e.getGeoJson(),f=l.geometry.coordinates[0],{absCoordIndex:h}=Za(l,r);if(h===-1)return ne.error("EditChange.updateRectangle: start vertex not found",e),null;const p=zd(h-2,4),d=f[p];return _l(s,d)}}function Y2(t,e,{ignoreSelfIntersections:r=!0}={ignoreSelfIntersections:!0}){let s=!0;return Cr(t,u=>{Cr(e,l=>{if(s===!1)return!1;s=H2(u.geometry,l.geometry,r)})}),s}function H2(t,e,r){switch(t.type){case"Point":switch(e.type){case"Point":return!V2(t.coordinates,e.coordinates);case"LineString":return!qd(e,t);case"Polygon":return!ti(t,e)}break;case"LineString":switch(e.type){case"Point":return!qd(t,e);case"LineString":return!J2(t,e,r);case"Polygon":return!Yd(e,t,r)}break;case"Polygon":switch(e.type){case"Point":return!ti(e,t);case"LineString":return!Yd(t,e,r);case"Polygon":return!$2(e,t,r)}}return!1}function qd(t,e){for(let r=0;r<t.coordinates.length-1;r++)if(X2(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function J2(t,e,r){return Ws(t,e,{ignoreSelfIntersections:r}).features.length>0}function Yd(t,e,r){for(const u of e.coordinates)if(ti(u,t))return!0;return Ws(e,vl(t),{ignoreSelfIntersections:r}).features.length>0}function $2(t,e,r){for(const u of t.coordinates[0])if(ti(u,e))return!0;for(const u of e.coordinates[0])if(ti(u,t))return!0;return Ws(vl(t),vl(e),{ignoreSelfIntersections:r}).features.length>0}function X2(t,e,r){const s=r[0]-t[0],u=r[1]-t[1],l=e[0]-t[0],f=e[1]-t[1];return s*f-u*l!==0?!1:Math.abs(l)>=Math.abs(f)?l>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:f>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]}function V2(t,e){return t[0]===e[0]&&t[1]===e[1]}function W2(t,e,{ignoreSelfIntersections:r=!0}={}){let s=!1;return Cr(t,u=>{Cr(e,l=>{if(s===!0)return!0;s=!Y2(u.geometry,l.geometry,{ignoreSelfIntersections:r})})}),s}var Hd=W2,j2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Yl=Math.ceil,sn=Math.floor,Dt="[BigNumber Error] ",Jd=Dt+"Number primitive has more than 15 significant digits: ",Sn=1e14,xe=14,Hl=9007199254740991,Jl=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Rr=1e7,ct=1e9;function $d(t){var e,r,s,u=A.prototype={constructor:A,toString:null,valueOf:null},l=new A(1),f=20,h=4,p=-7,d=21,v=-1e7,_=1e7,w=!1,k=1,M=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz",I=!0;function A(E,S){var b,O,P,F,D,L,B,U,H=this;if(!(H instanceof A))return new A(E,S);if(S==null){if(E&&E._isBigNumber===!0){H.s=E.s,!E.c||E.e>_?H.c=H.e=null:E.e<v?H.c=[H.e=0]:(H.e=E.e,H.c=E.c.slice());return}if((L=typeof E=="number")&&E*0==0){if(H.s=1/E<0?(E=-E,-1):1,E===~~E){for(F=0,D=E;D>=10;D/=10,F++);F>_?H.c=H.e=null:(H.e=F,H.c=[E]);return}U=String(E)}else{if(!j2.test(U=String(E)))return s(H,U,L);H.s=U.charCodeAt(0)==45?(U=U.slice(1),-1):1}(F=U.indexOf("."))>-1&&(U=U.replace(".","")),(D=U.search(/e/i))>0?(F<0&&(F=D),F+=+U.slice(D+1),U=U.substring(0,D)):F<0&&(F=U.length)}else{if(Ke(S,2,C.length,"Base"),S==10&&I)return H=new A(E),q(H,f+H.e+1,h);if(U=String(E),L=typeof E=="number"){if(E*0!=0)return s(H,U,L,S);if(H.s=1/E<0?(U=U.slice(1),-1):1,A.DEBUG&&U.replace(/^0\.0*|\./,"").length>15)throw Error(Jd+E)}else H.s=U.charCodeAt(0)===45?(U=U.slice(1),-1):1;for(b=C.slice(0,S),F=D=0,B=U.length;D<B;D++)if(b.indexOf(O=U.charAt(D))<0){if(O=="."){if(D>F){F=B;continue}}else if(!P&&(U==U.toUpperCase()&&(U=U.toLowerCase())||U==U.toLowerCase()&&(U=U.toUpperCase()))){P=!0,D=-1,F=0;continue}return s(H,String(E),L,S)}L=!1,U=r(U,S,10,H.s),(F=U.indexOf("."))>-1?U=U.replace(".",""):F=U.length}for(D=0;U.charCodeAt(D)===48;D++);for(B=U.length;U.charCodeAt(--B)===48;);if(U=U.slice(D,++B)){if(B-=D,L&&A.DEBUG&&B>15&&(E>Hl||E!==sn(E)))throw Error(Jd+H.s*E);if((F=F-D-1)>_)H.c=H.e=null;else if(F<v)H.c=[H.e=0];else{if(H.e=F,H.c=[],D=(F+1)%xe,F<0&&(D+=xe),D<B){for(D&&H.c.push(+U.slice(0,D)),B-=xe;D<B;)H.c.push(+U.slice(D,D+=xe));D=xe-(U=U.slice(D)).length}else D-=B;for(;D--;U+="0");H.c.push(+U)}}else H.c=[H.e=0]}A.clone=$d,A.ROUND_UP=0,A.ROUND_DOWN=1,A.ROUND_CEIL=2,A.ROUND_FLOOR=3,A.ROUND_HALF_UP=4,A.ROUND_HALF_DOWN=5,A.ROUND_HALF_EVEN=6,A.ROUND_HALF_CEIL=7,A.ROUND_HALF_FLOOR=8,A.EUCLID=9,A.config=A.set=function(E){var S,b;if(E!=null)if(typeof E=="object"){if(E.hasOwnProperty(S="DECIMAL_PLACES")&&(b=E[S],Ke(b,0,ct,S),f=b),E.hasOwnProperty(S="ROUNDING_MODE")&&(b=E[S],Ke(b,0,8,S),h=b),E.hasOwnProperty(S="EXPONENTIAL_AT")&&(b=E[S],b&&b.pop?(Ke(b[0],-ct,0,S),Ke(b[1],0,ct,S),p=b[0],d=b[1]):(Ke(b,-ct,ct,S),p=-(d=b<0?-b:b))),E.hasOwnProperty(S="RANGE"))if(b=E[S],b&&b.pop)Ke(b[0],-ct,-1,S),Ke(b[1],1,ct,S),v=b[0],_=b[1];else if(Ke(b,-ct,ct,S),b)v=-(_=b<0?-b:b);else throw Error(Dt+S+" cannot be zero: "+b);if(E.hasOwnProperty(S="CRYPTO"))if(b=E[S],b===!!b)if(b)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))w=b;else throw w=!b,Error(Dt+"crypto unavailable");else w=b;else throw Error(Dt+S+" not true or false: "+b);if(E.hasOwnProperty(S="MODULO_MODE")&&(b=E[S],Ke(b,0,9,S),k=b),E.hasOwnProperty(S="POW_PRECISION")&&(b=E[S],Ke(b,0,ct,S),M=b),E.hasOwnProperty(S="FORMAT"))if(b=E[S],typeof b=="object")R=b;else throw Error(Dt+S+" not an object: "+b);if(E.hasOwnProperty(S="ALPHABET"))if(b=E[S],typeof b=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(b))I=b.slice(0,10)=="0123456789",C=b;else throw Error(Dt+S+" invalid: "+b)}else throw Error(Dt+"Object expected: "+E);return{DECIMAL_PLACES:f,ROUNDING_MODE:h,EXPONENTIAL_AT:[p,d],RANGE:[v,_],CRYPTO:w,MODULO_MODE:k,POW_PRECISION:M,FORMAT:R,ALPHABET:C}},A.isBigNumber=function(E){if(!E||E._isBigNumber!==!0)return!1;if(!A.DEBUG)return!0;var S,b,O=E.c,P=E.e,F=E.s;e:if({}.toString.call(O)=="[object Array]"){if((F===1||F===-1)&&P>=-ct&&P<=ct&&P===sn(P)){if(O[0]===0){if(P===0&&O.length===1)return!0;break e}if(S=(P+1)%xe,S<1&&(S+=xe),String(O[0]).length==S){for(S=0;S<O.length;S++)if(b=O[S],b<0||b>=Sn||b!==sn(b))break e;if(b!==0)return!0}}}else if(O===null&&P===null&&(F===null||F===1||F===-1))return!0;throw Error(Dt+"Invalid BigNumber: "+E)},A.maximum=A.max=function(){return $(arguments,-1)},A.minimum=A.min=function(){return $(arguments,1)},A.random=(function(){var E=9007199254740992,S=Math.random()*E&2097151?function(){return sn(Math.random()*E)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(b){var O,P,F,D,L,B=0,U=[],H=new A(l);if(b==null?b=f:Ke(b,0,ct),D=Yl(b/xe),w)if(crypto.getRandomValues){for(O=crypto.getRandomValues(new Uint32Array(D*=2));B<D;)L=O[B]*131072+(O[B+1]>>>11),L>=9e15?(P=crypto.getRandomValues(new Uint32Array(2)),O[B]=P[0],O[B+1]=P[1]):(U.push(L%1e14),B+=2);B=D/2}else if(crypto.randomBytes){for(O=crypto.randomBytes(D*=7);B<D;)L=(O[B]&31)*281474976710656+O[B+1]*1099511627776+O[B+2]*4294967296+O[B+3]*16777216+(O[B+4]<<16)+(O[B+5]<<8)+O[B+6],L>=9e15?crypto.randomBytes(7).copy(O,B):(U.push(L%1e14),B+=7);B=D/7}else throw w=!1,Error(Dt+"crypto unavailable");if(!w)for(;B<D;)L=S(),L<9e15&&(U[B++]=L%1e14);for(D=U[--B],b%=xe,D&&b&&(L=Jl[xe-b],U[B]=sn(D/L)*L);U[B]===0;U.pop(),B--);if(B<0)U=[F=0];else{for(F=-1;U[0]===0;U.splice(0,1),F-=xe);for(B=1,L=U[0];L>=10;L/=10,B++);B<xe&&(F-=xe-B)}return H.e=F,H.c=U,H}})(),A.sum=function(){for(var E=1,S=arguments,b=new A(S[0]);E<S.length;)b=b.plus(S[E++]);return b},r=(function(){var E="0123456789";function S(b,O,P,F){for(var D,L=[0],B,U=0,H=b.length;U<H;){for(B=L.length;B--;L[B]*=O);for(L[0]+=F.indexOf(b.charAt(U++)),D=0;D<L.length;D++)L[D]>P-1&&(L[D+1]==null&&(L[D+1]=0),L[D+1]+=L[D]/P|0,L[D]%=P)}return L.reverse()}return function(b,O,P,F,D){var L,B,U,H,j,Z,re,ce,le=b.indexOf("."),se=f,ue=h;for(le>=0&&(H=M,M=0,b=b.replace(".",""),ce=new A(O),Z=ce.pow(b.length-le),M=H,ce.c=S(pr(on(Z.c),Z.e,"0"),10,P,E),ce.e=ce.c.length),re=S(b,O,P,D?(L=C,E):(L=E,C)),U=H=re.length;re[--H]==0;re.pop());if(!re[0])return L.charAt(0);if(le<0?--U:(Z.c=re,Z.e=U,Z.s=F,Z=e(Z,ce,se,ue,P),re=Z.c,j=Z.r,U=Z.e),B=U+se+1,le=re[B],H=P/2,j=j||B<0||re[B+1]!=null,j=ue<4?(le!=null||j)&&(ue==0||ue==(Z.s<0?3:2)):le>H||le==H&&(ue==4||j||ue==6&&re[B-1]&1||ue==(Z.s<0?8:7)),B<1||!re[0])b=j?pr(L.charAt(1),-se,L.charAt(0)):L.charAt(0);else{if(re.length=B,j)for(--P;++re[--B]>P;)re[B]=0,B||(++U,re=[1].concat(re));for(H=re.length;!re[--H];);for(le=0,b="";le<=H;b+=L.charAt(re[le++]));b=pr(b,U,L.charAt(0))}return b}})(),e=(function(){function E(O,P,F){var D,L,B,U,H=0,j=O.length,Z=P%Rr,re=P/Rr|0;for(O=O.slice();j--;)B=O[j]%Rr,U=O[j]/Rr|0,D=re*B+U*Z,L=Z*B+D%Rr*Rr+H,H=(L/F|0)+(D/Rr|0)+re*U,O[j]=L%F;return H&&(O=[H].concat(O)),O}function S(O,P,F,D){var L,B;if(F!=D)B=F>D?1:-1;else for(L=B=0;L<F;L++)if(O[L]!=P[L]){B=O[L]>P[L]?1:-1;break}return B}function b(O,P,F,D){for(var L=0;F--;)O[F]-=L,L=O[F]<P[F]?1:0,O[F]=L*D+O[F]-P[F];for(;!O[0]&&O.length>1;O.splice(0,1));}return function(O,P,F,D,L){var B,U,H,j,Z,re,ce,le,se,ue,ke,Ne,X,qn,Te,fe,N,Pe=O.s==P.s?1:-1,Ge=O.c,Se=P.c;if(!Ge||!Ge[0]||!Se||!Se[0])return new A(!O.s||!P.s||(Ge?Se&&Ge[0]==Se[0]:!Se)?NaN:Ge&&Ge[0]==0||!Se?Pe*0:Pe/0);for(le=new A(Pe),se=le.c=[],U=O.e-P.e,Pe=F+U+1,L||(L=Sn,U=an(O.e/xe)-an(P.e/xe),Pe=Pe/xe|0),H=0;Se[H]==(Ge[H]||0);H++);if(Se[H]>(Ge[H]||0)&&U--,Pe<0)se.push(1),j=!0;else{for(qn=Ge.length,fe=Se.length,H=0,Pe+=2,Z=sn(L/(Se[0]+1)),Z>1&&(Se=E(Se,Z,L),Ge=E(Ge,Z,L),fe=Se.length,qn=Ge.length),X=fe,ue=Ge.slice(0,fe),ke=ue.length;ke<fe;ue[ke++]=0);N=Se.slice(),N=[0].concat(N),Te=Se[0],Se[1]>=L/2&&Te++;do{if(Z=0,B=S(Se,ue,fe,ke),B<0){if(Ne=ue[0],fe!=ke&&(Ne=Ne*L+(ue[1]||0)),Z=sn(Ne/Te),Z>1)for(Z>=L&&(Z=L-1),re=E(Se,Z,L),ce=re.length,ke=ue.length;S(re,ue,ce,ke)==1;)Z--,b(re,fe<ce?N:Se,ce,L),ce=re.length,B=1;else Z==0&&(B=Z=1),re=Se.slice(),ce=re.length;if(ce<ke&&(re=[0].concat(re)),b(ue,re,ke,L),ke=ue.length,B==-1)for(;S(Se,ue,fe,ke)<1;)Z++,b(ue,fe<ke?N:Se,ke,L),ke=ue.length}else B===0&&(Z++,ue=[0]);se[H++]=Z,ue[0]?ue[ke++]=Ge[X]||0:(ue=[Ge[X]],ke=1)}while((X++<qn||ue[0]!=null)&&Pe--);j=ue[0]!=null,se[0]||se.splice(0,1)}if(L==Sn){for(H=1,Pe=se[0];Pe>=10;Pe/=10,H++);q(le,F+(le.e=H+U*xe-1)+1,D,j)}else le.e=U,le.r=+j;return le}})();function Y(E,S,b,O){var P,F,D,L,B;if(b==null?b=h:Ke(b,0,8),!E.c)return E.toString();if(P=E.c[0],D=E.e,S==null)B=on(E.c),B=O==1||O==2&&(D<=p||D>=d)?Lo(B,D):pr(B,D,"0");else if(E=q(new A(E),S,b),F=E.e,B=on(E.c),L=B.length,O==1||O==2&&(S<=F||F<=p)){for(;L<S;B+="0",L++);B=Lo(B,F)}else if(S-=D,B=pr(B,F,"0"),F+1>L){if(--S>0)for(B+=".";S--;B+="0");}else if(S+=F-L,S>0)for(F+1==L&&(B+=".");S--;B+="0");return E.s<0&&P?"-"+B:B}function $(E,S){for(var b,O,P=1,F=new A(E[0]);P<E.length;P++)O=new A(E[P]),(!O.s||(b=si(F,O))===S||b===0&&F.s===S)&&(F=O);return F}function J(E,S,b){for(var O=1,P=S.length;!S[--P];S.pop());for(P=S[0];P>=10;P/=10,O++);return(b=O+b*xe-1)>_?E.c=E.e=null:b<v?E.c=[E.e=0]:(E.e=b,E.c=S),E}s=(function(){var E=/^(-?)0([xbo])(?=\w[\w.]*$)/i,S=/^([^.]+)\.$/,b=/^\.([^.]+)$/,O=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(F,D,L,B){var U,H=L?D:D.replace(P,"");if(O.test(H))F.s=isNaN(H)?null:H<0?-1:1;else{if(!L&&(H=H.replace(E,function(j,Z,re){return U=(re=re.toLowerCase())=="x"?16:re=="b"?2:8,!B||B==U?Z:j}),B&&(U=B,H=H.replace(S,"$1").replace(b,"0.$1")),D!=H))return new A(H,U);if(A.DEBUG)throw Error(Dt+"Not a"+(B?" base "+B:"")+" number: "+D);F.s=null}F.c=F.e=null}})();function q(E,S,b,O){var P,F,D,L,B,U,H,j=E.c,Z=Jl;if(j){e:{for(P=1,L=j[0];L>=10;L/=10,P++);if(F=S-P,F<0)F+=xe,D=S,B=j[U=0],H=sn(B/Z[P-D-1]%10);else if(U=Yl((F+1)/xe),U>=j.length)if(O){for(;j.length<=U;j.push(0));B=H=0,P=1,F%=xe,D=F-xe+1}else break e;else{for(B=L=j[U],P=1;L>=10;L/=10,P++);F%=xe,D=F-xe+P,H=D<0?0:sn(B/Z[P-D-1]%10)}if(O=O||S<0||j[U+1]!=null||(D<0?B:B%Z[P-D-1]),O=b<4?(H||O)&&(b==0||b==(E.s<0?3:2)):H>5||H==5&&(b==4||O||b==6&&(F>0?D>0?B/Z[P-D]:0:j[U-1])%10&1||b==(E.s<0?8:7)),S<1||!j[0])return j.length=0,O?(S-=E.e+1,j[0]=Z[(xe-S%xe)%xe],E.e=-S||0):j[0]=E.e=0,E;if(F==0?(j.length=U,L=1,U--):(j.length=U+1,L=Z[xe-F],j[U]=D>0?sn(B/Z[P-D]%Z[D])*L:0),O)for(;;)if(U==0){for(F=1,D=j[0];D>=10;D/=10,F++);for(D=j[0]+=L,L=1;D>=10;D/=10,L++);F!=L&&(E.e++,j[0]==Sn&&(j[0]=1));break}else{if(j[U]+=L,j[U]!=Sn)break;j[U--]=0,L=1}for(F=j.length;j[--F]===0;j.pop());}E.e>_?E.c=E.e=null:E.e<v&&(E.c=[E.e=0])}return E}function W(E){var S,b=E.e;return b===null?E.toString():(S=on(E.c),S=b<=p||b>=d?Lo(S,b):pr(S,b,"0"),E.s<0?"-"+S:S)}return u.absoluteValue=u.abs=function(){var E=new A(this);return E.s<0&&(E.s=1),E},u.comparedTo=function(E,S){return si(this,new A(E,S))},u.decimalPlaces=u.dp=function(E,S){var b,O,P,F=this;if(E!=null)return Ke(E,0,ct),S==null?S=h:Ke(S,0,8),q(new A(F),E+F.e+1,S);if(!(b=F.c))return null;if(O=((P=b.length-1)-an(this.e/xe))*xe,P=b[P])for(;P%10==0;P/=10,O--);return O<0&&(O=0),O},u.dividedBy=u.div=function(E,S){return e(this,new A(E,S),f,h)},u.dividedToIntegerBy=u.idiv=function(E,S){return e(this,new A(E,S),0,1)},u.exponentiatedBy=u.pow=function(E,S){var b,O,P,F,D,L,B,U,H,j=this;if(E=new A(E),E.c&&!E.isInteger())throw Error(Dt+"Exponent not an integer: "+W(E));if(S!=null&&(S=new A(S)),L=E.e>14,!j.c||!j.c[0]||j.c[0]==1&&!j.e&&j.c.length==1||!E.c||!E.c[0])return H=new A(Math.pow(+W(j),L?E.s*(2-Ao(E)):+W(E))),S?H.mod(S):H;if(B=E.s<0,S){if(S.c?!S.c[0]:!S.s)return new A(NaN);O=!B&&j.isInteger()&&S.isInteger(),O&&(j=j.mod(S))}else{if(E.e>9&&(j.e>0||j.e<-1||(j.e==0?j.c[0]>1||L&&j.c[1]>=24e7:j.c[0]<8e13||L&&j.c[0]<=9999975e7)))return F=j.s<0&&Ao(E)?-0:0,j.e>-1&&(F=1/F),new A(B?1/F:F);M&&(F=Yl(M/xe+2))}for(L?(b=new A(.5),B&&(E.s=1),U=Ao(E)):(P=Math.abs(+W(E)),U=P%2),H=new A(l);;){if(U){if(H=H.times(j),!H.c)break;F?H.c.length>F&&(H.c.length=F):O&&(H=H.mod(S))}if(P){if(P=sn(P/2),P===0)break;U=P%2}else if(E=E.times(b),q(E,E.e+1,1),E.e>14)U=Ao(E);else{if(P=+W(E),P===0)break;U=P%2}j=j.times(j),F?j.c&&j.c.length>F&&(j.c.length=F):O&&(j=j.mod(S))}return O?H:(B&&(H=l.div(H)),S?H.mod(S):F?q(H,M,h,D):H)},u.integerValue=function(E){var S=new A(this);return E==null?E=h:Ke(E,0,8),q(S,S.e+1,E)},u.isEqualTo=u.eq=function(E,S){return si(this,new A(E,S))===0},u.isFinite=function(){return!!this.c},u.isGreaterThan=u.gt=function(E,S){return si(this,new A(E,S))>0},u.isGreaterThanOrEqualTo=u.gte=function(E,S){return(S=si(this,new A(E,S)))===1||S===0},u.isInteger=function(){return!!this.c&&an(this.e/xe)>this.c.length-2},u.isLessThan=u.lt=function(E,S){return si(this,new A(E,S))<0},u.isLessThanOrEqualTo=u.lte=function(E,S){return(S=si(this,new A(E,S)))===-1||S===0},u.isNaN=function(){return!this.s},u.isNegative=function(){return this.s<0},u.isPositive=function(){return this.s>0},u.isZero=function(){return!!this.c&&this.c[0]==0},u.minus=function(E,S){var b,O,P,F,D=this,L=D.s;if(E=new A(E,S),S=E.s,!L||!S)return new A(NaN);if(L!=S)return E.s=-S,D.plus(E);var B=D.e/xe,U=E.e/xe,H=D.c,j=E.c;if(!B||!U){if(!H||!j)return H?(E.s=-S,E):new A(j?D:NaN);if(!H[0]||!j[0])return j[0]?(E.s=-S,E):new A(H[0]?D:h==3?-0:0)}if(B=an(B),U=an(U),H=H.slice(),L=B-U){for((F=L<0)?(L=-L,P=H):(U=B,P=j),P.reverse(),S=L;S--;P.push(0));P.reverse()}else for(O=(F=(L=H.length)<(S=j.length))?L:S,L=S=0;S<O;S++)if(H[S]!=j[S]){F=H[S]<j[S];break}if(F&&(P=H,H=j,j=P,E.s=-E.s),S=(O=j.length)-(b=H.length),S>0)for(;S--;H[b++]=0);for(S=Sn-1;O>L;){if(H[--O]<j[O]){for(b=O;b&&!H[--b];H[b]=S);--H[b],H[O]+=Sn}H[O]-=j[O]}for(;H[0]==0;H.splice(0,1),--U);return H[0]?J(E,H,U):(E.s=h==3?-1:1,E.c=[E.e=0],E)},u.modulo=u.mod=function(E,S){var b,O,P=this;return E=new A(E,S),!P.c||!E.s||E.c&&!E.c[0]?new A(NaN):!E.c||P.c&&!P.c[0]?new A(P):(k==9?(O=E.s,E.s=1,b=e(P,E,0,3),E.s=O,b.s*=O):b=e(P,E,0,k),E=P.minus(b.times(E)),!E.c[0]&&k==1&&(E.s=P.s),E)},u.multipliedBy=u.times=function(E,S){var b,O,P,F,D,L,B,U,H,j,Z,re,ce,le,se,ue=this,ke=ue.c,Ne=(E=new A(E,S)).c;if(!ke||!Ne||!ke[0]||!Ne[0])return!ue.s||!E.s||ke&&!ke[0]&&!Ne||Ne&&!Ne[0]&&!ke?E.c=E.e=E.s=null:(E.s*=ue.s,!ke||!Ne?E.c=E.e=null:(E.c=[0],E.e=0)),E;for(O=an(ue.e/xe)+an(E.e/xe),E.s*=ue.s,B=ke.length,j=Ne.length,B<j&&(ce=ke,ke=Ne,Ne=ce,P=B,B=j,j=P),P=B+j,ce=[];P--;ce.push(0));for(le=Sn,se=Rr,P=j;--P>=0;){for(b=0,Z=Ne[P]%se,re=Ne[P]/se|0,D=B,F=P+D;F>P;)U=ke[--D]%se,H=ke[D]/se|0,L=re*U+H*Z,U=Z*U+L%se*se+ce[F]+b,b=(U/le|0)+(L/se|0)+re*H,ce[F--]=U%le;ce[F]=b}return b?++O:ce.splice(0,1),J(E,ce,O)},u.negated=function(){var E=new A(this);return E.s=-E.s||null,E},u.plus=function(E,S){var b,O=this,P=O.s;if(E=new A(E,S),S=E.s,!P||!S)return new A(NaN);if(P!=S)return E.s=-S,O.minus(E);var F=O.e/xe,D=E.e/xe,L=O.c,B=E.c;if(!F||!D){if(!L||!B)return new A(P/0);if(!L[0]||!B[0])return B[0]?E:new A(L[0]?O:P*0)}if(F=an(F),D=an(D),L=L.slice(),P=F-D){for(P>0?(D=F,b=B):(P=-P,b=L),b.reverse();P--;b.push(0));b.reverse()}for(P=L.length,S=B.length,P-S<0&&(b=B,B=L,L=b,S=P),P=0;S;)P=(L[--S]=L[S]+B[S]+P)/Sn|0,L[S]=Sn===L[S]?0:L[S]%Sn;return P&&(L=[P].concat(L),++D),J(E,L,D)},u.precision=u.sd=function(E,S){var b,O,P,F=this;if(E!=null&&E!==!!E)return Ke(E,1,ct),S==null?S=h:Ke(S,0,8),q(new A(F),E,S);if(!(b=F.c))return null;if(P=b.length-1,O=P*xe+1,P=b[P]){for(;P%10==0;P/=10,O--);for(P=b[0];P>=10;P/=10,O++);}return E&&F.e+1>O&&(O=F.e+1),O},u.shiftedBy=function(E){return Ke(E,-Hl,Hl),this.times("1e"+E)},u.squareRoot=u.sqrt=function(){var E,S,b,O,P,F=this,D=F.c,L=F.s,B=F.e,U=f+4,H=new A("0.5");if(L!==1||!D||!D[0])return new A(!L||L<0&&(!D||D[0])?NaN:D?F:1/0);if(L=Math.sqrt(+W(F)),L==0||L==1/0?(S=on(D),(S.length+B)%2==0&&(S+="0"),L=Math.sqrt(+S),B=an((B+1)/2)-(B<0||B%2),L==1/0?S="5e"+B:(S=L.toExponential(),S=S.slice(0,S.indexOf("e")+1)+B),b=new A(S)):b=new A(L+""),b.c[0]){for(B=b.e,L=B+U,L<3&&(L=0);;)if(P=b,b=H.times(P.plus(e(F,P,U,1))),on(P.c).slice(0,L)===(S=on(b.c)).slice(0,L))if(b.e<B&&--L,S=S.slice(L-3,L+1),S=="9999"||!O&&S=="4999"){if(!O&&(q(P,P.e+f+2,0),P.times(P).eq(F))){b=P;break}U+=4,L+=4,O=1}else{(!+S||!+S.slice(1)&&S.charAt(0)=="5")&&(q(b,b.e+f+2,1),E=!b.times(b).eq(F));break}}return q(b,b.e+f+1,h,E)},u.toExponential=function(E,S){return E!=null&&(Ke(E,0,ct),E++),Y(this,E,S,1)},u.toFixed=function(E,S){return E!=null&&(Ke(E,0,ct),E=E+this.e+1),Y(this,E,S)},u.toFormat=function(E,S,b){var O,P=this;if(b==null)E!=null&&S&&typeof S=="object"?(b=S,S=null):E&&typeof E=="object"?(b=E,E=S=null):b=R;else if(typeof b!="object")throw Error(Dt+"Argument not an object: "+b);if(O=P.toFixed(E,S),P.c){var F,D=O.split("."),L=+b.groupSize,B=+b.secondaryGroupSize,U=b.groupSeparator||"",H=D[0],j=D[1],Z=P.s<0,re=Z?H.slice(1):H,ce=re.length;if(B&&(F=L,L=B,B=F,ce-=F),L>0&&ce>0){for(F=ce%L||L,H=re.substr(0,F);F<ce;F+=L)H+=U+re.substr(F,L);B>0&&(H+=U+re.slice(F)),Z&&(H="-"+H)}O=j?H+(b.decimalSeparator||"")+((B=+b.fractionGroupSize)?j.replace(new RegExp("\\d{"+B+"}\\B","g"),"$&"+(b.fractionGroupSeparator||"")):j):H}return(b.prefix||"")+O+(b.suffix||"")},u.toFraction=function(E){var S,b,O,P,F,D,L,B,U,H,j,Z,re=this,ce=re.c;if(E!=null&&(L=new A(E),!L.isInteger()&&(L.c||L.s!==1)||L.lt(l)))throw Error(Dt+"Argument "+(L.isInteger()?"out of range: ":"not an integer: ")+W(L));if(!ce)return new A(re);for(S=new A(l),U=b=new A(l),O=B=new A(l),Z=on(ce),F=S.e=Z.length-re.e-1,S.c[0]=Jl[(D=F%xe)<0?xe+D:D],E=!E||L.comparedTo(S)>0?F>0?S:U:L,D=_,_=1/0,L=new A(Z),B.c[0]=0;H=e(L,S,0,1),P=b.plus(H.times(O)),P.comparedTo(E)!=1;)b=O,O=P,U=B.plus(H.times(P=U)),B=P,S=L.minus(H.times(P=S)),L=P;return P=e(E.minus(b),O,0,1),B=B.plus(P.times(U)),b=b.plus(P.times(O)),B.s=U.s=re.s,F=F*2,j=e(U,O,F,h).minus(re).abs().comparedTo(e(B,b,F,h).minus(re).abs())<1?[U,O]:[B,b],_=D,j},u.toNumber=function(){return+W(this)},u.toPrecision=function(E,S){return E!=null&&Ke(E,1,ct),Y(this,E,S,2)},u.toString=function(E){var S,b=this,O=b.s,P=b.e;return P===null?O?(S="Infinity",O<0&&(S="-"+S)):S="NaN":(E==null?S=P<=p||P>=d?Lo(on(b.c),P):pr(on(b.c),P,"0"):E===10&&I?(b=q(new A(b),f+P+1,h),S=pr(on(b.c),b.e,"0")):(Ke(E,2,C.length,"Base"),S=r(pr(on(b.c),P,"0"),10,E,O,!0)),O<0&&b.c[0]&&(S="-"+S)),S},u.valueOf=u.toJSON=function(){return W(this)},u._isBigNumber=!0,u[Symbol.toStringTag]="BigNumber",u[Symbol.for("nodejs.util.inspect.custom")]=u.valueOf,t!=null&&A.set(t),A}function an(t){var e=t|0;return t>0||t===e?e:e-1}function on(t){for(var e,r,s=1,u=t.length,l=t[0]+"";s<u;){for(e=t[s++]+"",r=xe-e.length;r--;e="0"+e);l+=e}for(u=l.length;l.charCodeAt(--u)===48;);return l.slice(0,u+1||1)}function si(t,e){var r,s,u=t.c,l=e.c,f=t.s,h=e.s,p=t.e,d=e.e;if(!f||!h)return null;if(r=u&&!u[0],s=l&&!l[0],r||s)return r?s?0:-h:f;if(f!=h)return f;if(r=f<0,s=p==d,!u||!l)return s?0:!u^r?1:-1;if(!s)return p>d^r?1:-1;for(h=(p=u.length)<(d=l.length)?p:d,f=0;f<h;f++)if(u[f]!=l[f])return u[f]>l[f]^r?1:-1;return p==d?0:p>d^r?1:-1}function Ke(t,e,r,s){if(t<e||t>r||t!==sn(t))throw Error(Dt+(s||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Ao(t){var e=t.c.length-1;return an(t.e/xe)==e&&t.c[e]%2!=0}function Lo(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function pr(t,e,r){var s,u;if(e<0){for(u=r+".";++e;u+=r);t=u+t}else if(s=t.length,++e>s){for(u=r,e-=s;--e;u+=r);t+=u}else e<s&&(t=t.slice(0,e)+"."+t.slice(e));return t}var Un=$d(),Z2=class{key;left=null;right=null;constructor(t){this.key=t}},Zs=class extends Z2{constructor(t){super(t)}},K2=class{size=0;modificationCount=0;splayCount=0;splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let r=null,s=null,u=null,l=null,f=e;const h=this.compare;let p;for(;;)if(p=h(f.key,t),p>0){let d=f.left;if(d==null||(p=h(d.key,t),p>0&&(f.left=d.right,d.right=f,f=d,d=f.left,d==null)))break;r==null?s=f:r.left=f,r=f,f=d}else if(p<0){let d=f.right;if(d==null||(p=h(d.key,t),p<0&&(f.right=d.left,d.left=f,f=d,d=f.right,d==null)))break;u==null?l=f:u.right=f,u=f,f=d}else break;return u!=null&&(u.right=f.left,f.left=l),r!=null&&(r.left=f.right,f.right=s),this.root!==f&&(this.root=f,this.splayCount++),p}splayMin(t){let e=t,r=e.left;for(;r!=null;){const s=r;e.left=s.right,s.right=e,e=s,r=e.left}return e}splayMax(t){let e=t,r=e.right;for(;r!=null;){const s=r;e.right=s.left,s.left=e,e=s,r=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let r=this.root;const s=r,u=r.left;if(this.size--,u==null)this.root=r.right;else{const l=r.right;r=this.splayMax(u),r.right=l,this.root=r}return this.modificationCount++,s}addNewRoot(t,e){this.size++,this.modificationCount++;const r=this.root;if(r==null){this.root=t;return}e<0?(t.left=r,t.right=r.right,r.right=null):(t.right=r,t.left=r.left,r.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},Co=class ca extends K2{root=null;compare;validKey;constructor(e,r){super(),this.compare=e??this.defaultCompare(),this.validKey=r??(s=>s!=null&&s!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const r of e)this.delete(r)}forEach(e){const r=this[Symbol.iterator]();let s;for(;s=r.next(),!s.done;)e(s.value,s.value,this)}add(e){const r=this.splay(e);return r!=0&&this.addNewRoot(new Zs(e),r),this}addAndReturn(e){const r=this.splay(e);return r!=0&&this.addNewRoot(new Zs(e),r),this.root.key}addAll(e){for(const r of e)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let u=s.right;for(;u!=null;)s=u,u=s.right;return s.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let u=s.left;for(;u!=null;)s=u,u=s.left;return s.key}retainAll(e){const r=new ca(this.compare,this.validKey),s=this.modificationCount;for(const u of e){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(u)&&this.splay(u)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const r=new ca(this.compare,this.validKey);for(const s of this)e.has(s)&&r.add(s);return r}difference(e){const r=new ca(this.compare,this.validKey);for(const s of this)e.has(s)||r.add(s);return r}union(e){const r=this.clone();return r.addAll(e),r}clone(){const e=new ca(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function r(u,l){let f,h;do{if(f=u.left,h=u.right,f!=null){const p=new Zs(f.key);l.left=p,r(f,p)}if(h!=null){const p=new Zs(h.key);l.right=p,u=h,l=p}}while(h!=null)}const s=new Zs(e.key);return r(e,s),s}toSet(){return this.clone()}entries(){return new eS(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Q2(this.wrap())}[Symbol.toStringTag]="[object Set]"},Xd=class{tree;path=new Array;modificationCount=null;splayCount;constructor(t){this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let r=this.tree.getRoot();for(;r!=null;)this.path.push(r),r=r.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},Q2=class extends Xd{getValue(t){return t.key}},eS=class extends Xd{getValue(t){return[t.key,t.key]}},Vd=t=>()=>t,$l=t=>{const e=t?(r,s)=>s.minus(r).abs().isLessThanOrEqualTo(t):Vd(!1);return(r,s)=>e(r,s)?0:r.comparedTo(s)};function tS(t){const e=t?(r,s,u,l,f)=>r.exponentiatedBy(2).isLessThanOrEqualTo(l.minus(s).exponentiatedBy(2).plus(f.minus(u).exponentiatedBy(2)).times(t)):Vd(!1);return(r,s,u)=>{const l=r.x,f=r.y,h=u.x,p=u.y,d=f.minus(p).times(s.x.minus(h)).minus(l.minus(h).times(s.y.minus(p)));return e(d,l,f,h,p)?0:d.comparedTo(0)}}var nS=t=>t,rS=t=>{if(t){const e=new Co($l(t)),r=new Co($l(t)),s=(l,f)=>f.addAndReturn(l),u=l=>({x:s(l.x,e),y:s(l.y,r)});return u({x:new Un(0),y:new Un(0)}),u}return nS},Xl=t=>({set:e=>{mr=Xl(e)},reset:()=>Xl(t),compare:$l(t),snap:rS(t),orient:tS(t)}),mr=Xl(),Ks=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),Vl=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;const r=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,s=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,u=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,l=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:r,y:u},ur:{x:s,y:l}}},No=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),Wd=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),Po=t=>Wd(t,t).sqrt(),iS=(t,e,r)=>{const s={x:e.x.minus(t.x),y:e.y.minus(t.y)},u={x:r.x.minus(t.x),y:r.y.minus(t.y)};return No(u,s).div(Po(u)).div(Po(s))},sS=(t,e,r)=>{const s={x:e.x.minus(t.x),y:e.y.minus(t.y)},u={x:r.x.minus(t.x),y:r.y.minus(t.y)};return Wd(u,s).div(Po(u)).div(Po(s))},jd=(t,e,r)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(r.minus(t.y))),y:r},Zd=(t,e,r)=>e.x.isZero()?null:{x:r,y:t.y.plus(e.y.div(e.x).times(r.minus(t.x)))},aS=(t,e,r,s)=>{if(e.x.isZero())return Zd(r,s,t.x);if(s.x.isZero())return Zd(t,e,r.x);if(e.y.isZero())return jd(r,s,t.y);if(s.y.isZero())return jd(t,e,r.y);const u=No(e,s);if(u.isZero())return null;const l={x:r.x.minus(t.x),y:r.y.minus(t.y)},f=No(l,e).div(u),h=No(l,s).div(u),p=t.x.plus(h.times(e.x)),d=r.x.plus(f.times(s.x)),v=t.y.plus(h.times(e.y)),_=r.y.plus(f.times(s.y)),w=p.plus(d).div(2),k=v.plus(_).div(2);return{x:w,y:k}},zn=class sm{point;isLeft;segment;otherSE;consumedBy;static compare(e,r){const s=sm.comparePoints(e.point,r.point);return s!==0?s:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:Ro.compare(e.segment,r.segment))}static comparePoints(e,r){return e.x.isLessThan(r.x)?-1:e.x.isGreaterThan(r.x)?1:e.y.isLessThan(r.y)?-1:e.y.isGreaterThan(r.y)?1:0}constructor(e,r){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const r=e.point.events;for(let s=0,u=r.length;s<u;s++){const l=r[s];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let r=0;r<e;r++){const s=this.point.events[r];if(s.segment.consumedBy===void 0)for(let u=r+1;u<e;u++){const l=this.point.events[u];l.consumedBy===void 0&&s.otherSE.point.events===l.otherSE.point.events&&s.segment.consume(l.segment)}}}getAvailableLinkedEvents(){const e=[];for(let r=0,s=this.point.events.length;r<s;r++){const u=this.point.events[r];u!==this&&!u.segment.ringOut&&u.segment.isInResult()&&e.push(u)}return e}getLeftmostComparator(e){const r=new Map,s=u=>{const l=u.otherSE;r.set(u,{sine:iS(this.point,e.point,l.point),cosine:sS(this.point,e.point,l.point)})};return(u,l)=>{r.has(u)||s(u),r.has(l)||s(l);const{sine:f,cosine:h}=r.get(u),{sine:p,cosine:d}=r.get(l);return f.isGreaterThanOrEqualTo(0)&&p.isGreaterThanOrEqualTo(0)?h.isLessThan(d)?1:h.isGreaterThan(d)?-1:0:f.isLessThan(0)&&p.isLessThan(0)?h.isLessThan(d)?-1:h.isGreaterThan(d)?1:0:p.isLessThan(f)?-1:p.isGreaterThan(f)?1:0}}},oS=class dc{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const r=[];for(let s=0,u=e.length;s<u;s++){const l=e[s];if(!l.isInResult()||l.ringOut)continue;let f=null,h=l.leftSE,p=l.rightSE;const d=[h],v=h.point,_=[];for(;f=h,h=p,d.push(h),h.point!==v;)for(;;){const w=h.getAvailableLinkedEvents();if(w.length===0){const R=d[0].point,C=d[d.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${C.x}, ${C.y}].`)}if(w.length===1){p=w[0].otherSE;break}let k=null;for(let R=0,C=_.length;R<C;R++)if(_[R].point===h.point){k=R;break}if(k!==null){const R=_.splice(k)[0],C=d.splice(R.index);C.unshift(C[0].otherSE),r.push(new dc(C.reverse()));continue}_.push({index:d.length,point:h.point});const M=h.getLeftmostComparator(f);p=w.sort(M)[0].otherSE;break}r.push(new dc(d))}return r}constructor(e){this.events=e;for(let r=0,s=e.length;r<s;r++)e[r].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const r=[e];for(let d=1,v=this.events.length-1;d<v;d++){const _=this.events[d].point,w=this.events[d+1].point;mr.orient(_,e,w)!==0&&(r.push(_),e=_)}if(r.length===1)return null;const s=r[0],u=r[1];mr.orient(s,e,u)===0&&r.shift(),r.push(r[0]);const l=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:r.length-1,h=this.isExteriorRing()?r.length:-1,p=[];for(let d=f;d!=h;d+=l)p.push([r[d].x.toNumber(),r[d].y.toNumber()]);return p}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let u=1,l=this.events.length;u<l;u++){const f=this.events[u];zn.compare(e,f)>0&&(e=f)}let r=e.segment.prevInResult(),s=r?r.prevInResult():null;for(;;){if(!r)return null;if(!s)return r.ringOut;if(s.ringOut!==r.ringOut)return s.ringOut?.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut?.enclosingRing();r=s.prevInResult(),s=r?r.prevInResult():null}}},Kd=class{exteriorRing;interiorRings;constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let r=0,s=this.interiorRings.length;r<s;r++){const u=this.interiorRings[r].getGeom();u!==null&&e.push(u)}return e}},uS=class{rings;polys;constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const s=this.polys[e].getGeom();s!==null&&t.push(s)}return t}_composePolys(t){const e=[];for(let r=0,s=t.length;r<s;r++){const u=t[r];if(!u.poly)if(u.isExteriorRing())e.push(new Kd(u));else{const l=u.enclosingRing();l?.poly||e.push(new Kd(l)),l?.poly?.addInterior(u)}}return e}},lS=class{queue;tree;segments;constructor(t,e=Ro.compare){this.queue=t,this.tree=new Co(e),this.segments=[]}process(t){const e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),r;t.isLeft&&this.tree.add(e);let s=e,u=e;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do u=this.tree.firstAfter(u);while(u!=null&&u.consumedBy!=null);if(t.isLeft){let l=null;if(s){const h=s.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(l=h),!s.isAnEndpoint(h))){const p=this._splitSafely(s,h);for(let d=0,v=p.length;d<v;d++)r.push(p[d])}}let f=null;if(u){const h=u.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(f=h),!u.isAnEndpoint(h))){const p=this._splitSafely(u,h);for(let d=0,v=p.length;d<v;d++)r.push(p[d])}}if(l!==null||f!==null){let h=null;l===null?h=f:f===null?h=l:h=zn.comparePoints(l,f)<=0?l:f,this.queue.delete(e.rightSE),r.push(e.rightSE);const p=e.split(h);for(let d=0,v=p.length;d<v;d++)r.push(p[d])}r.length>0?(this.tree.delete(e),r.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&u){const l=s.getIntersection(u);if(l!==null){if(!s.isAnEndpoint(l)){const f=this._splitSafely(s,l);for(let h=0,p=f.length;h<p;h++)r.push(f[h])}if(!u.isAnEndpoint(l)){const f=this._splitSafely(u,l);for(let h=0,p=f.length;h<p;h++)r.push(f[h])}}}this.tree.delete(e)}return r}_splitSafely(t,e){this.tree.delete(t);const r=t.rightSE;this.queue.delete(r);const s=t.split(e);return s.push(r),t.consumedBy===void 0&&this.tree.add(t),s}},cS=class{type;numMultiPolys;run(t,e,r){Qs.type=t;const s=[new ep(e,!0)];for(let d=0,v=r.length;d<v;d++)s.push(new ep(r[d],!1));if(Qs.numMultiPolys=s.length,Qs.type==="difference"){const d=s[0];let v=1;for(;v<s.length;)Vl(s[v].bbox,d.bbox)!==null?v++:s.splice(v,1)}if(Qs.type==="intersection")for(let d=0,v=s.length;d<v;d++){const _=s[d];for(let w=d+1,k=s.length;w<k;w++)if(Vl(_.bbox,s[w].bbox)===null)return[]}const u=new Co(zn.compare);for(let d=0,v=s.length;d<v;d++){const _=s[d].getSweepEvents();for(let w=0,k=_.length;w<k;w++)u.add(_[w])}const l=new lS(u);let f=null;for(u.size!=0&&(f=u.first(),u.delete(f));f;){const d=l.process(f);for(let v=0,_=d.length;v<_;v++){const w=d[v];w.consumedBy===void 0&&u.add(w)}u.size!=0?(f=u.first(),u.delete(f)):f=null}mr.reset();const h=oS.factory(l.segments);return new uS(h).getGeom()}},Qs=new cS,Oo=Qs,hS=0,Ro=class Wo{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,r){const s=e.leftSE.point.x,u=r.leftSE.point.x,l=e.rightSE.point.x,f=r.rightSE.point.x;if(f.isLessThan(s))return 1;if(l.isLessThan(u))return-1;const h=e.leftSE.point.y,p=r.leftSE.point.y,d=e.rightSE.point.y,v=r.rightSE.point.y;if(s.isLessThan(u)){if(p.isLessThan(h)&&p.isLessThan(d))return 1;if(p.isGreaterThan(h)&&p.isGreaterThan(d))return-1;const _=e.comparePoint(r.leftSE.point);if(_<0)return 1;if(_>0)return-1;const w=r.comparePoint(e.rightSE.point);return w!==0?w:-1}if(s.isGreaterThan(u)){if(h.isLessThan(p)&&h.isLessThan(v))return-1;if(h.isGreaterThan(p)&&h.isGreaterThan(v))return 1;const _=r.comparePoint(e.leftSE.point);if(_!==0)return _;const w=e.comparePoint(r.rightSE.point);return w<0?1:w>0?-1:1}if(h.isLessThan(p))return-1;if(h.isGreaterThan(p))return 1;if(l.isLessThan(f)){const _=r.comparePoint(e.rightSE.point);if(_!==0)return _}if(l.isGreaterThan(f)){const _=e.comparePoint(r.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!l.eq(f)){const _=d.minus(h),w=l.minus(s),k=v.minus(p),M=f.minus(u);if(_.isGreaterThan(w)&&k.isLessThan(M))return 1;if(_.isLessThan(w)&&k.isGreaterThan(M))return-1}return l.isGreaterThan(f)?1:l.isLessThan(f)||d.isLessThan(v)?-1:d.isGreaterThan(v)?1:e.id<r.id?-1:e.id>r.id?1:0}constructor(e,r,s,u){this.id=++hS,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=s,this.windings=u}static fromRing(e,r,s){let u,l,f;const h=zn.comparePoints(e,r);if(h<0)u=e,l=r,f=1;else if(h>0)u=r,l=e,f=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const p=new zn(u,!0),d=new zn(l,!1);return new Wo(p,d,[s],[f])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(r)?e:r},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(r)?e:r}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return mr.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const r=this.bbox(),s=e.bbox(),u=Vl(r,s);if(u===null)return null;const l=this.leftSE.point,f=this.rightSE.point,h=e.leftSE.point,p=e.rightSE.point,d=Ks(r,h)&&this.comparePoint(h)===0,v=Ks(s,l)&&e.comparePoint(l)===0,_=Ks(r,p)&&this.comparePoint(p)===0,w=Ks(s,f)&&e.comparePoint(f)===0;if(v&&d)return w&&!_?f:!w&&_?p:null;if(v)return _&&l.x.eq(p.x)&&l.y.eq(p.y)?null:l;if(d)return w&&f.x.eq(h.x)&&f.y.eq(h.y)?null:h;if(w&&_)return null;if(w)return f;if(_)return p;const k=aS(l,this.vector(),h,e.vector());return k===null||!Ks(u,k)?null:mr.snap(k)}split(e){const r=[],s=e.events!==void 0,u=new zn(e,!0),l=new zn(e,!1),f=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(u);const h=new Wo(u,f,this.rings.slice(),this.windings.slice());return zn.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),zn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(u.checkForConsuming(),l.checkForConsuming()),r}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,s=this.windings.length;r<s;r++)this.windings[r]*=-1}consume(e){let r=this,s=e;for(;r.consumedBy;)r=r.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const u=Wo.compare(r,s);if(u!==0){if(u>0){const l=r;r=s,s=l}if(r.prev===s){const l=r;r=s,s=l}for(let l=0,f=s.rings.length;l<f;l++){const h=s.rings[l],p=s.windings[l],d=r.rings.indexOf(h);d===-1?(r.rings.push(h),r.windings.push(p)):r.windings[d]+=p}s.rings=null,s.windings=null,s.consumedBy=r,s.leftSE.consumedBy=r.leftSE,s.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,s=this._afterState.windings,u=this._afterState.multiPolys;for(let h=0,p=this.rings.length;h<p;h++){const d=this.rings[h],v=this.windings[h],_=r.indexOf(d);_===-1?(r.push(d),s.push(v)):s[_]+=v}const l=[],f=[];for(let h=0,p=r.length;h<p;h++){if(s[h]===0)continue;const d=r[h],v=d.poly;if(f.indexOf(v)===-1)if(d.isExterior)l.push(v);else{f.indexOf(v)===-1&&f.push(v);const _=l.indexOf(d.poly);_!==-1&&l.splice(_,1)}}for(let h=0,p=l.length;h<p;h++){const d=l[h].multiPoly;u.indexOf(d)===-1&&u.push(d)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Oo.type){case"union":{const s=e.length===0,u=r.length===0;this._isInResult=s!==u;break}case"intersection":{let s,u;e.length<r.length?(s=e.length,u=r.length):(s=r.length,u=e.length),this._isInResult=u===Oo.numMultiPolys&&s<u;break}case"xor":{const s=Math.abs(e.length-r.length);this._isInResult=s%2===1;break}case"difference":{const s=u=>u.length===1&&u[0].isSubject;this._isInResult=s(e)!==s(r);break}}return this._isInResult}},Qd=class{poly;isExterior;segments;bbox;constructor(t,e,r){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=mr.snap({x:new Un(t[0][0]),y:new Un(t[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let u=s;for(let l=1,f=t.length;l<f;l++){if(typeof t[l][0]!="number"||typeof t[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const h=mr.snap({x:new Un(t[l][0]),y:new Un(t[l][1])});h.x.eq(u.x)&&h.y.eq(u.y)||(this.segments.push(Ro.fromRing(u,h,this)),h.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=h.x),h.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=h.y),h.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=h.x),h.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=h.y),u=h)}(!s.x.eq(u.x)||!s.y.eq(u.y))&&this.segments.push(Ro.fromRing(u,s,this))}getSweepEvents(){const t=[];for(let e=0,r=this.segments.length;e<r;e++){const s=this.segments[e];t.push(s.leftSE),t.push(s.rightSE)}return t}},fS=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Qd(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,s=t.length;r<s;r++){const u=new Qd(t[r],this,!1);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){const s=this.interiorRings[e].getSweepEvents();for(let u=0,l=s.length;u<l;u++)t.push(s[u])}return t}},ep=class{isSubject;polys;bbox;constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new Un(Number.POSITIVE_INFINITY),y:new Un(Number.POSITIVE_INFINITY)},ur:{x:new Un(Number.NEGATIVE_INFINITY),y:new Un(Number.NEGATIVE_INFINITY)}};for(let r=0,s=t.length;r<s;r++){const u=new fS(t[r],this);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const s=this.polys[e].getSweepEvents();for(let u=0,l=s.length;u<l;u++)t.push(s[u])}return t}},gS=(t,...e)=>Oo.run("union",t,e),dS=(t,...e)=>Oo.run("difference",t,e);mr.set;function pS(t){const e=[];if(Lr(t,u=>{e.push(u.coordinates)}),e.length<2)throw new Error("Must have at least two features");const r=t.features[0].properties||{},s=dS(e[0],...e.slice(1));return s.length===0?null:s.length===1?hr(s[0],r):fl(s,r)}var tp=pS;function Wl(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&t.length===4)e=t;else if(Array.isArray(t)&&t.length===6)e=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")e=fr(t);else if(t.type==="FeatureCollection")e=fr(t);else throw new Error("invalid geojson");return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}var mS=class{constructor(t=9){this.tree=new Tl(t),this.tree.toBBox=Wl}insert(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:fr(t),this.tree.insert(t),this}load(t){var e=[];return Array.isArray(t)?t.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:fr(r),e.push(r)}):Dn(t,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:fr(r),e.push(r)}),this.tree.load(e),this}remove(t,e){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:fr(t),this.tree.remove(t,e),this}clear(){return this.tree.clear(),this}search(t){var e=this.tree.search(Wl(t));return rt(e)}collides(t){return this.tree.collides(Wl(t))}all(){const t=this.tree.all();return rt(t)}toJSON(){return this.tree.toJSON()}fromJSON(t){return this.tree.fromJSON(t),this}};function np(t){return new mS(t)}function vS(t,e){if(e=e??{},!Ya(e))throw new Error("options is invalid");var r=e.precision,s=e.coordinates,u=e.mutate;if(r=r==null||isNaN(r)?6:r,s=s==null||isNaN(s)?3:s,!t)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof s!="number")throw new Error("<coordinates> must be a number");(u===!1||u===void 0)&&(t=JSON.parse(JSON.stringify(t)));var l=Math.pow(10,r);return Ar(t,function(f){yS(f,l,s)}),t}function yS(t,e,r){t.length>r&&t.splice(r,t.length);for(var s=0;s<t.length;s++)t[s]=Math.round(t[s]*e)/e;return t}function _S(t){if(!t)throw new Error("geojson is required");const e=[];return Cr(t,r=>{ES(r,e)}),rt(e)}function ES(t,e){let r=[];const s=t.geometry;if(s!==null){switch(s.type){case"Polygon":r=Ht(s);break;case"LineString":r=[Ht(s)]}r.forEach(u=>{wS(u,t.properties).forEach(f=>{f.id=e.length,e.push(f)})})}}function wS(t,e){const r=[];return t.reduce((s,u)=>{const l=Tr([s,u],e);return l.bbox=xS(s,u),r.push(l),u}),r}function xS(t,e){const r=t[0],s=t[1],u=e[0],l=e[1],f=r<u?r:u,h=s<l?s:l,p=r>u?r:u,d=s>l?s:l;return[f,h,p,d]}var kS=Object.defineProperty,SS=Object.defineProperties,MS=Object.getOwnPropertyDescriptors,rp=Object.getOwnPropertySymbols,IS=Object.prototype.hasOwnProperty,bS=Object.prototype.propertyIsEnumerable,ip=(t,e,r)=>e in t?kS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,TS=(t,e)=>{for(var r in e||(e={}))IS.call(e,r)&&ip(t,r,e[r]);if(rp)for(var r of rp(e))bS.call(e,r)&&ip(t,r,e[r]);return t},AS=(t,e)=>SS(t,MS(e));function LS(t,e,r={}){if(!t||!e)throw new Error("lines and inputPoint are required arguments");const s=tt(e);let u=kn([1/0,1/0],{lineStringIndex:-1,segmentIndex:-1,totalDistance:-1,lineDistance:-1,segmentDistance:-1,pointDistance:1/0,multiFeatureIndex:-1,index:-1,location:-1,dist:1/0}),l=0,f=0,h=-1;return Cr(t,function(p,d,v){h!==v&&(h=v,f=0);const _=Ht(p),w=_.length-2;for(let k=0;k<_.length-1;k++){const M=kn(_[k]),R=tt(M),C=kn(_[k+1]),I=tt(C),A=ei(M,C,r);let Y,$;I[0]===s[0]&&I[1]===s[1]?[Y,$]=[I,!0]:R[0]===s[0]&&R[1]===s[1]?[Y,$]=[R,!1]:[Y,$]=PS(R,I,s);const J=ei(e,Y,r);if(J<u.properties.pointDistance){const q=ei(M,Y,r);u=kn(Y,{lineStringIndex:v,segmentIndex:$&&k+1<=w?k+1:k,totalDistance:l+q,lineDistance:f+q,segmentDistance:q,pointDistance:J,multiFeatureIndex:-1,index:-1,location:-1,dist:1/0}),u.properties=AS(TS({},u.properties),{multiFeatureIndex:u.properties.lineStringIndex,index:u.properties.segmentIndex,location:u.properties.totalDistance,dist:u.properties.pointDistance})}l+=A,f+=A}}),u}function ai(t,e){const[r,s,u]=t,[l,f,h]=e;return r*l+s*f+u*h}function ea(t,e){const[r,s,u]=t,[l,f,h]=e;return[s*h-u*f,u*l-r*h,r*f-s*l]}function CS(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))}function sp(t){const e=CS(t);return[t[0]/e,t[1]/e,t[2]/e]}function jl(t){const e=ut(t[1]),r=ut(t[0]);return[Math.cos(e)*Math.cos(r),Math.cos(e)*Math.sin(r),Math.sin(e)]}function NS(t){const[e,r,s]=t,u=Math.min(Math.max(s,-1),1),l=Qr(Math.asin(u));return[Qr(Math.atan2(r,e)),l]}function PS(t,e,r){const s=jl(t),u=jl(e),l=jl(r),f=ea(s,u);if(f[0]===0&&f[1]===0&&f[2]===0)return ai(s,u)>0?[[...e],!0]:[[...r],!1];const h=ea(f,l);if(h[0]===0&&h[1]===0&&h[2]===0)return[[...e],!0];const p=ea(h,f),d=sp(p),v=[-d[0],-d[1],-d[2]],_=ai(l,d)>ai(l,v)?d:v,w=sp(f),k=ai(ea(s,_),w),M=ai(ea(_,u),w);return k>=0&&M>=0?[NS(_),!1]:ai(s,l)>ai(u,l)?[[...t],!1]:[[...e],!0]}function OS(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");const r=fg(t),s=fg(e);if(r!=="LineString")throw new Error("line must be LineString");if(s==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(s==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var u=vS(e,{precision:7});switch(t.type!=="Feature"&&(t=nn(t)),s){case"Point":return Zl(t,u);case"MultiPoint":return ap(t,u);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ap(t,Ws(t,u,{ignoreSelfIntersections:!0}))}}function ap(t,e){var r=[],s=np();return Cr(e,function(u){if(r.forEach(function(h,p){h.id=p}),!r.length)r=Zl(t,u).features,s.load(rt(r));else{var l=s.search(u);if(l.features.length){var f=op(u,l);r=r.filter(function(h){return h.id!==f.id}),s.remove(f),Dn(Zl(f,u),function(h){r.push(h),s.insert(h)})}}}),rt(r)}function Zl(t,e){var r=[],s=Ht(t)[0],u=Ht(t)[t.geometry.coordinates.length-1];if(Kl(s,tt(e))||Kl(u,tt(e)))return rt([t]);var l=np(),f=_S(t);l.load(f);var h=l.search(e);if(!h.features.length)return rt([t]);var p=op(e,h),d=[s],v=mx(f,function(_,w,k){var M=Ht(w)[1],R=tt(e);return k===p.id?(_.push(R),r.push(Tr(_)),Kl(R,M)?[R]:[R,M]):(_.push(M),_)},d);return v.length>1&&r.push(Tr(v)),rt(r)}function op(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var r,s=1/0;return Dn(e,function(u){var l=LS(u,t),f=l.properties.dist;f<s&&(r=u,s=f)}),r}function Kl(t,e){return t[0]===e[0]&&t[1]===e[1]}var up=OS;class RS extends ri{mode="cut";lineDrawer=new io(this.gm,{snappingMarkers:"first",targetShape:"polygon"});cutShapesAllowed=["circle","ellipse","line","rectangle","polygon"];eventHandlers={[`${ae}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)};onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.cutPolygonFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return Xe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}cutPolygonFinished(e){this.lineDrawer.endShape();const r=bl(e.geoJson),s=this.getBBoxFeaturesByPolygon(r);this.cutFeaturesByPolygon(s,r)}getBBoxFeaturesByPolygon(e){const r=El(e),s=this.gm.mapAdapter.coordBoundsToScreenBounds(r);return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:s,sourceNames:[K.main]})}cutFeaturesByPolygon(e,r){e.forEach(s=>{if(s.getShapeProperty("disableEdit")!==!0){if(js(s.getGeoJson(),r)){this.gm.features.delete(s),this.fireFeatureRemovedEvent(s);return}if(Hd(s.getGeoJson(),r)&&this.cutShapesAllowed.includes(s.shape)){if(s.shape==="line"){this.cutLineFeatureByPolygon(s,r);return}this.cutPolygonFeatureByPolygon(s.id,r)}}})}cutLineFeatureByPolygon(e,r){const s=e.getGeoJson(),u=O2(this.gm.mapAdapter,r);let l=!1,f=[];if(u){if(s.geometry.type==="MultiLineString")s.geometry.coordinates.forEach(h=>{if(js(Tr(h),r))return;const p=up(Tr(h),r);if(p.features.length===0){f.push(h);return}p.features.filter(d=>!js(d,u)).forEach(d=>{l=!0,f.push(d.geometry.coordinates)})});else if(s.geometry.type==="LineString"){const h=up(s,r);f=h.features.filter(p=>!js(p,u)&&p.geometry.type==="LineString").map(p=>p.geometry.coordinates),h.features.length>0&&(l=!0)}l&&f.length&&(f.length===1?e.updateGeoJsonGeometry({type:"LineString",coordinates:f[0]}):e.updateGeoJsonGeometry({type:"MultiLineString",coordinates:f}),this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:[e]}))}}cutPolygonFeatureByPolygon(e,r){const s=this.gm.features.get(K.main,e);if(!s){ne.warn("cutPolygonFeatureByPolygon: featureData not found",e);return}s.convertToPolygon();const u=s.getGeoJson(),l=this.getGeoJsonDifference(u,r);l&&(s.updateGeoJsonGeometry(l.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[s],targetFeatures:[s]}))}getGeoJsonDifference(e,r){const s=rt([e,r]),u=tp(s);return u?u.type==="Feature"?u:(u.type==="FeatureCollection"&&ne.error("getGeoJsonDifference: FeatureCollection detected (not supported)",u),null):null}}class DS extends ri{mode="delete";allowedShapes=[...Rn];eventHandlers={click:this.onMouseClick.bind(this)};onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0}),this.gm.markerPointer.pauseSnapping()}onEndAction(){this.gm.markerPointer.resumeSnapping(),this.gm.markerPointer.disable()}onMouseClick(e){if(!Xe(e,{warning:!0}))return{next:!1};const r=this.getFeatureByMouseEvent({event:e,sourceNames:[K.main]});return r&&this.allowedShapes.includes(r.shape)&&(this.gm.features.delete(r),this.fireFeatureRemovedEvent(r)),{next:!1}}}class FS extends bo{mode="drag";onStartAction(){}onEndAction(){}handleGmEdit(e){return ni(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(this.previousLngLat||(this.previousLngLat=e.lngLatStart),this.moveFeature(e.featureData,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(e.featureData.changeSource({sourceName:K.temporary,atomic:!0}),this.flags.actionInProgress=!0,this.fireFeatureEditStartEvent({feature:e.featureData}),this.setCursorToPointer()):e.action==="marker_released"&&(this.previousLngLat=null,e.featureData.changeSource({sourceName:K.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData}),this.flags.actionInProgress=!1),{next:!0}):(ne.error("EditDrag.handleGmEdit: not an edit event",e),{next:!0})}}class GS extends bo{mode="rotate";allowedShapes=["line","rectangle","polygon","ellipse"];convertFeaturesTypes=["rectangle"];shapeRotateHandlers={marker:this.rotateFeature.bind(this),circle:this.rotateFeature.bind(this),circle_marker:this.rotateFeature.bind(this),text_marker:this.rotateFeature.bind(this),line:this.rotateFeature.bind(this),rectangle:this.rotateFeature.bind(this),polygon:this.rotateFeature.bind(this),ellipse:this.rotateEllipse.bind(this)};onStartAction(){}onEndAction(){}handleGmEdit(e){return ni(e)?this.isFeatureAllowed(e)?{next:!0}:e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(e.markerData?.type==="vertex"?this.moveVertex(e):this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(e.featureData.changeSource({sourceName:K.temporary,atomic:!0}),this.setCursorToPointer(),this.flags.actionInProgress=!0,this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(e.featureData.changeSource({sourceName:K.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData}),this.flags.actionInProgress=!1),{next:!0}):(ne.error("EditChange.handleGmEdit: not an edit event",e),{next:!1})}isFeatureAllowed(e){return"featureData"in e&&!this.allowedShapes.includes(e.featureData.shape)}moveVertex(e){const r=e.featureData,s=this.shapeRotateHandlers[r.shape]?.(e)||null;s?(this.fireBeforeFeatureUpdate({features:[r],geoJsonFeatures:[s]}),this.updateFeatureGeoJson({featureData:r,featureGeoJson:s})&&this.convertFeaturesTypes.includes(r.shape)&&r.convertToPolygon()):ne.error("EditRotate.moveVertex: invalid geojson",s,e)}rotateEllipse(e){const{featureData:r}=e;if(r.shape!=="ellipse")return ne.error("EditRotate.rotateEllipse: invalid shape type",r),null;const s=r.getShapeProperty("center"),u=r.getShapeProperty("xSemiAxis"),l=r.getShapeProperty("ySemiAxis"),f=r.getShapeProperty("angle");if(!Array.isArray(s)||typeof u!="number"||typeof l!="number"||typeof f!="number")return ne.error("rotateEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",r),null;const h=this.calculateRotationAngle(s,e.lngLatStart,e.lngLatEnd,!1);return eo({center:s,xSemiAxis:u,ySemiAxis:l,angle:f+h})}rotateFeature(e){const r=e.featureData,s=Ut(r.getGeoJson()),u=Ka(pl(s)),l=this.calculateRotationAngle(u,e.lngLatStart,e.lngLatEnd);return s.geometry=bx(s,l,{pivot:u}).geometry,s}calculateRotationAngle(e,r,s,u=!0){const l=Ja(e,r),h=Ja(e,s)-l;return u?(h+360)%360:h}}const Do={drag:FS,change:q2,rotate:GS,scale:null,copy:null,cut:RS,split:null,union:null,difference:null,line_simplification:null,lasso:null,delete:DS},BS=(t,e)=>Do[e]?new Do[e](t):(ne.error(`Edit "${e}" is not available`),null);class US extends Ua{eventHandlers={[`${ae}:edit`]:this.handleEditEvent.bind(this)};constructor(e,r){super(e),r.attachEvents(this.eventHandlers)}handleEditEvent(e){if(!ni(e))return{next:!0};const r=`${e.actionType}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){if(r.action!=="mode_start")return;const s=BS(this.gm,r.mode);s&&(e in this.gm.actionInstances&&ne.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=s,s.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof ri?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}": `,r)}}class lp extends gr{mode="shape_markers";pinEnabled=this.gm.options.controls.helper.pin?.active||!1;previousPosition=null;activeMarker=null;activeFeatureData=null;sharedMarkers=[];allowedShapes=["circle","line","rectangle","polygon","ellipse"];edgeMarkersAllowed=!1;edgeMarkerAllowedShapes=["line","rectangle","polygon"];shapeMarkerAllowedModes=["drag","change","cut","split"];eventHandlers={[`${ae}:draw`]:this.handleGmDraw.bind(this),[`${ae}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this),mousemove:this.onMouseMove.bind(this),touchmove:this.onMouseMove.bind(this),contextmenu:this.onMouseRightButtonClick.bind(this)};throttledMethods=Nr({sendMarkerMoveEvent:this.sendMarkerMoveEvent,sendMarkerRightClickEvent:this.sendMarkerRightClickEvent},this,this.gm.options.settings.throttlingDelay);debouncedMethods=Hx({refreshMarkers:this.refreshMarkers},this,this.gm.options.settings.throttlingDelay*10);get pinHelperInstance(){return this.pinEnabled&&Object.values(this.gm.actionInstances).find(Kx)||null}onStartAction(){this.isShapeMarkerAllowed()&&this.gm.markerPointer.enable({invisibleMarker:!0}),this.edgeMarkersAllowed=this.gm.getActiveEditModes().includes("change"),this.addMarkers()}onEndAction(){this.gm.markerPointer.disable(),this.removeMarkers()}setPin(e){this.pinEnabled=e}onMouseDown(e){const r=["mousedown","touchstart"];if(!Xe(e,{warning:!0})||!r.includes(e.type)||Vx(e))return{next:!0};if(e.type==="mousedown"&&e.originalEvent.button!==0)return{next:!0};const s=this.getFeatureMarkerByMouseEvent(e);return this.activeMarker=s||null,this.activeFeatureData=s?.instance.parent||null,this.activeMarker&&this.activeFeatureData?(this.previousPosition=ql(this.activeMarker.instance),this.gm.mapAdapter.setDragPan(!1),this.activeMarker.type==="edge"&&this.sendMarkerEvent("edge_marker_click",this.activeFeatureData,this.activeMarker),this.pinEnabled&&this.pinHelperInstance?(this.sharedMarkers=this.pinHelperInstance.getSharedMarkers(this.activeMarker.position.coordinate),this.sharedMarkers.forEach(u=>this.snappingHelper?.addExcludedFeature(u.featureData))):this.snappingHelper?.addExcludedFeature(this.activeFeatureData),this.sendMarkerEvent("marker_captured",this.activeFeatureData,this.activeMarker),{next:!1}):{next:!0}}onMouseUp(){if(!this.activeMarker)return{next:!0};const e={featureData:this.activeFeatureData,markerData:this.activeMarker};return this.activeMarker=null,this.activeFeatureData=null,this.sharedMarkers=[],this.snappingHelper?.clearExcludedFeatures(),this.previousPosition=null,this.gm.mapAdapter.setDragPan(!0),e.featureData&&e.markerData?(this.sendMarkerEvent("marker_released",e.featureData,e.markerData),{next:!1}):(ne.debug("ShapeMarkersHelper.onMouseUp: no active marker or featureData",e),{next:!0})}onMouseMove(e){return!this.activeMarker||!Xe(e,{warning:!0})?{next:!0}:(this.throttledMethods.sendMarkerMoveEvent(e),{next:!1})}onMouseRightButtonClick(e){if(!Xe(e,{warning:!0}))return{next:!0};const r=this.getFeatureMarkerByMouseEvent(e);return r&&r.instance.parent?(this.throttledMethods.sendMarkerRightClickEvent(r.instance.parent,r),{next:!1}):{next:!0}}isShapeMarkerAllowed(){return w1(this.shapeMarkerAllowedModes,this.gm.getActiveEditModes()).length>0}convertToVertexMarker(e){if(e.type==="edge"&&e.instance.parent){const r=e.position,s=e.instance.parent;this.removeMarker(e);const u=this.createMarker({type:"vertex",positionData:r,parentFeature:s}),l=s.getGeoJson(),f=Tg(l,r.coordinate);if(f){const h=f.path.join("."),p=s.markers.get(h);return p&&this.removeMarker(p),s.markers.set(h,u),u}}return ne.error("ShapeMarkersHelper.convertToVertexMarker: invalid marker type",e),e}getFeatureMarkerByMouseEvent(e){const r=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[K.main]});if(r?.parent?.markers){const s=G1(r.parent.markers,u=>u.instance===r);if(s?.type!=="dom")return s}return null}addMarkers(){this.gm.features.forEach(e=>{if(!e||!this.allowedShapes.includes(e.shape)||e.getShapeProperty("disableEdit")===!0)return;this.addCenterMarker(e);const r=this.getAllShapeSegments(e),s=this.getEndMarkerIndexes(e);r.forEach((u,l)=>{if(this.isMarkerIndexAllowed(e.shape,l,r.length)){const h=this.createOrUpdateVertexMarker(u.segment.start,e);if(e.markers.set(h.markerKey,h.markerData),s.has(l)){const p=this.createOrUpdateVertexMarker(u.segment.end,e);e.markers.set(p.markerKey,p.markerData)}}if(this.isEdgeMarkerAllowed(e)){const h=this.createOrUpdateEdgeMarker(u,e);e.markers.set(h.markerKey,h.markerData)}})})}addCenterMarker(e){const r=e.getShapeProperty("center");if(r){const s=this.createMarker({type:"center",positionData:{path:[],coordinate:r},parentFeature:e});e.markers.set("center",s)}}getAllShapeSegments(e){const r=e.getGeoJson(),s=[];return ja(r,(u,l)=>{s.push({segment:u,middle:this.getSegmentMiddlePosition(u),edgeMarkerKey:this.getEdgeMarkerKey(l)})}),s}isEdgeMarkerAllowed(e){return this.edgeMarkersAllowed&&this.edgeMarkerAllowedShapes.includes(e.shape)}isMarkerIndexAllowed(e,r,s){const u=Math.floor(s/4);return e==="circle"?(r+u/2)%u===0:e==="ellipse"?r%u===0:!0}getEdgeMarkerKey(e){return`edge.${e}`}getEndMarkerIndexes(e){const r=e.getGeoJson().geometry;return e.shape!=="line"||!["LineString","MultiLineString"].includes(r.type)?new Set:r.type==="MultiLineString"?r.coordinates.reduce((u,l)=>(u.indexes.add(u.sum+l.length-2),u.sum+=l.length-1,u),{sum:0,indexes:new Set}).indexes:new Set([r.coordinates.length-2])}getSegmentMiddlePosition(e){const r=this.gm.mapAdapter.project(e.start.coordinate),s=this.gm.mapAdapter.project(e.end.coordinate),u=[(r[0]+s[0])/2,(r[1]+s[1])/2],l=e.start.path.slice(0,e.start.path.length-1).concat([-1]);return{coordinate:this.gm.mapAdapter.unproject(u),path:l}}removeMarkers(){this.gm.features.forEach((e,r)=>{const s=this.gm.features.get(K.main,r);s&&(s.markers.forEach(u=>{u.type!=="dom"?this.gm.features.delete(u.instance):ne.error("Non a FeatureData marker",u)}),s.markers=new Map)})}removeMarker(e){if(e.type==="dom"){ne.error("Wrong marker type",e);return}const r=e.instance.parent;if(!r){ne.error("Missing parent feature data",e);return}try{r.markers.forEach((s,u)=>{if(s===e)throw this.gm.features.delete(s.instance),r.markers.delete(u),new Error("break")})}catch{}}handleGmDraw(e){return ro(e)?(["feature_created","mode_start"].includes(e.action)&&this.debouncedMethods.refreshMarkers(),{next:!0}):(ne.error("ShapeMarkersHelper.handleGmDraw: not a draw event",e),{next:!0})}refreshMarkers(){this.gm.options.isModeEnabled("helper","shape_markers")&&(this.removeMarkers(),this.addMarkers())}handleGmEdit(e){return ni(e)?(e.action==="feature_updated"&&this.handleShapeUpdate(e),{next:!0}):(ne.error("ShapeMarkersHelper.handleGmEdit: not an edit event",e),{next:!0})}handleShapeUpdate(e){const r=e.targetFeatures[0];if(!r){ne.error("ShapeMarkersHelper.handleShapeUpdate: no featureData",e);return}this.activeMarker?.type==="edge"&&(this.activeMarker=this.convertToVertexMarker(this.activeMarker));const s=this.getAllShapeSegments(r),u=new Set(r.markers.keys()),l=this.getEndMarkerIndexes(r);s.forEach((f,h)=>{if(this.isMarkerIndexAllowed(r.shape,h,s.length)){const d=this.createOrUpdateVertexMarker(f.segment.start,r);if(u.delete(d.markerKey),l.has(h)){const v=this.createOrUpdateVertexMarker(f.segment.end,r);u.delete(v.markerKey)}}if(this.isEdgeMarkerAllowed(r)){const d=this.createOrUpdateEdgeMarker(f,r);u.delete(d.markerKey)}}),this.updateCenterMarkerPosition(r),u.delete("center"),u.forEach(f=>{const h=r.markers.get(f);h&&h.type!=="dom"?this.gm.features.delete(h.instance):ne.error("Non a FeatureData marker"),r.markers.delete(f)})}createOrUpdateVertexMarker(e,r){const s=e.path.join(".");let u=r.markers.get(s)||null;if(u&&u?.type!=="vertex")throw new Error(`Invalid marker type "${u?.type}" for edge marker`);return u?(yl(u.position.coordinate,e.coordinate)||this.gm.features.updateMarkerFeaturePosition(u.instance,e.coordinate),u.position=e):(u=this.createMarker({type:"vertex",positionData:e,parentFeature:r}),r.markers.set(s,u)),{markerKey:s,markerData:u}}createOrUpdateEdgeMarker(e,r){let s=r.markers.get(e.edgeMarkerKey)||null;if(s&&s?.type!=="edge")throw new Error(`Invalid marker type "${s?.type}" for edge marker`);return s?(yl(s.position.coordinate,e.middle.coordinate)||s.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.middle.coordinate}),s.position=e.middle,s.segment=e.segment):(s=this.createMarker({type:"edge",positionData:e.middle,segment:e.segment,parentFeature:r}),r.markers.set(e.edgeMarkerKey,s)),{markerKey:e.edgeMarkerKey,markerData:s}}updateCenterMarkerPosition(e){const r=e.markers.get("center")||null,s=e.getShapeProperty("center");r&&r.type!=="dom"&&s&&(r.instance.updateGeoJsonGeometry({type:"Point",coordinates:s}),r.position.coordinate=s)}sendMarkerEvent(e,r,s){const u={name:`${ae}:edit:marker`,level:"system",actionType:"edit",mode:"change",action:e,featureData:r,markerData:s};this.gm.events.fire(`${ae}:edit`,u)}sendMarkerRightClickEvent(e,r){const s={name:`${ae}:edit:marker`,level:"system",actionType:"edit",mode:"change",action:"marker_right_click",featureData:e,markerData:r};this.gm.events.fire(`${ae}:edit`,s)}sendMarkerMoveEvent(e){const r=this.gm.markerPointer.marker?.getLngLat()||e.lngLat.toArray();this.activeMarker&&this.activeFeatureData&&(this.pinEnabled?this.sharedMarkers:[{markerData:this.activeMarker,featureData:this.activeFeatureData}]).forEach(u=>{if(this.previousPosition){const l={name:`${ae}:edit:marker_move`,level:"system",actionType:"edit",mode:"drag",action:"marker_move",featureData:u.featureData,markerData:u.markerData,lngLatStart:this.previousPosition,lngLatEnd:r};this.gm.events.fire(`${ae}:edit`,l)}}),this.previousPosition=r}createMarker({type:e,segment:r,positionData:s,parentFeature:u}){const l=s.coordinate,f=this.gm.features.createMarkerFeature({sourceName:u.sourceName,parentFeature:u,type:e,coordinate:l});if(!f)throw new Error(`Missine feature data for the "${e}" marker`);if(e==="edge"&&r)return{type:e,instance:f,position:Ut(s),segment:r};if(e==="vertex"||e==="center")return{type:e,instance:f,position:Ut(s)};throw new Error(`Invalid marker type "${e}" with segment: ${r}`)}}class zS extends gr{mode="snapping";tolerance=18;lineSnappingShapes=["circle","line","rectangle","polygon","snap_guide"];eventHandlers={};shapeSnappingHandlers={marker:this.getPointsSnapping.bind(this),circle:this.getLineSnapping.bind(this),circle_marker:this.getPointsSnapping.bind(this),text_marker:this.getPointsSnapping.bind(this),line:this.getLineSnapping.bind(this),rectangle:this.getLineSnapping.bind(this),polygon:this.getLineSnapping.bind(this),snap_guide:this.getLineSnapping.bind(this)};excludedFeature=new Set;customSnappingLngLats=new Map;customSnappingFeatures=new Set;onStartAction(){this.gm.markerPointer.setSnapping(!0)}onEndAction(){this.gm.markerPointer.setSnapping(!1)}addExcludedFeature(e){this.excludedFeature.add(e)}clearExcludedFeatures(){this.excludedFeature.clear()}addCustomSnappingFeature(e){this.customSnappingFeatures.add(e)}removeCustomSnappingFeature(e){this.customSnappingFeatures.delete(e)}clearCustomSnappingFeature(){this.customSnappingFeatures.clear()}setCustomSnappingCoordinates(e,r){this.customSnappingLngLats.set(e,r)}clearCustomSnappingCoordinates(e){this.customSnappingLngLats.delete(e)}getSnappedLngLat(e,r){let s=this.getCustomLngLatsSnapping(r);if(s)return s;const u=this.getFeaturesInPointBounds(r).filter(l=>!this.excludedFeature.has(l));return s=this.getFeaturePointsSnapping(u,e,r),s||(s=this.getFeatureLinesSnapping(u,e,r),s)?s:e}getCustomLngLatsSnapping(e){const r={distance:1/0,lngLat:null};return this.customSnappingLngLats.forEach(s=>{s.forEach(u=>{const l=this.gm.mapAdapter.project(u),f=Bs(e,l);f<this.tolerance&&f<r.distance&&(r.distance=f,r.lngLat=u)})}),r.lngLat}getFeaturePointsSnapping(e,r,s){let u=e.map(l=>({shape:l.shape,...this.getPointsSnapping(l,r,s)})).filter(l=>l.distance<this.tolerance);return u.length?(u=Ih(u,["distance"]),u[0].lngLat):null}getFeatureLinesSnapping(e,r,s){let u=e.filter(l=>this.lineSnappingShapes.includes(l.shape)).map(l=>{const f=this.shapeSnappingHandlers[l.shape];return f?{shape:l.shape,...f(l,r,s)}:null}).filter(l=>l!==null&&l.distance<this.tolerance);return u.length?(u=Ih(u,["distance"]),u[0].lngLat):null}getFeaturesInPointBounds(e){const r=[[e[0]-this.tolerance,e[1]-this.tolerance],[e[0]+this.tolerance,e[1]+this.tolerance]];return this.gm.features.getFeaturesByScreenBounds({bounds:r,sourceNames:[K.main,K.temporary]}).filter(s=>s.temporary?this.customSnappingFeatures.has(s):!0)||[]}getPointsSnapping(e,r,s){const u=e.getGeoJson(),l={distance:1/0,coord:null};return Ri(u,f=>{const h=this.gm.mapAdapter.project(f.coordinate),p=Bs(s,h);p<this.tolerance&&p<l.distance&&(l.distance=p,l.coord=f.coordinate)},!0),{lngLat:l.coord?l.coord:r,distance:l.distance}}getLineSnapping(e,r,s){const u=e.getGeoJson();return this.getNearestLinePointData(u,r,s)}getNearestLinePointData(e,r,s){const u={lngLat:r,distance:1/0},l=this.gm.mapAdapter.getEuclideanNearestLngLat(e,r),f=this.gm.mapAdapter.project(l);return u.distance=Bs(f,s),u.distance<this.tolerance&&(u.lngLat=l),u}}class qS extends gr{mode="zoom_to_features";eventHandlers={};onStartAction(){this.fitMapToFeatures(),setTimeout(()=>{this.gm.options.disableMode("helper","zoom_to_features")})}onEndAction(){}fitMapToFeatures(){const e=this.gm.features.asGeoJsonFeatureCollection({sourceNames:[K.main,...st?[K.standby]:[]]}),r=hg(e),s=[[r[0],r[1]],[r[2],r[3]]];try{this.gm.mapAdapter.fitBounds(s,{padding:20})}catch{ne.warn("Wrong bounds for zooming to features",s,e)}}}const Fo={shape_markers:lp,pin:null,snapping:zS,snap_guides:null,measurements:null,auto_trace:null,geofencing:null,zoom_to_features:qS,click_to_edit:null},YS=(t,e)=>Fo[e]?new Fo[e](t):(ne.error(`Helper "${e}" is not available`),null);class HS extends Ua{eventHandlers={[`${ae}:helper`]:this.handleHelperEvent.bind(this)};constructor(e,r){super(e),r.attachEvents(this.eventHandlers)}handleHelperEvent(e){if(!to(e))return{next:!0};const r=`${e.actionType}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){const s=YS(this.gm,r.mode);s&&(e in this.gm.actionInstances&&ne.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=s,s.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof gr?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}":`,r)}}class JS{gm;bus;listeners={};constructor(e){this.gm=e,this.bus=new cx(this.gm),this.listeners={draw:new Gk(this.gm,this.bus),edit:new US(this.gm,this.bus),helper:new HS(this.gm,this.bus),control:new hx(this.gm,this.bus)}}fire(e,r){this.listeners[r.actionType]||ne.error(`Can't find event listener for "${r.actionType}" event type`),this.bus.fireEvent(e,r)}}const cp=5e3;class $S{gm;updateStorage;autoUpdatesEnabled=!0;delayedSourceUpdateMethods;pendingUpdatePromises;constructor(e){this.gm=e,this.updateStorage=Object.fromEntries(al(K).map(r=>[r,[]])),this.pendingUpdatePromises={},this.delayedSourceUpdateMethods=Object.fromEntries(al(K).map(r=>[r,bh(()=>this.updateSourceActual(r),this.gm.options.settings.throttlingDelay)]))}updatesPending(e){return!!this.updateStorage[e]?.length||!!(this.pendingUpdatePromises[e]?.length??0)}getFeatureId(e){const r=e.properties?.[Pt]??e.id;return r==null&&console.warn("Feature id is null or undefined",e),r}updateSource({sourceName:e,diff:r}){r&&this.updateStorage[e].push(r),this.delayedSourceUpdateMethods[e]()}updateSourceActual(e){const r=this.gm.features.sources[e];if(this.autoUpdatesEnabled&&r){if(!r.loaded){setTimeout(()=>{this.updateSourceActual(e)},this.gm.options.settings.throttlingDelay);return}const s=this.getCombinedDiff(e);if(s){const u=r.updateData(s);this.addPendingPromise(e,u)}this.updateStorage[e].length>0&&setTimeout(()=>this.updateSourceActual(e),this.gm.options.settings.throttlingDelay)}}addPendingPromise(e,r){this.pendingUpdatePromises[e]||(this.pendingUpdatePromises[e]=[]),this.pendingUpdatePromises[e].push(r),r.finally(()=>{const s=this.pendingUpdatePromises[e];if(s){const u=s.indexOf(r);u!==-1&&s.splice(u,1),s.length===0&&delete this.pendingUpdatePromises[e]}})}async waitForPendingUpdates(e){const r=this.gm.features.sources[e];if(r){for(;this.updateStorage[e]?.length||this.pendingUpdatePromises[e]?.length;){if(this.updateStorage[e]?.length){const u=this.getCombinedDiff(e);if(u){const l=r.updateData(u);this.addPendingPromise(e,l)}}const s=this.pendingUpdatePromises[e];s?.length&&await Promise.all(s),await new Promise(u=>setTimeout(u,0))}await new Promise(s=>requestAnimationFrame(s))}}withAtomicSourcesUpdate(e){try{return this.autoUpdatesEnabled=!1,e()}finally{et(this.gm.features.sources).forEach(r=>{this.updateSource({sourceName:r})}),this.autoUpdatesEnabled=!0}}getCombinedDiff(e){let r={remove:[],add:[],update:[]};for(let s=0;s<cp&&this.updateStorage[e][s]!==void 0;s+=1)r=this.mergeGeoJsonDiff(r,this.updateStorage[e][s]);return this.updateStorage[e]=this.updateStorage[e].slice(cp),Object.values(r).find(s=>s.length)?r:null}mergeGeoJsonDiff(e,r){const s=e??{add:[],update:[],remove:[]},u=r??{add:[],update:[],remove:[]},l=new Set(u.remove),f=s.add?.filter(d=>!l.has(this.getFeatureId(d)))||[],h=s.update?.filter(d=>!l.has(this.getFeatureId(d)))||[],p=[];return u.update?.forEach(d=>{const v=f.findIndex(w=>this.getFeatureId(w)===this.getFeatureId(d)),_=h.findIndex(w=>this.getFeatureId(w)===this.getFeatureId(d));if(v===-1&&_===-1){p.push(d);return}v!==-1&&(f[v]=d),_!==-1&&(h[_]=d)}),{add:[...f,...u.add||[]],update:[...h,...p],remove:[...s.remove||[],...u.remove||[]]}}}class hp{isInstanceAvailable(){return this.sourceInstance?!0:(ne.error("Source instance is not available"),!1)}}class XS{gm;featureCounter=0;featureStore=new Map;featureStoreAllowedSources=[K.main,K.temporary];sources;defaultSourceName=K.main;updateManager;layers;constructor(e){this.gm=e,this.updateManager=new $S(e),this.sources=Object.fromEntries(al(K).map(r=>[r,null])),this.layers=[]}get forEach(){return this.filteredForEach(e=>!e.temporary)}get tmpForEach(){return this.filteredForEach(e=>e.temporary)}init(){if(Object.values(this.sources).some(e=>e!==null)){ne.warn("features.init(): features are already initialized");return}et(this.sources).forEach(e=>{this.sources[e]=this.createSource(e)}),this.hydrateFromExistingSources(),this.gm.options.settings.useDefaultLayers&&(this.layers=this.createLayers())}hydrateFromExistingSources(){let e=0;et(this.sources).forEach(r=>{const s=this.sources[r];if(s)try{const u=s.getGeoJson();if(u&&"features"in u)for(const l of u.features){const f=l.properties?.[Pt];if(!f)continue;if(typeof f=="string"&&f.startsWith("feature-")){const d=parseInt(f.replace("feature-",""),10);!isNaN(d)&&d>e&&(e=d)}if(this.featureStore.has(f))continue;const h=l,p=new Fi({gm:this.gm,id:f,parent:null,source:s,geoJsonShapeFeature:Ut(h),skipSourceUpdate:!0});this.featureStore.set(f,p)}}catch{}}),e>this.featureCounter&&(this.featureCounter=e)}getNewFeatureId(e){if(this.featureCounter+=1,this.gm.options.settings.idGenerator)return this.gm.options.settings.idGenerator(e);let r=`feature-${this.featureCounter}`;for(;this.featureStore.has(r);)this.featureCounter+=1,r=`feature-${this.featureCounter}`;return r}filteredForEach(e){return r=>{this.featureStore.forEach((s,u,l)=>{e(s)&&r(s,u,l)})}}has(e,r){const s=this.featureStore.get(r);return!!s&&s?.source===this.sources[e]}get(e,r){const s=this.featureStore.get(r)||null;return s?.source===this.sources[e]?s:null}add(e){if(this.featureStore.has(e.id)){ne.error(`features.add: feature with the id "${e.id}" already exists`);return}this.featureStoreAllowedSources.includes(e.source.id)&&this.featureStore.set(e.id,e)}setDefaultSourceName(e){this.defaultSourceName=e}createSource(e){const r=this.gm.mapAdapter.addSource(e,{type:"FeatureCollection",features:[]});if(r)return r;throw new Error(`Features: failed to create the source: "${e}"`)}delete(e){let r;e instanceof Fi?r=e:r=this.featureStore.get(e)||null,r?(this.featureStore.delete(r.id),r.delete()):ne.error(`features.delete: feature "${e}" not found`)}deleteAll(){this.featureStore.forEach(e=>{e.delete()}),this.featureStore.clear()}getFeatureByMouseEvent({event:e,sourceNames:r}){if(!Xe(e,{warning:!0}))return null;const s=[e.point.x,e.point.y],u=this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:s,sourceNames:r});return u.length?u[0]:null}getFeaturesByGeoJsonBounds({geoJson:e,sourceNames:r}){const s=El(e),u=this.gm.mapAdapter.coordBoundsToScreenBounds(s);return this.getFeaturesByScreenBounds({bounds:u,sourceNames:r})}getFeaturesByScreenBounds({bounds:e,sourceNames:r}){return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:e,sourceNames:r})}createFeature({featureId:e,shapeGeoJson:r,parent:s,sourceName:u,imported:l}){const f=this.sources[u];if(!f)return ne.error("Features.createFeature Missing source for feature creation"),null;const h=e??r.properties[Pt]??this.getNewFeatureId(r);if(this.featureStore.get(h))return ne.error(`Features.createFeature: feature with the id "${h}" already exists`,this.featureStore.get(h)),null;const p=new Fi({gm:this.gm,id:h,parent:s||null,source:f,geoJsonShapeFeature:Ut(r)});return this.add(p),!p.temporary&&!l&&this.fireFeatureCreatedEvent(p),this.featureCounter+=1,p}importGeoJson(e,r){const s=r??{},u="features"in e?e.features:[e],l={stats:{total:0,success:0,failed:0,overwritten:0},addedFeatures:[]};return u.forEach(f=>{let h=null;l.stats.total+=1;const p=F2(f);if(p){if(s.idPropertyName){const d=G2(p,s.idPropertyName);d&&(p.id=d)}if(s.overwrite){const d=p.id??p.properties?.[Pt];d&&this.featureStore.has(d)&&(this.delete(d),l.stats.overwritten+=1)}h=this.importGeoJsonFeature(p)}h?(l.addedFeatures.push(h),l.stats.success+=1):l.stats.failed+=1}),l}importGeoJsonFeature(e){const r=this.defaultSourceName,s=this.getFeatureShapeByGeoJson(e);return s?this.createFeature({featureId:e.id,shapeGeoJson:e,sourceName:r,imported:!0}):(ne.error("features.addGeoJsonFeature: unknown shape",s),null)}getAll(){return this.exportGeoJson()}exportGeoJson({allowedShapes:e,idPropertyName:r}={allowedShapes:void 0}){return this.asGeoJsonFeatureCollection({sourceNames:[K.main,...st?[K.standby]:[]],shapeTypes:e||[...Rn],idPropertyName:r,useMapLibreSource:!1})}exportGeoJsonFromSource({allowedShapes:e,idPropertyName:r}={allowedShapes:void 0}){return this.asGeoJsonFeatureCollection({sourceNames:[K.main,...st?[K.standby]:[]],shapeTypes:e||[...Rn],idPropertyName:r,useMapLibreSource:!0})}asGeoJsonFeatureCollection({shapeTypes:e,sourceNames:r,idPropertyName:s,useMapLibreSource:u=!1}){const l={type:"FeatureCollection",features:[]};return s??=Pt,r.forEach(f=>{const h=this.sources[f];h&&(u?h.getGeoJson():h.getGmGeoJson()).features.filter(d=>!!d).forEach(d=>{const v=this.get(f,d.id);if(!v)return;const _=d.properties[Pt];s!==Pt&&(d.properties[s]=_,delete d.properties[Pt]),(e===void 0||e.includes(v.shape))&&l.features.push({...d,id:_})})}),l}convertSourceToGm(e){const r=[],s=e.getGeoJson(),u="features"in s?s.features:[s];return this.gm.mapAdapter.getSource(e.id).remove(),u.forEach(f=>{const h=this.addGeoJsonFeature({shapeGeoJson:f,defaultSource:!0});h&&r.push(h)}),r}addGeoJsonFeature({shapeGeoJson:e,sourceName:r,defaultSource:s}){let u;if(s?(u=this.defaultSourceName,r&&ne.warn("features.addGeoJsonFeature: default source is set, sourceName is ignored")):u=r||null,!u)return ne.error("features.addGeoJsonFeature: missing sourceName"),null;const l=this.getFeatureShapeByGeoJson(e);return l?this.createFeature({featureId:e.id,shapeGeoJson:{...e,properties:{...e.properties,shape:l}},sourceName:u}):(ne.error("features.addGeoJsonFeature: unknown shape",l),null)}createLayers(){const e=[];return et(this.sources).forEach(r=>{et(this.gm.options.layerStyles).forEach(s=>{this.gm.options.layerStyles[s][r].forEach(l=>{const f=this.createGenericLayer({sourceName:r,shapeNames:[s],partialStyle:l});f&&e.push(f)})})}),e}createGenericLayer({sourceName:e,shapeNames:r,partialStyle:s}){const u=this.getGenericLayerName({sourceName:e,shapeNames:r,partialStyle:s});if(!u)throw new Error(`Can't create a layer, for ${{sourceName:e,shapeNames:r,partialStyle:s}}`);const l={...s,id:u,source:e,filter:["in",["get",`${gt}shape`],["literal",r]]};return this.gm.mapAdapter.addLayer(l)}getGenericLayerName({sourceName:e,shapeNames:r,partialStyle:s}){const l=r.length===1?r[0]:"mixed",f=p=>`${e}-${l}__${s.type}-layer-${p}`;let h=null;for(let p=0;p<100;p+=1){const d=f(p);if(!this.gm.mapAdapter.getLayer(d))return h=d,h}return null}getFeatureShapeByGeoJson(e){const r={Point:"marker",LineString:"line",MultiLineString:"line",Polygon:"polygon",MultiPolygon:"polygon"},s=e.properties;return s?.shape&&Rn.includes(s?.shape)?s?.shape:r[e.geometry.type]||null}createMarkerFeature({parentFeature:e,coordinate:r,type:s,sourceName:u}){return this.createFeature({sourceName:u,parent:e,shapeGeoJson:{type:"Feature",geometry:{type:"Point",coordinates:r},properties:{[`${gt}shape`]:`${s}_marker`}}})}updateMarkerFeaturePosition(e,r){e.updateGeoJsonGeometry({type:"Point",coordinates:r})}fireFeatureCreatedEvent(e){if(cr(e.shape,Rn)){const r={name:`${ae}:draw:feature_created`,level:"system",actionType:"draw",mode:e.shape,action:"feature_created",featureData:e};this.gm.events.fire(`${ae}:draw`,r)}}}class fp{getEuclideanNearestLngLat(e,r){const s=this.project(r);let u=[0,0],l=1/0;return ja(e,f=>{const h=this.project(f.start.coordinate),p=this.project(f.end.coordinate),d=Lg(h,p,s),v=Bs(s,d);v<l&&(l=v,u=[d[0],d[1]])}),this.unproject(u)}getDistance(e,r){return xg(e,r,{units:"meters"})}}class gp{isInstanceAvailable(){return this.layerInstance?!0:(ne.error("layerInstance is not available"),!1)}}class Ql extends gp{gm;layerInstance=null;mapInstance;constructor({gm:e,layerId:r,options:s}){super(),this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,s?this.layerInstance=this.createLayer(s):this.layerInstance=this.mapInstance.getLayer(r)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.id}get source(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.source}createLayer(e){let r=this.mapInstance.getLayer(e.id);return r?ne.warn(`Layer "${e.id}" already exists, skipping`):(this.mapInstance.addLayer(e),r=this.mapInstance.getLayer(e.id)),r??null}remove(){this.isInstanceAvailable()&&this.mapInstance.removeLayer(this.id),this.layerInstance=null}}class VS extends za{markerInstance;constructor({mapInstance:e,options:r,lngLat:s}){super(),this.markerInstance=new Ur.Marker(r).setLngLat(s).addTo(e)}getElement(){return this.isMarkerInstanceAvailable()&&this.markerInstance?.getElement()||null}setLngLat(e){this.isMarkerInstanceAvailable()&&this.markerInstance?.setLngLat(e)}getLngLat(){return this.isMarkerInstanceAvailable()?this.markerInstance?.getLngLat().toArray()||[0,0]:[0,0]}remove(){this.markerInstance?.remove()}}class dp{isInstanceAvailable(){return this.popupInstance?!0:(ne.error("Popup instance is not available"),!1)}}class WS extends dp{popupInstance;constructor({mapInstance:e,options:r,lngLat:s}){super(),this.popupInstance=new Ur.Popup(r).addTo(e),s&&this.setLngLat(s)}getLngLat(){return this.isInstanceAvailable()?this.popupInstance.getLngLat().toArray()||[0,0]:[0,0]}setLngLat(e){this.isInstanceAvailable()&&this.popupInstance.setLngLat(e)}setHtml(e){this.isInstanceAvailable()&&this.popupInstance.setHTML(e)}remove(){this.isInstanceAvailable()&&this.popupInstance.remove()}}class pp extends hp{gm;mapInstance;sourceInstance;constructor({gm:e,geoJson:r,sourceId:s}){super(),this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,r?this.sourceInstance=this.createSource({geoJson:r,sourceId:s}):this.sourceInstance=this.mapInstance.getSource(s)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.id}get loaded(){return this.mapInstance.isSourceLoaded(this.id)}createSource({geoJson:e,sourceId:r}){let s=this.mapInstance.getSource(r);return s?ne.warn(`Source "${s.id}" already exists, skipping`):(this.mapInstance.addSource(r,{type:"geojson",data:e,promoteId:Pt}),s=this.mapInstance.getSource(r)),s??null}getGeoJson(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.serialize().data}getGmGeoJson(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");const e={type:"FeatureCollection",features:[]};return this.gm.features.filteredForEach(s=>s.source.id===this.sourceInstance?.id)(s=>{Rn.includes(s.shape)&&e.features.push(s.getGeoJson())}),e}async setData(e){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");await this.sourceInstance.setData(e,!0)}async updateData(e){if(!this.isInstanceAvailable())return;const r=this.convertUniversalDiffToMlDiff(e);await this.sourceInstance.updateData(r,!0)}convertUniversalDiffToMlDiff(e){return{add:e.add?.map(this.sanitizeFeatureForAdd.bind(this)),update:e.update?.map(this.convertFeatureToMlUpdateDiff.bind(this)),remove:e.remove}}sanitizeFeatureForAdd(e){if(!e.properties)return e;const r={};for(const[s,u]of Object.entries(e.properties))u!==void 0&&(r[s]=u);return{...e,properties:r}}convertFeatureToMlUpdateDiff(e){const r=[],s=[];return Object.entries(e.properties||{}).forEach(([u,l])=>{l===void 0?s.push(u):r.push({key:u,value:l})}),{id:e.properties?.[Pt],newGeometry:e.geometry,addOrUpdateProperties:r,removeProperties:s}}remove(){this.isInstanceAvailable()&&(this.gm.mapAdapter.eachLayer(e=>{e.source===this.sourceInstance.id&&this.gm.mapAdapter.removeLayer(e.id)}),this.mapInstance.removeSource(this.sourceInstance.id))}}const jS=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"],ec=t=>jS.includes(t);class ZS extends fp{gm;mapType="maplibre";mapInstance;constructor(e,r){super(),this.gm=r,this.mapInstance=e}getMapInstance(){return this.mapInstance}isLoaded(){return this.mapInstance._loaded}getContainer(){return this.mapInstance.getContainer()}getCanvas(){return this.mapInstance.getCanvas()}addControl(e){this.mapInstance.addControl(e)}removeControl(e){this.mapInstance.removeControl(e)}async loadImage({id:e,image:r}){if(!this.mapInstance.hasImage(e)){const s=await this.mapInstance.loadImage(r);this.mapInstance.addImage(e,s.data)}}removeImage(e){try{this.mapInstance.hasImage(e)&&this.mapInstance.removeImage(e)}catch{}}getBounds(){return this.mapInstance.getBounds().toArray()}fitBounds(e,r){this.mapInstance.fitBounds(e,r)}setCursor(e){this.mapInstance.getCanvas().style.cursor=e}disableMapInteractions(e){e.forEach(r=>{this.mapInstance[r].disable()})}enableMapInteractions(e){e.forEach(r=>{this.mapInstance[r].enable()})}setDragPan(e){e?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()}queryFeaturesByScreenCoordinates({queryCoordinates:e=void 0,sourceNames:r}){return Th(this.mapInstance.queryRenderedFeatures(e).map(u=>({featureId:u.properties[Pt],featureSourceName:u.source})),ki).map(({featureId:u,featureSourceName:l})=>u===void 0||!r.includes(l)?null:this.gm.features.get(l,u)||null).filter(u=>!!u)}queryGeoJsonFeatures({queryCoordinates:e=void 0,sourceNames:r}){const s=(l,f)=>l?.id===f?.id;return Th(this.mapInstance.queryRenderedFeatures(e).map(l=>{const f=this.convertToGeoJsonImportFeature(l);return f?{id:l.properties[Pt],sourceName:l.source,geoJson:f}:null}),s).filter(l=>!!l&&l.id!==void 0&&l.geoJson&&r.includes(l.sourceName))}convertToGeoJsonImportFeature(e){const r=e.properties[Pt];return r===void 0||e.geometry.type==="GeometryCollection"?null:{id:r,type:"Feature",properties:e.properties,geometry:e.geometry}}addSource(e,r){return new pp({gm:this.gm,sourceId:e,geoJson:r})}getSource(e){return new pp({gm:this.gm,sourceId:e})}addLayer(e){const r=e.id;return new Ql({gm:this.gm,layerId:r,options:e})}getLayer(e){return this.mapInstance.getLayer(e)?new Ql({gm:this.gm,layerId:e}):null}removeLayer(e){const r=this.getLayer(e);r&&r.remove()}eachLayer(e){this.mapInstance.getStyle().layers.forEach(r=>{e(new Ql({gm:this.gm,layerId:r.id}))})}createDomMarker(e,r){return new VS({mapInstance:this.mapInstance,options:e,lngLat:r})}createPopup(e,r){return new WS({mapInstance:this.mapInstance,options:e,lngLat:r})}project(e){const r=this.mapInstance.project(e);return[r.x,r.y]}unproject(e){const r=this.mapInstance.unproject(e);return[r.lng,r.lat]}coordBoundsToScreenBounds(e){const r=new Ur.LngLatBounds(e),s=this.project(r.getSouthWest().toArray()),u=this.project(r.getNorthEast().toArray());return[s,u]}fire(e,r){this.mapInstance.fire(e,r)}on(e,r,s){if(typeof r=="string"&&s&&ec(e))this.mapInstance.on(e,r,s);else if(typeof r=="function")this.mapInstance.on(e,r);else throw new Error("Invalid arguments passed to 'on' method")}once(e,r,s){if(typeof r=="string"&&s&&ec(e))this.mapInstance.once(e,r,s);else if(typeof r=="function")this.mapInstance.once(e,r);else throw new Error("Invalid arguments passed to 'once' method.")}off(e,r,s){if(typeof r=="string"&&s&&ec(e))this.mapInstance.off(e,r,s);else if(typeof r=="function")this.mapInstance.off(e,r);else throw new Error("Invalid arguments passed to 'off' method")}}const KS=(t,e)=>new ZS(e,t),mp=(t,e)=>{if(!Array.isArray(t)||!Array.isArray(e))return;if(e.some(u=>!Wx(u))){ne.warn("Wrong partial layer detected for layer styles");return}const r=x1(t,"type"),s=o1(e,"type");if(Object.values(s).some(u=>u>1))throw new Error('Multiple layers for the same shape are detected. Use "useDefaultLayers: false" and define layers manually.');return e.forEach(u=>{r[u.type]?k1(r[u.type],u):r[u.type]=Ut(u)}),v1(r)};class vp{gm;settings;controls;layerStyles;constructor(e,r){this.gm=e;const s=this.getMergedOptions(r);this.settings=s.settings,this.controls=s.controls,this.layerStyles=s.layerStyles}getMergedOptions(e={}){const r=Tu();return typeof e.settings?.controlsUiEnabledByDefault=="boolean"&&(r.settings.controlsUiEnabledByDefault=e.settings.controlsUiEnabledByDefault),B1(r),g1(r,e,mp)}enableMode(e,r){const s=this.isModeEnabled(e,r),u=this.isModeAvailable(e,r);if(u||ne.warn(`Unable to enable mode, "${e}:${r}" is not available`),s||!u)return;const f=this.controls[e][r];f?(f.active=!0,this.fireModeEvent(e,r,"mode_start"),this.fireControlEvent(e,r,"on"),this.fireModeEvent(e,r,"mode_started")):ne.error("Can't find control section for",e,r)}disableMode(e,r){const s=this.isModeEnabled(e,r),u=this.isModeAvailable(e,r);if(!s||!u)return;const f=this.controls[e][r];f?(f.active=!1,this.fireModeEvent(e,r,"mode_end"),this.fireControlEvent(e,r,"off"),this.fireModeEvent(e,r,"mode_ended")):ne.error("Can't find control section for",e,r)}syncModeState(e,r){const u=this.controls[e][r],l=this.isModeAvailable(e,r);u&&(l?u.active?this.enableMode(e,r):this.disableMode(e,r):(console.log(`Not available mode: ${e}:${r}`),u.active=!1,u.uiEnabled=!1))}toggleMode(e,r){this.isModeEnabled(e,r)?this.disableMode(e,r):this.enableMode(e,r)}isModeEnabled(e,r){return!!Object.entries(this.gm.actionInstances).find(([s,u])=>s===`${e}__${r}`&&u)}isModeAvailable(e,r){return e==="draw"&&cr(r,ul)?!!this.gm.drawClassMap[r]:e==="edit"&&cr(r,cl)?!!this.gm.editClassMap[r]:e==="helper"&&cr(r,ll)?!!this.gm.helperClassMap[r]:!1}getControlOptions({modeType:e,modeName:r}){return e&&r&&this.controls[e][r]||null}fireModeEvent(e,r,s){const u={name:`${ae}:${r}:mode`,level:"system",actionType:e,mode:r,action:s};Go(u)&&(ro(u)?this.gm.events.fire(`${ae}:${e}`,u):ni(u)?this.gm.events.fire(`${ae}:${e}`,u):to(u)?this.gm.events.fire(`${ae}:${e}`,u):ne.warn("Unknown mode event: ",u))}fireControlEvent(e,r,s){const u={name:`${ae}:control:switch`,level:"system",actionType:"control",section:e,mode:r,action:s};this.gm.events.fire(`${ae}:control`,u)}}class yp{gm;marker=null;tmpMarker=null;snapping=!1;oldSnapping=void 0;constructor(e){this.gm=e,this.initEventHandlers()}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}initEventHandlers(){this.throttledMethods=Nr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay),this.eventHandlers={mousemove:this.throttledMethods.onMouseMove.bind(this)}}setSnapping(e){if(e&&!this.snappingHelper){ne.error("MarkerPointer: snapping is not available");return}this.snapping=e}pauseSnapping(){this.oldSnapping!==void 0&&ne.error("MarkerPointer: snapping is already paused"),this.oldSnapping=this.snapping,this.setSnapping(!1)}resumeSnapping(){this.oldSnapping===void 0?(ne.error("MarkerPointer: resumeSnapping is called before pauseSnapping"),this.setSnapping(!0)):(this.setSnapping(this.oldSnapping),this.oldSnapping=void 0)}enable({lngLat:e,customMarker:r,invisibleMarker:s}={lngLat:[0,0],customMarker:void 0,invisibleMarker:!1}){if(!Yx()){if(r&&s)throw new Error("MarkerPointer: customMarker and invisibleMarker can't be used together");if(this.marker)throw new Error("MarkerPointer: marker is already enabled");this.gm.events.bus.attachEvents(this.eventHandlers),s?this.marker=this.createInvisibleMarker(e||[0,0]):this.marker=r||this.createMarker(e||[0,0]),this.gm.getActiveDrawModes().length&&this.gm.mapAdapter.setCursor("crosshair")}}disable(){this.marker&&(this.gm.events.bus.detachEvents(this.eventHandlers),this.marker.remove(),this.marker=null),this.gm.mapAdapter.setCursor("")}createMarker(e=[0,0]){return this.gm.mapAdapter.createDomMarker({anchor:"center",element:this.gm.createSvgMarkerElement("control",{pointerEvents:"none"})},e)}createInvisibleMarker(e=[0,0]){const r=document.createElement("div");return r.style.width="0px",r.style.height="0px",this.gm.mapAdapter.createDomMarker({anchor:"center",element:r},e)}onMouseMove(e){if(Xe(e,{warning:!0})&&this.marker)if(this.snapping&&this.snappingHelper){const r=[e.point.x,e.point.y],s=this.snappingHelper.getSnappedLngLat(e.lngLat.toArray(),r);this.marker.setLngLat(s)}else this.marker.setLngLat(e.lngLat.toArray());return{next:!0}}syncTmpMarker(e){this.tmpMarker||(this.tmpMarker=this.createMarker(e)),this.tmpMarker.setLngLat(e)}}const QS={type:"Feature",properties:{shape:"polygon"},geometry:{type:"MultiPolygon",coordinates:[[[[4,51.2],[5.4,52.4],[6.8,51.2],[4,51.2]]]]}},eM={type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[-.47,51.67],[1.43,51.67],[1.43,53.32],[-.47,53.32],[-.47,51.67]]]}},tM=t=>tn(t)&&t.name===`${ae}:feature:before_create`,nM=t=>tn(t)&&t.name===`${ae}:feature:before_update`,rM=["mode_start","mode_started","mode_end","mode_ended"],Go=t=>tn(t)&&cr(t.action,rM),_p=t=>t.length>0;function iM(t,e={}){const r=[];if(Lr(t,u=>{r.push(u.coordinates)}),r.length<2)throw new Error("Must have at least 2 geometries");const s=gS(r[0],...r.slice(1));return s.length===0?null:s.length===1?hr(s[0],e.properties):fl(s,e.properties)}var sM=iM;class aM extends ri{features=[];featureData=null;eventHandlers={click:this.onMouseClick.bind(this)};onStartAction(){}onEndAction(){this.features.forEach(e=>{e.changeSource({sourceName:K.main,atomic:!0})}),this.features=[]}onMouseClick(e){if(!Xe(e))return{next:!0};if(this.unselectFeature(e))return{next:!0};const s=this.getAllowedFeatureByMouseEvent({event:e,sourceNames:[K.main]});return s&&this.isFeatureAllowedToGroup(s)&&(s.changeSource({sourceName:K.temporary,atomic:!0}),this.features.push(s)),this.features.length>1?(this.groupFeatures(),{next:!0}):{next:!0}}unselectFeature(e){const r=this.getAllowedFeatureByMouseEvent({event:e,sourceNames:[K.temporary]});if(r){const s=this.features.findIndex(u=>u===r);return s>-1&&this.features.splice(s,1),r.changeSource({sourceName:K.main,atomic:!0}),!0}return!1}getAllowedFeatureByMouseEvent({event:e,sourceNames:r}){const s=this.getFeatureByMouseEvent({event:e,sourceNames:r});return s&&this.allowedShapeTypes.includes(s.shape)?s:null}isFeatureAllowedToGroup(e){if(!this.allowedShapeTypes.includes(e.shape))return!1;if(this.features.length===0)return!0;const r=e.getGeoJson();return this.features.every(s=>Hd(s.getGeoJson(),r))}groupFeatures(){if(!this.features.length){ne.error("BaseGroupEdit.groupFeatures: no features to group");return}const e={type:"FeatureCollection",features:this.features.map(s=>{const u=s.getGeoJson();return["Polygon","MultiPolygon"].includes(u.geometry.type)?u:null}).filter(s=>!!s)};let r=null;if(this.mode==="union"?r=sM(e):this.mode==="difference"&&(r=tp(e)),r){const s=this.gm.features.createFeature({shapeGeoJson:{...r,properties:{...r.properties,shape:"polygon"}},sourceName:K.main});this.features.forEach(u=>{this.gm.features.delete(u)}),s&&_p(this.features)&&this.fireFeatureUpdatedEvent({sourceFeatures:this.features,targetFeatures:[s]}),this.features=[]}}}class Ep{mapAdapterInstance=null;globalLngLatBounds=this.getGlobalLngLatBounds();features;loaded=!1;destroyed=!1;options;events;control;actionInstances={};markerPointer;constructor(e,r={}){this.options=this.initCoreOptions(r),this.events=this.initCoreEvents(),this.features=this.initCoreFeatures(),this.control=this.initCoreControls(),this.markerPointer=this.initMarkerPointer();const s=Object.assign(e,{gm:this});this.mapAdapterInstance=KS(this,s),this.waitForBaseMap().then(this.init.bind(this)).catch(u=>{ne.error("Geoman initialization failed:",u),this.destroy()})}get drawClassMap(){return uo}get editClassMap(){return Do}get helperClassMap(){return Fo}get mapAdapter(){if(this.mapAdapterInstance)return this.mapAdapterInstance;throw ne.trace("Map adapter is not initialized"),new Error("Map adapter is not initialized")}initCoreOptions(e={}){return new vp(this,e)}initCoreEvents(){return new JS(this)}initCoreFeatures(){return new XS(this)}initCoreControls(){return new ox(this)}initMarkerPointer(){return new yp(this)}addControls(e=void 0){return new Promise(r=>{(async()=>{e?this.control.createControls(e):this.mapAdapter.addControl(this.control),await this.onMapLoad(),r()})().then()})}async waitForBaseMap(){const e=this.mapAdapter.mapInstance;if(!Dg(e)){ne.error('Map instance does not have a "once" method',e);return}return this.mapAdapter.isLoaded()||await Og(new Promise(r=>{const s=()=>r(e);e.once("load",s),this.mapAdapter.isLoaded()&&(e.off("load",s),r(e))}),"waitForBaseMap failed"),e}async waitForGeomanLoaded(){if(this.loaded)return this;if(this.destroyed)return;const e=await this.waitForBaseMap();if(!e){ne.error("Map instance is not available",e);return}const r=`${it}:loaded`;return await Og(new Promise(s=>{const u=()=>s(this);e.once(r,u),this.loaded&&(e.off(r,u),s(this))}),"waitForGeomanLoaded failed"),this}async init(){this.destroyed||(this.features.init(),!this.destroyed&&await this.addControls())}async destroy({removeSources:e}={removeSources:!1}){if(this.destroyed=!0,this.mapAdapterInstance&&"gm"in this.mapAdapterInstance.mapInstance&&delete this.mapAdapterInstance.mapInstance.gm,this.loaded?(this.removeControls(),this.mapAdapter.removeImage("default-marker")):this.events.bus.detachAllEvents(),e)for(const r of Object.values(this.features.sources))r&&r.remove()}removeControls(){this.disableAllModes(),this.mapAdapter.removeControl(this.control)}async onMapLoad(){if(this.loaded||this.destroyed||(await this.mapAdapter.loadImage({id:"default-marker",image:am}),this.destroyed))return;const e={name:`${ae}:control:load`,level:"system",actionType:"control",action:"loaded"};this.events.fire(`${ae}:control`,e),this.loaded=!0}disableAllModes(){et(this.actionInstances).forEach(e=>{const[r,s]=e.split("__");Dk(r)&&Kg(s)&&this.options.disableMode(r,s)})}getActiveDrawModes(){return et(this.actionInstances).map(e=>{const r=this.actionInstances[e];return r instanceof Fn?r.mode:null}).filter(e=>e!==null)}getActiveEditModes(){return et(this.actionInstances).map(e=>{const r=this.actionInstances[e];return r instanceof ri?r.mode:null}).filter(e=>e!==null)}getActiveHelperModes(){return et(this.actionInstances).map(e=>{const r=this.actionInstances[e];return r instanceof gr?r.mode:null}).filter(e=>e!==null)}getGlobalLngLatBounds(){const e=85.051129;return[[-179.99999,-e],[179.99999,e]]}setGlobalEventsListener(e=null){this.events.bus.forwarder.globalEventsListener=e}createSvgMarkerElement(e,r=void 0){const s=this.options.settings.markerIcons;s[e]||ne.error(`createMarkerElement: marker type "${e}" not found`);const u=document.createElement("div");u.classList.add("marker-wrapper"),u.style.lineHeight="0",u.innerHTML=s[e]||"NO_ICON";const l=u.firstChild;if(typeof l!="object")throw ne.error(`createMarkerElement: no icon "${e}" found`),new Error(`No icon "${e}" found`);return r&&Object.assign(l.style,r),u}enableMode(e,r){this.options.enableMode(e,r)}disableMode(e,r){this.options.disableMode(e,r)}toggleMode(e,r){this.options.toggleMode(e,r)}isModeEnabled(e,r){return this.options.isModeEnabled(e,r)}enableDraw(e){this.options.enableMode("draw",e)}disableDraw(){this.getActiveDrawModes().forEach(e=>this.options.disableMode("draw",e))}toggleDraw(e){this.options.toggleMode("draw",e)}drawEnabled(e){return this.options.isModeEnabled("draw",e)}enableGlobalDragMode(){this.options.enableMode("edit","drag")}disableGlobalDragMode(){this.options.disableMode("edit","drag")}toggleGlobalDragMode(){this.options.toggleMode("edit","drag")}globalDragModeEnabled(){return this.options.isModeEnabled("edit","drag")}enableGlobalEditMode(){this.options.enableMode("edit","change")}disableGlobalEditMode(){this.options.disableMode("edit","change")}toggleGlobalEditMode(){this.options.toggleMode("edit","change")}globalEditModeEnabled(){return this.options.isModeEnabled("edit","change")}enableGlobalRotateMode(){this.options.enableMode("edit","rotate")}disableGlobalRotateMode(){this.options.disableMode("edit","rotate")}toggleGlobalRotateMode(){this.options.toggleMode("edit","rotate")}globalRotateModeEnabled(){return this.options.isModeEnabled("edit","rotate")}enableGlobalCutMode(){this.options.enableMode("edit","cut")}disableGlobalCutMode(){this.options.disableMode("edit","cut")}toggleGlobalCutMode(){this.options.toggleMode("edit","cut")}globalCutModeEnabled(){return this.options.isModeEnabled("edit","cut")}enableGlobalRemovalMode(){this.options.enableMode("edit","delete")}disableGlobalRemovalMode(){this.options.disableMode("edit","delete")}toggleGlobalRemovalMode(){this.options.toggleMode("edit","delete")}globalRemovalModeEnabled(){return this.options.isModeEnabled("edit","delete")}}const oM=async(t,e)=>{const r=new Ep(t,e);if(!await r.waitForGeomanLoaded()||r.destroyed)throw new Error("Geoman initialization failed");return r};te.BaseAction=no,te.BaseDomMarker=za,te.BaseDrag=bo,te.BaseDraw=Fn,te.BaseEdit=ri,te.BaseGroupEdit=aM,te.BaseHelper=gr,te.BaseLayer=gp,te.BaseMapAdapter=fp,te.BasePopup=dp,te.BaseSource=hp,te.DRAW_MODES=ul,te.EDIT_MODES=cl,te.EXTRA_DRAW_MODES=ug,te.FEATURE_ID_PROPERTY=Pt,te.FEATURE_PROPERTY_PREFIX=gt,te.FeatureData=Fi,te.GM_PREFIX=it,te.Geoman=Ep,te.GmOptions=vp,te.HELPER_MODES=ll,te.IS_PRO=st,te.LineDrawer=io,te.MarkerPointer=yp,te.SHAPE_NAMES=Rn,te.SOURCES=K,te.ShapeMarkersHelper=lp,te.boundsContains=Cx,te.boundsToBBox=Ag,te.calculatePerimeter=Fx,te.controlIcons=vt,te.convertToLineStringFeatureCollection=Gx,te.convertToThrottled=Nr,te.createGeomanInstance=oM,te.customShapeRectangle=eM,te.customShapeTriangle=QS,te.defaultLayerStyles=yc,te.drawClassMap=uo,te.eachCoordinateWithPath=Ri,te.eachSegmentWithPath=ja,te.editClassMap=Do,te.findCoordinateWithPath=Tg,te.formatArea=z2,te.formatDistance=U2,te.geoJsonPointToLngLat=Ka,te.getEuclideanDistance=Bs,te.getEuclideanSegmentNearestPoint=Lg,te.getGeoJsonCoordinatesCount=Qa,te.getGeoJsonFirstPoint=xl,te.getLngLatDiff=Va,te.helperClassMap=Fo,te.includesWithType=cr,te.isActionType=Fk,te.isBaseMapEventName=Xx,te.isDrawModeName=Wg,te.isEditModeName=jg,te.isEqualPosition=yl,te.isGeoJsonFeatureInPolygon=js,te.isGmControlEvent=ol,te.isGmDrawEvent=ro,te.isGmDrawFreehandDrawerEvent=zx,te.isGmDrawLineDrawerEvent=Ml,te.isGmDrawShapeEvent=Sl,te.isGmEditEvent=ni,te.isGmEvent=tn,te.isGmFeatureBeforeCreateEvent=tM,te.isGmFeatureBeforeUpdateEvent=nM,te.isGmHelperEvent=to,te.isGmModeEvent=Go,te.isHelperModeName=Zg,te.isMapPointerEvent=Xe,te.isMapWithOnceMethod=Dg,te.isModeName=Kg,te.isMultiPolygonFeature=Xa,te.isNonEmptyArray=_p,te.isPointerEventName=$x,te.isPolygonFeature=$a,te.lngLatToGeoJsonPoint=Cg,te.mergeByTypeCustomizer=mp,te.moveFeatureData=R2,te.moveGeoJson=Gd,te.toMod=zd,te.twoCoordsToLineString=Ax,te.typedKeys=et,Object.defineProperty(te,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=maplibre-geoman.umd.js.map
